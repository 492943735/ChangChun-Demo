var fusiongis=function(e){function t(r){if(a[r])return a[r].exports;var o=a[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var a={};return t.m=e,t.c=a,t.p="./build",t(0)}([function(e,t,a){var r=a(1),o=a(2),n=a(45),l=r.extend({},o,n),i=a(5),s=a(46),d=r.extend({},i,s);e.exports={Constant:a(7),Algorithm:a(47),AdminRegion:a(48),BaseLayer:d,BLayerManager:a(27),BubbleCircle:a(49),Bubble:a(50),GradientCircle:a(51),Cell:a(52),Chart:a(53),Curve:a(54),FigTense:a(55),GridDensity:a(56),HeatMap:a(57),Highlight:a(31),Icon:a(58),Icon2Label:a(59),InfoPop:a(60),ImageFilter:a(61),Line:a(62),LayerManager:a(64),LegendRange:a(66),LegendSlider:a(67),PointCluster:a(68),Radar:a(69),RenderShadowArea:a(70),SetVectorLayerData:a(46),TrackShow:a(71),ConvergeCell:a(72),ConvergeGrid:a(73),Legend:l,Grid:a(37),BCell:a(35),BsiteAndCell:a(74),BSite:a(36),BLine:a(41),CirclePoint:a(33),Point:a(30),Polygon:a(75),ServicePoint:a(39),ServiceLine:a(40),ServicePolygon:a(38),VectorPolygon:a(34),DGrid:a(76),DBCell:a(77),DBSite:a(78),DServicePoint:a(43),DServiceLine:a(44),DServicePolygon:a(42),Render:a(79),RenderToken:a(80),Events:a(11),Map:a(8),AcrossLine:a(17),GStreetView:a(81),Overlay:a(12),Drag:a(82),Popup:a(9),Measure:a(83),MeasureAngle:a(86),Geometry:a(87),Search:a(88),SearchObject:a(89),Graticule:a(90),SelectMode:a(91),Migration:a(92),BubbleLine:a(93),PolygonQuery:a(94),InterSectPolygons:a(95),ShowPolygonCenterIcon:a(96),ThiessenPolygon:a(97),ContributionPlotOnLine:a(98),LineStraight:a(99),LineAdd:a(100),PolygonBezier:a(101),UnChangePolygon:a(102),Util:r,DomUtil:a(10),OlUtil:a(32),I18n:a(13),ImageUtil:a(103),OriginalAjax:a(14),ExportUI:a(104),DragZoomInteraction:a(108),GPSNavigation:a(109),HashMap:a(4),RenderGeometry:a(110),CustomQuery:a(111),Transform:a(112),SearchUI:a(113),ServiceHeatMap:a(114),Union:a(115),Intersect:a(116),Difference:a(117),SecondaryMesh:a(118),IntersectSelf:a(119),AnalysisGeoJson:a(120),Buffer:a(121),Drag:a(82),XYZLayer:a(122),PreLoad:a(123)}},function(e,t){function a(e){if(e&&C(e)){var t=[];if("function"==typeof arguments[1]){for(var a=arguments[1],r=e.length,o=[],n=0;n<r;n++){var l=a(e[n],n);o.push({source_pos:n,value:l})}for(var i=0;i<r;i++)for(var s=i;s<r;s++)if(o[i].value>o[s].value){var d=o[i];o[i]=o[s],o[s]=d}for(var c=0;c<r;c++)t.push(e[o[c].source_pos]);return t}if(C(arguments[1])&&arguments[1].length===e.length){var u=arguments[1];return t.length=u.length,u.forEach(function(a,r){t[a]=e[r]}),t}}}function r(e,t){if(e&&C(e)){for(var a=e.length,r=[],o=0;o<a;o++){var n=t(e[o],o);r.push({source_pos:o,value:n})}for(var l=0;l<a;l++)for(var i=l;i<a;i++)if(r[l].value>r[i].value){var s=r[l];r[l]=r[i],r[i]=s}for(var d=new Array(a),c=0;c<a;c++)d[r[c].source_pos]=c;return d}}function o(e){if(!e||!C(e))return[];for(var t=e.length,a=[],r=0;r<t;r++)a=a.concat(e[r]);return a}function n(e){var t=[];for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];if(null!==r&&"function"!=typeof r){var o;if("object"==typeof r&&r.constructor===Array){for(var n,l=[],i=0,s=r.length;i<s;i++)n=r[i],l.push(encodeURIComponent(null===n||void 0===n?"":n));o=l.join(",")}else o=encodeURIComponent(r);t.push(encodeURIComponent(a)+"="+o)}}return t.join("&")}function l(){for(var e=arguments,t=e[0],a=1,r=e.length;a<r;a++)for(var o=e[a],n=Object.keys(o),l=0,i=n.length;l<i;l++){var s=n[l];"undefined"!==o[s]&&null!==o[s]&&(t[s]=o[s])}return t}function i(e){if(C(e)){for(var t=[],a=0,r=e.length;a<r;a++)void 0!==e[a]&&null!==e[a]&&t.push(e[a]);return t}}function s(e){if(C(e))return e[e.length-1]}function d(e,t){if(e&&C(e)){for(var a={},r=0,o=e.length;r<o;r++){var n=t(e[r]);a[n]||(a[n]=[]),a[n].push(e[r])}return a}}function c(e,t){if(e&&C(e)){e=a(e,t);for(var r=[],o=null,n=0,l=e.length;n<l;n++){var i=t(e[n]);o!==i&&(o=i,r.push([])),s(r).push(e[n])}return r}}function u(e){e.sort(function(e,t){return e>t?1:e<t?-1:0})}function g(e){e.sort(function(e,t){return e>t?-1:e<t?1:0})}function y(e){if(e&&"number"==typeof e.length){for(var t=[],a=0,r=e.length;a<r;a++)t.push(e[a]);return t}}function p(e,t){return e.indexOf(t)===e.length-t.length}function f(e){for(var t,a,r={},o=[],n=(e.length,0);n<e.length;n++)t=e[n],a=typeof t,r[t]?r[t].indexOf(a)<0&&(r[t].push(a),o.push(t)):(r[t]=[a],o.push(t));return o}String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},String.prototype.removeDot=function(){for(var e=this;e.indexOf(".")>-1;)e=e.replace(".","");return e};var m=function(){var e={};return e.mozilla=/firefox/.test(navigator.userAgent.toLowerCase()),e.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),e.opera=/opera/.test(navigator.userAgent.toLowerCase()),e.msie=/msie/.test(navigator.userAgent.toLowerCase())||!!navigator.userAgent.match(/Trident.*rv\:11\./),e},v=function(e){return void 0!==e&&null!==e},h=function(){for(var e=[],t="0123456789abcdef",a=0;a<36;a++)e[a]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var r=e.join("");return r},I=function(e){return Object.assign({},e)},b=function(e,t){for(var a in t)Object.assign(e,t[a]);return e},S=function(e,t){for(var a in t)e[a]=t[a]},L=function(e,t){return void 0!==e.find(function(e,a,r){return e===t})},w=function(e,t){return e.findIndex(function(e,a,r){return e===t})},T=function(e){return"."===e.substring(0,1)?document.getElementsByClassName(e.substring(1)):document.getElementById(e)},E=function(e,t){return e.hasOwnProperty(t)},k=function(e,t){var a=[],r=e[0],o=e[1],n=e[2],l=e[3],i=(n-r)/2*t,s=(l-o)/2*t,d=r-i,c=o-s,u=n+i,g=l+s;return a[0]=d,a[1]=c,a[2]=u,a[3]=g,a},C=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},x=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},O=function(e){return e===Object(e)},_=function(e,t){if(C(e)||e.length){if(e.find)return e.find(t);for(var a,r=e.length,o=0;o<r;o++)if(t(e[o])){a=e[o];break}return a}},N=function(e){var t=document.createElement("div");t.innerHTML=e;var a=t.innerText||t.textContent;return t=null,a},P=function(e){return e?JSON.parse(this.htmlDecode(JSON.stringify(e))):e},M=function(e){var t=new ol.format.WKT;if(e){var a=t.readFeature(e);return!!a.getGeometry()&&{geoType:a.getGeometry().getType(),coordinates:a.getGeometry().getCoordinates()}}};e.exports={getBrowserType:m,isValid:v,getUUID:h,cloneObj:I,mergeObj:b,mixin:S,isInArray:L,getIndexInArray:w,getDom:T,isPropertyInObj:E,extentTimes:k,isArray:C,isFinite:x,isObject:O,find:_,getParameterString:n,sortBy:a,sortedIndex:r,flatten:o,extend:l,compact:i,last:s,groupBy:d,sortGroupBy:c,sortAsc:u,sortDesc:g,toArray:y,endsWith:p,unique:f,htmlDecode:N,objectDecode:P,getWKTFromText:M}},function(e,t,a){var r=a(3),o=a(1),n=a(4),l=a(5),i=a(8),s=a(7),d=a(10),c=null,u=[],g=function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(l.createLayer(e),a=n.get(t)),c=a.getSource(),y(e)},y=function(e){var t=[],a=e.datas,n=i.getExtent(e.mapId);(o.isValid(a)||a.length>0)&&(a.forEach(function(e){var a=r.proj.fromLonLat(e.coordinate);if(r.extent.containsCoordinate(n,a)){var o=new r.geom.Point(a),l=new r.Feature({geometry:o,businessType:s.BUSINESSTYPE.LEGEND,data:e});l.setId(e.id),l.set("legendVal",e.legendVal);var i=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new r.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});l.setStyle(i),l.set("foreverStyle",i),l.set("radius",e.radius?e.radius:5),l.set("strokeWidth",e.strokeWidth?e.strokeWidth:1),t.push(l)}}),c.addFeatures(t),u=t),p(e)},p=function(e){var t=e.legendData,a=e.mapId,o=d,n=null,l=o.getDom(a).getElementsByClassName("layer_legend_container_for_one_map");l&&l.length>0?n=l[0]:(n=o.createDom({tagName:"div",attributes:{"class":"layer_legend_container_for_one_map"}}),o.getDom(a).appendChild(n));var i=o.createDom({tagName:"div",attributes:{"class":"one_legend_box_one_layer"}});if(!document.querySelector(".layer_legend_container_for_one_map").hasChildNodes("measure-close-legend")){var s=o.createDom({tagName:"div",attributes:{id:"closeEvent","class":"measure-close-legend"}});n.insertBefore(s,n.childNodes[0]),s.onclick=function(){n.style.display="none",o.getDom(a).removeChild(n)}}n.querySelector(".one_legend_box_one_layer")&&n.removeChild(n.querySelector(".one_legend_box_one_layer")),n.appendChild(i),t.forEach(function(e){var t=o.createDom({tagName:"div",attributes:{"class":"one_legend_line"}});t.style.cursor="pointer",t.id=e.val,i.appendChild(t),t.onclick=function(){var e=t.getAttribute("id");u.forEach(function(a){if(a.get("legendVal")===parseFloat(e))if(0===a.get("opacity"))a.set("opacity",1),a.setStyle(a.get("foreverStyle")),t.style.borderLeftWidth="0px",t.childNodes[0].style.backgroundColor=t.childNodes[0].id;else{a.set("opacity",0);var o=new r.style.Style({image:new r.style.Circle({radius:a.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:a.get("strokeWidth")})})});a.setStyle(o),t.style.borderLeftWidth="2px",t.style.borderLeftStyle="solid",t.style.borderLeftColor="#00BFFF",t.childNodes[0].style.backgroundColor="gray"}})};var a=o.createDom({tagName:"div"});a.style.width="8px",a.style.height="8px",a.style.marginTop="9px",a.style.marginLeft="10px",a.style.marginRight="10px",a.style.backgroundColor=e.color,a.style.borderRadius="100px",a.style.webkitBorderRadius="100px",a.style.mozBorderRadius="100px",a.id=e.color,t.appendChild(a);var n=o.createDom({tagName:"div"});n.innerHTML=e.title?e.title:e.text,t.appendChild(n)})};e.exports={addFeature:g,setLayerData:y}},function(e,t){e.exports=ol},function(e,t){var a=new Array,r=new Array,o=function(e,t){var o=!1,n=this.getIndex(e);return n==-1?(a.push(e),r.push(t),o=!0):r[n]=t,o},n=function(e){var t=!1;try{for(var o=0;o<a.length;o++)if(a[o]==e){a.splice(o,1),r.splice(o,1);break}t=!0}catch(n){t=!1}return t},l=function(e){var t=-1;try{for(var r=0;r<a.length;r++)if(a[r]==e){t=r;break}}catch(o){t=-1}return t},i=function(e){var t=!1;try{for(var r=0;r<a.length;r++)a[r]==e&&(t=!0)}catch(o){t=!1}return t},s=function(e){try{for(var t=0;t<a.length;t++)if(a[t]==e)return r[t]}catch(o){return null}},d=function(){return a.length},c=function(){return 0==a.length},u=function(){var e=!0;try{a=[],r=[]}catch(t){e=!1}return e};e.exports={put:o,remove:n,getIndex:l,containsKey:i,clear:u,get:s,size:d,isEmpty:c,keys:a,vals:r}},function(e,t,a){function r(e){if(e.layerId&&e.mapId){var t=f.getLayer(e);t.setOpacity(e.opacity),f.setEffectLayerOpacity(t,e.opacity)}}function o(e){var t=f.getLayer(e);if(t){var a=t.getSource().getFeatureById(e.geoId);if(a){t.getSource()&&t.getSource().removeFeature(a);var r=p.getLayer({mapId:e.mapId,layerId:e.layerId+"&&&highlight"});if(r&&r.getSource()){var o=r.getSource().getFeatureById(e.geoId);o&&r.getSource().removeFeature(o)}}}}function n(e){var t=d.getMapObj(e.mapId);if(!t){var a,r=D(e);return a=e.isBusiness?r.filter(function(e){return e.get("businessType")}):r,a.map(function(e){return{layerId:e.get("layerId"),visible:e.getVisible(),zIndex:e.getZIndex(),dataType:e.get("dataType"),layerType:e.get("businessType"),layerData:e.get("layerData")}})}}function l(e,t){var a=d.getMapObj(e.mapId);if(a){a.get("pointermoveKey")&&a.unByKey(a.get("pointermoveKey"));var r=a.on("pointermove",function(e){var r=a.getEventPixel(e.originalEvent),o=a.hasFeatureAtPixel(r),n=a.forEachFeatureAtPixel(e.pixel,function(e){if(o)return e});n?t&&"function"==typeof t&&t(n):t&&"function"==typeof t&&t(null)});a.set("pointermoveKey",r)}}function i(e){if(e.mapId){var t=d.getMapObj(e.mapId);t&&t.getLayers().on("change:length",function(t){e.callbackFunc&&"function"==typeof e.callbackFunc&&e.callbackFunc({layerCount:t.target.getLength(),layerIds:function(){var e=[];return t.target.getArray()&&t.target.getArray().length>0&&t.target.getArray().forEach(function(t){e.push(t.get("layer_id")?t.get("layer_id"):void 0)}),e}()})})}}var s=a(3),d=a(6),c=a(8),u=a(4),g=a(7),y=a(1),p=a(32),f=a(29),m=a(11),v=new Map,h={Point:[new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:"#319FD3"}),radius:5,stroke:new s.style.Stroke({color:"#ff0",width:1})})})],Circle:[new s.style.Style({fill:new s.style.Fill({color:"#319FD3"}),stroke:new s.style.Stroke({color:"#ff0",width:1})})],Polygon:[new s.style.Style({fill:new s.style.Fill({color:"#319FD3"}),stroke:new s.style.Stroke({color:"#ff0",width:1})})],LineString:[new s.style.Style({stroke:new s.style.Stroke({color:"#2C89E8",width:3})})],MultiPolygon:[new s.style.Style({stroke:new s.style.Stroke({color:"#2C89E8",width:3})})]},I=function(e,t){var a=e.getStyleFunction();return a?a.call(e,t):h[e.getGeometry().getType()]},b=function(e){var t=e.strokeColor,a=e.fillColor,r=e.strokeWidth;return[new s.style.Style({image:new s.style.Circle({radius:e.radius,fill:new s.style.Fill({color:a}),stroke:new s.style.Stroke({color:t,width:r})}),text:new s.style.Text({text:e.label,fill:new s.style.Fill({color:"white"})})})]},S=function(e,t){var a=e.get("features"),r=a.length,o={};return r>1?(o.radius=10*r*.4,o.label=r.toString(),o.strokeColor="white",o.strokeWidht=1*r*.4,o.fillColor="rgba(250,139,46, 0.9)"):o=a[0].get("property"),b(o)},L=function(e,t){var a=e.get("features"),r=a.length,o={};return r>1?(o.radius=15,o.label=r.toString(),o.strokeColor="white",o.strokeWidht=1*r*.4,o.fillColor="rgba(250,139,46, 0.9)"):o=a[0].get("property"),b(o)},w=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=e.isCluster,o=d.getMapObj(t),n=void 0===e.isShow||e.isShow,l=e.label?e.label:e.layerId;if(!y.isValid(u.get(a))){var i=null;if(r){var c=new s.source.Cluster({distance:e.distance?e.distance:20,source:new s.source.Vector({wrapX:!1}),wrapX:!1});i=e.isClusterVariableSize?new s.layer.Vector({source:c,style:S}):new s.layer.Vector({source:c,style:L})}else i=new s.layer.Vector({source:new s.source.Vector({wrapX:!1}),style:I});i.set("type",g.CUSTOMTYPE.LAYERTYPE),i.set("map",o),i.set("layerId",a),i.set("params.label",l),i.set("layer_id",e.layerId),n||i.setVisible(!1),o.addLayer(i),u.put(a,i)}},T=function(e){var t=e.mapId,a=d.getMapObj(t),r=e.layerIds;if(a&&r&&r.length>0)for(var o=0;o<r.length;o++){var n=r[o]+"_"+t,l=u.get(n);if(l){if(f.removeEffectLayer({mapId:t,layer:l}),a.removeLayer(l),l.get("mineLegendID")){var i=l.get("mineLegendID"),s=a.getTargetElement().querySelector("."+i);s&&s.parentNode&&s.parentNode.removeChild(s)}l.get("isCustomMap")&&c.destroyCustomMap(t),u.remove(n)}}},E=function(e){var t=e.layerIds;y.isValid(t)&&t.length>0&&t.forEach(function(t){var a=u.get(t+"_"+e.mapId);y.isValid(a)&&(a.setVisible(e.isShow),f.setEffectLayerVisible(a,e.isShow))})},k=function(e){var t=e.mapId,a=e.layerId,r=e.zIndex,o=f.getLayer({mapId:t,layerId:a});o.setZIndex(r)},C=function(e){var t=e.mapId,a=e.layerId,r=f.getLayer({mapId:t,layerId:a});return!!r&&r.getZIndex()},x=function(e){var t=e.mapId,a=e.layerId,r=!1,o=d.getMapObj(t),n=o.getLayers();return n.forEach(function(e,t,o){e.get("layerId")===a&&(r=!0)}),r},O=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=e.featureId,o=u.get(a).getSource(),n=o.getFeatureById(r);n&&o.removeFeature(n)},_=function(e){var t=e.layerId+g.Joiner.UNDERLINE+e.mapId;return e.featureId&&u.get(t).getSource().getFeatureById(e.featureId)},N=function(e){var t=e.layerId+"_"+e.mapId,a=e.callbackfunc,r=t&&u.get(t);r&&a&&m.addClickCallback(e.mapId,"ui-designer-apply-click-event-"+t,a,e.layerId)},P=function(e){var t=e.layerId+"_"+e.mapId,a=e.callbackfunc,r=t&&u.get(t);r&&a&&(r.zoomCallback=a)},M=function(e){var t=e.layerId+g.Joiner.UNDERLINE+e.mapId,a=u.get(t);e.hasOwnProperty("callbackfunc")&&a&&(a.mouseoverCallback=e.callbackfunc)},F=function(e){var t=e.layerId+g.Joiner.UNDERLINE+e.mapId,a=u.get(t);e.hasOwnProperty("callbackfunc")&&a&&(a.rightClickCallback=e.callbackfunc)},R=function(e){var t=g.LAST_CLICK_FEATURE;void 0===u.get(t)&&u.put(t,[]);var a=_(e);a&&a.getStyle()&&u.get(t).push({feature:a,style:a.getStyle()});var r=new s.style.Style({fill:new s.style.Fill({color:e.fillColor||"red"}),stroke:new s.style.Stroke({color:e.strokeColor||"yellow",width:2})});a.setStyle(r)},A=function(e){var t=e.layerId+"_"+e.mapId,a=e.featureId,r=e.opacity,o=u.get(t).getSource().getFeatureById(a),n=o.getStyle(),l=n.getFill().a,i=l.split(",");i.pop(),i.push(r);var d=i.toLocaleString()+")",c=new s.style.Style({fill:new s.style.Fill({color:d})});o.setStyle(c)},G=function(e){var t=u.get(e.layerId+"_"+e.mapId);t&&(t.refreshDataCallback=e.refreshDataCallback)},D=function(e){var t="_"+e,a=[];return u.keys.forEach(function(e){e&&y.endsWith(e,t)&&a.push(u.get(e))}),a},j=function(e){for(var t=d.getMapObj(e),a=t.getLayers(),r=a.getArray(),o=r.length,n=o-1;n>=0;n--){var l=r[n];l&&t.removeLayer(l),u.remove(l.get("layerId"))}},V=function(e,t){var a=e.getGeometry().getType(),r=null,o=null,n=null;switch(a){case"Point":t&&t.star&&(r=new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:t.starFillColor}),radius:t.radius,stroke:new s.style.Stroke({color:t.starStrokeColor,width:t.width})})})),t&&t.now&&(o=new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:t.nowFillColor}),radius:t.radius,stroke:new s.style.Stroke({color:t.nowStrokeColor,width:t.width})})})),t&&t.end&&(n=new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:t.endFillColor}),radius:t.radius,stroke:new s.style.Stroke({color:t.endStrokeColor,width:t.width})})}));break;case"Polygon":t&&t.star&&(r=new s.style.Style({fill:new s.style.Fill({color:t.starFillColor}),stroke:new s.style.Stroke({color:t.starStrokeColor,width:t.width})})),t&&t.now&&(o=new s.style.Style({fill:new s.style.Fill({color:t.nowFillColor}),stroke:new s.style.Stroke({color:t.nowStrokeColor,width:t.width})})),t&&t.end&&(n=new s.style.Style({fill:new s.style.Fill({color:t.endFillColor}),stroke:new s.style.Stroke({color:t.endStrokeColor,width:t.width})}));break;case"LineString":t&&t.star&&(r=new s.style.Style({fill:new s.style.Fill({color:t.starFillColor}),stroke:new s.style.Stroke({color:t.starStrokeColor,width:t.width})})),t&&t.now&&(o=new s.style.Style({fill:new s.style.Fill({color:t.nowFillColor}),stroke:new s.style.Stroke({color:t.nowStrokeColor,width:t.width})})),t&&t.end&&(n=new s.style.Style({fill:new s.style.Fill({color:t.endFillColor}),stroke:new s.style.Stroke({color:t.endStrokeColor,width:t.width})}))}return{starStyle:r,nowStyle:o,endStyle:n}},Y=function(e){var t=e.mapId,a=e.layerId,r=_({mapId:t,layerId:a,featureId:e.featureId});if(r){var o=e.timestamp||800,n=r.get("data").radius,l=e.starFillColor||"blue",i=e.nowFillColor||"red",s=e.endFillColor||"yellow",d=e.starStrokeColor||"red",c=e.nowStrokeColor||"blue",u=e.endStrokeColor||"green",y="flickerFeature_"+a+g.Joiner.UNDERLINE+t,p="feature_"+a+g.Joiner.UNDERLINE+t;v.has(y)||v.set(y,[]),v.has(p)||v.set(p,new Map);var f=setInterval(function(){var e=V(r,{starFillColor:l,starStrokeColor:d,radius:n,width:2,star:"star"}).starStyle,t=V(r,{nowFillColor:i,nowStrokeColor:c,radius:n,width:2,now:"now"}).nowStyle,a=V(r,{endFillColor:s,endStrokeColor:u,radius:n,width:2,end:"end"}).endStyle,o="customStyle",g=r.get(o);g===s?(r.setStyle(t),r.set(o,i)):g===i?(r.setStyle(e),r.set(o,l)):(r.setStyle(a),r.set(o,s))},o);return v.get(y).push(f),v.get(p).set(f,r),f}},B=function(e){var t=e.layerId,a=e.mapId,r="flickerFeature_"+t+"_"+a,o="feature_"+t+"_"+a,n=function(e){var t=v.get(o).get(e),a=t.get("defaultStyle");t.setStyle(a)};v.get(r).length&&(e.intervals&&e.intervals.length>0?v.get(r).forEach(function(t){e.intervals.forEach(function(e){e===t&&(clearInterval(t),n(t))})}):v.get(r).forEach(function(e){clearInterval(e),n(e)}))},U=function(e){e&&e.getSource()&&e.getSource().clear()};e.exports={createLayer:w,removeLayer:T,getLayer:f.getLayer,setVisible:E,setLayerOpacity:r,setLayerZIndex:k,getLayerZIndex:C,isLayerExist:x,getLayers:D,getLayersInfo:n,clearLayers:j,removeGeometry:o,removeFeatureById:O,clearFeatureOnLayer:U,clearFeatureFlicker:B,getFeatureById:_,setGeometryOpacity:A,highLight:R,flickerFeature:Y,registerClick:N,registerMove:G,registerZoom:P,registerMouseHover:M,registerRightClick:F,registerMouseEvent:l,registerLayerChange:i}},function(e,t,a){var r=a(4),o=a(7),n=a(3),l=function(e){var t=r.get(e);return t&&t instanceof n.Map?t:void 0},i=function(e,t){var a=r.get(e),l=a.getView().calculateExtent(a.getSize());return t?n.proj.transformExtent(l,o.PROJ.EPSG_3857,o.PROJ.EPSG_4326):l};e.exports={getMapObj:l,getExtent:i}},function(e,t){var a={OSM_MAP:"OSM_MAP",HUAWEI_MAP:"HUAWEI_MAP",BING_MAP:"BING_MAP",GOOGLE_MAP:"GOOGLE_MAP",WMS_MAP:"WMS_MAP",NAVER_MAP:"NAVER_MAP"},r={EPSG_4326:"EPSG:4326",EPSG_3857:"EPSG:3857"},o={SCALELINE:"scaleLine",MOUSEPOSITION:"mousePosition",ZOOMCONTENT:"zoomContent",OVERVIEWMAP:"overviewMap"},n={DEFAULT_PROJECTION:"EPSG:3857",DEFAULT_UNITS:"metric",DEFAULT_ZOOM:10,DEFAULT_MIN_ZOOM:0,DEFAULT_MAX_ZOOM:17,DEFAULT_CENTER:[116.38229370117188,39.90868283513285]},l="lastClickFeature",i={BUBBLE:"BUBBLE",BUBBLE_CIRCLE:"BUBBLE_CIRCLE",POINTER_CLUSTER:"POINTER_CLUSTER",TRACK_SHOW:"TRACK_SHOW",TRACK_SHOW_LINE:"TRACK_SHOW_LINE",ICON:"ICON",ICONWITH2LABEL:"ICONWITH2LABEL",ICON2LABEL:"ICON2LABEL",VECTOR_CELL:"VECTOR_CELL",LEGEND:"LEGEND",LEGEND_RANGE:"LEGEND_RANGE",LEGEND_SLIDER:"LEGEND_SLIDER",ADMIN_REGION:"ADMIN_REGION",CELLSITE:"CELLSITE",CELL:"CELL",GRID:"GRID",CIRCLEPOINT:"CIRCLEPOINT",MARKPOINT:"MARKPOINT",LINE:"LINE",POLYGON:"POLYGON",SITE:"SITE",POINT:"POINT",SERVICEPOLYGON:"SERVICEPOLYGON",SERVICEPOINT:"SERVICEPOINT",SERVICELINE:"SERVICELINE",HEAT_MAP:"HEAT_MAP",STRAIGHTLINE:"STRAIGHTLINE"},s={MAPTYPE:"ol.Map",LAYERTYPE:"ol.layer.Vector",LAYERTILETYPE:"ol.layer.Tile",LAYERIMGTYPE:"ol.layer.Image",LAYERHEATTYPE:"ol.layer.Heatmap",SOURCETYPE:"ol.source.Vector"},d={EN:"en",ZH:"zh",ES:"es"},c={POINT:"POINT",LINE:"LINE",POLYGON:"POLYGON"},u={OSM:"OSM",GOOGLE:"GOOGLE"},g={BASELAYER:0,GRID:100,POLYGON:300,CELL:400,SITE:450,RADAR:500,TEMPPOLYGON:600,ROAD:{PIXPOINTS:751,HIGHLIGHT:756,INTER:771},LINE:800,LANDMARKER:850,ROUTEPOINT:900,MARKER:1e3,TRACK:1100,SYSROAD:1600,SHADOWAREA:1700,DRAGBOX:1800,GRIDMASSHL:1820,HIGHLIGHT:1850,DISTANCEMEASURE:1900,CROSSLINE:1999},y="/fusiongisaccess",p={IMGTOKENURL:y+"/gridManager/getImgToken",EXPORTURL:y+"/gridManager/export",GET_GRIDINFO:y+"/gridManager/getGridInfo",QUERY_GRIDINFO:y+"/gridManager/queryGridInfo",MAPRENDER_EXPORT:y+"/mapRender/export"},f={GET_FEATURE_INFO:y+"/custommap/v1/getfeatureinfo",GET_LAYER_INFO:y+"/custommap/v1/getlayerinfo",GET_ATTR_INFO:y+"/customMap.do",GET_COMMON_LAYER_INFO:y+"/resource/v1/getspatialdatalist",GET_ATTR_IN_COMMON_LAYER:y+"/spatialdata/v1/queryFieldsInfo",GET_FEATURE_IN_COMMON_LAYER:y+"/spatialdata/v1/Query"},m={GET_THIESSEN_POLYGONLAYER_INFO:y+"/spatialdata/v1/Query"},v={CLICK:"click",SINGLE:"single",MULlTI:"multi",VECTOR:"vector",SERVICE:"service"},h={NE:["CELL","SITE"]},I={UNDERLINE:"_",SHORT_TERM:"-"},b={CELL:0,SITE:0,POLYGON:0,GRID:0,HEAT_MAP:0},S={HYBRID:"hybrid",ROADMAP:"roadmap",SATELLITE:"satellite",TERRAIN:"terrain"},L={ROAD:"Road",AERIAL:"Aerial",AERIALWITHLABELS:"AerialWithLabels",BIRDSEYE:"Birdseye",BIRDSEYEWITHLABELS:"BirdseyeWithLabels",COLLINSBART:"CollinsBart",ORDNANCESURVEY:"OrdnanceSurvey"};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame,e.exports={MAPTYPE:a,PROJ:r,CONTROL_TYPE:o,MAPPROPERTY:n,LAST_CLICK_FEATURE:l,BUSINESSTYPE:i,CUSTOMTYPE:s,I18N:d,LAYERTYPE:c,Search_Engine:u,Z_INDEX:g,URL:p,HTYPE:v,GisRootUrl:y,layerGroup:h,Joiner:I,DefaultLayerVisibleLevel:b,CustomQuery:f,PolygonQuery:m,GoogleMapTypes:S,BingMapTypes:L,GisResourceURL:function(){var e=function(e){var t=document.createElement("div");t.innerHTML=e;var a=t.innerText||t.textContent;return t=null,a},t=document.scripts;return t=t[t.length-1].src.substring(0,t[t.length-1].src.lastIndexOf("/")+1),e(t+"resources/imgs/")}(),GlobalVariable:{}}},function(e,t,a){function r(e){var t=null,a=e.mapId,r=e.layerId,o=e.mapType,n=e.url,u=e.key,g=e.mapName,y=e.layers,p=e.version,f=e.language,I=e.controls,b=e.controlStyles||{scaleLine:"vGisWeb_scale-line-gis",mousePosition:"vGisWeb_mouse-position-gis"},w=e.initCallback,M=function(e){var t=[];for(var a in e){var r=b[a],o=L[a](r);t.push(o)}return t}(I);if(!v.containsKey(a)){var F=T.createView(e);if(t=new m.Map({renderer:"canvas",target:a,view:F,controls:m.control.defaults({zoomOptions:{className:"vGisWeb_olZoom_custom"},attributionOptions:{collapsible:!0}}).extend(M)})){t.set("mineView",F),t.set("type",h.CUSTOMTYPE.MAPTYPE),t.set("currentMapType",o),t.set("paramObj",e),v.put(a,t);var R=t.getTargetElement();R&&R.setAttribute("class",R.className+" map_background"),w&&"function"==typeof w&&w(),c(a,e)}if(t=v.get(a)){var A="base_layer";switch(o){case h.MAPTYPE.OSM_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,C.createLayer({mapId:a,layerId:r,layer_id:A}));break;case h.MAPTYPE.HUAWEI_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,O.createLayer({mapId:a,url:n,key:u,layerId:r,layer_id:A}));break;case h.MAPTYPE.WMS_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,_.createLayer({mapId:a,url:n,layers:y,version:p,layerId:r,mapName:g}));break;case h.MAPTYPE.BING_MAP:t.getLayers().insertAt(0,x.createLayer({mapId:a,key:u,layerId:r,layer_id:A,layers:y})),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.BING_MAP,bingMapKey:u});break;case h.MAPTYPE.GOOGLE_MAP:u?k.loadGoogleAPI(u,f,function(a){a&&(window.sessionStorage&&sessionStorage.setItem("key",u),k.createCustomMap(e),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GOOGLE_MAP,bingMapKey:void 0}))}):console.error("load google api failed...");break;case h.MAPTYPE.NAVER_MAP:t.getLayers().insertAt(0,N.createLayer({mapId:a,layerId:r})),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.NAVER_MAP,bingMapKey:u});break;default:t.getLayers().insertAt(0,C.createLayer({mapId:a,layer_id:A,layerId:r})),E.mapTypeToolbar({mapObj:t})}B(e),l(a),S.mapClick(a),c(a,e),d(a),S.zoomChangeEvent(t),S.centerChangeEvent(t),P.monitorLayers(e),t.set("statistics",{}),Y(e,t),i(a),s(a)}}}function o(e){var t=e.mapId,a=b.getMapObj(t);if(a.get("customMap")){a.unset("customMap");var r=a.get("customCenterKey"),o=a.get("customResolutionKey");r&&a.unByKey(r),o&&a.unByKey(o)}var n=document.getElementById("$$customMap_"+t);n&&n.parentNode&&n.parentNode.removeChild(n)}function n(){function e(e,t){var a=[];if(2===arguments.length){var r=t.layerType,o=t.geometry;if(o){"String"==typeof o&&(o=JSON.parse(o));var n=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(m.proj.toLonLat(t))}},l=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(m.proj.toLonLat(t))}},i=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(m.proj.transformExtent(t,"EPSG:3857","EPSG:4326"))}};switch(r){case h.BUSINESSTYPE.GRID:i();break;case h.BUSINESSTYPE.SITE:l();break;case h.BUSINESSTYPE.SERVICEPOINT:l();break;case h.BUSINESSTYPE.CELL:n();break;case h.BUSINESSTYPE.SERVICELINE:n();break;default:n()}}}else{var s=e&&e.getGeometry();if(!s)return;if(s instanceof m.geom.GeometryCollection)return;var d=s.getCoordinates();if(!d)return[];if(s instanceof m.geom.Point)a.push(m.proj.toLonLat(d));else if(s instanceof m.geom.LineString)for(var c=0;c<d.length;c++){var u=d[c];a.push(m.proj.toLonLat(u))}else if(s instanceof m.geom.Polygon)for(var c=0;c<d[0].length;c++){var u=d[0][c];a.push(m.proj.toLonLat(u))}}return a}function t(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:{x:a.coordinate[0],y:a.coordinate[1]},tolerance:1,mapExtent:n,imgToken:t.get("imgToken")};A.postJSON({url:h.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(l),success:function(e){var t=JSON.parse(e),a=t.status,n=t.data&&t.data.length>0&&t.data[0];1===a.code?n&&o({lonLat:n.centerPoint,geometry:n.geometry,geoId:n.id,data:n,key:r}):o({})},failure:function(e){console.log(e)}})}function a(e,t,a,r,o){if(!t.getVisible())return void o([]);var n,l,i,s;if(a.coordinate){i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),l=t.get("imgToken"),s=l.slice(0,l.indexOf(":"));var d={geometry:i,tolerance:.1,mapExtent:n,imgToken:l,FCName:s}}A.get({url:h.GisRootUrl+"/common/mapRender/identify",data:F.getParameterString(d),success:function(a){if(!a)return void o([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([]);var n=F.sortBy(a.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),l=n[0].extentInfo.radius;n=n.filter(function(e){return e.extentInfo.radius===l}),n.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var i=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r}});o(i)},failure:function(){"function"==typeof o&&o([])}})}function r(e,t,a,r,o){if(!t.getVisible())return void o([]);var n,l,i;l=t.get("imgToken"),i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(",");var s=l.slice(0,l.indexOf(":")),d={geometry:i,tolerance:1,mapExtent:n,imgToken:l,FCName:s};A.get({url:h.GisRootUrl+"/common/mapRender/identify",data:F.getParameterString(d),success:function(a){if(!a)return void o([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([]);var n=a.data,l=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,geoId:a.id,geoName:a.name,key:r}});o(l)},failure:function(){o([])}})}function o(e,t,a,r,o){if(!t.getVisible())return void o([]);var n,l,i,s;l=t.get("imgToken"),i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),s=l.slice(0,l.indexOf(":"));var d={geometry:i,tolerance:1,mapExtent:n,imgToken:l,FCName:s};A.get({url:h.GisRootUrl+"/common/mapRender/identify",data:F.getParameterString(d),success:function(a){if(!a)return void o([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([]);var n=a.data,l=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,geoId:a.id,geoName:a.name,key:r}});o(l)},failure:function(){o([])}})}var n,l,i,s,d,c,u=this,g=-1,y=-1;window.setInterval(function(){u.mouseHoverPublisher(s,d,c)},1e3),document.onmousemove=function(e){e=e||window.event,(e.pageX||e.pageY)&&(g=e.pageX,y=e.pageY)},this.beat=function(e,t,a){s=e,d=t,c=a},this.mouseHoverPublisher=function(e,t,a){if(e&&t&&a&&!(g<0||g>e.getSize()[0]||y<0||y>e.getSize()[1])){if(!l||!n)return l=new Date,void(n=t);var r=new Date-l;if(n[0]==t[0]&&n[1]==t[1]){if(r<=3e3)return;if(i&&i[0]==t[0]&&i[1]==t[1])return;this.mouseHoverHandle(e,t,a),i=t}else l=new Date;n=t}},this.mouseHoverHandle=function(n,l,i){var s={coordinate:n.getCoordinateFromPixel(l)};v.keys.filter(function(e){return!!e&&e.indexOf(n.getTarget())===e.length-n.getTarget().length}).forEach(function(l){var d=v.get(l);if(d&&d instanceof m.layer.Layer){var c=d;c.hasOwnProperty("mouseoverCallback")&&"function"==typeof c.mouseoverCallback&&(c.get("businessType")===h.BUSINESSTYPE.GRID?t(n,c,s,void 0,function(t){c.mouseoverCallback({e:s,layer:c,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:e(void 0,{layerType:h.BUSINESSTYPE.GRID,geometry:t.geometry}),businessType:c&&c.get("businessType"),layerType:c&&c.get("businessType"),mapId:i,target:i,layerId:!!c&&c.get("layer_id"),featureId:t.geoId})}):"DCELL"===c.get("businessType")?a(n,c,s,void 0,function(t){t&&t.length>0&&(t=t[0],c.mouseoverCallback({e:s,layer:c,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:e(void 0,{layerType:h.BUSINESSTYPE.CELL,geometry:t.geometry}),businessType:c&&c.get("businessType"),layerType:c&&c.get("businessType"),
mapId:i,target:i,layerId:!!c&&c.get("layer_id"),featureId:t.geoId}))}):"DPOINT"===c.get("businessType")?r(n,c,s,void 0,function(t){t&&t.length>0&&(t=t[0],c.mouseoverCallback({e:s,layer:c,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:e(void 0,{layerType:h.BUSINESSTYPE.SITE,geometry:t.geometry}),businessType:c&&c.get("businessType"),layerType:c&&c.get("businessType"),mapId:i,target:i,layerId:!!c&&c.get("layer_id"),featureId:t.geoId}))}):"DLINE"===c.get("businessType")?o(n,c,s,void 0,function(e){e=e[0],c.mouseoverCallback({e:s,layer:c,featureCenter:e.lonLat,data:e.data,geoId:e.geoId,layerId:!!c&&c.get("layer_id"),featureId:e.geoId})}):"DPOLYGON"===c.get("businessType")?p(n,c,s,void 0,function(t){t=t[0],c.mouseoverCallback({e:s,layer:c,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:e(void 0,{layerType:h.BUSINESSTYPE.SERVICEPOLYGON,geometry:t.geometry}),businessType:c&&c.get("businessType"),layerType:c&&c.get("businessType"),mapId:i,target:i,layerId:!!c&&c.get("layer_id"),featureId:t.geoId})}):c.get("businessType")===h.BUSINESSTYPE.SERVICEPOINT?I(n,c,s,void 0,function(t){t=t[0],c.mouseoverCallback({e:s,layer:c,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:e(void 0,{layerType:h.BUSINESSTYPE.SERVICEPOINT,geometry:t.geometry}),businessType:c&&c.get("businessType"),layerType:c&&c.get("businessType"),mapId:i,target:i,layerId:!!c&&c.get("layer_id"),featureId:t.geoId})}):c.get("businessType")===h.BUSINESSTYPE.SERVICELINE?b(n,c,s,void 0,function(t){t=t[0],c.mouseoverCallback({e:s,layer:c,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:e(void 0,{layerType:h.BUSINESSTYPE.SERVICELINE,geometry:t.geometry}),businessType:c&&c.get("businessType"),layerType:c&&c.get("businessType"),mapId:i,target:i,layerId:!!c&&c.get("layer_id"),featureId:t.geoId})}):c.get("businessType")===h.BUSINESSTYPE.SERVICEPOLYGON&&f(n,c,s,void 0,function(t){t=t[0],c.mouseoverCallback({e:s,layer:c,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:e(void 0,{layerType:h.BUSINESSTYPE.SERVICEPOLYGON,geometry:t.geometry}),businessType:c&&c.get("businessType"),layerType:c&&c.get("businessType"),mapId:i,target:i,layerId:!!c&&c.get("layer_id"),featureId:t.geoId})}))}})};var p=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l=t.get("imgToken"),i=l.slice(0,l.indexOf(":")),s={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:.1,mapExtent:n,imgToken:l,FCName:i};A.get({url:h.GisRootUrl+"/common/mapRender/identify",data:F.getParameterString(s),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})},f=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:.1,mapExtent:n,imgToken:t.get("params.imgToken")};A.get({url:h.GisRootUrl+"/mapRender/identify",data:F.getParameterString(l),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})},I=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:10,mapExtent:n,imgToken:t.get("imgToken")};A.get({url:h.GisRootUrl+"/mapRender/identify",data:F.getParameterString(l),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})},b=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:10,mapExtent:n,imgToken:t.get("imgToken")};A.get({url:h.GisRootUrl+"/mapRender/identify",data:F.getParameterString(l),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})}}function l(e){var t=v.get(e);t.on("pointermove",function(a){var r=t.getEventPixel(a.originalEvent),o=t.hasFeatureAtPixel(r);document.getElementById(e).style.cursor=o?"pointer":"",U.beat(t,r,e);var n=t.forEachFeatureAtPixel(r,function(e,t){if(o)return e});if(n){var l=n.getGeometry().getExtent(),i=m.extent.getCenter(l),s=null;if(n.get("data"))s=n.get("data");else{var d=n.get("features");d&&(s=d[0].get("data"))}v.keys.filter(function(e){return!!e&&e.indexOf(t.getTarget())===e.length-t.getTarget().length}).forEach(function(t){var a=v.get(t);if(a&&a instanceof m.layer.Layer){var r=a;if(r.hasOwnProperty("mouseoverCallback")&&"function"==typeof r.mouseoverCallback){var o=t.substr(0,t.length-(e.length+1));if(G.get("lastMouseOverFeature")===n.getId())return;r.mouseoverCallback({centerCoordinate:i,lonLat:m.proj.toLonLat(i),mapId:e,layerId:o,infor:s}),G.set("lastMouseOverFeature",n.getId())}}})}else I.removeSuspensionPopup(e),G.set("lastMouseOverFeature",null)})}function i(e){var t=v.get(e);if(t){var a=[];t.on("pointerdrag",function(r){for(var o=function(){var e=[];return v.vals.forEach(function(t,a){t instanceof m.Map&&e.push(v.keys[a])}),e}(),n=0;n<o.length;n++)v.keys.filter(function(e){e&&e.indexOf(o[n])===e.length-o[n].length&&a.push(e)});a.forEach(function(a){var r=v.get(a),o=v.get("nowLink");if((o!==!1&&void 0!==o||a.indexOf(e)!==-1)&&r&&r instanceof m.layer.Layer&&r.get("businessType")){var n=r.get("businessType");n===h.BUSINESSTYPE.VECTOR_CELL&&"GOOGLE_MAP"===t.get("currentMapType")&&r.get("hideWhenPan")&&r.setVisible(!1)}})})}}function s(e){var t=v.get(e);if(t){var a=[];t.on("pointerup",function(e){var r=function(){var e=[];return v.vals.forEach(function(t,a){t instanceof m.Map&&e.push(v.keys[a])}),e}();setTimeout(function(){for(var e=0;e<r.length;e++)v.keys.filter(function(t){t&&t.indexOf(r[e])===t.length-r[e].length&&a.push(t)});a.forEach(function(e){var a=v.get(e);if(a&&a instanceof m.layer.Layer&&a.get("businessType")){var r=a.get("businessType");if(r===h.BUSINESSTYPE.VECTOR_CELL&&"GOOGLE_MAP"===t.get("currentMapType")&&a.get("hideWhenPan")){a.setVisible(!0);var o=t.getView().getCenter();o=m.proj.toLonLat(o);var n=[o[0]+1e-10,o[1]+1e-10];n=m.proj.fromLonLat(n),t.getView().setCenter(n)}}})},800)})}}function d(e){var t=v.get(e);t&&t.on("moveend",function(){v.keys.filter(function(t){return!!t&&t.indexOf(e)===t.length-e.length}).forEach(function(e){var a=v.get(e);if(a&&a instanceof m.layer.Layer&&a.get("businessType")){var r=a.get("businessType");if(r===h.BUSINESSTYPE.VECTOR_CELL){var o=a.get("layer_id"),n=t.getTarget(),l=a.get("noChangeRadius");l&&(fusiongis.Cell.clear({mapId:n,layerId:o}),a.get("datas")&&fusiongis.Cell.setLayerData({mapId:n,layerId:o,datas:a.get("datas"),noChangeRadius:l}))}else if("unChangePolygon"===r){var i=a.get("datas"),n=t.getTarget(),o=a.get("layer_id");fusiongis.BaseLayer.getLayer({mapId:n,layerId:o}).getSource().clear(),i&&fusiongis.UnChangePolygon.setLayerData({mapId:n,layerId:o,datas:i})}}})})}function c(e,t){var a=v.get(e);if(a){var r=a.getSize(),o=document.querySelector("#"+e).querySelector(".vGisWeb_olZoom_custom");if(o){var n=document.querySelector("#"+e).querySelector(".vGisWeb_custom_zoom_ctrl");if(!n){var l=M.createDom({tagName:"div",attributes:{"class":"vGisWeb_custom_zoom_ctrl"},text:Z(e)});o.insertBefore(l,o.childNodes[0])}var i=a.getView(),s=i.get("linkedMapIds");i&&i.on("change:resolution",function(o){var n=i.calculateExtent(r),l=m.proj.transformExtent(n,h.PROJ.EPSG_3857,h.PROJ.EPSG_4326);if(s.length>0)for(var d=0;d<s.length;d++){var c=document.querySelector("#"+s[d]).querySelector(".vGisWeb_custom_zoom_ctrl");c&&(c.innerHTML=i.getZoom())}else{var u=document.querySelector("#"+e).querySelector(".vGisWeb_custom_zoom_ctrl");u&&(u.innerHTML=i.getZoom())}v.keys.filter(function(t){return!!t&&t.indexOf(e)===t.length-e.length}).forEach(function(r){var o=v.get(r);if(o){if(o instanceof m.layer.Layer){if(o.get("businessType")){var s=o.get("businessType");if(s===h.BUSINESSTYPE.VECTOR_CELL){var d=o.get("layer_id"),c=o.get("noChangeRadius");c&&(fusiongis.Cell.clear({mapId:e,layerId:d}),o.get("datas")&&fusiongis.Cell.setLayerData({mapId:e,layerId:d,datas:o.get("datas"),noChangeRadius:c}))}}if(o.hasOwnProperty("zoomCallback")&&"function"==typeof o.zoomCallback&&o.zoomCallback({extent:l,zoom:i.getZoom()}),t.defaultVisibleLevel){var u=o.get("defaultVisibleLevel");if(u){var g=!1;if(g=i.getZoom()>=u,a.getTargetElement()){var y=a.getTargetElement().querySelectorAll(".vGisWeb_component .layerItem");if(y&&y.length>0){for(var p=0;p<y.length;p++){var f=y[p],I=!!f&&f.querySelectorAll(".visible_check")[0];if(!I)return;var d=I.layerId,b=I.checked;o.get("layer_id")===d&&(g=b)}o.setVisible(g)}}}}}if(t.multiple&&o.hasOwnProperty("refreshDataCallback")&&"function"==typeof o.refreshDataCallback){var S=o.get("multiple");S&&W({mapObj:a,extent4326:l,extent3857:n,mapId:e,multiple:S||1,layer:o})}}})})}}}function u(e){var t=e.mapId,a=b.getMapObj(t),r=a.get("paramObj");if(e=F.extend({},r,e),r.mapType===e.mapType){if(e.mapType===h.MAPTYPE.BING_MAP){var o="base_layer";R.removeLayer({mapId:t,layer_id:o});var n=x.createLayer({mapId:t,layerId:e.layerId,layer_id:o,key:e.key,layers:e.layers});a.addLayer(n)}e.mapType===h.MAPTYPE.GOOGLE_MAP&&k.updateCustomMap(e)}}function g(e){var t=v.keys,a=[];return t.forEach(function(t){var r=v.get(t);r instanceof m.Map&&("map"!==e&&e?"id"===e&&a.push(t):a.push(r))}),a}function y(e){var t=fusiongis.HashMap.containsKey(e);return t}function p(e){var t=document.getElementById(e.mapId),a=t.getElementsByTagName("div");for(var r in a)if("vGisWeb_olZoom_custom ol-unselectable ol-control"==a[r].className)var o=a[r];e.showZoom?o.style.display="block":o.style.display="none"}function f(e,t){var a=document.getElementById(e),r=a.getElementsByClassName("map_type_toolbar_container")[0];t?r.style.display="block":r.style.display="none"}var m=a(3),v=a(4),h=a(7),I=a(9),b=a(6),S=a(11),L=a(15),w=a(16),T=a(18),E=a(19),k=a(20),C=a(22),x=a(23),O=a(24),_=a(25),N=a(26),P=a(27),M=a(10),F=a(1),R=a(32),A=a(14),G=new Map,D=function(e){var t=h.MAPTYPE.OSM_MAP;A.postJSON({url:fusiongis.Constant.GisRootUrl+"/mapCfgView.do",data:JSON.stringify({subject:{param:{},formatter:{date:""}},services:[{name:"getMapSource",param:{}}]}),success:function(a){if(a){var o=JSON.parse(a);if(o&&1===o.status.code&&o.data){var n=o.data,l=n.mapFormat,i=F.htmlDecode(n&&n.mapService),s=F.htmlDecode(n&&n.mapService),d=n&&n.mapLayer,c=F.htmlDecode(n&&n.mapName);t=3===l||4===l||5===l||9===l||20===l?h.MAPTYPE.WMS_MAP:101===o.data.mapFormat?h.MAPTYPE.OSM_MAP:102===o.data.mapFormat?h.MAPTYPE.GOOGLE_MAP:103===o.data.mapFormat?h.MAPTYPE.BING_MAP:105===o.data.mapFormat?h.MAPTYPE.HUAWEI_MAP:h.MAPTYPE.OSM_MAP,20===o.data.mapFormat?s=fusiongis.Constant.GisRootUrl+"/offlineMap/customServer?MAPNAME="+c+"&LAYERS="+d:3===o.data.mapFormat?(s=fusiongis.Constant.GisRootUrl+"/offlineMap/planetServer",c=void 0):4===o.data.mapFormat?(s=fusiongis.Constant.GisRootUrl+"/offlineMap/shapeServer",c=void 0):5===o.data.mapFormat?(s=fusiongis.Constant.GisRootUrl+"/offlineMap/RailwayServer",c=void 0):9===o.data.mapFormat&&(s=fusiongis.Constant.GisRootUrl+"/offlineMap/customMap?MAPNAME="+c+"&LAYERS="+d),r({mapId:e.mapId,layerId:e.layerId,center:e.center,defaultZoom:e.defaultZoom,mapType:t,url:s,key:i,layers:d?d:[],mapName:c?c:void 0,version:e.version?e.version:"1.1.1",language:e.language?e.language:"zh-CH",linkage:!!e.linkage&&e.linkage,controls:e.controls?e.controls:void 0,controlStyles:e.controlStyles?e.controlStyles:void 0,initCallback:e.initCallback?e.initCallback:void 0,rightClickCallback:e.rightClickCallback?e.rightClickCallback:void 0})}else r({mapId:e.mapId,layerId:e.layerId,center:e.center,defaultZoom:e.defaultZoom,mapType:e.mapType?e.mapType:h.MAPTYPE.OSM_MAP,url:e.url?e.url:void 0,key:e.key?e.key:void 0,layers:e.layers?e.layers:[],mapName:e.mapName?e.mapName:void 0,version:e.version?e.version:"1.1.1",language:e.language?e.language:"zh-CH",linkage:!!e.linkage&&e.linkage,controls:e.controls?e.controls:void 0,controlStyles:e.controlStyles?e.controlStyles:void 0,initCallback:e.initCallback?e.initCallback:void 0,rightClickCallback:e.rightClickCallback?e.rightClickCallback:void 0})}},failure:function(t){r({mapId:e.mapId,layerId:e.layerId,center:e.center,defaultZoom:e.defaultZoom,mapType:e.mapType?e.mapType:h.MAPTYPE.OSM_MAP,url:e.url?e.url:void 0,key:e.key?e.key:void 0,layers:e.layers?e.layers:[],mapName:e.mapName?e.mapName:void 0,version:e.version?e.version:"1.1.1",language:e.language?e.language:"zh-CH",linkage:!!e.linkage&&e.linkage,controls:e.controls?e.controls:void 0,controlStyles:e.controlStyles?e.controlStyles:void 0,initCallback:e.initCallback?e.initCallback:void 0,rightClickCallback:e.rightClickCallback?e.rightClickCallback:void 0})}})},j=function(e){A.postJSON({url:fusiongis.Constant.GisRootUrl+"/mapCfgView.do",data:JSON.stringify({subject:{param:{},formatter:{date:""}},services:[{name:"mapSourceList",param:{}}]}),success:function(t){if(t){var a=JSON.parse(t);if(a&&1===a.status.code&&a.data){var r=[],o=a.data.mapSourceList;o.forEach(function(e){var t=e&&e.mapFormat,a=e&&e.mapLayer,o=F.htmlDecode(e&&e.mapName);if(t&&9===t){var n=h.GisRootUrl+"/offlineMap/customMap?MAPNAME="+o+"&LAYERS="+a;r.push({mapFormat:t,mapName:o,mapLayer:a,url:n})}}),e&&"function"==typeof e&&e(r)}}},failure:function(e){console.log("离线地图信息获取失败,返回"+e)}})},V=function(e){e.UI?r(e):D(e)},Y=function(e,t){t&&t.getViewport()&&(t.getViewport().oncontextmenu=function(a){var r=t.getTarget();a.preventDefault();var o=t.getEventPixel(a),n=t.hasFeatureAtPixel(o);document.getElementById(r).style.cursor=n?"pointer":"";var l=t.forEachFeatureAtPixel(t.getEventPixel(a),function(e){return e});l?v.keys.filter(function(e){return e.indexOf(r)===e.length-r.length}).forEach(function(o){var i=v.get(o);if(i&&i instanceof m.layer.Layer){var s=i;if(s.hasOwnProperty("rightClickCallback")&&"function"==typeof s.rightClickCallback){var d=o.substring(0,o.indexOf(r)-1);n&&s.rightClickCallback({mapId:e.mapId,layerId:d,layerType:s.get("businessType"),popupPosition:m.proj.toLonLat(t.getEventCoordinate(a)),lonLat:m.proj.toLonLat(m.extent.getCenter(l.getGeometry().getExtent())),geoId:l.getId(),points:!!l.getProperties()&&!!l.getProperties().data&&l.getProperties().data.coordinates})}}}):e.rightClickCallback&&"function"==typeof e.rightClickCallback&&(fusiongis.Popup.removeContextMenu(),e.rightClickCallback({mapId:e.mapId,popupPosition:m.proj.toLonLat(t.getEventCoordinate(a))}))})},B=function(e){var t=b.getMapObj(e.mapId);if(t&&e.mapType&&e.mapType===h.MAPTYPE.GOOGLE_MAP){var a=k.createCustomMap(e);t.set("customMap",a)}},U=new n,W=function(e){var t=e.extent4326,a=e.extent3857,r=e.multiple,o=e.layer,n=!1,l=function(){var e=o.get("lastExtent")||a;return e===a?(n=!0,!0):(n=!1,!m.extent.containsExtent(e,a))}();l&&(n||o.refreshDataCallback({extent:t})),o.set("lastExtent",F.extentTimes(a,r))},H=function(e){if(e&&e.length>0){var t;for(t=0;t<e.length;t++){var a=e[t];if(b.getMapObj(a)){var r=b.getMapObj(a).getViewport();if(r){r.parentNode.removeChild(r);for(var o=v.keys.length;o>0;o--){var n=v.keys[o];n&&n.substring(n.lastIndexOf("_")+1)===a&&n!==a&&v.remove(n)}v.remove(a)}}}}},J=function(e){var t=null,a=e.zoom,r=e.mapId,o=e.layerId,n=e.geoId,l=v.get(r),i=l&&l.getView(),s=o+h.Joiner.UNDERLINE+r,d=v.get(s);if(e.coordinate)t=m.proj.fromLonLat(e.coordinate);else if(n){var c=m.proj.fromLonLat([108,39]);d.get("imgToken")||d.get("params.imgToken")?A.postJSON({url:h.GisRootUrl+"/mapRender/query",data:JSON.stringify({id:[n],imgToken:d.get("imgToken")||d.get("params.imgToken")}),success:function(e){if(e){var t=JSON.parse(e);1===t.status.code&&t.data&&(i||t.data[0].centerPoint)&&(i.setCenter(m.proj.fromLonLat(t.data[0].centerPoint)),a&&i.setZoom(a))}},failure:function(e){console.log("get feature with featureID failed: "+e)}}):c=function(){var e=v.get(o+h.Joiner.UNDERLINE+r),t=e&&e.getSource()&&e.getSource().getFeatureById(n);return t&&m.extent.getCenter(t.getGeometry().getExtent())}(),t=c}if(i&&i){if(l&&l.get("mineCustomMap")){var u=l.get("mineCustomMap"),g=new google.maps.LatLng(e.coordinate[1],e.coordinate[0]);u.setCenter(g),void 0!==a&&null!==a&&u.setZoom(a)}t&&i.setCenter(t),void 0!==a&&null!==a&&i.setZoom(a)}},Z=function(e){return b.getMapObj(e).getView().getZoom()},z=function(e,t){var a=v.get(e),r=a.getView().calculateExtent(a.getSize());return t?m.proj.transformExtent(r,h.PROJ.EPSG_3857,h.PROJ.EPSG_4326):r},K=function(e){if(e&&e instanceof Array)for(var t=0;t<e.length;t++)b.getMapObj(e[t]).updateSize()},X=function(e,t){var a=b.getMapObj(e).getView().getCenter();return m.proj.toLonLat(a,t)},q=function(e){var t=e.mapId,a=null,r=b.getMapObj(t);e.extent?a=m.proj.transformExtent(e.extent,h.PROJ.EPSG_4326,h.PROJ.EPSG_3857):A.postJSON({url:h.GisRootUrl+"/getMapExtent/extent",data:JSON.stringify({geoParams:{fcName:e.fcName}}),success:function(e){if(e){var t=JSON.parse(e);if(t&&t.status&&1===t.status.code&&t.data){var r=t.data.mapExtent;if(0===r.length)return;a=r}}},failure:function(e){console.log(e)}}),!!a&&r.getView().fit(a,r.getSize())},Q=function(e){var t=b.getMapObj(e.mapId),a=t.get("paramObj");e=F.extend({},a,e);var r=t.getView();if(e.center&&e.center instanceof Array){if(e.center[0]===a.center[0]&&e.center[1]===a.center[1])return;r.setCenter(m.proj.fromLonLat(e.center))}if(e.defaultZoom){if(e.defaultZoom===a.defaultZoom)return;r.setZoom(e.defaultZoom)}if(e.maxZoom||e.minZoom){if(e.maxZoom===a.maxZoom&&e.minZoom===a.minZoom)return;var o=r.get(h.MAPPROPERTY.DEFAULT_MAX_ZOOM),n=r.get(h.MAPPROPERTY.DEFAULT_MAX_ZOOM);r.set(h.MAPPROPERTY.DEFAULT_MAX_ZOOM,e.maxZoom||o),r.set(h.MAPPROPERTY.DEFAULT_MIN_ZOOM,e.minZoom||n)}},$=function(e){for(var t=b.getMapObj(e.mapId),a=t.getControls().getArray(),r=a.length;r>0;r--)t.removeControl(a[r]);var o=e.controlStyles?e.controlStyles:{scaleLine:"vGisWeb_scale-line-gis",mousePosition:"vGisWeb_mouse-position-gis"},n=m.control.defaults({zoomOptions:{className:"vGisWeb_olZoom_custom_un"},attributionOptions:{collapsible:!0}}).getArray(),l=e.controls;for(var i in l)n.push(L[l[i]](o[i]));n.forEach(function(e){t.addControl(e)})},ee=function(e){},te=function(e){var t=b.getMapObj(e.mapId),a=e.mapId,r=t.get("paramObj");r.center=m.proj.toLonLat(t.getView().getCenter()),e=F.extend({},r,e),o(e);var n="base_layer";switch(R.removeLayer({mapId:a,layer_id:n}),e.mapType){case h.MAPTYPE.OSM_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,C.createLayer({mapId:a,layerId:e.layerId,layer_id:n}));break;case h.MAPTYPE.HUAWEI_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,O.createLayer({mapId:a,url:e.url,key:e.key,layerId:e.layerId,layer_id:n}));break;case h.MAPTYPE.BING_MAP:if(!e.key)return void console.warn("bing map api license invalid, please enter valid key!");t.getLayers().insertAt(0,x.createLayer({mapId:a,layerId:e.layerId,layer_id:n,key:e.key,layers:e.layers})),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.BING_MAP,bingMapKey:e.key});break;case h.MAPTYPE.WMS_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,_.createLayer({mapId:a,url:e.url,layers:e.layers,layer_id:n,version:e.version,mapName:e.mapName}));break;case h.MAPTYPE.NAVER_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,N.createLayer({mapId:a,layer_id:n,layerId:n}));break;case h.MAPTYPE.GOOGLE_MAP:e&&e.key?k.loadGoogleAPI(e.key,e.language,function(a){a&&(window.sessionStorage&&sessionStorage.setItem("key",e.key),k.createCustomMap(e),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GOOGLE_MAP}))}):console.warn("load google api failed...");break;default:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,C.createLayer({mapId:a,layerId:e.layerId,layer_id:n}))}},ae=function(e){var t={center:Q,defaultZoom:Q,minZoom:Q,maxZoom:Q,proj:ee,mapType:te,layers:u,controls:$};for(var a in e)t.hasOwnProperty(a)&&t[a]&&"function"==typeof t[a]&&t[a](e);var r=e.mapId,o=b.getMapObj(r);o.set("currentMapType",e.mapType);var n=o.get("paramObj");e=F.extend({},n,e),o.set("paramObj",e)};e.exports={createMap:V,destroyCustomMap:o,getMapObj:b.getMapObj,removeMap:H,setMapCenter:J,getZoom:Z,getExtent:z,getCenter:X,setExtent:q,refreshMaps:K,mapAssociate:w.mapAssociate,getMapList:g,isMapExist:y,updateMap:ae,setZoomVisible:p,mapTypeVisible:f,getOffLineMapUrls:j}},function(e,t,a){var r=a(3),o=a(10),n=a(6),l=(a(1),[]),i=null,s=null,d=function(e){var t=e.content,a=r.proj.fromLonLat(e.position),i=e.mapId,s=void 0===e.showCloseButton||e.showCloseButton,d="ol-popupContainer-id"+i,c=o.getDom(d);c&&c.parentNode.removeChild(c);var g=o.createDom({tagName:"div",attributes:{id:d,"class":"ol-popupContainer-class"}}),y=o.createDom({tagName:"a",attributes:{id:"ol-popupClose-id","class":"ol-popupClose-class",href:"#"}}),p=o.createDom({tagName:"div",attributes:{id:"ol-popupContent-id"}});t&&("string"==typeof t?p.innerHTML=t:"object"==typeof t&&p.appendChild(t)),g.appendChild(y),g.appendChild(p),document.body.appendChild(g),s?y.style.display="block":y.style.display="none";var f=new r.Overlay({element:g,position:a});return f.featureCenter=a,f.mapId=i,u(i),n.getMapObj(i).addOverlay(f),l.push(f),g.style.display="block",y.style.position="absolute",y.style.top="2px",y.style.right="8px",y.onclick=function(){u(i)},f},c=function(e){var t=e.content,a=r.proj.fromLonLat(e.position),l=e.mapId,s="ol-susPopupContainer-id"+l,d=o.getDom(s);d&&d.parentNode.removeChild(d);var c=o.createDom({tagName:"div",attributes:{id:s,"class":"ol-susPopupContainer-class"}}),u=o.createDom({tagName:"div",attributes:{id:"ol-susPopupContent-id"}});"string"==typeof t?u.innerHTML=t:u.appendChild(t),c.appendChild(u),document.body.appendChild(c),i&&n.getMapObj(l).removeOverlay(i);var g=new r.Overlay({element:c,position:a,mapId:l});n.getMapObj(l).addOverlay(g),i=g,c.style.display="block"},u=function(e){l&&l.length>0&&l.forEach(function(t,a,r){t.mapId===e&&(n.getMapObj(e).removeOverlay(t),r.splice(a,1))})},g=function(e){i&&n.getMapObj(e).removeOverlay(i)},y=function(e){var t=r.proj.fromLonLat(e.position),a=e.mapId,o=n.getMapObj(a),l=e.element;s=new r.Overlay({element:l,positioning:"top-left",position:t}),s.setMap(o),fusiongis.Events.addClickCallback(a,"popup-click-event",function(){s.setPosition(void 0)})},p=function(){s&&s.setPosition(void 0)};e.exports={addPopup:d,removePopup:u,getPopups:function(){return l},addSuspensionPopup:c,removeSuspensionPopup:g,addContextMenu:y,removeContextMenu:p}},function(e,t,a){function r(e,t,a){e.addEventListener(t,a)}function o(e,t,a){e.removeEventListener(t,a)}var n=a(4),l=a(1),i=function(e){return"."===e.substring(0,1)?document.getElementsByClassName(e.substring(1)):document.getElementById(e)},s=function(e){var t=e.tagName,a=e.attributes,r=e.text,o=document.createElement(t);for(var n in a)o.setAttribute(n,a[n]);return r&&(o.innerHTML=r),o},d=function(e){var t=e.mapId,a=e.dom,r=void 0,o=void 0,i=void 0,d=void 0,c=function(){if(e.style){var t=e.style;r=t.top+"px"||void 0,o=t.bottom+"px"||void 0,d=t.right+"px"||void 0,i=t.left+"px"||void 0}var a=[];return r&&a.push("top: "+r),o&&a.push("bottom: "+o),d&&a.push("right: "+d),i&&a.push("left: "+i),a.join(";")+";"}(),u=!!t&&n.get(t),g=function(){return!!(u&&u instanceof ol.Map)||(console.error("map init failed, please load map before!!!"),!1)}();if(g){var y=u.getTargetElement(),p=s({tagName:"div",attributes:{id:l.getUUID(),style:"position: absolute;z-index: 1000;"+c}});y.appendChild(p),a&&p.appendChild(a)}};e.exports={on:r,off:o,getDom:i,createDom:s,appendExtendNode:d}},function(e,t,a){function r(e){var t=v.getMapObj(e.mapId);if(t){var a=t.get("zoomCallbackList"),r=e.callbackfunc;r&&"function"==typeof r&&(e.id&&(r.id=e.id),a.push(e.callbackfunc))}}function o(e){e.get("zoomCallbackList")||e.set("zoomCallbackList",[]),e.getView().on("change:resolution",function(e){var t=e.target,a=t.get("linkedMapIds");a.forEach(function(a){var r={mapId:a,zoom:t.getZoom(),lonLat:m.proj.toLonLat(t.getCenter())},o=v.getMapObj(a);if(o){var n=o.get("zoomCallbackList");n.forEach(function(t){t(r,e)})}})})}function n(e){var t=v.getMapObj(e.mapId);if(t){var a=t.get("centerCallbackList"),r=e.callbackfunc;r&&"function"==typeof r&&(e.id&&(r.id=e.id),a.push(e.callbackfunc))}}function l(e){e.get("centerCallbackList")||e.set("centerCallbackList",[]),e.getView().on("change:center",function(t){var a=t.target,r=a.get("linkedMapIds");r.forEach(function(a){var r={mapId:a,lonLat:m.proj.toLonLat(e.getView().getCenter())},o=v.getMapObj(a);if(o){var n=o.get("centerCallbackList");n.forEach(function(e){e(r,t)})}})})}function i(e,t){var a=[];if(2===arguments.length){var r=t.layerType,o=t.geometry;if(o){"String"==typeof o&&(o=JSON.parse(o));var n=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(m.proj.toLonLat(t))}},l=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(m.proj.toLonLat(t))}},i=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(m.proj.transformExtent(t,"EPSG:3857","EPSG:4326"))}};switch(r){case b.BUSINESSTYPE.GRID:i();break;case b.BUSINESSTYPE.SITE:l();break;case b.BUSINESSTYPE.SERVICEPOINT:l();break;case b.BUSINESSTYPE.CELL:n();break;case b.BUSINESSTYPE.SERVICELINE:n();break;default:n()}}}else{var s=e&&e.getGeometry();if(!s)return;if(s instanceof m.geom.GeometryCollection)return;var d=s.getCoordinates();if(!d)return[];if(s instanceof m.geom.Point)a.push(m.proj.toLonLat(d));else if(s instanceof m.geom.LineString)for(var c=0;c<d.length;c++){var u=d[c];a.push(m.proj.toLonLat(u))}else if(s instanceof m.geom.Polygon)for(var c=0;c<d[0].length;c++){var u=d[0][c];a.push(m.proj.toLonLat(u))}}return a}function s(e){var t=v.getMapObj(e);if(!t.get("clickHandle")){var a={};t.set("callbackList",a),t.set("eventKeyANDEventLayerObj",{});var r=t.on("click",function(a){var r=[],o=[],n=[],l=[];t.forEachFeatureAtPixel(a.pixel,function(e){if(e)if(e.get("vectorType")===b.BUSINESSTYPE.POINT||e.get("vectorType")===b.BUSINESSTYPE.LINE||e.get("vectorType")===b.BUSINESSTYPE.POLYGON){if(!e.get("hType")){l.push(e),r.push(e);var t=e.getId()?e.getId():e.get("id");o.push(t)}}else{r.push(e);var t=e.getId()?e.getId():e.get("id");o.push(t)}}),n=t.getCoordinateFromPixel(a.pixel),n&&(n=m.proj.toLonLat(n));var s=t.get("callbackList"),d=t.get("eventKeyANDEventLayerObj");if(l.length>1){var c=document.createElement("div"),u=document.createElement("ul");c.appendChild(u),c.style.width="400px",c.style.maxHeight="300px",c.className="clickpop-content",l.forEach(function(t){var r=t.get("data"),o=document.createElement("li"),n=r.label||t.get("layerId");t.geoName&&(n=n+"--"+t.geoName),o.innerHTML=n,o.className="vGisWeb-restrict-line clickpop-line",o.title=n,o.style.cursor="pointer",o.attributes.feature=t,o.onclick=function(){h.removeAllPopup(e);var t={e:a,layer:this.attributes.feature.get("layer"),feature:this.attributes.feature},r=this.attributes.feature.get("businessType");r===b.BUSINESSTYPE.POINT?s.business_vector_point_event_id&&s.business_vector_point_event_id(t):r===b.BUSINESSTYPE.LINE?s.business_line_event_id&&s.business_line_event_id(t):r===b.BUSINESSTYPE.POLYGON&&s.business_vector_polygon_event_id&&s.business_vector_polygon_event_id(t)},u.appendChild(o)}),h.addPopup({mapId:e,title:I.prop("mapClick.popup.title"),position:m.proj.toLonLat(a.coordinate),content:c,maxHeight:300,width:280})}else if(1===l.length){h.removeAllPopup(e);var v=l[0].get("vectorType"),S=null,L=null;r.length>0&&(L=r[0]);var w=L&&L.getGeometry()&&L.getGeometry().getExtent(),T=m.extent.getCenter(w),O=[];T&&(O=m.proj.toLonLat(T));var _={e:a,layer:l[0].get("layer"),feature:l[0],featureCenter:T,data:L&&L.get("data"),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:o[0],geoId:o[0],lonLat:O&&[O[0].toFixed(6),O[1].toFixed(6)],pixLonLat:n,points:L&&L.getGeometry()&&i(L)};v===b.BUSINESSTYPE.POINT?s.business_vector_point_event_id&&s.business_vector_point_event_id(_):v===b.BUSINESSTYPE.LINE?s.business_line_event_id&&s.business_line_event_id(_):v===b.BUSINESSTYPE.POLYGON&&s.business_vector_polygon_event_id&&s.business_vector_polygon_event_id(_)}else s.business_vector_point_event_id&&s.business_vector_point_event_id({}),s.business_line_event_id&&s.business_line_event_id({}),s.business_vector_polygon_event_id&&s.business_vector_polygon_event_id({});for(var N in s)if("business_vector_point_event_id"!==N&&"business_line_event_id"!==N&&"business_vector_polygon_event_id"!==N&&"function"==typeof s[N]){var L=null,S=null;r.length>0&&(L=r[0]);var w=L&&L.getGeometry().getExtent(),T=w&&m.extent.getCenter(w),O=[];T&&(O=m.proj.toLonLat(T));var P=d[N];if(S=P,P&&S){if(S.get("layer_id")===P.get("layer_id"))if(S.get("businessType")===b.BUSINESSTYPE.GRID)g(t,S,a,N,function(t){s[t.key]({e:a,layer:S,feature:L,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:i(void 0,{layerType:b.BUSINESSTYPE.GRID,geometry:t.geometry}),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:t.geoId,pixLonLat:n})});else if("DCELL"===S.get("businessType"))y(t,S,a,N,function(t){t&&t.length>0&&(t=t[0],s[t.key]({e:a,layer:S,feature:L,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:i(void 0,{layerType:b.BUSINESSTYPE.CELL,geometry:t.geometry}),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:t.geoId,pixLonLat:n}))});else if("DPOINT"===S.get("businessType"))p(t,S,a,N,function(t){t&&t.length>0&&(t=t[0],s[t.key]({e:a,layer:S,feature:L,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:i(void 0,{layerType:b.BUSINESSTYPE.SITE,geometry:t.geometry}),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:t.geoId,pixLonLat:n}))});else if("DLINE"===S.get("businessType"))f(t,S,a,N,function(e){e=e[0],s[e.key]({e:a,layer:S,feature:L,featureCenter:e.lonLat,data:e.data,geoId:e.geoId,layerId:!!S&&S.get("layer_id"),featureId:e.geoId,pixLonLat:n})});else if("DPOLYGON"===S.get("businessType"))E(t,S,a,N,function(t){t=t[0],s[t.key]({e:a,layer:S,feature:L,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:i(void 0,{layerType:b.BUSINESSTYPE.SERVICEPOLYGON,geometry:t.geometry}),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:t.geoId,pixLonLat:n})});else if(S.get("businessType")===b.BUSINESSTYPE.SERVICEPOINT)C(t,S,a,N,function(t){t=t[0],s[t.key]({e:a,layer:S,feature:L,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:i(void 0,{layerType:b.BUSINESSTYPE.SERVICEPOINT,geometry:t.geometry}),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:t.geoId,pixLonLat:n})});else if(S.get("businessType")===b.BUSINESSTYPE.SERVICELINE)x(t,S,a,N,function(t){t=t[0],s[t.key]({e:a,layer:S,feature:L,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:i(void 0,{layerType:b.BUSINESSTYPE.SERVICELINE,
geometry:t.geometry}),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:t.geoId,pixLonLat:n})});else if(S.get("businessType")===b.BUSINESSTYPE.SERVICEPOLYGON)k(t,S,a,N,function(t){t=t[0],s[t.key]({e:a,layer:S,feature:L,featureCenter:t.lonLat,data:t.data,geoId:t.geoId,lonLat:t.lonLat,points:i(void 0,{layerType:b.BUSINESSTYPE.SERVICEPOLYGON,geometry:t.geometry}),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,layerId:!!S&&S.get("layer_id"),featureId:t.geoId,pixLonLat:n})});else{var M=function(){if(L)return L.get("features")?1===L.get("features").length?L.get("features")[0].get("id"):void 0:L.get("id")},F=function(){if(L)return L.get("features")?1===L.get("features").length?L.get("features")[0].get("data"):void 0:L.get("data")},R={e:a,layer:S,feature:L,data:F(),businessType:S&&S.get("businessType"),layerType:S&&S.get("businessType"),mapId:e,target:e,geoId:M(),featureId:M(),layerId:!!S&&S.get("layer_id"),featureCenter:T,lonLat:O?O:[108,34],pixLonLat:n,points:L&&L.getGeometry()&&i(L)};L&&L.getGeometry&&L.getGeometry().getArea&&(R.area=L.getGeometry().getArea()),s[N](R)}}else s[N]({e:a})}});t.set("clickHandle",r)}}function d(e){var t=v.getMapObj(e);t.get("clickHandle")&&(t.unByKey(t.get("clickHandle")),t.set("clickHandle",null))}function c(e,t,a,r){var o=v.getMapObj(e);if(void 0!==t&&"function"==typeof a){o.get("callbackList")&&(o.get("callbackList")[t.toString()]=a);var n=function(){if(r)return S.get(r+"_"+e)}();o.get("eventKeyANDEventLayerObj")&&(o.get("eventKeyANDEventLayerObj")[t.toString()]=n)}}function u(e,t){var a=v.getMapObj(e);void 0!==t&&(delete a.get("callbackList")[t.toString()],delete a.get("eventKeyANDEventLayerObj")[t.toString()])}function g(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:{x:a.coordinate[0],y:a.coordinate[1]},tolerance:1,mapExtent:n,imgToken:t.get("imgToken")};L.postJSON({url:b.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(l),success:function(e){var t=JSON.parse(e),a=t.status,n=t.data&&t.data.length>0&&t.data[0];1===a.code?n&&o({lonLat:n.centerPoint,geometry:n.geometry,geoId:n.id,data:n,key:r}):o({})},failure:function(e){console.log(e)}})}function y(e,t,a,r,o){if(!t.getVisible())return void o([]);var n,l,i,s;if(a.coordinate){i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),l=t.get("imgToken"),s=l.slice(0,l.indexOf(":"));var d={geometry:i,tolerance:.1,mapExtent:n,imgToken:l,FCName:s}}L.get({url:b.GisRootUrl+"/common/mapRender/identify",data:w.getParameterString(d),success:function(a){if(!a)return void o([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([]);var n=w.sortBy(a.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),l=n[0].extentInfo.radius;n=n.filter(function(e){return e.extentInfo.radius===l}),n.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var i=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r}});o(i)},failure:function(){"function"==typeof o&&o([])}})}function p(e,t,a,r,o){if(!t.getVisible())return void o([]);var n,l,i;l=t.get("imgToken"),i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(",");var s=l.slice(0,l.indexOf(":")),d={geometry:i,tolerance:1,mapExtent:n,imgToken:l,FCName:s};L.get({url:b.GisRootUrl+"/common/mapRender/identify",data:w.getParameterString(d),success:function(a){if(!a)return void o([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([]);var n=a.data,l=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,geoId:a.id,geoName:a.name,key:r}});o(l)},failure:function(){o([])}})}function f(e,t,a,r,o){if(!t.getVisible())return void o([]);var n,l,i,s;l=t.get("imgToken"),i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),s=l.slice(0,l.indexOf(":"));var d={geometry:i,tolerance:1,mapExtent:n,imgToken:l,FCName:s};L.get({url:b.GisRootUrl+"/common/mapRender/identify",data:w.getParameterString(d),success:function(a){if(!a)return void o([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([]);var n=a.data,l=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,geoId:a.id,geoName:a.name,key:r}});o(l)},failure:function(){o([])}})}var m=a(3),v=a(6),h=a(12),I=a(13),b=a(7),S=a(4),L=a(14),w=a(1),T=function(e){var t=e.mapId,a=e.callback,r=v.getMapObj(t);if(r){var o=r.getTargetElement().querySelector(".toolbar-container");o&&(o.onclick=function(e){var t=e.target,r="";r=t.className.indexOf("Gray")!==-1||t.className.indexOf("exportData")!==-1?t.parentElement.parentElement.parentElement.id:t.parentElement.parentElement.id,a&&"function"==typeof a&&a({mapId:r,domId:t.classList[t.classList.length-1]})})}},E=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l=t.get("imgToken"),i=l.slice(0,l.indexOf(":")),s={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:.1,mapExtent:n,imgToken:l,FCName:i};L.get({url:b.GisRootUrl+"/common/mapRender/identify",data:w.getParameterString(s),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})},k=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:.1,mapExtent:n,imgToken:t.get("params.imgToken")};L.get({url:b.GisRootUrl+"/mapRender/identify",data:w.getParameterString(l),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})},C=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:10,mapExtent:n,imgToken:t.get("imgToken")};L.get({url:b.GisRootUrl+"/mapRender/identify",data:w.getParameterString(l),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})},x=function(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),l={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:10,mapExtent:n,imgToken:t.get("imgToken")};L.get({url:b.GisRootUrl+"/mapRender/identify",data:w.getParameterString(l),success:function(a){if(a){var n=JSON.parse(a),l=n.status;if(1===l.code&&n.data&&n.data.length>0){var i=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(i)}}},failure:function(e){o([])}})};e.exports={zoomChangeEvent:o,centerChangeEvent:l,onZoomChange:r,onCenterChange:n,registerDomEvent:T,mapClick:s,mapUnClick:d,addClickCallback:c,removeClickCallback:u}},function(e,t,a){function r(e){return g.getMapObj(e)}function o(e,t){var a=r(e).getOverlays().getArray();return y.find(a,function(e){return e.get("name")===t})}function n(e,t,a){var r=e.getBoundingClientRect(),o=t-r.left,n=a-r.top;e.style.left=e.offsetLeft+o+"px",e.style.top=e.offsetTop+n+"px"}function l(e){this.setOptions(e),this.setElement()}function i(e){var t=e.mapId,a=r(t);if(a){var n=o(t,"popup-default");n&&a.removeOverlay(n);var i=new l(e),s=new u.Overlay({element:i.element});s.set("type","popups"),s.set("name","popup-default"),s.setPosition(u.proj.fromLonLat(e.position)),s.popover=i,a.addOverlay(s),i.show()}}function s(e){var t=r(e);t&&d(e,"popups",function(e){e.popover&&e.popover.destroy()})}function d(e,t,a){var o=r(e).getOverlays().getArray().slice(0);o.forEach(function(o){o.get("type")===t&&(a&&a(o),r(e).removeOverlay(o))})}function c(e,t){var a=r(e);if(a){var n=o(e,t);n&&(n.popover&&n.popover.destroy(),a.removeOverlay(n))}}var u=a(3),g=a(6),y=a(1),p=a(10);l.prototype.setOptions=function(e){this.options=e,this.title=e.title?e.title:""},l.prototype.setElement=function(){var e=document.createElement("div");e.className="gisCovery-popup",e.style.minWidth="100px";var t=document.createElement("div");t.className="gisCovery-popup-header";var a=document.createElement("div");a.className="gisCovery-popup-title",a.innerHTML=this.title,t.appendChild(a);var r=document.createElement("div");r.className="gisCovery-popup-close",r.innerHTML="✖",t.appendChild(r);var o=document.createElement("div");o.className="gisCovery-popup-content",this.options.contentClass&&o.classList.add(this.options.contentClass),this.options.contentId&&(o.id=this.options.contentId),"string"==typeof this.options.content?o.innerHTML=this.options.content:o.appendChild(this.options.content);var n=document.createElement("div");n.className="gisCovery-popup-arrow",e.appendChild(t),e.appendChild(o),e.appendChild(n),this.headerElement=t,this.contentElement=o,this.arrowElement=n,this.element=e;var l=this;p.on(r,"click",function(){c(l.options.mapId,"popup-default")})},l.prototype.getPosition=function(e){return e=e||this.element.parentNode,e.getBoundingClientRect()},l.prototype.getCalculatedOffset=function(e,t,a,r){return"bottom"===e?{top:t.top+t.height,left:t.left+t.width/2-a/2}:"top"===e?{top:t.top-r,left:t.left+t.width/2-a/2}:"left"===e?{top:t.top+t.height/2-r/2,left:t.left-a}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},l.prototype.show=function(){var e=this.getPosition(),t=this.element,a=t.offsetWidth,r=t.offsetHeight,o=this.getCalculatedOffset("top",e,a,r);n(t,o.left,o.top+5)},l.prototype.destroy=function(){this.element=null,this.headerElement=null,this.contentElement=null,this.arrowElement=null},e.exports={addPopup:i,removeAllPopup:s}},function(e,t,a){function r(e){e!==i.ZH&&e!==i.EN&&e!==i.ES||(s=e)}function o(){return s}function n(e){return g[s][e]}var l=a(7),i=l.I18N,s=function(){function e(e){for(var t=0;t<a.length;t++){var r=a[t],o=r.split("=");if(e==o[0].trim()&&o[1])return o[1].trim()}}var t=i.EN;if(document.cookie.indexOf("locale=")===-1)t=i.EN;else{var a=document.cookie.split(";");t=!!e("locale")&&e("locale").slice(0,2),t||(t=!!e("exlocale")&&e("exlocale").slice(0,2)),t||(console.log("%c 通过cooie获取国际化资源是被，系统指定en","color:blue;font-size:14px;"),t=i.EN)}return t}(),d={},c={},u={},g={en:d,zh:c,es:u};c["common.km"]="公里",c["common.m"]="米",c["mapClick.popup.title"]="图层选择",c["measure.message.startHelper"]="单击确定起点",c["measure.message.helper"]="单击确点起点，双击结束",c["measure.message.start"]="起点",c["measure.message.total"]="总长：",c["measureArea.message.total"]="总面积：",c["layerManager.title"]="图层管理",c["LayerLabel.BASELAYER"]="底图",c["LayerLabel.NE"]="工参",c["components.drawPolygon"]="画多边形",c["components.exportImage.title"]="导出",c["components.exportImage.saveType"]="保存类型：",c["components.exportImage.OK"]="确定",c["components.exportImage.Cancel"]="取消",c["components.exportImage.Layers"]="图层",c["components.exportImage.format"]="格式",c["components.exportImage.closeExportBox"]="关闭导出框界面",c["search.layerName"]="图层名称",c["search.propertyName"]="属性名",c["search.propertyValue"]="属性值",c["search.online"]="在线搜索",c["search.offline"]="离线搜索",c["search.title"]="搜索",c["search.click.search"]="点击搜索",c["search.current.map.not.support"]="当前地图不支持搜索，请使用谷歌或者OSM",c["search.elementList"]="元素列表",c["search.cell"]="小区",c["search.site"]="基站",c["search.systemPolygon"]="系统多边形",c["search.choose"]="请选择",c["toolbar.layerManger"]="图层管理",c["toolbar.exportImage"]="导出图片",c["toolbar.exportData"]="导出数据",c["toolbar.search"]="在线 & 离线 搜索",c["toolbar.lonLatGridLine"]="经纬度栅格线",c["toolbar.drawPolygon"]="画多边形",c["toolbar.drawLine"]="划线",c["toolbar.drawPoint"]="画点",c["toolbar.measureDistance"]="测量距离",c["toolbar.measureArea"]="测量面积",c["toolbar.measureAngle"]="测量角度",d["common.km"]="km",d["common.m"]="m",d["mapClick.popup.title"]="Layer Select",d["measure.message.startHelper"]="Click to determine the location.",d["measure.message.helper"]="Click to determine the location<br> or double-click to finish.",d["measure.message.start"]="Start",d["measure.message.total"]="Total Distance:",d["measureArea.message.total"]="Total Area：",d["layerManager.title"]="Layer Management",d["LayerLabel.BASELAYER"]="Base Layer",d["LayerLabel.NE"]="NE",d["components.drawPolygon"]="Draw Polygon",d["components.exportImage.title"]="Export",d["components.exportImage.saveType"]="Save as:",d["components.exportImage.OK"]="OK",d["components.exportImage.Cancel"]="Cancel",d["components.exportImage.Layers"]="Layers",d["components.exportImage.format"]="format",d["components.exportImage.closeExportBox"]="Close the Export Box interface",d["search.layerName"]="layer name",d["search.propertyName"]="attr_ name",d["search.propertyValue"]="attr_ value",d["search.online"]="Online search",d["search.offline"]="Offline search",d["search.title"]="search",d["search.click.search"]="click search",d["search.current.map.not.support"]="current map not support search, please use osm or google",d["search.elementList"]="element list",d["search.cell"]="cell",d["search.site"]="site",d["search.systemPolygon"]="system polygon",d["search.choose"]="please choose",d["toolbar.layerManger"]="layer manager",d["toolbar.exportImage"]="export image",d["toolbar.exportData"]="export data",d["toolbar.search"]="online & offline search",d["toolbar.lonLatGridLine"]="lonLat grid line",d["toolbar.drawPolygon"]="draw polygon",d["toolbar.drawLine"]="draw line",d["toolbar.drawPoint"]="draw point",d["toolbar.measureDistance"]="measure distance",d["toolbar.measureArea"]="measure area",d["toolbar.measureAngle"]="measure angle",u["common.km"]="kilómetro",u["common.m"]="metro",u["mapClick.popup.title"]="Seleccione capa",u["measure.message.startHelper"]="Haga clic en OK para iniciar",u["measure.message.helper"]="Haga clic en OK punto de partida, de dos extremos",u["measure.message.start"]="punto de partida",u["measure.message.total"]="Longitud total：",u["measureArea.message.total"]="El área total：",u["layerManager.title"]="capa de Gestión",u["LayerLabel.BASELAYER"]="arpillera",u["LayerLabel.NE"]="El trabajo de referencia",u["components.drawPolygon"]="Videos polígono",u["components.exportImage.title"]="exportación",u["components.exportImage.saveType"]="Guardar como tipo：",u["components.exportImage.OK"]="determinar",u["components.exportImage.Cancel"]="cancelado",u["components.exportImage.Layers"]="capas",u["components.exportImage.format"]="formato",u["components.exportImage.closeExportBox"]="Cerrar la caja de interconexión de exportación",e.exports={setLang:r,getLang:o,prop:n}},function(e,t,a){function r(){if(!o.GlobalVariable.csrfToken){var e=n(),t=o.GisRootUrl+"/csrftoken.do";e.open("GET",t,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),e.send(null),e.onreadystatechange=function(){if(4===e.readyState){var t=e.status;if(t>=200&&t<300){var a=e.responseText;if(a){var r=JSON.parse(a);if(1===r.status.code){var n=r._csrf_header,l=r._csrf;o.GlobalVariable.csrfToken=n+"|"+l}}}else console.log("%c fusiongis get csrftoken failed, ajax.setHeader","font-size:14px;color:red")}}}}var o=(a(1),a(7)),n=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml");else if(window.ActiveXObject)for(var t=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],a=0;a<t.length;a++)try{if(e=new ActiveXObject(t[a]))break}catch(r){}return e},l=function(e){var t=n(),a=setTimeout(function(){var r=e.url;e.data&&(r=r+"?"+e.data),t.open("GET",r,!0);var n=o.GlobalVariable.csrfToken;if(n){var l=n.split("|");t.setRequestHeader(l[0],l[1]),t.onreadystatechange=function(){if(4===t.readyState){var r=t.status;r>=200&&r<300?e.success&&"function"==typeof e.success&&e.success(t.responseText):(e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status)),clearTimeout(a)}},t.send(null)}else console.log("%c fusiongis get csrftoken failed, ajax.get","font-size:14px;color:red"),e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status)},500)},i=function(e){var t=n();if(t)var a=setTimeout(function(){t.open("POST",e.url,!0),t.setRequestHeader("Content-Type","application/json; charset=UTF-8;");var r=o.GlobalVariable.csrfToken;if(r){var n=r.split("|");t.setRequestHeader(n[0],n[1]),t.onreadystatechange=function(){if(4===t.readyState){var r=t.status;r>=200&&r<300?e.success&&"function"==typeof e.success&&e.success(t.responseText):(e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status))}clearTimeout(a)},t.send(e.data)}else console.log("%c fusiongis get csrftoken failed, ajax.post or ajax.postJSON","font-size:14px;color:red"),e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status)},500)};e.exports={setHeader:r,get:l,post:i,postJSON:i}},function(e,t,a){var r=a(3),o=a(7),n=function(e){return e?new r.control.ScaleLine({className:e}):new r.control.ScaleLine},l=function(e){return e?new r.control.MousePosition({className:e,coordinateFormat:r.coordinate.createStringXY(6),projection:o.PROJ.EPSG_4326}):new r.control.MousePosition({coordinateFormat:r.coordinate.createStringXY(6),projection:o.PROJ.EPSG_4326})},i=function(e,t,a){return e?new r.control.ZoomToExtent({extent:r.proj.transformExtent(e,t,a)}):new r.control.ZoomToExtent({extent:r.proj.transformExtent([94.37296875000001,31.667004036130592,131.28703125,44.28205382728058],o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)})},s=function(e){return e?new r.control.OverviewMap({className:e,collapsible:!0}):new r.control.OverviewMap({collapsible:!0})};e.exports={scaleLine:n,mousePosition:l,zoomContent:i,overviewMap:s}},function(e,t,a){function r(e){var t=e.isAssociate,a=e.mapIds;if(a&&a.forEach(function(e){t?(o(e),s.put("nowLink",!0)):(n(e),s.put("nowLink",!1))}),d.length>0){var r,c,u,g;d.forEach(function(e,t){if(0===t){r=l.getMapObj(e),c=r.getView(),u=r.get("currentMapType"),g=r.get("mineCustomMap");var a=c.getCenter();a=ol.proj.toLonLat(a),a=[a[0]+1e-8,a[1]],a=ol.proj.fromLonLat(a),c.setCenter(a)}if("GOOGLE_MAP"===u){var o=l.getMapObj(e).get("mineCustomMap"),n=ol.proj.toLonLat(c.getCenter());o.setCenter(new google.maps.LatLng(n[1],n[0])),o.setZoom(c.getZoom())}})}e.hasOwnProperty("isOpen")&&i.acrossLine(e)}function o(e){var t=l.getMapObj(e);if(t){t.updateSize(),d.indexOf(e)===-1&&d.push(e);var a=l.getMapObj(d[0]),r=a.getView(),o=t.getView(),n=a.get("currentMapType");if("GOOGLE_MAP"===n){var i=t.get("mineCustomMap");if(!i)return;var s=t.get("customCenterKey"),c=t.get("customResolutionKey");s&&t.unByKey(s),c&&t.unByKey(c);var u=function(e){google.maps.event.trigger(i,"resize");var t=e.target,a=ol.proj.toLonLat(t.getCenter());i.setCenter(new google.maps.LatLng(a[1],a[0]))},g=function(e){var t=e.target;i.setZoom(t.getZoom())},s=r.on("change:center",u),c=r.on("change:resolution",g);t.set("customCenterKey",s),t.set("customResolutionKey",c)}o!==r&&t.setView(r);var y=r.get("linkedMapIds");y.indexOf(e)===-1&&y.push(e)}}function n(e){var t=l.getMapObj(e);if(t){t.updateSize();var a=t.get("mineView");if(d.indexOf(e)!==-1&&!(d.length<1)){var r=l.getMapObj(d[0]),o=r.get("currentMapType"),n=r.getView();if("GOOGLE_MAP"===o){var i=t.get("mineCustomMap");if(!i)return;var s=i.olViewPropery,c=ol.proj.toLonLat(s.center);i.setCenter(new google.maps.LatLng(c[1],c[0])),i.setZoom(s.zoom);var u=t.get("customCenterKey"),g=t.get("customResolutionKey");u&&t.unByKey(u),g&&t.unByKey(g);var y=function(e){google.maps.event.trigger(i,"resize");var t=e.target,a=ol.proj.toLonLat(t.getCenter());i.setCenter(new google.maps.LatLng(a[1],a[0]))},p=function(e){var t=e.target;i.setZoom(t.getZoom())},u=a.on("change:center",y),g=a.on("change:resolution",p);t.set("customCenterKey",u),t.set("customResolutionKey",g);var f=fusiongis.Map.getMapObj(e).get("mineCustomMap");google.maps.event.trigger(f,"resize");var m=ol.proj.toLonLat(n.getCenter());f.setCenter(new google.maps.LatLng(m[1],m[0])),f.setZoom(n.getZoom())}t.setView(a);var v=n.get("linkedMapIds"),h=v.indexOf(e);h>-1&&(v.splice(h,1),d.splice(h,1))}}else for(var I in d)d[I]==e&&d.splice(I,1)}var l=a(6),i=a(17),s=a(4),d=[];e.exports={mapAssociate:r}},function(e,t,a){function r(e){var t=e.mapIds;if(e.isOpen){var a=[],r=e.crossLength||30;if(t&&t.length>0)for(var n=0,l=t.length;n<l;n++){var i=o.getMapObj(t[n]);if(i){a.push(i);var s=new ol.style.Style({stroke:new ol.style.Stroke({color:e.strokeColor||"#000000",width:e.width||2})}),d=new ol.Feature({geometry:new ol.geom.LineString([[0,0],[1,1]])}),c=new ol.Feature({geometry:new ol.geom.LineString([[0,0],[1,1]])});d.setId(t[n]+"_across"),c.setId(t[n]+"upDown"),d.setStyle(s),c.setStyle(s);var u=new ol.layer.Vector({source:new ol.source.Vector({features:[d,c],wrapX:!1})});i.set("acrossFeature",d),i.set("upDownFeature",c),u.set("id","crossLayer"),i.addLayer(u);var g=i.on("pointermove",function(e){this.getTargetElement().style.cursor="default";for(var t=e.pixel,o=this.getCoordinateFromPixel([t[0]+r/2,t[1]]),n=this.getCoordinateFromPixel([t[0]-r/2,t[1]]),l=this.getCoordinateFromPixel([t[0],t[1]+r/2]),i=this.getCoordinateFromPixel([t[0],t[1]-r/2]),s=0;s<a.length;s++)a[s].get("acrossFeature").setGeometry(new ol.geom.LineString([o,n])),a[s].get("upDownFeature").setGeometry(new ol.geom.LineString([l,i]))});i.set("crossLayer",u),i.set("crossLineHandle",g)}}}else if(t&&t.length>0)for(var n=0,l=t.length;n<l;n++){var i=o.getMapObj(t[n]);i&&(i.unByKey(i.get("crossLineHandle")),i.removeLayer(i.get("crossLayer")))}}var o=a(6);e.exports={acrossLine:r}},function(e,t,a){function r(e){var t=new o.View({center:e.center?o.proj.fromLonLat(e.center):o.proj.fromLonLat(n.MAPPROPERTY.DEFAULT_CENTER),zoom:e.defaultZoom?e.defaultZoom:n.MAPPROPERTY.DEFAULT_ZOOM,maxZoom:e.maxZoom?e.maxZoom:n.MAPPROPERTY.DEFAULT_MAX_ZOOM,minZoom:e.minZoom?e.minZoom:n.MAPPROPERTY.DEFAULT_MIN_ZOOM,projection:e.proj?e.proj:n.PROJ.EPSG_3857});return t.set("linkedMapIds",[e.mapId]),t}var o=a(3),n=a(7);e.exports={createView:r}},function(e,t,a){var r=a(7),o=(a(4),function(e){var t=document.createElement(e.labelName);return!!e.id&&t.setAttribute("id",e.id),!!e["class"]&&t.setAttribute("class",e["class"]),!!e.title&&t.setAttribute("title",e.title),t}),n=function(e){var t=e.mapObj,a=e.mapType,n=e.bingMapKey,l=t.getTarget(),i=t.getTargetElement(),s=null;if(i.querySelector(".map_type_toolbar_container")?s=i.querySelector(".map_type_toolbar_container"):(s=o({labelName:"div","class":"map_type_toolbar_container"}),t.getTargetElement().appendChild(s)),function(){var e=s&&s.childNodes;if(e)for(var t=e.length,a=t;a>0;a--)s.removeChild(e[a-1])}(),a===r.MAPTYPE.GOOGLE_MAP){var d="base_layer_id_google",c=o({labelName:"div","class":"small_map_button google road"}),u=o({labelName:"div","class":"small_map_button google satellite"}),g=o({labelName:"div","class":"small_map_button google terrain"}),y=o({labelName:"div","class":"small_map_button google hybrid"});s.appendChild(c),s.appendChild(u),s.appendChild(g),s.appendChild(y),c.onclick=function(){fusiongis.Map.updateMap({mapId:l,mapType:a,layerId:d,layers:"roadmap"})},u.onclick=function(){fusiongis.Map.updateMap({mapId:l,mapType:a,layerId:d,layers:"satellite"})},g.onclick=function(){fusiongis.Map.updateMap({mapId:l,mapType:a,layerId:d,layers:"terrain"})},y.onclick=function(){fusiongis.Map.updateMap({mapId:l,mapType:a,layerId:d,layers:"hybrid"})}}else if(a===r.MAPTYPE.BING_MAP){var d="base_layer_id_bing",c=o({labelName:"div","class":"small_map_button bing road"}),u=o({labelName:"div","class":"small_map_button bing satellite"}),y=o({labelName:"div","class":"small_map_button bing hybrid"});s.appendChild(c),s.appendChild(u),s.appendChild(y),c.onclick=function(){n&&fusiongis.Map.updateMap({mapId:l,mapType:a,key:n,layerId:d,layers:"Road"})},u.onclick=function(){n&&fusiongis.Map.updateMap({mapId:l,mapType:a,key:n,layerId:d,layers:"Aerial"})},y.onclick=function(){n&&fusiongis.Map.updateMap({mapId:l,mapType:a,key:n,layerId:d,layers:"AerialWithLabels"})}}};e.exports={mapTypeToolbar:n}},function(e,t,a){function r(e){if("undefined"!=typeof google){var t=c.getMapObj(e.mapId),a=t.getTargetElement(),r=document.createElement("div");r.setAttribute("id","$$customMap_"+e.mapId),r.setAttribute("class","customMap"),r.style.position="absolute",r.style.zIndex=0,r.style.width="100%",r.style.height="100%",a.insertBefore(r,a.firstChild);var o;o=e.layers?e.layers:g.Roadmap;var n=new google.maps.Map(r,{mapTypeId:o,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:u.style()}),l=function(e){google.maps.event.trigger(n,"resize");var t=e.target,a=d.proj.toLonLat(t.getCenter());n.setCenter(new google.maps.LatLng(a[1],a[0]))},i=function(e){var t=e.target;n.setZoom(t.getZoom())},s=t.getView(),y=s.getZoom(),p=s.getCenter();n.olViewPropery={},n.olViewPropery.zoom=y,n.olViewPropery.center=p;var f=t.get("customCenterKey"),m=t.get("customResolutionKey");f&&t.unByKey(f),m&&t.unByKey(m),f=s.on("change:center",l),m=s.on("change:resolution",i),t.set("customCenterKey",f),t.set("customResolutionKey",m),t.set("mineCustomMap",n);var v=d.proj.toLonLat(s.getCenter());n.setCenter(new google.maps.LatLng(parseFloat(v[1]),parseFloat(v[0]))),n.setZoom(y);var h=a.querySelectorAll(".customMap");if(h&&h.length>1)for(var I=h.length-1;I>0;I--)t.getTargetElement().removeChild(h[I]);return n}}function o(e,t){var a=document.getElementById("$$customMap_"+e.getTarget());a&&(t?a.style.display="":a.style.display="none")}function n(e,t){var a=document.getElementById("$$customMap_"+e.getTarget());a&&isFinite(t)&&null!==t&&void 0!==t&&(t=Number(t),a.style.opacity=t)}function l(e){var t=c.getMapObj(e.mapId),a=t.get("customMap");if(a){var r=e.layers;a.setMapTypeId(r);var o=t.getView(),n=o.getCenter();a.setCenter(new google.maps.LatLng(n[1],n[0])),a.setZoom(o.getZoom())}}function i(e){var t=c.getMapObj(e.mapId),a=t.get("customMap");a&&a.set("styles",[{stylers:[{hue:"#9DF4C3"},{saturation:-100}]}])}function s(e){var t=c.getMapObj(e.mapId),a=t.get("customMap");a&&a.set("styles",null)}var d=a(3),c=(a(1),a(7),a(4),a(6)),u=a(21),g={Hybrid:"hybrid",Roadmap:"roadmap",Satellite:"satellite",Terrain:"terrain"},y=[],p=!1,f=0,m=function(e,t,a){if(p===!1){p=!0;var r=document.createElement("script"),o="http:";"file:"!==location.protocol&&(o=location.protocol);var n=t||"en-US",l=o+"//maps.google.com/maps/api/js?v=3&language="+n+"&key="+e;r.setAttribute("src",l),y.push(a),r.onload=function(){f=1,y.forEach(function(e){e(!0)}),y.splice(0)},r.onerror=function(){f=-1,a(!1)},document.body.appendChild(r)}else f>0?a(!0):f<0?a(!1):y.push(a)};e.exports={loadGoogleAPI:m,createCustomMap:r,updateCustomMap:l,setVisible:o,setOpacity:n,setImageFilter:i,removeImageFilter:s}},function(e,t){var a=function(){return[{featureType:"water",elementType:"geometry",stylers:[{color:"#23353b"}]},{featureType:"water",elementType:"labels",stylers:[{color:"#0f6665"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#23363c"},{lightness:10}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#23363c"},{lightness:5}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#23363c"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#23363c"},{lightness:16}]},{featureType:"road.local",elementType:"geometry",stylers:[{weight:.4},{color:"#5b7f91"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#5b7f91"},{weight:1}]},{featureType:"road.highway",elementType:"geometry",stylers:[{weight:.6},{color:"#5b7f91"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#333333"},{weight:2}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#cccccc"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#999999"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#999999"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#cccccc"},{weight:2},{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{gamma:.6},{lightness:-30}]},{featureType:"transit",elementType:"labels.icon",stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{lightness:5},{color:"#999999"}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels.icon",stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6}]},{featureType:"administrative",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{lightness:-30},{gamma:.6}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#658c99"}]},{featureType:"administrative.country",elementType:"geometry",stylers:[{weight:2},{color:"#00ffff"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{lightness:-5},{color:"#00807d"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{weight:1.5},{color:"#00807d"},{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{lightness:-40}]},{featureType:"landscape"}]},r=function(){return[{featureType:"water",elementType:"geometry",stylers:[{color:"#0f171a"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#1a282c"},{lightness:10}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#1a282c"},{lightness:5}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#1a282c"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#1a282c"},{lightness:16}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#415e68"},{weight:.1}]},{featureType:"road.highway",elementType:"geometry",stylers:[{weight:.6},{color:"#415e68"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#333333"},{weight:2},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#cccccc"},{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#999999"},{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#999999"},{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#cccccc"},{weight:2},{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{gamma:.6},{lightness:-30},{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",
stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6},{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{lightness:5},{color:"#999999"},{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels.icon",stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{lightness:-30},{gamma:.6},{visibility:"off"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#557580"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{lightness:-5},{color:"#00807d"},{visibility:"off"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{weight:1.5},{color:"#00807d"},{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{lightness:-40},{visibility:"off"}]},{featureType:"administrative.country",stylers:[{color:"#00fffc"},{weight:2}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}]},o=function(){return[{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]}]},n=function(){return[{elementType:"geometry",stylers:[{color:"#ebe3cd"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#c9b2a6"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#dcd2be"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#93817c"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#a5b076"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#447530"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f5f1e6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fdfcf8"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#f8c967"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#e9bc62"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#e98d58"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#db8555"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#806b63"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#8f7d77"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#ebe3cd"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b9d3c2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#92998d"}]}]},l=function(){return[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]},i=function(){return[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}]};e.exports={style:a,smallStyle:r,hiding:o,retro:n,night:l,silver:i}},function(e,t,a){var r=a(3),o=a(4),n=a(7),l=function(e){var t=e.layerId+"_"+e.mapId,a=void 0;"http:"!==location.protocol&&"file:"!==location.protocol||(a="http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png");var l=new r.layer.Tile({source:new r.source.OSM({url:a,wrapX:!1})});return l.set("type",n.CUSTOMTYPE.LAYERTILETYPE),l.set("layerId",t),l.set("layer_id",e.layer_id),l.set("mapType",n.Search_Engine.OSM),o.put(t,l),l};e.exports={createLayer:l}},function(e,t,a){function r(e){var t;t=e.layers?e.layers:i.Road;var a=new o.layer.Tile({source:new o.source.BingMaps({imagerySet:t,key:e.key||void 0,wrapX:!1})}),r=e.layerId+"_"+e.mapId;return a.set("type",n.CUSTOMTYPE.LAYERTILETYPE),a.set("layerId",r),a.set("layer_id",e.layer_id),l.put(r,a),a}var o=a(3),n=a(7),l=a(4),i=(a(1),{Road:"Road",Aerial:"Aerial",AerialWithLabels:"AerialWithLabels",Birdseye:"Birdseye",BirdseyeWithLabels:"BirdseyeWithLabels",CollinsBart:"CollinsBart",OrdnanceSurvey:"OrdnanceSurvey"});e.exports={BingMapTypes:i,createLayer:r}},function(e,t,a){var r=a(3),o=a(7),n=a(4),l=function(e){var t=e.layerId+"_"+e.mapId,a="http://gis.huawei.com/gis/cbb/rest/ogcservices/v1r1/gmapwmts/MapServer/tile/{z}/{y}/{x}",l=new r.layer.Tile({source:new r.source.XYZ({url:a+"?key="+e.key,attributions:[new r.Attribution({html:'<a href="http://gis.huawei.com/gis/" target="_blank" title="huawei Map">GisSpace</a>'})],wrapX:!1})});return l.set("type",o.CUSTOMTYPE.LAYERTILETYPE),l.set("layerId",t),l.set("layer_id",e.layer_id),n.put(t,l),l};e.exports={createLayer:l}},function(e,t,a){var r=a(3),o=a(7),n=a(4),l=function(e){var t=e.layerId+"_"+e.mapId,a=new r.layer.Tile({source:new r.source.TileWMS({url:e.url,params:{LAYERS:e.layers,MAPNAME:e.mapName,VERSION:e.version||"1.1.1",mapName:e.mapName},wrapX:!1})});return a.set("type",o.CUSTOMTYPE.LAYERTILETYPE),a.set("layerId",t),a.set("layer_id",e.layer_id),n.put(t,a),a};e.exports={createLayer:l}},function(e,t,a){var r=a(3),o=a(4),n=(a(7),function(e){var t=e.layerId+"_"+e.mapId,a=new r.layer.Tile({title:"VWorld Gray Map",visible:!0,type:"base",source:new r.source.XYZ({url:"http://xdworld.vworld.kr:8080/2d/Base/201512/{z}/{x}/{y}.png",attributions:[new r.Attribution({html:['&copy; <a href="http://map.vworld.kr">V-World Map</a>']})]})});return a.set("layer_id",e.layerId),o.put(t,a),a});e.exports={createLayer:n}},function(e,t,a){function r(e){var t=g.getMapObj(e.mapId);t.getTargetElement().querySelector(".vGisWeb_component")||!function(e){var t=document.createElement("div");t.className="vGisWeb_component",e.getTargetElement().appendChild(t),e.set("component.container",t)}(t);var a=t.get("layerManager.layersChange");a&&t.unByKey(a),a=t.getLayers().on("change:length",function(t){o(e.mapId)}),t.set("layerManager.layersChange",a);new u(e.mapId)}function o(e){var t=g.getMapObj(e),a=t.getLayers().getArray();if(a=p.sortBy(a,function(e){return e.getZIndex()}),d(t,a)!==!1){var r=[];r.mapId=e,r.changeType="list",a.forEach(function(t){t.get("layer_id")&&n(e,t,r)}),c(r)}}function n(e,t,a){var r="",o="",n=t.get("layer_id");"base_layer"===n?(r="BASELAYER",o=f.prop("LayerLabel.BASELAYER")):(r=t.get("businessType"),o=t.get("params.label")?t.get("params.label"):n),a.push({mapId:e,layerName:o,layerId:n,layerType:r,visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")}),l(e,t,r),i(e,t,r),s(e,t,r)}function l(e,t,a){var r=t.get("layerManager.visibleChange");r||(r=t.on("change:visible",function(r){var o={mapId:e,layerName:t.get("params.label"),layerId:t.get("layer_id"),layerType:a,changeType:"visible",visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")},n=g.getMapObj(e),l=n.get("layerManager.manager");l.displayOpacity(o)}),t.set("layerManager.visibleChange",r))}function i(e,t,a){var r=t.get("layerManager.opacityChange");r||(r=t.on("change:opacity",function(){var r={mapId:e,layerName:t.get("params.label"),layerId:t.get("layer_id"),layerType:a,changeType:"opacity",visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")},o=g.getMapObj(e),n=o.get("layerManager.manager");n.displayVisibility(r)}),t.set("layerManager.opacityChange",r))}function s(e,t,a){var r=t.get("layerManager.nameChange");r||(r=t.on("change:params.label",function(){var r={mapId:e,layerName:t.get("params.label"),layerId:t.get("layer_id"),layerType:a,changeType:"layerName",visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")},o=g.getMapObj(e),n=o.get("layerManager.manager");n.displayLayerName(r)}),t.set("layerManager.nameChange",r))}function d(e,t){var a=e.get("layerManager.bLayers");if(a){var r=p.sortGroupBy(t,function(e){return e.getZIndex()}),o=p.sortGroupBy(a,function(e){return e.getZIndex()});if(r.length===o.length){for(var n=!0,l=0,i=r.length;l<i;l++){var s=r[l];if(s.length!==o[l].length){n=!1;break}for(var d=0,c=s.length;d<c;d++)if(o[l].indexOf(s[l][d])===-1){n=!1;break}if(n===!1)break}if(n===!0)return!1}}return e.set("layerManager.bLayers",t),!0}function c(e){var t=e.mapId,a=g.getMapObj(t),r=a.get("layerManager.manager");r.appendLayers(e)}function u(e){this.mapId=e,this.isShow=!1;var t=g.getMapObj(this.mapId),a=t.get("layerManager.manager");a&&(a.destroy(),t.unset("layerManager.manager")),this.createElement(),this.addEventHandle(),t.set("layerManager.manager",this)}var g=a(6),y=a(7),p=a(1),f=a(13),m=a(28),v=a(29);u.prototype.createElement=function(){this.element=document.createElement("div"),this.element.className="bLayerManager",this.element.style.display="none",this.headerElement=document.createElement("div"),this.headerElement.className="header",this.titleElement=document.createElement("div"),this.titleElement.className="title",this.titleElement.innerHTML=f.prop("layerManager.title"),this.closeElement=document.createElement("div"),this.closeElement.className="closeIcon",this.closeElement.innerHTML="✖",this.headerElement.appendChild(this.titleElement),this.headerElement.appendChild(this.closeElement),this.contentElement=document.createElement("div"),this.contentElement.className="content",this.element.appendChild(this.headerElement),this.element.appendChild(this.contentElement);var e=g.getMapObj(this.mapId);e.get("component.container")&&e.get("component.container").appendChild(this.element)},u.prototype.appendLayers=function(e){var t=this;e=this.reSortLayers(e);for(var a=this.contentElement,r=a.childNodes.length-1;r>=0;r--)a.removeChild(a.childNodes[r]);e.forEach(function(a,r){a.layerId?t.appendLayer(e,a,r):t.appendLayerGroup(e,a,r)})},u.prototype.appendLayer=function(e,t,a){var r=document.createElement("div");r.className="layerItem",r.mapId=t.mapId,r.layerType=t.layerType,r.layerId=t.layerId;var o=document.createElement("input");o.className="visible_check",o.mapId=t.mapId,o.layerType=t.layerType,o.layerId=t.layerId,o.setAttribute("type","checkbox"),o.setAttribute("layer_type",t.layerType),o.setAttribute("layer_id",t.layerId),o.checked=t.visible;var n=document.createElement("div");t.visible?n.className=t.layerType+"_ICON layerIcon":n.className=t.layerType+"_GRAYICON layerIcon";var l=document.createElement("div");l.className="layerName",l.mapId=t.mapId,l.layerType=t.layerType,l.layerId=t.layerId,l.innerHTML=t.layerName,l.setAttribute("title",t.layerName);var i=document.createElement("input");i.className="range",i.mapId=t.mapId,i.layerType=t.layerType,i.layerId=t.layerId,i.opacity=t.opacity,i.setAttribute("type","range"),i.setAttribute("max","100"),i.setAttribute("min","0"),i.value=100*t.opacity;var s=document.createElement("div");s.className="label_block";var d=document.createElement("input");d.className="label_check",d.mapId=t.mapId,d.layerType=t.layerType,d.layerId=t.layerId,d.setAttribute("type","checkbox"),d.checked=t.showLabel;var c=document.createElement("label");t.showLabel?c.className="active_label":c.className="inactive_label",c.innerHTML="Aa",s.appendChild(d),s.appendChild(c);var u=document.createElement("div");0!==a?u.className="active_up_arrow":u.className="inactive_up_arrow",u.mapId=t.mapId,u.layerType=t.layerType,u.layerId=t.layerId,u.mIndex=a,u.zIndex=t.zIndex;var g=document.createElement("div");a!==e.length-1?g.className="active_down_arrow":g.className="inactive_down_arrow",g.mapId=t.mapId,g.layerType=t.layerType,g.layerId=t.layerId,g.mIndex=a,g.zIndex=t.zIndex,r.appendChild(o),r.appendChild(n),r.appendChild(l),r.appendChild(i),r.appendChild(s),r.appendChild(u),r.appendChild(g),this.contentElement.appendChild(r);var y=v.getLayer({mapId:t.mapId,layerId:t.layerId});if(y&&y.get("mineLegendName")){var p=document.createElement("div");p.setAttribute("class","legend_name"),p.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --"+y.get("mineLegendName"),this.contentElement.appendChild(p)}},u.prototype.appendLayerGroup=function(e,t,a){var r=document.createElement("div");r.className="layerItem",r.mapId=t.mapId,r.groupType=t.groupType;var o=document.createElement("input");o.className="visible_check",o.mapId=t.mapId,o.groupType=t.groupType,o.setAttribute("type","checkbox"),o.checked=t.visible;var n=document.createElement("div");t.visible?n.className=t.groupType+"_ICON layerIcon":n.className=t.groupType+"_GRAYICON layerIcon";var l=document.createElement("span");l.className="layerName",l.innerHTML=t.groupName;var i=document.createElement("input");i.className="range",i.mapId=t.mapId,i.groupType=t.groupType,i.opacity=t.opacity,i.setAttribute("type","range"),i.setAttribute("max","100"),i.setAttribute("min","0"),i.value=100*t.opacity;var s=document.createElement("div");s.className="label_block";var d=document.createElement("input");d.setAttribute("type","checkbox"),d.className="label_check",d.mapId=t.mapId,d.groupType=t.groupType,d.checked=t.showLabel;var c=document.createElement("label");t.showLabel?c.className="active_label":c.className="inactive_label",c.innerHTML="Aa",s.appendChild(d),s.appendChild(c);var u=document.createElement("div");0!==a?u.className="active_up_arrow":u.className="inactive_up_arrow",u.mapId=t.mapId,u.groupType=t.groupType,u.mIndex=a,u.zIndex=t.zIndex;var g=document.createElement("div");a!==e.length-1?g.className="active_down_arrow":g.className="inactive_down_arrow",g.mapId=t.mapId,g.groupType=t.groupType,g.mIndex=a,g.zIndex=t.zIndex,r.appendChild(o),r.appendChild(n),r.appendChild(l),r.appendChild(i),r.appendChild(s),r.appendChild(u),r.appendChild(g),this.contentElement.appendChild(r)},u.prototype.reSortLayers=function(e){e=this.transformLayerGroup(e);for(var t=p.sortGroupBy(e,function(e){return-e.zIndex}),a=0,r=t.length;a<r;a++)if(t[a].length>1)for(var o=t[a],n=o[0].zIndex,l=0;l<o.length;l++){var i=n+o.length-1-l;m.setZIndex({mapId:this.mapId,layerId:o[l].layerId,zIndex:i}),o[l].zIndex=i}e=p.flatten(t);for(var s,d=e.length-1;d>-1;d--)d!==e.length-1?(e[d].zIndex<=s&&(e[d].zIndex=s+1),s=e[d].zIndex):s=e[d].zIndex;return e},u.prototype.transformLayerGroup=function(e){var t=g.getMapObj(this.mapId),a=y.layerGroup;for(var r in a){if(!a.hasOwnProperty(r))return;for(var o={mapId:this.mapId,groupType:r,groupName:f.prop("LayerLabel."+r),noAttrs:!0},n=y.layerGroup[r],l=[],i=e.length-1;i>-1;i--){var s=e[i];if(!s.groupType)for(var d=s.layerType,c=0;c<n.length;c++)if(l[c]||(l[c]=[]),n[c]===d){o.noAttrs&&(o.visible=s.visible,o.opacity=s.opacity,o.zIndex=Math.floor(s.zIndex),o.showLabel=s.showLabel,t.set("layerGroup.ZIndex."+r,o.zIndex),delete o.noAttrs);var u=e.splice(i,1)[0];l[c].push(u)}}o.layers=p.flatten(l.reverse()),o.layers.length>0&&e.push(o)}return e},u.prototype.displayOpacity=function(e){var t=document.querySelectorAll("#"+e.mapId+" .layerItem .range"),a=p.find(t,function(t){return t.layerId===e.layerId});a&&a.opacity!==e.opacity&&(a.opacity=e.opacity,a.value=100*e.opacity)},u.prototype.displayVisibility=function(e){var t=document.querySelectorAll("#"+e.mapId+" .layerItem .visible_check"),a=p.find(t,function(t){return t.layerId===e.layerId});a&&a.checked!==e.visible&&(a.checked=e.visible)},u.prototype.displayLayerName=function(e){var t=document.querySelectorAll("#"+e.mapId+" .layerItem .layerName"),a=p.find(t,function(t){return t.layerId===e.layerId});a&&a.innerHTML!==e.layerName&&(a.innerHTML=e.layerName)},u.prototype.addEventHandle=function(){var e=this;this.contentElement.addEventListener("click",function(e){var t=e.target;if("visible_check"===t.className){m.setVisible({mapId:t.mapId,layerId:t.layerId,groupType:t.groupType,visible:t.checked});var a=t.layerType||t.groupType;t.checked?t.nextSibling.className=a+"_ICON layerIcon":t.nextSibling.className=a+"_GRAYICON layerIcon"}"label_check"===t.className&&(m.setShowLabel({mapId:t.mapId,layerId:t.layerId,layerType:t.layerType,groupType:t.groupType,showLabel:t.checked}),t.checked?t.nextSibling.className="active_label":t.nextSibling.className="inactive_label");var r;"active_up_arrow"===t.className?r=document.querySelectorAll("#"+t.mapId+" .layerItem")[t.mIndex-1]:"active_down_arrow"===t.className&&(r=document.querySelectorAll("#"+t.mapId+" .layerItem")[t.mIndex+1]),r&&(m.swapLayerZIndex({mapId:t.mapId,sourceLayerId:t.layerId,sourceGroupType:t.groupType,targetLayerId:r.layerId,targetGroupType:r.groupType}),o(t.mapId))}),this.contentElement.addEventListener("change",function(e){var t=e.target;if("range"===t.className){var a=t.value/t.max;m.setOpacity({mapId:t.mapId,layerId:t.layerId,groupType:t.groupType,opacity:a})}}),this.closeElement.addEventListener("click",function(t){e.hide()})},u.prototype.show=function(){this.isShow=!0,this.element.style.display=""},u.prototype.hide=function(){this.isShow=!1,this.element.style.display="none"},u.prototype.destroy=function(){this.element.getParent().removeChild(this.element),this.element=null,this.headerElement=null,this.closeElement=null,this.contentElement=null;var e=g.getMapObj(this.mapId);e.unset("layerManager.manager")},e.exports={monitorLayers:r,toggle:function(e){var t=g.getMapObj(e.mapId),a=t.get("layerManager.manager");a.isShow=!a.isShow,a.isShow?a.show():a.hide()},syncLayers:o}},function(e,t,a){function r(e){var t;return e===m.BUSINESSTYPE.POINT&&(t=a(30)),e===m.BUSINESSTYPE.CIRCLEPOINT&&(t=a(33)),e===m.BUSINESSTYPE.POLYGON&&(t=a(34)),e===m.BUSINESSTYPE.CELL&&(t=a(35)),e===m.BUSINESSTYPE.SITE&&(t=a(36)),e===m.BUSINESSTYPE.GRID&&(t=a(37)),e===m.BUSINESSTYPE.SERVICEPOLYGON&&(t=a(38)),e===m.BUSINESSTYPE.SERVICEPOINT&&(t=a(39)),e===m.BUSINESSTYPE.SERVICELINE&&(t=a(40)),e===m.BUSINESSTYPE.LINE&&(t=a(41)),"DPOLYGON"===e&&(t=a(42)),"DPOINT"===e&&(t=a(43)),"DLINE"===e&&(t=a(44)),t}function o(e){var t=m.layerGroup[e.groupType];if(t){var a=f.getMapObj(e.mapId),r=a.getLayers().getArray().slice(0);return r.filter(function(e){for(var a=e.get("businessType"),r=!1,o=0,n=t.length;o<n;o++)if(a===t[o]){r=!0;break}return r})}}function n(e){var t=f.getMapObj(e.mapId),a=t.get("layerGroup.ZIndex."+e.groupType);return null!==a&&void 0!==a||(a=0),a}function l(e){if(e.layerId){var t=r(e.layerType);if(!t||!t.setShowLabel)return;t.setShowLabel(e)}else if(e.groupType){var a=o(e);a.forEach(function(t){var a=r(t.get("businessType"));a&&a.setShowLabel&&a.setShowLabel({mapId:e.mapId,layerId:t.get("layer_id"),layerType:t.get("businessType"),showLabel:e.showLabel})})}}function i(e){var t=e.mapId,a=e.layerId,r=f.getMapObj(t).getLayers().getArray().slice(0);return v.find(r,function(e){if(e&&e.get("layer_id")===a)return e})}function s(e){var t,a,r=e.mapId;e.sourceLayerId?t=i({mapId:r,layerId:e.sourceLayerId}).getZIndex():e.sourceGroupType&&(t=n({mapId:r,groupType:e.sourceGroupType})),e.targetLayerId?a=i({mapId:r,layerId:e.targetLayerId}).getZIndex():e.targetGroupType&&(a=n({mapId:r,groupType:e.targetGroupType})),e.sourceLayerId?i({mapId:r,layerId:e.sourceLayerId}).setZIndex(a):e.sourceGroupType&&d({mapId:r,groupType:e.sourceGroupType,zIndex:a}),e.targetLayerId?i({mapId:r,layerId:e.targetLayerId}).setZIndex(t):e.targetGroupType&&d({mapId:r,groupType:e.targetGroupType,zIndex:t})}function d(e){var t=m.layerGroup[e.groupType];if(t){for(var a=f.getMapObj(e.mapId),r=o(e),n=[],l=0;l<t.length;l++)n.push(0);a.set("layerGroup.ZIndex."+e.groupType,e.zIndex),r.forEach(function(a){for(var r=a.get("businessType"),o=0,l=t.length;o<l;o++)r===t[o]&&(a.setZIndex(e.zIndex+.1*o+.001*n[o]),n[o]++)})}}function c(e){if(e.layerId){var t=i(e);t.setOpacity(e.opacity),h.setEffectLayerOpacity(t,e.opacity),"base_layer"===e.layerId&&p(e.mapId,e.opacity)}else if(e.groupType){var a=o(e);a.forEach(function(t){t.setOpacity(e.opacity),h.setEffectLayerOpacity(t,e.opacity)})}}function u(e){if(e.layerId){var t=i(e);t.setVisible(e.visible),h.setEffectLayerVisible(t,e.visible),"base_layer"===e.layerId&&y(e.mapId,e.visible)}else if(e.groupType){var a=o(e);a.forEach(function(t){t.setVisible(e.visible),h.setEffectLayerVisible(t,e.visible)})}}function g(e){if(e.layerId){var t=i(e);t.setZIndex(e.zIndex)}else e.groupType&&d(e)}function y(e,t){var a=f.getMapObj(e);if(a){var r=a.get("paramObj");r.mapType.toUpperCase()===m.MAPTYPE.GOOGLE_MAP&&I.setVisible(a,t)}}function p(e,t){var a=f.getMapObj(e);if(a){var r=a.get("paramObj");r.mapType.toUpperCase()===m.MAPTYPE.GOOGLE_MAP&&I.setOpacity(a,t)}}var f=a(6),m=a(7),v=a(1),h=a(29),I=a(20);e.exports={getBsHandler:r,setShowLabel:l,setVisible:u,swapLayerZIndex:s,setOpacity:c,setZIndex:g}},function(e,t,a){function r(e){if(e.layerId)return s.get(e.layerId+"_"+e.mapId)}function o(e,t){var a=e.get("effectLayers");a&&a.forEach(function(e){e.get("effectCombine.visible")!==!1&&e.setVisible(t)})}function n(e,t){var a=e.get("effectLayers");a&&a.forEach(function(e){e.get("effectCombine.opacity")!==!1&&e.setOpacity(t)})}function l(e){var t;if(t=e.layer?e.layer:r(e),t&&e.effectLayer){var a=t.get("effectLayers");a||(a=[],t.set("effectLayers",a)),a.indexOf(e.effectLayer)===-1&&a.push(e.effectLayer)}}function i(e){var t;if(t=e.layer?e.layer:r(e)){var a=t.get("effectLayers");if(a){var o=d.getMapObj(e.mapId);!!a&&a.forEach(function(e){e.get("state.deleted")||(e.set("state.deleted",!0),e.onDestroy&&e.onDestroy(),e.setMap(null),e&&o.removeLayer(e))}),t.set("effectLayers",null)}}}var s=a(4),d=a(6),c=a(1),u=function(e){var t="_"+e,a=[];return s.keys.forEach(function(e){e&&c.endsWith(e,t)&&a.push(s.get(e))}),a};e.exports={getLayer:r,addEffectLayer:l,removeEffectLayer:i,setEffectLayerVisible:o,setEffectLayerOpacity:n,getLayers:u}},function(e,t,a){function r(e,t){var a=fusiongis.BaseLayer.getLayer({mapId:t.mapId,layerId:t.layerId});if(a){var r=a.get("highLightFeatrue");if(r)for(var o=0;o<r.length;o++){var l=a.getSource().getFeatureById(r[o].getId());if(l){var i=l.get("data"),d=i.fontStyle+" "+i.fontSize+" "+i.fontFamily,c=new n.style.Style({image:new n.style.Circle({radius:i.radius||5,fill:new n.style.Fill({color:i.fillColor||"red"}),stroke:new n.style.Stroke({color:i.strokeColor||"319FD3",width:void 0!==i.strokeWidth?i.strokeWidth:2})}),text:new n.style.Text({text:i.label||"",font:"undefined undefined undefined"!==d?d:"normal 14px Arial",fill:new n.style.Fill({color:i.labelFillColor||"black"}),stroke:new n.style.Stroke({color:i.labelStrokeColor||"#ffffff",width:void 0!==i.labelStrokeWidth?i.labelStrokeWidth:1}),offsetX:void 0!==i.labelOffsetX?i.labelOffsetX:30,offsetY:void 0!==i.labelOffsetY?i.labelOffsetY:-15})});l.setStyle(c)}}var u=[];if(e===s.HTYPE.CLICK)if(t.feature){var g=t.feature.get("select"),i=t.feature.get("data"),d=i.fontStyle+" "+i.fontSize+" "+i.fontFamily,c=new n.style.Style({image:new n.style.Circle({radius:g.radius,stroke:new n.style.Stroke({width:g.strokeWidth,color:g.strokeColor}),fill:new n.style.Fill({color:g.fillColor})}),text:new n.style.Text({text:i.label||"",font:"undefined undefined undefined"!==d?d:"normal 14px Arial",fill:new n.style.Fill({color:g.labelFillColor}),stroke:new n.style.Stroke({color:g.labelStrokeColor,width:void 0!==i.labelStrokeWidth?i.labelStrokeWidth:1}),offsetX:void 0!==i.labelOffsetX?i.labelOffsetX:30,offsetY:void 0!==i.labelOffsetY?i.labelOffsetY:-15})});t.feature.setStyle(c),u.push(t.feature),a.set("highLightFeatrue",u)}else a.set("highLightFeatrue",[]);else e===s.HTYPE.VECTOR&&(t.geoIds.map(function(e){var t=a.getSource().getFeatureById(e),r=t.get("select"),o=t.get("data"),l=o.fontStyle+" "+o.fontSize+" "+o.fontFamily,i=new n.style.Style({image:new n.style.Circle({radius:r.radius,fill:new n.style.Fill({color:r.fillColor}),stroke:new n.style.Stroke({color:r.strokeColor,width:r.strokeWidth})}),text:new n.style.Text({text:o.label||"",font:"undefined undefined undefined"!==l?l:"normal 14px Arial",fill:new n.style.Fill({color:r.labelFillColor}),stroke:new n.style.Stroke({color:r.labelStrokeColor,width:void 0!==o.labelStrokeWidth?o.labelStrokeWidth:1}),offsetX:void 0!==o.labelOffsetX?o.labelOffsetX:30,offsetY:void 0!==o.labelOffsetY?o.labelOffsetY:-15})});t.setStyle(i),u.push(t)}),a.set("highLightFeatrue",u))}}function o(e){var t=d.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var n=a(3),l=a(6),i=a(4),s=a(7),d=a(29),c=a(1),u=(a(31),a(32),a(11)),g=function(e){var t=e.layerId+"_"+e.mapId,a=null,o=l.getMapObj(e.mapId),d=!e.isShow||e.isShow,c=e.label?e.label:e.layerId;i.containsKey(t)?a=i.get(t):(a=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})}),a.set("type",s.CUSTOMTYPE.LAYERTYPE),a.set("map",o),a.set("layerId",t),a.set("layer_id",e.layerId),a.set("businessType",s.BUSINESSTYPE.POINT),a.set("params.label",c),a.set("state.showLabel",!!e.showLabel),a.set("legendName",e.legendName),a.setZIndex(s.Z_INDEX.LANDMARKER),i.put(t,a),o.addLayer(a)),a.setVisible(d),e.multiple&&a.set("multiple",e.multiple),u.addClickCallback(e.mapId,"business_vector_point_event_id",function(t){var a=t.feature;r("click",{mapId:e.mapId,layerId:e.layerId,feature:a})},e.layerId)},y=function(e){var t=[],a=e.datas,r=d.getLayer(e);if(r.set("legendName",e.legendName),e.label&&r.set("params.label",e.label),c.isValid(a)||a.length>0){r.set("state.showLabel",!!e.showLabel);var o=r.getSource();a.forEach(function(a){var o=n.proj.fromLonLat(a.coordinate),l=a.fontStyle+" "+a.fontSize+" "+a.fontFamily,i=void 0!==a.strokeWidth?a.strokeWidth:2,d=void 0!==a.labelStrokeWidth?a.labelStrokeWidth:1,c=void 0!==a.labelOffsetX?a.labelOffsetX:30,u=void 0!==a.labelOffsetY?a.labelOffsetY:-15,g={fillColor:a.fillColor,strokeColor:a.strokeColor||"black",strokeWidth:i,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff",radius:a.radius||5},y=new n.Feature({geometry:new n.geom.Point(o),data:a,layerId:e.layerId,mapId:e.mapId,businessType:s.BUSINESSTYPE.POINT,select:a.hightLight?a.hightLight:g});if(a.hightLight)for(var p in g)a.hightLight[p]?a.hightLight[p]:a.hightLight[p]=g[p];y.setId(a.id),y.set("layer",r),y.set("vectorType",s.BUSINESSTYPE.POINT);var f=new n.style.Style({image:new n.style.Circle({radius:a.radius?a.radius:5,fill:new n.style.Fill({color:a.fillColor?a.fillColor:"red"}),stroke:new n.style.Stroke({color:a.strokeColor?a.strokeColor:"#319FD3",width:a.strokeWidth?a.strokeWidth:1})}),text:new n.style.Text({text:a.label?a.label:"",fill:new n.style.Fill({color:a.labelFillColor?a.labelFillColor:"black"}),font:"undefined undefined undefined"!==l?l:"normal 14px Arial",offsetX:c,offsetY:u,stroke:new n.style.Stroke({color:a.labelStrokeColor||"#ffffff",width:d})})}),m=new n.style.Style({image:new n.style.Circle({radius:a.radius?a.radius:5,fill:new n.style.Fill({color:a.fillColor?a.fillColor:"red"}),stroke:new n.style.Stroke({color:a.strokeColor?a.strokeColor:"#319FD3",width:a.strokeWidth?a.strokeWidth:1})})});y.setStyle(f),y.set("defaultStyle",f),y.set("shapeStyle",m),t.push(y)}),o.addFeatures(t)}},p=function(e,t){var a,r=d.getLayer({mapId:e.mapId,layerId:e.layerId});if(!r)return void t();var o=r.getSource().getFeatureById(e.geoId),l=o.getGeometry();a=new n.proj.toLonLat(l.getCoordinates()),t(a)};e.exports={addLayer:g,setLayerData:y,highlight:r,getLineLonLat:p,setShowLabel:o}},function(e,t,a){function r(e){var t=i.getMapObj(e.mapId),a=s.getLayer(e);if(a){var r=a.get("layer_id"),o=r+"&&&highlight",n=c.getLayer({mapId:e.mapId,layerId:o});return n?n:(n=new l.layer.Vector({source:new l.source.Vector({wrapX:!1})}),n.set("mapId",e.mapId),n.set("source_layerId",r),n.set("layerId",o),n.setZIndex(1999),s.addEffectLayer({layer:a,effectLayer:n}),t.addLayer(n),n)}}function o(e){if(e.layerId){var t=r({mapId:e.mapId,layerId:e.layerId}),a=t&&t.getSource();if(!e.hTypes||!e.hTypes.length)return void a.clear();var o=a.getFeatures().slice(0);o&&o.forEach(function(t){var r=t.get("hType");e.hTypes.indexOf(r)>-1&&a.removeFeature(t)})}}function n(e){var t=s.getLayer({layerId:e.layerId,mapId:e.mapId});if(t){var a=t.get("businessType"),r=d.getBsHandler(a);r&&r.highlight&&r.highlight(t,e.highlightType,e)}}var l=a(3),i=a(6),s=a(29),d=a(28),c=a(32);e.exports={highlight:n,getHLayer:r,removeHighlight:o}},function(e,t,a){function r(e){var t,a,r=e.mapId;e.layerId?(t=e.layerId,a="layerId"):e.layer_id&&(t=e.layer_id,a="layer_id");var o=m.getMapObj(r).getLayers().getArray().slice(0);return v.find(o,function(e){if(e&&e.get(a)===t)return e})}function o(e){var t,a,r=e.mapId,o=m.getMapObj(r);e.layerId?(t=e.layerId,a="layerId"):e.layer_id&&(t=e.layer_id,a="layer_id");var n=m.getMapObj(r).getLayers().getArray().slice(0);v.find(n,function(e){if(e&&e.get(a)===t)return o.removeLayer(e),e})}function n(e){return isFinite(e)&&null!==e&&e!==!1}function l(e){return n(e)?(e="EPSG:"+e,f.proj.get(e)):"string"==typeof e?(e=e.toUpperCase(),f.proj.get(e)):e instanceof f.proj.Projection?e:null}function i(e,t,a){if(!t||!a)return e;t=l(t),a=l(a);var r=f.proj.getTransform(t,a);return"string"==typeof e[0]||"number"==typeof e[0]?r(e):e.map(function(e){return r(e)})}function s(e){return m.getMapObj(e);
}function d(e,t){var a=s(e).getOverlays().getArray().slice(0);return v.find(a,function(e){return e.get("name")===t})}function c(e,t){var a=s(e).getInteractions().getArray().slice(0);return v.find(a,function(e){return e.get("name")===t})}function u(e,t){e&&e.getFeatures().slice(0).forEach(function(a){a.get("type")===t&&e.removeFeature(a)})}function g(e){var t=s(e);if(t){var a=t.get("statistics");return a.popupZIndex?a.popupZIndex+=1:a.popupZIndex=20,a.popupZIndex}}function y(e){var t=new f.geom.Polygon([e]).transform("EPSG:4326","EPSG:3857");return t.getArea()}function p(e){var t=s(e.mapId);if(t&&e.extent&&4===e.extent.length){e.projection||(e.projection="EPSG:4326");var a=l(e.projection),r=f.proj.transformExtent(e.extent,a,"EPSG:3857");return h.fit(r,t.getSize()),h.getZoom()}}var f=a(3),m=a(6),v=a(1),h=new f.View;e.exports={getLayer:r,removeLayer:o,transform:i,getOverlayByName:d,getIntactByName:c,delFeatureByType:u,getPopupZIndex:g,getZoomForExtent:p,getPolygonArea:y}},function(e,t,a){function r(e,t){var a=fusiongis.BaseLayer.getLayer({mapId:t.mapId,layerId:t.layerId});if(a){var r=a.get("highLightFeatrue");if(r)for(var o=0;o<r.length;o++){var l=a.getSource().getFeatureById(r[o].getId());if(l){var i=l.get("data"),d=i.fontStyle+" "+i.fontSize+" "+i.fontFamily,c=new n.style.Style({image:new n.style.Circle({radius:i.radius||5,fill:new n.style.Fill({color:i.fillColor||"red"}),stroke:new n.style.Stroke({color:i.strokeColor||"white",width:void 0!==i.strokeWidth?i.strokeWidth:2})}),text:new n.style.Text({text:i.name||"",font:"undefined undefined undefined"!==d?d:"normal 13px Arial",fill:new n.style.Fill({color:i.labelFillColor||"black"}),stroke:new n.style.Stroke({color:i.labelStrokeColor||"#ffffff",width:void 0!==i.labelStrokeWidth?i.labelStrokeWidth:2}),offsetX:void 0!==i.labelOffsetX?i.labelOffsetX:30,offsetY:void 0!==i.labelOffsetY?i.labelOffsetY:-15})});l.setStyle(c)}}var u=[];if(e===s.HTYPE.CLICK)if(t.feature){var g=t.feature.get("select"),i=t.feature.get("data"),d=i.fontStyle+" "+i.fontSize+" "+i.fontFamily,c=new n.style.Style({image:new n.style.Circle({radius:g.radius,stroke:new n.style.Stroke({width:g.strokeWidth,color:g.strokeColor}),fill:new n.style.Fill({color:g.fillColor})}),text:new n.style.Text({text:i.name||"",font:"undefined undefined undefined"!==d?d:"normal 13px Arial",fill:new n.style.Fill({color:g.labelFillColor}),stroke:new n.style.Stroke({color:g.labelStrokeColor,width:void 0!==i.labelStrokeWidth?i.labelStrokeWidth:2}),offsetX:void 0!==i.labelOffsetX?i.labelOffsetX:30,offsetY:void 0!==i.labelOffsetY?i.labelOffsetY:-15})});t.feature.setStyle(c),u.push(t.feature),a.set("highLightFeatrue",u)}else a.set("highLightFeatrue",[]);else e===s.HTYPE.VECTOR&&(t.geoIds.map(function(e){var t=a.getSource().getFeatureById(e),r=t.get("select"),o=t.get("data"),l=o.fontStyle+" "+o.fontSize+" "+o.fontFamily,i=new n.style.Style({image:new n.style.Circle({radius:r.radius,fill:new n.style.Fill({color:r.fillColor}),stroke:new n.style.Stroke({color:r.strokeColor,width:r.strokeWidth})}),text:new n.style.Text({text:o.name||"",font:"undefined undefined undefined"!==l?l:"normal 13px Arial",fill:new n.style.Fill({color:r.labelFillColor}),stroke:new n.style.Stroke({color:r.labelStrokeColor,width:void 0!==o.labelStrokeWidth?o.labelStrokeWidth:2}),offsetX:void 0!==o.labelOffsetX?o.labelOffsetX:30,offsetY:void 0!==o.labelOffsetY?o.labelOffsetY:-15})});t.setStyle(i),u.push(t)}),a.set("highLightFeatrue",u))}}function o(e){var t=d.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var n=a(3),l=a(6),i=a(4),s=a(7),d=a(29),c=a(1),u=(a(31),a(11)),g=function(e){var t=e.layerId+"_"+e.mapId,a=null,o=l.getMapObj(e.mapId);i.containsKey(t)?a=i.get(t):(a=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})}),a.set("type",s.CUSTOMTYPE.LAYERTYPE),a.set("map",o),a.set("layerId",t),a.set("layer_id",e.layerId),a.set("businessType",s.BUSINESSTYPE.CIRCLEPOINT),a.set("params.label",e.label),a.set("state.showLabel",!!e.showLabel),a.setZIndex(s.Z_INDEX.LANDMARKER),i.put(t,a),o.addLayer(a)),a.set("legendName",e.legendName),e.multiple&&a.set("multiple",e.multiple),u.addClickCallback(e.mapId,"business_vector_circlePoint_event_id",function(t){var a=t.feature;r("click",{mapId:e.mapId,layerId:e.layerId,feature:a})},e.layerId)},y=function(e){var t=[],a=e.datas,r=d.getLayer(e);if(r.set("legendName",e.legendName),e.label&&r.set("params.label",e.label),c.isValid(a)||a.length>0){var o=r.getSource();a.forEach(function(a){var r=n.proj.fromLonLat(a.coordinate),o=void 0!==a.strokeWidth?a.strokeWidth:2,l=(a.fontStyle+" "+a.fontSize+" "+a.fontFamily,void 0!==a.labelStrokeWidth?a.labelStrokeWidth:2),i=void 0!==a.labelOffsetX?a.labelOffsetX:30,d=void 0!==a.labelOffsetY?a.labelOffsetY:-15,c={fillColor:a.fillColor||"red",strokeColor:a.strokeColor||"white",strokeWidth:o,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff",radius:a.radius||5},u=new n.Feature({geometry:new n.geom.Point(r),data:a,layerId:e.layerId,mapId:e.mapId,businessType:s.BUSINESSTYPE.CIRCLEPOINT,select:a.hightLight?a.hightLight:c});if(a.hightLight)for(var g in c)a.hightLight[g]?a.hightLight[g]:a.hightLight[g]=c[g];u.setId(a.id);var y=new n.style.Style({image:new n.style.Circle({radius:a.radius?a.radius:5,fill:new n.style.Fill({color:a.fillColor?a.fillColor:"red"})}),text:new n.style.Text({text:a.name?a.name:"",fill:new n.style.Fill({color:a.labelFillColor?a.labelFillColor:"black"}),font:"normal 14px Arial",offsetX:i,offsetY:d,stroke:new n.style.Stroke({color:a.labelStrokeColor||"#ffffff",width:l})})}),p=new n.style.Style({image:new n.style.Circle({radius:a.radius?a.radius:5,fill:new n.style.Fill({color:a.fillColor||"green"}),stroke:new n.style.Stroke({color:a.strokeColor||"black",width:o})})});u.setStyle(y),u.set("defaultStyle",y),u.set("shapeStyle",p),t.push(u)}),o.addFeatures(t)}},p=function(e,t){var a,r=d.getLayer({mapId:e.mapId,layerId:e.layerId});if(!r)return void t();var o=r.getSource().getFeatureById(e.geoId),l=o.getGeometry();a=new n.proj.toLonLat(l.getCoordinates()),t(a)};e.exports={addLayer:g,setLayerData:y,highlight:r,getLineLonLat:p,setShowLabel:o}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=c.getMapObj(e.mapId),r=a.getView().getZoom(),o=e.defaultVisibleLevel||g.DefaultLayerVisibleLevel.POLYGON,n=!e.isShow||e.isShow,i=e.label?e.label:e.layerId;if(!u.containsKey(t)){var s=new d.layer.Vector({source:new d.source.Vector({wrapX:!1})});s.set("type",g.CUSTOMTYPE.LAYERTYPE),s.set("map",a),s.set("layerId",t),s.set("layer_id",e.layerId),s.set("params.label",i),s.set("state.showLabel",!!e.showLabel),s.set("businessType",g.BUSINESSTYPE.POLYGON),s.setZIndex(g.Z_INDEX.POLYGON),s.set("defaultVisibleLevel",o),s.set("multiple",e.multiple),s.set("legendName",e.legendName),u.put(t,s),s.setVisible(n),r<o&&s.setVisible(!1),a.addLayer(s)}m.addClickCallback(e.mapId,"business_vector_polygon_event_id",function(t){t.layer&&t.layer.get("businessType")===g.BUSINESSTYPE.POLYGON&&t.feature&&t.feature.get("businessType")===g.BUSINESSTYPE.POLYGON?l(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,geoId:t.feature.getId()}):f.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})},e.layerId)}function o(e){var t=[],a=e.datas,r=y.getLayer(e);if(r.set("legendName",e.legendName),e.label&&r.set("params.label",e.label),p.isValid(a)||a.length>0){r.set("state.showLabel",!0);var o=r.getSource();a.forEach(function(a){var r=a.coordinates,o=new d.geom.Polygon([r]),n=d.extent.getCenter(o.getExtent()),l=new d.Feature({geometry:o.transform(g.PROJ.EPSG_4326,g.PROJ.EPSG_3857),labelPoint:d.proj.fromLonLat(n),businessType:g.BUSINESSTYPE.POLYGON,data:a,layerId:e.layerId,mapId:e.mapId});l.setId(a.id);var i=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth||1}),text:new d.style.Text({text:a.label?a.label:"",fill:new d.style.Fill({color:a.labelFillColor||"black"}),font:"normal 14px Arial",stroke:new d.style.Stroke({color:"#ffffff",width:3})})}),s=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth||1})});l.setStyle(i),l.set("defaultStyle",i),l.set("shapeStyle",s),l.set("state.showLabel",!0),t.push(l)}),o.addFeatures(t)}}function n(e){var t=[],a=e.datas,r=y.getLayer(e);if(e.label&&r.set("params.label",e.label),p.isValid(a)||a.length>0){r.set("state.showLabel",!0);var o=r.getSource();a.forEach(function(a){var r=a.coordinates,o=new d.geom.Polygon([r]),n=d.extent.getCenter(o.getExtent()),l=new d.Feature({geometry:o.transform(g.PROJ.EPSG_4326,g.PROJ.EPSG_3857),labelPoint:d.proj.fromLonLat(n),businessType:g.BUSINESSTYPE.POLYGON,data:a,layerId:e.layerId,mapId:e.mapId});l.setId(a.id);var i=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth||1}),text:new d.style.Text({text:a.label?a.label:"",fill:new d.style.Fill({color:a.labelFillColor||"black"}),font:"normal 14px Arial",stroke:new d.style.Stroke({color:"#ffffff",width:3})})}),s=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth||1})});l.setStyle(i),l.set("defaultStyle",i),l.set("shapeStyle",s),l.set("state.showLabel",!0),t.push(l)}),o.addFeatures(t)}}function l(e,t,a){var r=e.get("map"),o=r.getTarget(),n=e.get("layer_id"),l=e.get("businessType");f.removeHighlight({mapId:o,layerId:n,hTypes:["click"]});var i=f.getHLayer({mapId:o,layerId:n});if(t===g.HTYPE.CLICK){var s;if(s=e.getSource().getFeatureById(a.geoId),!s)return;s=s.clone(),s.setStyle(new d.style.Style({stroke:new d.style.Stroke({width:2.5,color:"#000"})})),s.setId(a.geoId),s.set("mapId",o),s.set("layerId",n),s.set("layerType",l),s.set("hType",t),i.getSource().addFeature(s)}else if(t===g.HTYPE.VECTOR){var c=a.geoIds.map(function(r){var i=e.getSource().getFeatureById(r);if(i)return i=i.clone(),i.setStyle(new d.style.Style({stroke:new d.style.Stroke({width:2.5,color:"#9900ff"})})),i.setId(a.geoId),i.set("mapId",o),i.set("layerId",n),i.set("layerType",l),i.set("hType",t),i});c=p.compact(c),i.getSource().addFeatures(c)}}function i(e,t){var a=y.getLayer({mapId:e.mapId,layerId:e.layerId});if(!a&&"POLYGON"!==e.sourceLayerType)return void t();var r,o=a.getSource().getFeatureById(e.geoId).getGeometry(),n=o.getCoordinates()[0],l=(n[0][0]-e.targetPoint[0])*(n[0][0]-e.targetPoint[0])+(n[0][1]-e.targetPoint[1])*(n[0][1]-e.targetPoint[1]),i=0;n.forEach(function(t,a){i=(t[0]-e.targetPoint[0])*(t[0]-e.targetPoint[0])+(t[1]-e.targetPoint[1])*(t[1]-e.targetPoint[1]),l>i&&(l=i,r=a)}),t(n[r])}function s(e){var t=y.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var d=a(3),c=a(6),u=a(4),g=a(7),y=a(29),p=a(1),f=a(31),m=(a(32),a(11));e.exports={addLayer:r,appendLayerData:n,setLayerData:o,highlight:l,getLineLonLat:i,setShowLabel:s}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=u.get(e.mapId),r=a.getView().getZoom(),o=e.defaultVisibleLevel||g.DefaultLayerVisibleLevel.CELL,i=!e.isShow||e.isShow,s=e.label?e.label:e.layerId,d=null;u.containsKey(t)?d=u.containsKey(t):(d=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),e.multiple&&d.set("multiple",e.multiple),u.put(t,d)),d.setZIndex(g.Z_INDEX.CELL),d.set("type",g.CUSTOMTYPE.LAYERIMGTYPE),d.set("businessType",g.BUSINESSTYPE.CELL),d.set("params.label",s),d.set("state.showLabel",!!e.showLabel),d.set("layerId",t),d.set("map",a),d.set("layer_id",e.layerId),d.set("defaultVisibleLevel",o),d.set("legendName",e.legendName),d.setVisible(i),r<o&&d.setVisible(!1),a.addLayer(d),v.addClickCallback(e.mapId,"business_service_cell_event_id",function(t){if(t.layer&&t.layer.get("businessType")===g.BUSINESSTYPE.CELL){var a=h.getMapObj(e.mapId);n(a,t.layer,t.e,function(a){a?l(t.layer,"click",a[0]):m.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)}function o(e){var t=y.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("imgToken",e.imgToken),t.set("imgTokenLabel",e.imgTokenLabel),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("legendName",e.legendName),e.label&&t.set("params.label",e.label),t.set("state.showLabel",!!e.showLabel);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r={VERSION:"1.1.1",imgToken:a};t&&(t.getSource().setUrl(g.GisRootUrl+"/mapRender/export"),t.getSource().updateParams(r))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o,n,l;if(o=g.GisRootUrl+"/mapRender/identify",a.coordinate){l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(",");var i={geometry:l,tolerance:.1,mapExtent:n,imgToken:t.get("params.imgToken")}}f.get({url:o,data:p.getParameterString(i),success:function(a){if(!a)return void r([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void r([]);var o=p.sortBy(a.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),n=o[0].extentInfo.radius;o=o.filter(function(e){return e.extentInfo.radius===n}),o.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var l=o.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name}});r(l)},failure:function(){"function"==typeof r&&r([])}})}function l(e,t,a,r){var o,n=e.get("map"),l=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(m.removeHighlight({mapId:l,layerId:s,hTypes:["click"]}),t===g.HTYPE.CLICK){var u=JSON.parse(a.geometry),y=new c.geom.LineString(u);o=new c.Feature({geometry:new c.geom.Polygon([y.getCoordinates()]),mapId:l,layerId:s,layerType:d,hType:t});var p=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});o.setStyle(p);var f=m.getHLayer({mapId:l,layerId:s});f.getSource().addFeature(o)}else t===g.HTYPE.VECTOR&&i(e,a,function(e){if(e){var a=[],n=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});e.map(function(e){o=new c.Feature({geometry:new c.geom.Polygon([JSON.parse(e.geometry)]),mapId:l,layerId:s,layerType:d,hType:t}),o.setStyle(n),a.push(o)});var i=m.getHLayer({mapId:l,layerId:s});i.getSource().addFeatures(a),r&&r(e)}})}function i(e,t,a){var r=e.get("params.imgToken"),o=g.GisRootUrl+"/mapRender/query";f.postJSON({url:o,data:JSON.stringify({id:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){console.log(e),a(null)}})}function s(e,t){var a,r=y.getLayer({mapId:e.mapId,layerId:e.layerId});return r?void i(r,{geoIds:[e.geoId]},function(e){e&&(a=e[0].extentInfo.circleCenter,a=c.proj.fromLonLat(a),t(a))}):void t()}function d(e){var t=y.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),u=a(4),g=a(7),y=a(29),p=a(1),f=a(14),m=a(31),v=a(11),h=a(6);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:l,getLineLonLat:s,setShowLabel:d}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=u.getMapObj(e.mapId),r=a.getView().getZoom(),o=e.defaultVisibleLevel||y.DefaultLayerVisibleLevel.SITE,i=!e.isShow||e.isShow,s=e.label?e.label:e.layerId;if(!g.containsKey(t)){var d=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});g.put(t,d),d.setZIndex(y.Z_INDEX.SITE),d.set("type",y.CUSTOMTYPE.LAYERIMGTYPE),d.set("businessType",y.BUSINESSTYPE.SITE),d.set("params.label",s),d.set("state.showLabel",!!e.showLabel),d.set("layerId",t),d.set("map",a),d.set("layer_id",e.layerId),d.set("defaultVisibleLevel",o),d.set("multiple",e.multiple),d.set("legendName",e.legendName),d.setVisible(i),r<o&&d.setVisible(!1),a.addLayer(d)}h.addClickCallback(e.mapId,"business_service_site_event_id",function(t){if(t.layer&&t.layer.get("businessType")===y.BUSINESSTYPE.SITE){var a=u.getMapObj(e.mapId);n(a,t.layer,t.e,function(a){a?l(t.layer,"click",a[0]):v.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)}function o(e){var t=p.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("state.showLabel",!!e.showLabel),t.set("legendName",e.legendName),e.label&&t.set("params.label",e.label);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r={VERSION:"1.1.1",imgToken:a};t&&(t.getSource().setUrl(y.GisRootUrl+"/mapRender/export"),t.getSource().updateParams(r))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o,n,l;o=y.GisRootUrl+"/mapRender/identify",l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(",");var i={geometry:l,tolerance:1,mapExtent:n,imgToken:t.get("params.imgToken")};m.get({url:o,data:f.getParameterString(i),success:function(o){if(!o)return void r([]);if(o=JSON.parse(o),!o||!o.data||!o.data.length)return void r([]);var n=o.data,l=n.map(function(r){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.coordinate,geometry:r.geometry,geoId:r.id,geoName:r.name}});r(l)},failure:function(){console.log("grid clickFun error!"),r([])}})}function l(e,t,a,r){var o,n=e.get("map"),l=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(v.removeHighlight({mapId:l,layerId:s}),t===y.HTYPE.CLICK){var u=a.geometry;o=new c.Feature({geometry:new c.geom.Point(u),mapId:l,layerId:s,layerType:d,hType:t});var g=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(g);var p=v.getHLayer({mapId:l,layerId:s});p.getSource().addFeature(o)}else t===y.HTYPE.VECTOR&&i(e,a,function(e){var a;if(e){a=e[0].geometry,o=new c.Feature({geometry:new c.geom.Point(a),mapId:l,layerId:s,layerType:d,hType:t});var n=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(n);var i=v.getHLayer({mapId:l,layerId:s});i.getSource().addFeature(o),r&&r(e)}})}function i(e,t,a){var r=e.get("params.imgToken"),o=y.GisRootUrl+"/mapRender/query";m.postJSON({url:o,data:JSON.stringify({id:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){console.log(e),a(null)}})}function s(e){var t,a=p.getLayer({mapId:e.mapId,layerId:e.sourceLayerId});if(a)return i(a,{geoIds:e.layerId,imgToken:a.get("params.imgToken")},function(e){e&&(t=e.extentInfo.circleCenter)}),t}function d(e){var t=p.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),u=a(6),g=a(4),y=a(7),p=a(29),f=a(1),m=a(14),v=a(31),h=a(11);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:l,getLineLonLat:s,setShowLabel:d}},function(e,t,a){function r(e,t,a){var r=e.get("map"),l=r.getTarget(),i=e.get("layer_id"),s=e.get("businessType");g.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===d.HTYPE.CLICK?o(l,i,s,t,a):t===d.HTYPE.VECTOR&&n(l,i,s,t,a,e)}function o(e,t,a,r,o){var n,i,s=o.geometry,d=50,c=[];i=o.lonLat[0]-d/2,n=o.lonLat[0]+d/2,c.push([i,s[1]]),c.push([n,s[1]]),c.push([n,s[3]]),c.push([i,s[3]]);var u=new l.Feature({geometry:new l.geom.Polygon([c]),mapId:e,layerId:t,layerType:a,hType:r}),y=new l.style.Style({stroke:new l.style.Stroke({width:2,color:"black"})});u.setStyle(y);var p=g.getHLayer({mapId:e,layerId:t});p.getSource().addFeature(u)}function n(e,t,a,r,o,n){var i=[];o.coordinates.forEach(function(e){i.push({x:e[0],y:e[1]})}),u.postJSON({url:d.GisRootUrl+"/gridManager/queryGridInfo",data:JSON.stringify({points:i,imgToken:n.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n,i,s=o.geometry,d=50,c=[];i=o.centerPoint[0]-d/2,n=o.centerPoint[0]+d/2,c.push([i,s[1]]),c.push([n,s[1]]),c.push([n,s[3]]),c.push([i,s[3]]);var u=new l.Feature({geometry:new l.geom.Polygon([c]),mapId:e,layerId:t,layerType:a,hType:r}),g=new l.style.Style({stroke:new l.style.Stroke({width:2,color:"black"})});return u.setStyle(g),u}),i=g.getHLayer({mapId:e,layerId:t});i.getSource().addFeatures(n)}},failure:function(e){console.log(e)}})}var l=a(3),i=a(8),s=a(4),d=a(7),c=a(29),u=a(14),g=a(31),y=a(11),p=a(6),f=a(5),m=function(e){var t=e.layerId+"_"+e.mapId,a=s.get(e.mapId),o=a.getView().getZoom(),n=e.defaultVisibleLevel||d.DefaultLayerVisibleLevel.GRID,i=!e.isShow||e.isShow,c=e.label?e.label:e.layerId,u=void 0===e.gridType?1:e.gridType,m=null;s.containsKey(t)||(m=1===u?new l.layer.Tile({source:new l.source.TileWMS({wrapX:!1})}):new l.layer.Image({source:new l.source.ImageWMS({wrapX:!1})}),m.setZIndex(d.Z_INDEX.GRID),m.set("type",d.CUSTOMTYPE.LAYERTILETYPE),m.set("businessType",d.BUSINESSTYPE.GRID),m.set("params.label",c),m.set("layerId",t),m.set("map",a),m.set("layer_id",e.layerId),m.set("defaultVisibleLevel",n),e.multiple&&m.set("multiple",e.multiple),s.put(t,m),m.setVisible(i),o<n&&m.setVisible(!1),a.addLayer(m)),y.addClickCallback(e.mapId,"business_grid_event_id",function(t){var a=f.getLayer({mapId:e.mapId,layerId:e.layerId});if(a&&8!==a.get("gridType")){var o=p.getMapObj(e.mapId);h(o,a,t.e,function(t){t?t&&t.length>0&&r(a,"click",t[0]):g.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},v=function(e){var t=e.imgTokenParam,a=e.imgToken,r=e.mapId,o=e.layerId,n=e.gridType?e.gridType:1,i=e.layers?e.layers:void 0,s=e.ISSOLIDGRID,u=c.getLayer({mapId:r,layerId:o});if(u){var g;e.label&&u.set("label",e.label),g=8===n||s===!1?new l.source.ImageWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:n,LAYERS:i,IMGTOKEN:a,VERSION:"1.1.1",ISSOLIDGRID:s},wrapX:!1}):new l.source.TileWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:n,LAYERS:i,IMGTOKEN:a,VERSION:"1.1.1",ISSOLIDGRID:s},wrapX:!1}),u.setSource(g),u.set("imgToken",a),u.set("gridType",n),u.set("imgTokenParam",t)}},h=function(e,t,a,r){var o=i.getExtent(e.getTarget()),n={geometry:{x:a.coordinate[0],y:a.coordinate[1]},tolerance:1,mapExtent:o,imgToken:t.get("imgToken")};u.postJSON({url:d.GisRootUrl+"/gridManager/getGridInfo",data:JSON.stringify(n),success:function(a){var o=JSON.parse(a),n=o.status,l=o.data&&o.data.length>0&&o.data[0];1===n.code&&l?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:l.centerPoint,geometry:l.geometry,extentInfo:l.extentInfo,geoId:l.id,geoName:l.name}]):r([])},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:m,setLayerData:v,getClickData:h,highlight:r}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,i=new l.Feature({geometry:new l.geom.Polygon([n]),mapId:e,layerId:t,layerType:a,hType:r}),s=new l.style.Style({stroke:new l.style.Stroke({width:2,color:"black"})});i.setStyle(s);var d=p.getHLayer({mapId:e,layerId:t});d.getSource().addFeature(i)}function o(e,t,a,r,o,n){y.postJSON({url:c.GisRootUrl+"/mapRender/query",data:JSON.stringify({id:o.geoIds,imgToken:n.get("params.imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n=o.geometry,i=new l.Feature({geometry:new l.geom.Polygon([n]),mapId:e,layerId:t,layerType:a,hType:r}),s=new l.style.Style({stroke:new l.style.Stroke({width:2,color:"black"})});return i.setStyle(s),i}),i=p.getHLayer({mapId:e,layerId:t});i.getSource().addFeatures(n)}},failure:function(e){console.log(e)}})}function n(e){var t=u.getLayer(e);if(t){var a;a=e.isShowLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.getSource().updateParams(r)}}var l=a(3),i=a(8),s=a(6),d=a(4),c=a(7),u=a(29),g=a(1),y=a(14),p=a(31),f=a(11),m=function(e){var t=e.layerId+"_"+e.mapId,a=d.get(e.mapId),r=e.defaultVisibleLevel||c.DefaultLayerVisibleLevel.POLYGON,o=a.getView().getZoom(),n=e.label?e.label:e.layerId,i=!e.isShow||e.isShow;if(!d.containsKey(t)){var u=new l.layer.Image({source:new l.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});u.setZIndex(c.Z_INDEX.POLYGON),u.set("type",c.CUSTOMTYPE.LAYERTILETYPE),u.set("businessType",c.BUSINESSTYPE.SERVICEPOLYGON),u.set("params.label",n),u.set("layerId",t),u.set("map",a),u.set("layer_id",e.layerId),u.set("defaultVisibleLevel",r),u.set("multiple",e.multiple),u.set("legendName",e.legendName),a.addLayer(u),d.put(t,u),u.setVisible(i),o<r&&u.setVisible(!1)}f.addClickCallback(e.mapId,"business_service_polygon_event_id",function(t){if(t.layer&&t.layer.get("businessType")===c.BUSINESSTYPE.SERVICEPOLYGON){var a=s.getMapObj(e.mapId);I(a,t.layer,t.e,function(a){a?h(t.layer,"click",a[0]):p.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},v=function(e){var t=u.getLayer(e);if(t.set("legendName",e.legendName),t){e.label&&t.set("params.label",e.label),t.set("params.imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel);var a=e.isShowLabel?e.imgTokenLabel:e.imgToken,r=new l.source.ImageWMS({url:c.GisRootUrl+"/mapRender/export",params:{imgToken:a,VERSION:"1.1.1"},wrapX:!1});t.setSource(r)}},h=function(e,t,a){var n=e.get("map"),l=n.getTarget(),i=e.get("layer_id"),s=e.get("businessType");p.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===c.HTYPE.CLICK?r(l,i,s,t,a):t===c.HTYPE.VECTOR&&o(l,i,s,t,a,e)},I=function(e,t,a,r){var o=i.getExtent(e.getTarget()),n={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:.1,mapExtent:o,imgToken:t.get("params.imgToken")};y.get({url:c.GisRootUrl+"/mapRender/identify",data:g.getParameterString(n),success:function(a){if(a){var o=JSON.parse(a),n=o.status;if(1===n.code)if(o.data&&o.data.length>0){var l=o.data.map(function(a){var r={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name};return r});r&&"function"==typeof r&&r(l)}else r([]);else r([])}},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:m,setLayerData:v,getClickData:I,highlight:h,setShowLabel:n}},function(e,t,a){function r(e,t,a,r,o){var l=o.geometry,i=new n.Feature({geometry:new n.geom.Point(l[0]),mapId:e,layerId:t,layerType:a,hType:r}),s=new n.style.Style({image:new n.style.Circle({stroke:new n.style.Stroke({width:2,color:"#000"}),radius:5})});i.setStyle(s);var d=y.getHLayer({mapId:e,layerId:t});d.getSource().addFeature(i)}function o(e,t,a,r,o,l){g.postJSON({url:d.GisRootUrl+"/mapRender/query",data:JSON.stringify({id:o.geoIds,imgToken:l.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var l=o.data.map(function(o){var l=o.geometry,i=new n.Feature({geometry:new n.geom.Point(l[0]),mapId:e,layerId:t,layerType:a,hType:r}),s=new n.style.Style({image:new n.style.Circle({stroke:new n.style.Stroke({width:2,color:"#000"}),radius:5})});return i.setStyle(s),i}),i=y.getHLayer({mapId:e,layerId:t});i.getSource().addFeatures(l)}},failure:function(e){console.log(e)}})}var n=a(3),l=a(6),i=a(8),s=a(4),d=a(7),c=a(29),u=a(1),g=a(14),y=a(31),p=a(11),f=function(e){var t=e.layerId+"_"+e.mapId,a=l.getMapObj(e.mapId),r=e.label?e.label:e.layerId,o=!e.isShow||e.isShow,i=a.getView().getZoom(),c=e.defaultVisibleLevel||d.DefaultLayerVisibleLevel.SITE;if(!s.containsKey(t)){var u=new n.layer.Image({source:new n.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});u.setVisible(o),i<c&&u.setVisible(!1),u.setZIndex(d.Z_INDEX.MARKER),u.set("type",d.CUSTOMTYPE.LAYERTILETYPE),u.set("businessType",d.BUSINESSTYPE.SERVICEPOINT),u.set("params.label",r),u.set("layerId",t),u.set("map",a),u.set("legendName",e.legendName),u.set("layer_id",e.layerId),e.multiple&&u.set("multiple",e.multiple),s.put(t,u),a.addLayer(u)}p.addClickCallback(e.mapId,"business_service_point_event_id",function(t){if(t.layer&&t.layer.get("businessType")===d.BUSINESSTYPE.SERVICEPOINT){var a=l.getMapObj(e.mapId);h(a,t.layer,t.e,function(a){a?v(t.layer,"click",a[0]):y.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},m=function(e){var t=c.getLayer(e);t.set("legendName",e.legendName),e.label&&t.set("params.label",e.label),t.set("imgToken",e.imgToken);var a={VERSION:"1.1.1",imgToken:e.imgToken};t&&(t.getSource().setUrl(d.GisRootUrl+"/mapRender/export"),t.getSource().updateParams(a))},v=function(e,t,a){var n=e.get("map"),l=n.getTarget(),i=e.get("layer_id"),s=e.get("businessType");y.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===d.HTYPE.CLICK?r(l,i,s,t,a):t===d.HTYPE.VECTOR&&o(l,i,s,t,a,e)},h=function(e,t,a,r){var o=i.getExtent(e.getTarget()),n={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:10,mapExtent:o,imgToken:t.get("imgToken")};g.get({url:d.GisRootUrl+"/mapRender/identify",data:u.getParameterString(n),success:function(a){if(a){var o=JSON.parse(a),n=o.status,l=o.data&&o.data.length>0&&o.data[0];1===n.code&&l?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:l.id,geoName:l.name,lonLat:l.centerPoint,geometry:l.geometry,extentInfo:l.extentInfo}]):r([])}},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:f,setLayerData:m,getClickData:h,highlight:v}},function(e,t,a){function r(e,t,a,r,o){var l=o.geometry,i=new n.Feature({geometry:new n.geom.LineString(l),mapId:e,layerId:t,layerType:a,hType:r}),s=new n.style.Style({stroke:new n.style.Stroke({width:2,color:"black"})});i.setStyle(s);var d=y.getHLayer({mapId:e,layerId:t});d.getSource().addFeature(i)}function o(e,t,a,r,o,l){g.postJSON({url:d.GisRootUrl+"/mapRender/query",data:JSON.stringify({id:o.geoIds,imgToken:l.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var l=o.data.map(function(o){var l=o.geometry,i=new n.Feature({geometry:new n.geom.LineString(l),mapId:e,layerId:t,layerType:a,hType:r}),s=new n.style.Style({stroke:new n.style.Stroke({width:2,color:"black"})});return i.setStyle(s),i}),i=y.getHLayer({mapId:e,layerId:t});i.getSource().addFeatures(l)}},failure:function(e){console.log(e)}})}var n=a(3),l=a(6),i=a(8),s=a(4),d=a(7),c=a(29),u=a(1),g=a(14),y=a(31),p=a(11),f=function(e){var t=e.layerId+"_"+e.mapId,a=l.getMapObj(e.mapId),r=e.label?e.label:e.layerId,o=!e.isShow||e.isShow;if(!s.containsKey(t)){var i=new n.layer.Image({source:new n.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});i.setZIndex(d.Z_INDEX.LINE),i.set("type",d.CUSTOMTYPE.LAYERTILETYPE),i.set("businessType",d.BUSINESSTYPE.SERVICELINE),i.set("params.label",r),i.set("layerId",t),i.set("map",a),i.set("legendName",e.legendName),i.set("layer_id",e.layerId),e.multiple&&i.set("multiple",e.multiple),i.setVisible(o),s.put(t,i),a.addLayer(i)}p.addClickCallback(e.mapId,"business_service_line_event_id",function(t){if(t.layer&&t.layer.get("businessType")===d.BUSINESSTYPE.SERVICELINE){var a=l.getMapObj(e.mapId);h(a,t.layer,t.e,function(a){a?v(t.layer,"click",a[0]):y.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},m=function(e){var t=c.getLayer(e);e.label&&t.set("params.label",e.label),t.set("imgToken",e.imgToken),t.set("legendName",e.legendName);var a={VERSION:"1.1.1",imgToken:e.imgToken};t&&(t.getSource().setUrl(d.GisRootUrl+"/mapRender/export"),t.getSource().updateParams(a))},v=function(e,t,a){var n=e.get("map"),l=n.getTarget(),i=e.get("layer_id"),s=e.get("businessType");
y.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===d.HTYPE.CLICK?r(l,i,s,t,a):t===d.HTYPE.VECTOR&&o(l,i,s,t,a,e)},h=function(e,t,a,r){var o=i.getExtent(e.getTarget()),n={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:10,mapExtent:o,imgToken:t.get("imgToken")};g.get({url:d.GisRootUrl+"/mapRender/identify",data:u.getParameterString(n),success:function(a){if(a){var o=JSON.parse(a),n=o.status,l=o.data&&o.data.length>0&&o.data[0];1===n.code&&l?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:l.id,geoName:l.name,lonLat:l.centerPoint,geometry:l.geometry,extentInfo:l.extentInfo}]):r([])}},failure:function(e){console.error(e),r([])}})};e.exports={addLayer:f,setLayerData:m,getClickData:h,highlight:v}},function(e,t,a){function r(e,t){var a=fusiongis.BaseLayer.getLayer({mapId:t.mapId,layerId:t.layerId});if(a){var r=a.get("highLightFeatrue");if(r)for(var o=0;o<r.length;o++){var l=a.getSource().getFeatureById(r[o].getId());if(l){var i=l.get("data"),d=i.fontStyle+" "+i.fontSize+" "+i.fontFamily,c=new n.style.Style({stroke:new n.style.Stroke({color:i.strokeColor||"#000",width:void 0!==i.strokeWidth?i.strokeWidth:2}),text:new n.style.Text({text:i.label||"",font:"undefined undefined undefined"!==d?d:"normal 14px Arial",fill:new n.style.Fill({color:i.labelFillColor||"black"}),stroke:new n.style.Stroke({color:i.labelStrokeColor||"#ffffff",width:void 0!==i.labelStrokeWidth?lineData.labelStrokeWidth:1})})});l.setStyle(c)}}var u=[];if(e===s.HTYPE.CLICK)if(t.feature){var g=t.feature.get("select"),i=t.feature.get("data"),d=i.fontStyle+" "+i.fontSize+" "+i.fontFamily,c=new n.style.Style({stroke:new n.style.Stroke({width:g.strokeWidth,color:g.strokeColor}),text:new n.style.Text({text:i.label||"",font:"undefined undefined undefined"!==d?d:"normal 14px Arial",fill:new n.style.Fill({color:g.labelFillColor}),stroke:new n.style.Stroke({color:g.labelStrokeColor,width:void 0!==i.labelStrokeWidth?i.labelStrokeWidth:1})})});t.feature.setStyle(c),u.push(t.feature),a.set("highLightFeatrue",u)}else a.set("highLightFeatrue",[]);else e===s.HTYPE.VECTOR&&(t.geoIds.map(function(e){var t=a.getSource().getFeatureById(e),r=t.get("select"),o=t.get("data"),l=o.fontStyle+" "+o.fontSize+" "+o.fontFamily,i=new n.style.Style({stroke:new n.style.Stroke({color:r.strokeColor,width:r.strokeWidth}),text:new n.style.Text({text:o.name||"",font:"undefined undefined undefined"!==l?l:"normal 14px Arial",fill:new n.style.Fill({color:r.labelFillColor}),stroke:new n.style.Stroke({color:r.labelStrokeColor,width:void 0!==o.labelStrokeWidth?o.labelStrokeWidth:1})})});t.setStyle(i),u.push(t)}),a.set("highLightFeatrue",u))}}function o(e){var t=d.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var n=a(3),l=a(6),i=a(4),s=a(7),d=a(29),c=a(1),u=(a(31),a(32)),g=a(11),y=function(e){var t=e.layerId+"_"+e.mapId,a=null,o=l.getMapObj(e.mapId);i.containsKey(t)?a=i.get(t):(a=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})}),a.set("type",s.CUSTOMTYPE.LAYERTYPE),a.set("map",o),a.set("layerId",t),a.set("layer_id",e.layerId),a.set("businessType",s.BUSINESSTYPE.LINE),a.set("params.label",e.label),a.set("state.showLabel",!!e.showLabel),a.set("legendName",e.legendName),a.setZIndex(s.Z_INDEX.LANDMARKER),i.put(t,a),o.addLayer(a)),g.addClickCallback(e.mapId,"business_line_event_id",function(t){var a=t.feature;r("click",{mapId:e.mapId,layerId:e.layerId,feature:a})},e.layerId)},p=function(e){var t=[],a=e.datas,r=d.getLayer(e);if(r.set("legendName",e.legendName),e.label&&r.set("params.label",e.label),c.isValid(a)||a.length>0){r.set("state.showLabel",!0);var o=r.getSource();a.forEach(function(a){var o=u.transform(a.coordinates,4326,3857),l=void 0!==a.strokeWidth?a.strokeWidth:2,i=a.fontStyle+" "+a.fontSize+" "+a.fontFamily,d=void 0!==a.labelStrokeWidth?a.labelStrokeWidth:1,c={strokeColor:"black",strokeWidth:2,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff"},g=new n.Feature({geometry:new n.geom.LineString(o),data:a,layerId:e.layerId,mapId:e.mapId,businessType:s.BUSINESSTYPE.LINE,select:a.hightLight?a.hightLight:c});if(a.hightLight)for(var y in c)a.hightLight[y]?a.hightLight[y]:a.hightLight[y]=c[y];g.setId(a.id),g.set("layer",r),g.set("vectorType",s.BUSINESSTYPE.LINE);var p=new n.style.Style({fill:new n.style.Fill({color:a.fillColor?a.fillColor:"rgba(0,0,0,0)"}),stroke:new n.style.Stroke({color:a.strokeColor||"#000",width:l}),text:new n.style.Text({text:a.label||"",fill:new n.style.Fill({color:a.labelFillColor||"black"}),font:"undefined undefined undefined"!==i?i:"normal 14px Arial",stroke:new n.style.Stroke({color:a.labelStrokeColor||"#ffffff",width:d})})}),f=new n.style.Style({fill:new n.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new n.style.Stroke({color:a.strokeColor||"#000",width:l})});g.setStyle(p),g.set("defaultStyle",p),g.set("shapeStyle",f),t.push(g)}),o.addFeatures(t)}},f=function(e,t){var a,r=d.getLayer({mapId:e.mapId,layerId:e.layerId});if(!r)return void t();var o=r.getSource().getFeature(e.geoId),l=o.getGeometry();a=new n.proj.toLonLat(l.getCoordinates()),t(a)};e.exports={addLayer:y,setLayerData:p,highlight:r,getLineLonLat:f,setShowLabel:o}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,l=void 0!==o.strokeWidth?o.strokeWidth:1,s=new i.Feature({geometry:new i.geom.Polygon([n]),mapId:e,layerId:t,layerType:a,hType:r}),d=new i.style.Style({stroke:new i.style.Stroke({strokeWidth:l,strokeColor:o.strokeColor||"black"})});s.setStyle(d);var c=f.getHLayer({mapId:e,layerId:t});c.getSource().addFeature(s)}function o(e,t,a,r,o,n){var l=n.get("imgToken"),s=l.slice(0,l.indexOf(":")),d=void 0!==o.strokeWidth?o.strokeWidth:1;p.postJSON({url:u.GisRootUrl+"/common/mapRender/query?FCName="+s,data:JSON.stringify({idValue:o.geoIds,imgToken:l}),success:function(n){if(n&&(n=JSON.parse(n),1===n.status.code&&n.data&&n.data.length)){var l=n.data.map(function(n){var l=n.geometry,s=new i.Feature({geometry:new i.geom.Polygon([l]),mapId:e,layerId:t,layerType:a,hType:r}),c=new i.style.Style({stroke:new i.style.Stroke({strokeWidth:d,strokeColor:o.strokeColor||"#9900FF"})});return s.setStyle(c),s}),s=f.getHLayer({mapId:e,layerId:t});s.getSource().addFeatures(l)}},failure:function(e){console.log(e)}})}function n(e,t){var a=e.get("imgToken"),r=t.callback,o=a.slice(0,a.indexOf(":")),n=e.get("map");p.postJSON({url:u.GisRootUrl+"/common/mapRender/query?FCName="+o,data:JSON.stringify({idValue:t.geoIds,imgToken:a}),success:function(t){if(t){var a=JSON.parse(t),o=a.status;if(1===o.code)if(a.data&&a.data.length>0){var l=a.data.map(function(t){var a={mapId:n.getTarget(),layerId:e.get("layer_id"),layerType:e.get("businessType"),label:e.get("params.label"),lonLat:t.centerPoint,geometry:t.geometry,extentInfo:t.extentInfo,geoId:t.id,geoName:t.name};return a});r&&"function"==typeof r&&r(l)}else r([]);else r([])}},failure:function(e){console.log(e)}})}function l(e){var t=g.getLayer(e);if(t){var a;a=e.isShowLabel?t.get("imgTokenLabel"):t.get("imgToken");var r={VERSION:"1.1.1",imgToken:a};t.getSource().updateParams(r)}}var i=a(3),s=a(8),d=a(6),c=a(4),u=a(7),g=a(29),y=a(1),p=a(14),f=a(31),m=a(11),v=function(e){var t=e.layerId+"_"+e.mapId,a=c.get(e.mapId),r=e.defaultVisibleLevel||u.DefaultLayerVisibleLevel.POLYGON,o=a.getView().getZoom();if(!c.containsKey(t)){var n=new i.layer.Image({source:new i.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});n.setZIndex(u.Z_INDEX.POLYGON),n.set("type",u.CUSTOMTYPE.LAYERTILETYPE),n.set("businessType","DPOLYGON"),n.set("params.label",e.label),n.set("layerId",t),n.set("map",a),n.set("layer_id",e.layerId),n.set("defaultVisibleLevel",r),n.set("multiple",e.multiple),c.put(t,n),a.addLayer(n),o<r&&n.setVisible(!1)}m.addClickCallback(e.mapId,"business_Dservice_polygon_event_id",function(t){if(t.layer&&"DPOLYGON"===t.layer.get("businessType")){var a=d.getMapObj(e.mapId);b(a,t.layer,t.e,function(a){a?I(t.layer,"click",a[0]):f.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},h=function(e){var t=g.getLayer(e);if(t){e.label&&t.set("params.label",e.label),t.set("params.imgToken",e.imgToken),t.set("imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel);var a=e.isShowLabel?e.imgTokenLabel:e.imgToken,r=a.slice(0,a.indexOf(":")),o=new i.source.ImageWMS({url:u.GisRootUrl+"/common/mapRender/export",params:{imgToken:a,VERSION:"1.1.1",FCName:r},wrapX:!1});t.setSource(o)}},I=function(e,t,a){var n=e.get("map"),l=n.getTarget(),i=e.get("layer_id"),s=e.get("businessType");f.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===u.HTYPE.CLICK?r(l,i,s,t,a):t===u.HTYPE.VECTOR&&o(l,i,s,t,a,e)},b=function(e,t,a,r){var o=s.getExtent(e.getTarget()),n=t.get("imgToken"),l=n.slice(0,n.indexOf(":")),i={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:.1,mapExtent:o,imgToken:n,FCName:l};p.get({url:u.GisRootUrl+"/common/mapRender/identify",data:y.getParameterString(i),success:function(a){if(a){var o=JSON.parse(a),n=o.status;if(1===n.code)if(o.data&&o.data.length>0){var l=o.data.map(function(a){var r={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name};return r});r&&"function"==typeof r&&r(l)}else r([]);else r([])}},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:v,setLayerData:h,getClickData:b,highlight:I,setShowLabel:l,getQueryData:n}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,i=void 0!==o.strokeWidth?param.strokeWidth:1,s=new l.Feature({geometry:new l.geom.Point(n[0]),mapId:e,layerId:t,layerType:a,hType:r}),d=new l.style.Style({image:new l.style.Circle({radius:o.radius||5,fill:new l.style.Fill({fillColor:o.fillColor||"black"}),stroke:new l.style.Stroke({strokeColor:o.strokeColor||"black",strokeWidth:i})})});s.setStyle(d);var c=p.getHLayer({mapId:e,layerId:t});c.getSource().addFeature(s)}function o(e,t,a,r,o,n){var i=n.get("imgToken"),s=i.slice(0,i.indexOf(":")),d=void 0!==o.strokeWidth?o.strokeWidth:1;y.postJSON({url:c.GisRootUrl+"/common/mapRender/query?FCName="+s,data:JSON.stringify({idValue:o.geoIds,imgToken:i}),success:function(n){if(n&&(n=JSON.parse(n),1===n.status.code&&n.data&&n.data.length)){var i=n.data.map(function(n){var i=n.geometry,s=new l.Feature({geometry:new l.geom.Point(i[0]),mapId:e,layerId:t,layerType:a,hType:r}),c=new l.style.Style({image:new l.style.Circle({radius:o.radius||5,fill:new l.style.Fill({fillColor:o.fillColor||"black"}),stroke:new l.style.Stroke({strokeColor:o.strokeColor||"black",strokeWidth:d})})});return s.setStyle(c),s}),s=p.getHLayer({mapId:e,layerId:t});s.getSource().addFeatures(i)}},failure:function(e){console.log(e)}})}function n(e,t){var a=e.get("imgToken"),r=t.callback,o=a.slice(0,a.indexOf(":")),n=e.get("map");y.postJSON({url:c.GisRootUrl+"/common/mapRender/query?FCName="+o,data:JSON.stringify({idValue:t.geoIds,imgToken:a}),success:function(t){if(t){var a=JSON.parse(t),o=a.status;if(1===o.code)if(a.data&&a.data.length>0){var l=a.data.map(function(t){var a={mapId:n.getTarget(),layerId:e.get("layer_id"),layerType:e.get("businessType"),label:e.get("params.label"),lonLat:t.centerPoint,geometry:t.geometry,extentInfo:t.extentInfo,geoId:t.id,geoName:t.name};return a});r&&"function"==typeof r&&r(l)}else r([]);else r([])}},failure:function(e){console.log(e)}})}var l=a(3),i=a(6),s=a(8),d=a(4),c=a(7),u=a(29),g=a(1),y=a(14),p=a(31),f=a(11),m=function(e){var t=e.layerId+"_"+e.mapId,a=i.getMapObj(e.mapId);if(!d.containsKey(t)){var r=new l.layer.Image({source:new l.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});r.setZIndex(c.Z_INDEX.MARKER),r.set("type",c.CUSTOMTYPE.LAYERTILETYPE),r.set("businessType","DPOINT"),r.set("params.label",e.label),r.set("layerId",t),r.set("map",a),r.set("layer_id",e.layerId),e.multiple&&r.set("multiple",e.multiple),d.put(t,r),a.addLayer(r)}f.addClickCallback(e.mapId,"business_Dservice_point_event_id",function(t){if(t.layer&&"DPOINT"===t.layer.get("businessType")){var a=i.getMapObj(e.mapId);I(a,t.layer,t.e,function(a){a?h(t.layer,"click",a[0]):p.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},v=function(e){var t=u.getLayer(e);e.label&&t.set("params.label",e.label),t.set("imgToken",e.imgToken);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=a.slice(0,a.indexOf(":")),o={VERSION:"1.1.1",imgToken:a,FCName:r};t&&(t.getSource().setUrl(c.GisRootUrl+"/common/mapRender/export"),t.getSource().updateParams(o))},h=function(e,t,a){var n=e.get("map"),l=n.getTarget(),i=e.get("layer_id"),s=e.get("businessType");p.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===c.HTYPE.CLICK?r(l,i,s,t,a):t===c.HTYPE.VECTOR&&o(l,i,s,t,a,e)},I=function(e,t,a,r){var o=s.getExtent(e.getTarget()),n=t.get("imgToken"),l=n.slice(0,n.indexOf(":")),i={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:10,mapExtent:o,imgToken:n,FCName:l};y.get({url:c.GisRootUrl+"/common/mapRender/identify",data:g.getParameterString(i),success:function(a){if(a){var o=JSON.parse(a),n=o.status,l=o.data&&o.data.length>0&&o.data[0];1===n.code&&l?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:l.id,geoName:l.name,lonLat:l.centerPoint,geometry:l.geometry,extentInfo:l.extentInfo}]):r([])}},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:m,setLayerData:v,getClickData:I,highlight:h,getQueryData:n}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,i=void 0!==o.strokeWidth?o.strokeWidth:1,s=new l.Feature({geometry:new l.geom.LineString(n),mapId:e,layerId:t,layerType:a,hType:r}),d=new l.style.Style({stroke:new l.style.Stroke({strokeWidth:i,strokeColor:o.strokeColor||"black"})});s.setStyle(d);var c=p.getHLayer({mapId:e,layerId:t});c.getSource().addFeature(s)}function o(e,t,a,r,o,n){var i=n.get("imgToken"),s=i.slice(0,i.indexOf(":")),d=void 0!==o.strokeWidth?o.strokeWidth:1;y.postJSON({url:c.GisRootUrl+"/common/mapRender/query?FCName="+s,data:JSON.stringify({idValue:o.geoIds,imgToken:i}),success:function(n){if(n&&(n=JSON.parse(n),1===n.status.code&&n.data&&n.data.length)){var i=n.data.map(function(n){var i=n.geometry,s=new l.Feature({geometry:new l.geom.LineString(i),mapId:e,layerId:t,layerType:a,hType:r}),c=new l.style.Style({stroke:new l.style.Stroke({strokeWidth:d,strokeColor:o.strokeColor||"#9900FF"})});return s.setStyle(c),s}),s=p.getHLayer({mapId:e,layerId:t});s.getSource().addFeatures(i)}},failure:function(e){console.log(e)}})}function n(e,t){var a=e.get("imgToken"),r=t.callback,o=a.slice(0,a.indexOf(":")),n=e.get("map");y.postJSON({url:c.GisRootUrl+"/common/mapRender/query?FCName="+o,data:JSON.stringify({idValue:t.geoIds,imgToken:a}),success:function(t){if(t){var a=JSON.parse(t),o=a.status;if(1===o.code)if(a.data&&a.data.length>0){var l=a.data.map(function(t){var a={mapId:n.getTarget(),layerId:e.get("layer_id"),layerType:e.get("businessType"),label:e.get("params.label"),lonLat:t.centerPoint,geometry:t.geometry,extentInfo:t.extentInfo,geoId:t.id,geoName:t.name};return a});r&&"function"==typeof r&&r(l)}else r([]);else r([])}},failure:function(e){console.log(e)}})}var l=a(3),i=a(6),s=a(8),d=a(4),c=a(7),u=a(29),g=a(1),y=a(14),p=a(31),f=a(11),m=function(e){var t=e.layerId+"_"+e.mapId,a=i.getMapObj(e.mapId);if(!d.containsKey(t)){var r=new l.layer.Image({source:new l.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});r.setZIndex(c.Z_INDEX.LINE),r.set("type",c.CUSTOMTYPE.LAYERTILETYPE),r.set("businessType","DLINE"),r.set("params.label",e.label),r.set("layerId",t),r.set("map",a),r.set("layer_id",e.layerId),e.multiple&&r.set("multiple",e.multiple),d.put(t,r),a.addLayer(r)}f.addClickCallback(e.mapId,"business_Dservice_line_event_id",function(t){if(t.layer&&"DLINE"===t.layer.get("businessType")){var a=i.getMapObj(e.mapId);I(a,t.layer,t.e,function(a){a?h(t.layer,"click",a[0]):p.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},v=function(e){var t=u.getLayer(e);e.label&&t.set("params.label",e.label),t.set("imgToken",e.imgToken);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=a.slice(0,a.indexOf(":")),o={VERSION:"1.1.1",imgToken:a,FCName:r};t&&(t.getSource().setUrl(c.GisRootUrl+"/common/mapRender/export"),t.getSource().updateParams(o))},h=function(e,t,a){var n=e.get("map"),l=n.getTarget(),i=e.get("layer_id"),s=e.get("businessType");p.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===c.HTYPE.CLICK?r(l,i,s,t,a):t===c.HTYPE.VECTOR&&o(l,i,s,t,a,e)},I=function(e,t,a,r){var o=s.getExtent(e.getTarget()),n=t.get("imgToken"),l=n.slice(0,n.indexOf(":")),i={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:1,mapExtent:o,imgToken:n,FCName:l};y.get({url:c.GisRootUrl+"/common/mapRender/identify",data:g.getParameterString(i),success:function(a){if(a){var o=JSON.parse(a),n=o.status,l=o.data&&o.data.length>0&&o.data[0];1===n.code&&l?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:l.id,geoName:l.name,lonLat:l.centerPoint,geometry:l.geometry,extentInfo:l.extentInfo}]):r([])}},failure:function(e){console.error(e),r([])}})};e.exports={addLayer:m,setLayerData:v,getClickData:I,highlight:h,getQueryData:n}},function(e,t,a){var r=a(3),o=a(10),n=a(29),l=a(7),i=a(4),s=a(1),d=a(6),c="vGisWeb_legend_box",u=new Map;u.set("refreshLayerManager_key",[]);var g=function(e){var t=e.mapId,a=i.get(t).getTargetElement(),r="vGisWeb_legend_switch_"+t,n=c+"_"+t,l=a.querySelector("#"+n),s=document.querySelector("#"+r);s||(s=o.createDom({tagName:"div",attributes:{"class":"vGisWeb_legend_switch",id:r,title:"legend switch"}}),a.appendChild(s)),l||(l=o.createDom({tagName:"div",attributes:{"class":c,id:n}}),a.appendChild(l)),s.onclick=function(){if(l=a.querySelector("#"+n),l&&l.style){var e=l.style.display;"block"===e?l.style.display="":e||(l.style.display="block")}}},y=function(e){var t=e.mapId,a=e.layerId,y=e.legendInfo,p=e.businessType,f=e.titleImgPath||l.GisResourceURL+"legend/",m=e.legendImgPath||l.GisResourceURL+"marker/",v=y&&y.byPercent,h=e.imgToken||void 0,I=function(){return s.htmlDecode(y&&y.legendName)}(),b=y&&y.legendType,S=y&&y.legendList,L=y&&y.renderStyle,w="business_"+b,T="business_"+a,E="oneLine",k=E+"_"+t,C=!!i.get(t)&&i.get(t).getTargetElement();if(C){!function(){var e=n.getLayer({mapId:t,layerId:a}),o=p+"("+I+")";if(e)if(e.set("mineLayerName",o),e.set("mineLayerImgToken",h),e.set("mineLegendID",T),e.set("mineLegendName",s.htmlDecode(e.get("legendName"))),u.get("refreshLayerManager_key").length<10){var l=new r.layer.Vector;d.getMapObj(t).addLayer(l),u.get("refreshLayerManager_key").push(l)}else{var i=u.get("refreshLayerManager_key");i&&i.length>0&&i.forEach(function(e,a){d.getMapObj(t).removeLayer(e),u.get("refreshLayerManager_key").splice(a,1)})}}();var x=C.querySelector("#"+c+"_"+t);x||(g(e),x=C.querySelector("#"+c+"_"+t));var O=o.createDom({tagName:"div",attributes:{"class":w+" "+T}});C.querySelector("."+T)&&x.removeChild(C.querySelector("."+T)),x.appendChild(O),y&&S&&S.length>0&&(O.appendChild(function(){var e=o.createDom({tagName:"div",attributes:{"class":"legendTitle"}});return e.appendChild(function(){var e=o.createDom({tagName:"div",attributes:{"class":"legendTitleLeft"}});return e.style.background="url("+f+p.toLowerCase()+".png)",e.style.backgroundPosition="3px 7px",e.style.backgroundRepeat="no-repeat",e}()),e.appendChild(function(){return o.createDom({tagName:"div",attributes:{"class":"legendTitleRight",title:I},text:I.length>20?I.substring(0,20)+"...":I})}()),e}()),S.forEach(function(e){var t=e.value,a=e.label,r=e.style,n=e.fillColor,l=e.borderColor,i=(e.borderWidth,e.percent),s=e.count,d=e.range,c=e.containsMin,u=e.containsMax,g=o.createDom({tagName:"div",attributes:{"class":E,id:k}});O.appendChild(g),g.appendChild(function(){if(r.indexOf(",")!==-1){if("singleColor"===b||"rangeColor"===b){if("Border"===L){var e=l?l:r;return 3==e.split(",").length?r="rgb("+r+")":4==e.split(",").length&&(r="rgba("+r+")"),o.createDom({tagName:"div",attributes:{style:"border: 1px solid "+r}})}if("Fill"===L){var e=n?n:r;return 3==e.split(",").length?r="rgb("+r+")":4==e.split(",").length&&(r="rgba("+r+")"),o.createDom({tagName:"div",attributes:{style:"background: "+r}})}}}else if("singleSymbol"===b||"rangeSymbol"===b){var t=r;return o.createDom({tagName:"div",attributes:{style:'background-image: url("'+m+t+'.png");background-size: 18px; background-repeat: no-repeat; background-position: 0px 2px;'}})}}()),g.appendChild(function(){var e="",r="";e=c===!0?"[":"(",r=u===!0?"]":")";var n=function(){return"singleColor"===b?[e,t,r," ",a].join(""):"rangeColor"===b?v?d?[e+t[0]+"%,"+t[1]+"%"+r," ",e,d,r," ",a].join(""):[e+t[0]+"%,"+t[1]+"%"+r," ",a].join(""):(t[0]||(t[0]="-&#8734;"),t[1]||(t[1]="+&#8734;"),i?[e,t,r," (",s,",",i,"%)"," ",a].join(""):[e,t,r," ",a].join("")):"singleSymbol"===b?[e,t,r," ",a].join(""):"rangeSymbol"===b?(t[0]||(t[0]="-&#8734;"),t[1]||(t[1]="+&#8734;"),i?[e,t,r," (",i,"%)"," ",a].join(""):[e,t,r," ",a].join("")):void 0}();return o.createDom({tagName:"div",attributes:{title:n},text:n})}())}))}};e.exports={createLegend:y}},function(e,t,a){var r=a(3),o=a(7),n=a(5),l=a(29),i=function(e){var t=function(e){var t,a=[];return e.forEach(function(e){t=new r.Feature({geometry:new r.geom.MultiPoint(e.data).transform(o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)}),t.setStyle(new r.style.Style({image:new r.style.Circle({fill:new r.style.Fill({color:e.fillColor}),stroke:new r.style.Stroke({color:e.strokeColor,width:e.strokeWidth}),radius:e.radius})})),a.push(t)}),a},a=function(e){var t,a=[];return e.forEach(function(e){t=new r.Feature({geometry:new r.geom.MultiLineString(e.data).transform(o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)}),t.setStyle(new r.style.Style({stroke:new r.style.Stroke({color:e.strokeColor,width:e.strokeWidth})})),a.push(t)}),a},i=function(e){var t,a=[];return e.forEach(function(e){t=new r.Feature({geometry:new r.geom.MultiPolygon([e.data]).transform(o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)}),t.setStyle(new r.style.Style({stroke:new r.style.Stroke({color:e.strokeColor,width:e.strokeWidth}),fill:new r.style.Fill({color:e.fillColor})})),a.push(t)}),a},s=l.getLayer({layerId:e.layerId,mapId:e.mapId});switch(s||(n.createLayer({layerId:e.layerId,mapId:e.mapId}),s=l.getLayer({layerId:e.layerId,mapId:e.mapId})),e.layerType){case o.LAYERTYPE.POINT:s.getSource().addFeatures(t(e.layerData));break;case o.LAYERTYPE.LINE:s.getSource().addFeatures(a(e.layerData));break;case o.LAYERTYPE.POLYGON:s.getSource().addFeatures(i(e.layerData));break;default:return}};e.exports={setVectorLayerData:i}},function(e,t,a){function r(e){if(!e||!p.isArray(e))return 0;var t=e[0],a=e[1];return t&&a?y.haversineDistance(n(t),n(a)):0}function o(e){if(!e||!p.isArray(e))return 0;for(var t=[],a=e.length,r=0;r<a;r++)t.push(n(e[r]));return y.geodesicArea(t)}function n(e){return p.isArray(e)&&2===e.length&&p.isFinite(e[0])&&p.isFinite(e[1])?[Number(e[0]),Number(e[1])]:p.isObject(e)&&p.isFinite(e.lon)&&p.isFinite(e.lat)?[Number(e.lon),Number(e.lat)]:p.isObject(e)&&p.isFinite(e.longitude)&&p.isFinite(e.latitude)?[Number(e.longitude),Number(e.latitude)]:null}function l(e,t,a,r,o,n,l,i){var s,d,c,u,g,y={x:null,y:null,onLine1:!1,onLine2:!1};return s=(i-n)*(a-e)-(l-o)*(r-t),0===s?null!==y.x&&null!==y.y&&y:(d=t-n,c=e-o,u=(l-o)*d-(i-n)*c,g=(a-e)*d-(r-t)*c,d=u/s,c=g/s,y.x=e+d*(a-e),y.y=t+d*(r-t),d>0&&d<1&&(y.onLine1=!0),c>0&&c<1&&(y.onLine2=!0),!(!y.onLine1||!y.onLine2)&&[y.x,y.y])}function i(e){var t={points:[],cross:!1};return e.forEach(function(a){e.forEach(function(e){for(var r=0;r<a.length-1;r++)for(var o=0;o<e.length-1;o++){var n=l(a[r][0],a[r][1],a[r+1][0],a[r+1][1],e[o][0],e[o][1],e[o+1][0],e[o+1][1]);n&&(t.cross=!0,t.points.push([n[0],n[1]]))}})}),t}var s=a(3),d=a(1),c=function(e,t,a,r,o){var n,l,i=a,s=5,d=o/s,c=s*Math.PI/180,u=Math.PI/2-(r+o/2)/180*Math.PI,g=[];g.push([e,t]);for(var y=0;y<d+1;y++)n=e+i*Math.cos(u),l=t+i*Math.sin(u),g.push([n,l]),u+=c;return g.push([e,t]),g},u=function(e,t,a,r,o){var n=[];n.push([e,t]);var l=a,i=Math.PI/2-(r+o/2)/180*Math.PI,s=e+l*Math.cos(i),d=t+l*Math.sin(i);n.push([s,d]),i=Math.PI/2-(r-o/2)/180*Math.PI;var c=e+l*Math.cos(i),u=t+l*Math.sin(i);return n.push([c,u]),n.push([e,t]),n},g=function(e,t,a,r,o){var n=a,l=[],i=Math.PI/2-(r+o/2)/180*Math.PI,s=e+n/2*Math.cos(i),d=t+n/2*Math.sin(i);i=Math.PI/2-(r-o/2)/180*Math.PI;var c=e+n/2*Math.cos(i),u=t+n/2*Math.sin(i);i=Math.PI/2-r/180*Math.PI;var g=e+n*Math.cos(i),y=t+n*Math.sin(i),p=e+n/2*Math.cos(i),f=t+n/2*Math.sin(i);return l.push([e,t]),l.push([p,f]),l.push([c,u]),l.push([g,y]),l.push([s,d]),l.push([p,f]),l.push([e,t]),l},y=new s.Sphere(6378137),p=d;e.exports={checkGeometryCross:i,createSector:c,createArrow:g,createTriangle:u,calcLength:r,calcArea:o}},function(e,t,a){var r=a(3),o=a(6),n=a(4),l=a(7),i=a(5),s=a(1),d=null,c=null,u=function(e){var t=e.layerId+"_"+e.mapId,a=null;c=o.getMapObj(e.mapId),n.containsKey(t)?a=n.get(t):(i.createLayer(e),a=n.get(t)),e.multiple&&a.set("multiple",e.multiple),d=a.getSource(),g(e)},g=function(e){var t=[],a=e.datas;(s.isValid(a)||a.length>0)&&(a.forEach(function(e){var a=e.coordinates,o=new r.geom.Polygon([a]),n=r.extent.getCenter(o.getExtent()),i=new r.Feature({geometry:o.transform("EPSG:4326","EPSG:3857"),labelPoint:r.proj.fromLonLat(n),businessType:l.BUSINESSTYPE.ADMIN_REGION,data:e});i.setId(e.id);var s=new r.style.Style({fill:new r.style.Fill({color:e.fillColor||null}),stroke:new r.style.Stroke({color:e.strokeColor||null,width:e.strokeWidth||1}),text:new r.style.Text({text:e.label?e.label:"",fill:new r.style.Fill({color:e.labelFillColor||"black"}),font:"normal 14px Arial",stroke:new r.style.Stroke({color:"#ffffff",width:3})})});i.setStyle(s),t.push(i)}),d.addFeatures(t))};e.exports={addFeature:u,setLayerData:g}},function(e,t,a){var r=a(3),o=a(4),n=a(5),l=a(1),i=a(7),s=function(e){var t=e.layerId+"_"+e.mapId,a=null;o.containsKey(t)?a=o.get(t):(n.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType",i.BUSINESSTYPE.BUBBLE_CIRCLE),a.on("postcompose",function(){});var r=a.getSource();e.source=r,d(e)},d=function(e){var t=e.datas,a=e.source;if(l.isValid(t)||t.length>0){var o=[];t.forEach(function(e){var t=r.proj.fromLonLat(e.coordinate),a=1e3,n=e.radius?e.radius*a:1e4,l=new r.Feature({geometry:new r.geom.Circle(t,n),data:e,businessType:i.BUSINESSTYPE.BUBBLE_CIRCLE});l.setId(e.id);var s=new r.style.Style({fill:new r.style.Fill({color:e.fillColor||"#319FD3"}),stroke:new r.style.Stroke({color:e.strokeColor||"#ff0",width:e.strokeWidth||1})});l.setStyle(s),o.push(l)}),a.addFeatures(o)}};e.exports={addBubble:s}},function(e,t,a){var r=a(3),o=a(4),n=a(5),l=a(1),i=a(7),s=function(e){var t=e.layerId+"_"+e.mapId,a=null;o.containsKey(t)?a=o.get(t):(n.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType",i.BUSINESSTYPE.BUBBLE),a.set("defaultVisibleLevel",e.defaultVisibleLevel||13),a.setZIndex(i.Z_INDEX.SITE);var r=a.getSource();e.source=r,d(e)},d=function(e){var t=[],a=e.datas;(l.isValid(a)||a.length>0)&&(a.forEach(function(e,a,o){var n=r.proj.fromLonLat(e.coordinate),l=new r.Feature({geometry:new r.geom.Point(n),data:e,businessType:i.BUSINESSTYPE.BUBBLE});l.setId(e.id),l.set("id",e.id);var s=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor||"red"}),stroke:new r.style.Stroke({color:e.strokeColor||"#319FD3",width:e.strokeWidth||1})})});l.setStyle(s),l.set("defaultStyle",s),t.push(l)}),e.source.addFeatures(t))};e.exports={addBubble:s,clear:function(e){o.get(e.layerId+"_"+e.mapId)&&o.get(e.layerId+"_"+e.mapId).getSource()&&o.get(e.layerId+"_"+e.mapId).getSource().clear()}}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId;if(n.containsKey(t)){var a=n.get(t);a.getSource().clear()}}var o=a(3),n=a(4),l=a(5),i=(a(1),a(7),function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(l.createLayer(e),a=n.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("defaultVisibleLevel",e.defaultVisibleLevel||13);var r=a.getSource();e.source=r,s(e)}),s=function(e){var t=[],a=e.datas;if(a&&a.length>0){for(var r=0;r<a.length;r++)for(var n=o.proj.fromLonLat(a[r].coordinate),l=a[r].radius,i=0;i<l.length;i++){var s=new o.geom.Circle(n,l[i]),d=new o.style.Style({fill:new o.style.Fill({color:a[r].fillColor[i]||"red"}),stroke:new o.style.Stroke({color:a[r].strokeColor[i]||"#319FD3",width:a[r].strokeWidth[i]||1})}),c=new o.Feature({geometry:s,data:a[r],type:"gradientCircle"});c.setStyle(d),0===i?c.setId(a[r].id):c.setId(a[r].id+"_"+i),t.push(c)}e.source.addFeatures(t)}};e.exports={addGradientCircle:i,removeGradientCircle:r}},function(e,t,a){var r=a(3),o=a(4),n=a(7),l=a(5),i=a(1),s=a(47),n=a(7),d=function(e){var t,a=e.layerId+"_"+e.mapId,i=null,s=o.get(e.mapId),d=s.getView().getZoom();t=void 0===e.defaultVisibleLevel?n.DefaultLayerVisibleLevel.CELL:e.defaultVisibleLevel;var u=!e.isShow||e.isShow;o.containsKey(a)?i=o.get(a):(l.createLayer(e),i=o.get(a)),e.multiple&&i.set("multiple",e.multiple),i.set("businessType",n.BUSINESSTYPE.VECTOR_CELL),i.set("layer_id",e.layerId),i.set("params.label",e.label?e.label:e.layerId),i.set("layerId",a),i.set("defaultVisibleLevel",t),i.setZIndex(n.Z_INDEX.CELL),i.set("hideWhenPan",e.hideWhenPan),i.set("legendName","mineLegendName"),i.setVisible(u),d<t&&i.setVisible(!1),fusiongis.Events.addClickCallback(e.mapId,"vector-cell-click-event",function(t){var a=t.feature,o=l.getLayer({mapId:e.mapId,layerId:e.layerId});if(o){var n=o.get("highLightFeature");if(n){var i=o.getSource().getFeatureById(n.getId());if(i){var s=i.get("data"),d=new r.style.Style({fill:new r.style.Fill({color:s.fillColor||"#836FFF"}),stroke:new r.style.Stroke({color:s.strokeColor||"#76EEC6",width:s.strokeWidth||2}),image:new r.style.Circle({radius:5,fill:new r.style.Fill({color:s.strokeColor||"#76EEC6"})}),text:new r.style.Text({text:s.label?s.label:""})});i.setStyle(d)}}if(a){var c=a.get("select"),d=new r.style.Style({fill:new r.style.Fill({color:c.fillColor||"#836FFF"}),stroke:new r.style.Stroke({color:c.strokeColor||"#76EEC6",width:c.strokeWidth||2}),image:new r.style.Circle({radius:5,fill:new r.style.Fill({color:c.strokeColor||"#76EEC6"})}),text:new r.style.Text({text:c.label?c.label:""})});a.setStyle(d),o.set("highLightFeature",a)}else o.set("highLightFeature",null)}},e.layerId),c(e)},c=function(e){var t=e.layerId+"_"+e.mapId,a=o.get(t),l=a.getSource(),d=[],c=e.datas,u=e.legendInfo,g={};if(u){var y={mapId:e.mapId,layerId:e.layerId,legendInfo:u,label:u.legendName,businessType:n.BUSINESSTYPE.CELL};g=u.legendList,e.legendInfo&&e.legendInfo.legendName&&a.set("legendName",e.legendInfo.legendName),fusiongis.Legend.createLegend(y)}a.set("datas",c),a.set("noChangeRadius",e.noChangeRadius),a.set("legendData",g);var p=o.get(e.mapId);if(i.isValid(c)||c.length>0){c.length>3e3&&console.warn("建议数据量控制在3000，大于3000建议使用服务类型小区！！");for(var f=c.length-1;f>0;f--)for(var m=0;m<f;m++)if(c[f].azimuth===c[m].azimuth&&c[f].radius>c[m].radius){var v=c[f];c[f]=c[m],c[m]=v}c.forEach(function(t,o,l){var i=t.cellType?t.cellType:"sector",c=t.coordinate[0],g=t.coordinate[1];if(c>180||c<-180)return console.warn("经度需要大于等于-180，且小于等于180！！"),!1;if(g>90||g<-90)return console.warn("纬度需要大于等于-90，且小于等于90！！"),!1;var y=t.radius;if(y<=0)return console.warn("小区半径必须大于0！！"),!1;var f=t.azimuth;if(f<0||f>360)return console.warn("小区方位角必须大于等于0， 或者小于等于360！！"),!1;var m=t.angle;if(m<=0||m>360)return console.warn("小区角度必须大于0，小于等于360！！"),!1;var v;if(e.noChangeRadius){y=y?y:40;var h,I=p.getPixelFromCoordinate(r.proj.fromLonLat(t.coordinate)),b=[];"arrow"===i?h=s.createArrow(I[0],I[1],y,f,m):"sector"===i?h=s.createSector(I[0],I[1],y,f,m):"triangle"===i&&(h=s.createTriangle(I[0],I[1],y,f,m));for(var S=0;S<h.length;S++)b.push(p.getCoordinateFromPixel(h[S]));v=new r.geom.LinearRing(b);
}else{y=y?y:4e3;var b,L=r.proj.fromLonLat([c,g]);"arrow"===i?b=s.createArrow(L[0],L[1],y,f,m):"sector"===i?b=s.createSector(L[0],L[1],y,f,m):"triangle"===i&&(b=s.createTriangle(L[0],L[1],y,f,m)),v=new r.geom.LinearRing(b)}var w=v.getCoordinates(),T=null;if(360===m){var E=t.pointRadius||0;T=new r.geom.GeometryCollection,w.splice(0,2),w.splice(w.length-1,2),T.setGeometries([new r.geom.Circle(r.proj.fromLonLat([c,g]),E),new r.geom.Polygon([w])])}else T=new r.geom.Polygon([w]);var k=a.get("legendData");if(u){if("singleColor"===u.legendType)for(var C=0,x=k.length;C<x;C++)if(parseFloat(k[C].value[0])===parseFloat(t.value)){if(!k[C].style){t.fillColor="rgba("+k[C].fillColor+")",t.strokeColor="rgba("+k[C].borderColor+")",t.strokeWidth=k[C].borderWidth;break}var O=k[C].style.split(",");3===O.length?(t.fillColor="rgb("+k[C].style+")",t.strokeColor="rgb("+k[C].style+")",t.strokeWidth=3):4===O.length&&(t.fillColor="rgba("+k[C].style+")",t.strokeColor="rgba("+k[C].style+")",t.strokeWidth=3)}if("rangeColor"===u.legendType)for(var C=0,x=k.length;C<x;C++)if(parseFloat(t.value)<=parseFloat(k[C].value[1])&&parseFloat(t.value)>=parseFloat(k[C].value[0])){if(!k[C].style){t.fillColor="rgba("+k[C].fillColor+")",t.strokeColor="rgba("+k[C].borderColor+")",t.strokeWidth=k[C].borderWidth;break}var O=k[C].style.split(",");3===O.length?(t.fillColor="rgb("+k[C].style+")",t.strokeColor="rgb("+k[C].style+")",t.strokeWidth=3):4===O.length&&(t.fillColor="rgba("+k[C].style+")",t.strokeColor="rgba("+k[C].style+")",t.strokeWidth=3)}}var _=new r.Feature({geometry:T,businessType:n.BUSINESSTYPE.VECTOR_CELL,data:t,select:t.hightLight?t.hightLight:{fillColor:t.fillColor?t.fillColor:"red",strokeColor:"black",strokeWidth:t.strokeWidth?t.strokeWidth:2,label:t.label?t.label:""}});_.setId(t.id),_.set("data",t);var N=new r.style.Style({fill:new r.style.Fill({color:t.fillColor||"#836FFF"}),stroke:new r.style.Stroke({color:t.strokeColor||"#76EEC6",width:t.strokeWidth||2}),text:new r.style.Text({text:t.label?t.label:""})});_.setStyle(N),_.set("defaultStyle",N),d.push(_)}),l.addFeatures(d)}var h=a.get("highLightFeature");if(h){var I=l.getFeatureById(h.getId());if(I){var b=I.get("select"),S=new r.style.Style({fill:new r.style.Fill({color:b.fillColor||"#836FFF"}),stroke:new r.style.Stroke({color:b.strokeColor||"#76EEC6",width:b.strokeWidth||2})});I.setStyle(S),a.set("highLightFeature",I)}}},u=function(e){var t=fusiongis.BaseLayer.getLayer(e);t&&t.getSource()&&t.getSource().clear()};e.exports={addCell:d,setLayerData:c,clear:u}},function(e,t,a){var r=a(3),o=a(4),n=function(e){var t=o.get(e.mapId),a=null,n=null,l=null,i=null,s=function(e){return l=document.createElement("div"),l.id="designChart_pie_"+e.id,l.style.width=e.width,l.style.height=e.height,a=echarts.init(l),n={series:[{name:"",type:"pie",hoverAnimation:!1,avoidLabelOverlap:!1,label:{normal:{show:!1,position:"inner"}},labelLine:{normal:{show:!1}},radius:"55%",center:["50%","50%"],data:e.Data}],color:e.color},a.setOption(n),l},d=function(e){return l=document.createElement("div"),l.id="designChart_bar_"+e.id,l.style.width=e.width,l.style.height=e.height,a=echarts.init(l),n={calculable:!0,grid:[{x:"7%",y:"7%",width:"80%",height:"80%"}],xAxis:[{type:"category",data:e.xAxisData}],yAxis:[{type:"value"}],series:[{name:"",type:"bar",data:e.Data}],color:e.color},a.setOption(n),l},c=function(e){return l=document.createElement("div"),l.id="designChart_line_"+e.id,l.style.width=e.width,l.style.height=e.height,a=echarts.init(l),n={backgroundColor:"rgba(255, 255, 255, 0.7)",calculable:!0,grid:[{x:"7%",y:"7%",width:"80%",height:"80%"}],xAxis:[{type:"category",data:e.xAxisData}],yAxis:[{type:"value"}],series:[{name:"",type:"line",symbol:"emptyCircle",symbolSize:4,data:e.Data}],color:e.color},a.setOption(n),l};for(var u in e.data)"bar"===u?e.data[u].forEach(function(e){var a=r.proj.fromLonLat(e.position),o=d(e);i=new r.Overlay({position:a,positioning:"bottom-left",element:o}),t.addOverlay(i)}):"pie"===u?e.data[u].forEach(function(e){var a=r.proj.fromLonLat(e.position),o=s(e);i=new r.Overlay({position:a,positioning:"bottom-left",element:o}),t.addOverlay(i)}):"line"===u&&e.data[u].forEach(function(e){i=new r.Overlay({position:r.proj.fromLonLat(e.position),positioning:"bottom-left",element:c(e)}),t.addOverlay(i)})};e.exports={addChartOnMap:n}},function(e,t){function a(e,t){var a,o,n,l,i,s,d,c,u=new r;return n=3*(e[1].x-e[0].x),o=3*(e[2].x-e[1].x)-n,a=e[3].x-e[0].x-n-o,s=3*(e[1].y-e[0].y),i=3*(e[2].y-e[1].y)-s,l=e[3].y-e[0].y-s-i,d=t*t,c=d*t,u.x=a*c+o*d+n*t+e[0].x,u.y=l*c+i*d+s*t+e[0].y,u}function r(e,t){this.x=e||0,this.y=t||0}function o(e,t,r){var o,n;for(o=1/(t-1),n=0;n<t;n++)r[n]=a(e,n*o)}var n=function(e,t){var a=e.coordinates.length;if(2===a){var n=[],l=e.coordinates[0],i=e.coordinates[1],s=e.radius[0],d=e.radius[1],c=e.azimuth[0],u=e.azimuth[1],g=ol.proj.fromLonLat(l),y=ol.proj.fromLonLat(i),p=Math.PI/2-c/180*Math.PI,f=Math.PI/2-u/180*Math.PI,m=g[0]+s*Math.cos(p),v=g[1]+s*Math.sin(p),h=y[0]+d*Math.cos(f),I=y[1]+d*Math.sin(f),b=ol.proj.fromLonLat(l),S=ol.proj.fromLonLat(i),L=[m,v],w=[h,I],T=[new r(b[0],b[1]),new r(L[0],L[1]),new r(w[0],w[1]),new r(S[0],S[1])],E=e.numberOfPoints,k=[];if(o(T,E,k),k.length>0)for(var C=0;C<k.length;C++)n.push(ol.proj.toLonLat([k[C].x,k[C].y]));var x={mapId:e.mapId,layerId:e.layerId,lineGeoId:e.lineGeoId,fillColor:e.fillColor?e.fillColor:"##208089",strokeColor:e.strokeColor?e.strokeColor:"##208089",strokeWidth:e.strokeWidth?e.strokeWidth:3,coordinates:n};if(fusiongis.LineStraight.addLine(x),!t)return n;t(n)}};e.exports={addCurve:n}},function(e,t,a){var r=a(3),o=a(4),n=a(7),l=(a(1),function(e){var t=e.mapId,a=e.layerId,n=a+"_"+t,l=o.get(t),i=null;return o.get(n)?i=o.get(n):(i=new r.layer.Image({opacity:e.opacity||.7}),i.set("layerId",a),i.set("mapId",t),l.addLayer(i),o.put(n,i)),e.multiple&&i.set("multiple",e.multiple),i}),i=function(e,t){var a=e.mapId,l=e.layerId,i=l+"_"+a,s=o.get(i),d=!!o.get(a)&&o.get(a).getSize(),c=null;if(t)c=new r.source.ImageStatic({url:e.imgUrl,projection:e.projection||n.PROJ.EPSG_4326,imageExtent:e.imageExtent});else{var u=n.GisRootUrl;u+="vector"===e.previewType?"/temporalmap/vector/getImage":"/temporalmap/grid/getImage",c=new r.source.ImageWMS({params:{parentTaskId:e.parentTaskId,subTaskId:e.subTaskId,VERSION:"1.1.1",WIDTH:d[0],HEIGHT:d[1]},extent:!!o.get(a)&&o.get(a).getExtent(a)||[-180,-85,180,85],url:u,wrapX:!1})}!!s&&s.setSource(c)};e.exports={createLayer:l,setLayerData:i}},function(e,t,a){function r(e,t,a){for(var r=(a[2]-a[0])/e,n=(-a[3]+a[1])/t,l=r/2,i=n/2,s=0;s<e;s++)for(var u=0;u<t;u++){var f=a[0]+r*s,m=a[3]+n*u,v=0;g.forEach(function(e){var t=o.proj.fromLonLat(e);t[0]>=f-l&&t[0]<f+l&&t[1]<=m-i&&t[1]>m+i&&(v+=1)});var h=d*s,I=c*u;y(h,I,v),p(h,I,v)}}var o=a(3),n=a(6),l=a(4),i=a(7),s=a(1),d=50,c=50,u=null,g=[],y=function(e,t,a){u.lineWidth=1,a>0?u.strokeStyle="rgba(0,0,255,0.8)":u.strokeStyle="rgba(0,0,255,0.1)",u.strokeRect(e-d/2,t-c/2,d,c)},p=function(e,t,a){a>0&&(u.textAlign="center",u.textBaseline="middle",u.font="15px Arial",u.fillStyle="white",u.fillText(a,e,t))},f=function(e,t,a,o,n){this.canvas||(this.canvas=document.createElement("canvas"));var l=o[0],i=o[1];this.canvas.setAttribute("width",l),this.canvas.setAttribute("height",i),u=this.canvas.getContext("2d");var s=l/d,g=i/c;return r(s,g,e),this.canvas},m=function(e){var t=e.mapId,a=e.layerId+"_"+t;g=e.datas;var r=n.getMapObj(t);if(!s.isValid(l.get(a))){var d=new o.layer.Image({source:new o.source.ImageCanvas({canvasFunction:f,projection:r.get("paramObj").proj})});d.set("type",i.CUSTOMTYPE.LAYERIMGTYPE),d.set("map",r),d.set("layerId",a),r.addLayer(d),l.put(a,d)}};e.exports={addGridDensity:m}},function(e,t,a){var r=a(3),o=a(6),n=(a(8),a(4)),l=a(7),i=a(29),s=a(1),d=function(e){var t=e.mapId,a=e.layerId+"_"+t,i=o.getMapObj(t),d=e.label?e.label:e.layerId,c=i.getView().getZoom(),u=e.defaultVisibleLevel||l.DefaultLayerVisibleLevel.HEAT_MAP,g=e.gradient?e.gradient:["#FF3030","#FF4500","#FF7F50","#FF8C00","#FFA54F","#FFB90F","#436EEE","#5CACEE","#54FF9F"];if(g.reverse(),!s.isValid(n.get(a))){var y=e.radius?e.radius:8,p=e.blur?e.blur:15,f=10*(y+p),m=new r.layer.Heatmap({gradient:g,radius:e.radius?e.radius:30,blur:e.blur?e.blur:50,shadow:f,source:new r.source.Vector({wrapX:!1})});m.set("type",l.CUSTOMTYPE.LAYERHEATTYPE),m.set("map",i),m.set("layerId",a),m.set("businessType",l.BUSINESSTYPE.HEAT_MAP),m.set("params.label",d),m.set("layer_id",e.layerId),m.set("defaultVisibleLevel",u),e.multiple&&m.set("multiple",e.multiple),c<u&&m.setVisible(!1),i.addLayer(m),n.put(a,m)}return m},c=function(e){var t=d(e),a=[],o=[],n=0;e.datas.forEach(function(e){o.push(e.weight)}),s.sortDesc(o),n=o[0],e.datas.forEach(function(e){var t=new r.geom.Point(r.proj.fromLonLat(e.coordinate)),o=new r.Feature({geometry:t,data:e,weight:e.weight/n});o.setId(e.id),a.push(o)}),t.getSource().addFeatures(a)},u=function(e){var t=i.getLayer(e),a=[],o=[],n=0;e.datas.forEach(function(e){o.push(e.weight)}),s.sortDesc(o),n=o[0],e.datas.forEach(function(e){var t=new r.geom.Point(r.proj.fromLonLat(e.coordinate)),o=new r.Feature({geometry:t,data:e,weight:e.weight/n});o.setId(e.id),a.push(o)}),t.getSource().addFeatures(a)};e.exports={addHeatMap:c,addLayer:d,setLayerData:u}},function(e,t,a){var r=a(3),o=(a(8),a(7)),n=a(4),l=a(5),i=(a(1),a(29)),s=null,d=o.GisResourceURL+"marker/",c=function(e){var t=e.layerId+"_"+e.mapId,a=e.label?e.label:e.layerId,r=null;s=n.get(e.mapId),n.containsKey(t)?r=n.get(t):(l.createLayer(e),r=n.get(t)),e.multiple&&r.set("multiple",e.multiple),r.set("type","ICON"),r.set("layerId",e.layerId),r.set("layer_id",e.layerId),r.set("businessType","ICON"),r.set("params.label",a),r.set("legendName",e.legendName),u(e)},u=function(e){var t=i.getLayer(e),a=[],n=e.datas,l=s.getView().calculateExtent(s.getSize());e.imgPath&&(d=e.imgPath),n&&(n.forEach(function(e){var t=null,n=null,i=e.coordinate,s=r.proj.transformExtent(l,o.PROJ.EPSG_3857,o.PROJ.EPSG_4326);if(r.extent.containsCoordinate(s,i)){var c=r.proj.fromLonLat(i),u=new r.geom.Point(c),g=new r.Feature({geometry:u,businessType:o.BUSINESSTYPE.ICON,data:e});g.setId(e.id),e.imageName?(t=d+e.imageName,n=d+e.selectImageName):(t=o.GisResourceURL+"marker/ne_default.png",n=o.GisResourceURL+"marker/ne_select.png");var y=0;y=e.rotation?e.rotation:0;var p=e.opacity||1,f=new r.style.Style({image:new r.style.Icon({src:t,rotation:y,opacity:p})});g.setStyle(f),g.set("imgUrl",t),g.set("selectImgUrl",n),g.set("rotation",y),g.set("opacity",p),a.push(g)}}),t.getSource().addFeatures(a),t.set("legendName",e.legendName))};e.exports={addIcon:c,setLayerData:u}},function(e,t,a){var r=a(3),o=a(6),n=a(4),l=a(7),i=a(5),s=a(1),d=null,c=null,u=function(e){var t=e.layerId+"_"+e.mapId;c=o.getMapObj(e.mapId);var a=null;n.containsKey(t)?a=n.get(t):(i.createLayer(e),a=n.get(t)),e.multiple&&a.set("multiple",e.multiple),d=a.getSource()},g=function(e){var t=[],a=e.datas,o=c.getView(),n=o.calculateExtent(c.getSize());(s.isValid(a)||a.length>0)&&(a.forEach(function(e){var a=e.coordinate,o=r.proj.transformExtent(n,l.PROJ.EPSG_3857,l.PROJ.EPSG_4326);if(r.extent.containsCoordinate(o,a)){var i=r.proj.fromLonLat(a),s=new r.geom.Point(i),d=new r.Feature({geometry:s}),c=e.id;d.setId(c);var u=d.clone(),g=c+"_shadow";u.setId(g);var y=d.clone(),p=c+"_relation_featureId";y.setId(p);var f=new r.style.Style({image:new r.style.Circle({radius:6,stroke:new r.style.Stroke({color:"#1E90FF",width:3}),fill:new r.style.Fill({color:"white"})}),text:new r.style.Text({text:e.pointLabel,font:"normal 14px Arial",offsetY:e.pointLabelY||20})});d.setStyle(f);var m=new r.style.Style({image:new r.style.Circle({radius:10,stroke:new r.style.Stroke({color:"#87CEEB",width:5}),fill:new r.style.Fill({color:"rgba(0,0,0,0)"})})});u.setStyle(m);var v=new r.style.Style({image:new r.style.Icon({src:e.imgUrl,opacity:.7,scale:e.scale||1,anchor:[.47,.7]}),text:new r.style.Text({text:e.iconLabel,font:"normal 14px Arial",offsetY:e.iconLabelY||25})});y.setStyle(v),t.push(d,u,y)}}),d.addFeatures(t))};e.exports={addLayer:u,setLayerData:g}},function(e,t,a){function r(e){var t=g.getMapObj(e.mapId),a=y.getLayer({mapId:e.mapId,layerId:e.sourceLayerId});if(!a)throw new Error("source layer does not exist!");var r=o(e,t);y.addEffectLayer({mapId:e.mapId,layer:a,effectLayer:r}),n(e,t,r);var l=d(e,t);l.onDrag=function(e,t){var a=t,r=a.get("line"),o=r.getGeometry().getCoordinates()[0],n=a.getGeometry().getCoordinates(),l=s(o,n);r.getGeometry().setCoordinates(l)}}function o(e,t){var a="infoPop香"+e.sourceLayerId,r=p.getLayer({mapId:e.mapId,layerId:a});return r?r:(r=new u.layer.Vector({map:t,layerId:a,source:new u.source.Vector({warpX:!1})}),r.setZIndex(1999),t.addLayer(r),r)}function n(e,t,a){var r=[];e.data.forEach(function(a){var o=a.position?a.position:"left",n=a.distance?a.distance:150,s=u.proj.fromLonLat(a.lonLat),d=t.getPixelFromCoordinate(s),c=d.slice(0);switch(o){case"left":c[0]=c[0]-n;break;case"right":c[0]=c[0]+n;break;case"up":c[1]=c[1]+n;break;case"down":c[1]=c[1]-n}var g=t.getCoordinateFromPixel(c),y=l(e,a,g),p=i(e,a,s,g);y.set("line",p),r.push(y),r.push(p)}),a.getSource().addFeatures(r)}function l(e,t,a){var r=new u.Feature(new u.geom.Point(a)),o=t.fontSize?t.fontSize:"16px",n=t.fontFamily?t.fontFamily:"serif",l=o+" "+n,i=t.radius?t.radius:39;return i+=t.strokeWidth?t.strokeWidth:4,r.setStyle([new u.style.Style({image:new u.style.Circle({radius:i,fill:new u.style.Fill({color:t.fillColor||"#FF8870"})})}),new u.style.Style({image:new u.style.Circle({radius:t.radius||35,fill:new u.style.Fill({color:t.fillColor||"#FF8870"}),stroke:new u.style.Stroke({color:t.strokeColor||"#FFFFFF",width:t.strokeWidth||4})}),text:new u.style.Text({font:l,text:t.content,fill:new u.style.Fill({color:t.fontColor||"#000000"})})})]),r.set("data",t),r.set("sourceLayerId",e.sourceLayerId),r.set("type","infoPop_shape"),r.setId(t.id),r}function i(e,t,a,r){var o=s(a,r),n=new u.Feature(new u.geom.LineString(o));return n.setStyle(new u.style.Style({stroke:new u.style.Stroke({color:t.lineColor||"#0099ff",width:t.lineWidth||2})})),n.set("data",t),n.set("sourceLayerId",e.sourceLayerId),n.set("type","infoPop_line"),n.setId("line香"+t.id),n}function s(e,t){var a=[e,t];return e[0]!==t[1]&&e[1]!==t[1]&&a.splice(1,0,[e[0],t[1]]),a}function d(e,t){var a=p.getIntactByName(e.mapId,"infoPopDrag");return a?a:(a=new c,a.set("mapId",e.mapId),a.set("name","infoPopDrag"),t.addInteraction(a),a)}function c(){u.interaction.Pointer.call(this,{handleDownEvent:c.prototype.handleDownEvent,handleDragEvent:c.prototype.handleDragEvent,handleMoveEvent:c.prototype.handleMoveEvent,handleUpEvent:c.prototype.handleUpEvent}),this.coordinate_=null,this.cursor_="pointer",this.feature_=null,this.previousCursor_=void 0,this.onDrag=null}var u=a(3),g=a(6),y=a(29),p=a(32);u.inherits(c,u.interaction.Pointer),c.prototype.handleDownEvent=function(e){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){if("infoPop_shape"===e.get("type"))return e});return a&&(this.coordinate_=e.coordinate,this.feature_=a),!!a},c.prototype.handleDragEvent=function(e){var t=e.coordinate[0]-this.coordinate_[0],a=e.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(t,a),this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1],this.onDrag&&this.onDrag(e,this.feature_)},c.prototype.handleMoveEvent=function(e){if(this.cursor_){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){if("infoPop_shape"===e.get("type"))return e}),r=e.map.getTargetElement();a?r.style.cursor!==this.cursor_&&(this.previousCursor_=r.style.cursor,r.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}},c.prototype.handleUpEvent=function(){return this.coordinate_=null,this.feature_=null,!1},e.exports={addInfoPop:r}},function(e,t,a){function r(e){var t=e.filterType,a=e.mapId,r=e.layerId,o=e.rateR,n=e.rateG,l=e.rateB,i=e.isCustom,s=e.layerRenderEnd,d=f.getLayer({mapId:a,layer_id:r});if(d&&t){var c=d.get("imageFilter.handle");if(c&&d.unByKey(c),c=d.on("postcompose",function(e){h[t](e.context,o,n,l,i),s&&"function"==typeof s&&s(e.context)}),d.set("imageFilter.handle",c),d.set("imageFilter.type",t),e.multiple&&d.set("multiple",e.multiple),"base_layer"===e.layerId){var u=m.getMapObj(e.mapId),g=u.get("paramObj");g.mapType===p.MAPTYPE.GOOGLE_MAP&&v.setImageFilter(e)}}}function o(e){var t=f.getLayer({mapId:e.mapId,layer_id:e.layerId});if(t){var a=t.get("imageFilter.handle");if(a&&(t.unByKey(a),t.unset("imageFilter.handle"),t.unset("imageFilter.type")),"base_layer"===e.layerId){var r=m.getMapObj(e.mapId),o=r.get("paramObj");o.mapType===p.MAPTYPE.GOOGLE_MAP&&v.removeImageFilter(e)}}}function n(e){var t=f.getLayer({mapId:e.mapId,layer_id:e.layerId});if(t)return t.get("imageFilter.type")}function l(e,t,t,t,a){if(!a){for(var r=e.canvas,o=r.width,n=r.height,l=e.getImageData(0,0,o,n),i=l.data,s=0,d=i.length;s<d;s+=4)i[s+0]=i[s+1]=i[s+2]=(3*i[s+0]+4*i[s+1]+i[s+2])/8;e.putImageData(l,0,0)}}function i(e,t,a,r,o){if(!o){var n=e.canvas,l=n.width,i=n.height,s=.01,d=.01,c=.7;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var u=e.getImageData(0,0,l,i),g=u.data,y=0,p=g.length;y<p;y+=4){var f=g[y+0],m=g[y+1],v=g[y+2],h=s*f+d*m+c*v;g[y+0]=255-h,g[y+1]=255-h,g[y+2]=h,g[y+3]=255}e.putImageData(u,0,0)}}function s(e,t,a,r,o){if(!o){var n=e.canvas,l=n.width,i=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var u=e.getImageData(0,0,l,i),g=u.data,y=0,p=g.length;y<p;y+=4){var f=g[y+0],m=g[y+1],v=g[y+2],h=s*f+d*m+c*v;g[y+0]=h,g[y+1]=255-h,g[y+2]=h,g[y+3]=255}e.putImageData(u,0,0)}}function d(e,t,a,r,o){if(!o){var n=e.canvas,l=n.width,i=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var u=e.getImageData(0,0,l,i),g=u.data,y=0,p=g.length;y<p;y+=4){var f=g[y+0],m=g[y+1],v=g[y+2],h=s*f+d*m+c*v;g[y+0]=255-h,g[y+1]=h,g[y+2]=h,g[y+3]=255}e.putImageData(u,0,0)}}function c(e,t,a,r,o){if(!o){var n=e.canvas,l=n.width,i=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var u=e.getImageData(0,0,l,i),g=u.data,y=0,p=g.length;y<p;y+=4){var f=g[y+0],m=g[y+1],v=g[y+2],h=s*f+d*m+c*v;g[y+0]=255-h,g[y+1]=h,g[y+2]=255-h,g[y+3]=255}e.putImageData(u,0,0)}}function u(e,t,a,r,o){if(!o){var n=e.canvas,l=n.width,i=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var u=e.getImageData(0,0,l,i),g=u.data,y=0,p=g.length;y<p;y+=4){var f=g[y+0],m=g[y+1],v=g[y+2],h=s*f+d*m+c*v;g[y+0]=h,g[y+1]=h,g[y+2]=255-h,g[y+3]=255}e.putImageData(u,0,0)}}function g(e,t,a,r,o){if(!o){var n=.02,l=.215,i=.545;t&&(n=t),0===t&&(n=t),a&&(l=a),0===a&&(l=a),r&&(i=r),0===r&&(i=r);for(var s=e.canvas,d=s.width,c=s.height,u=e.getImageData(0,0,d,c),g=u.data,y=0,p=g.length;y<p;y+=4){var f=g[y+0],m=g[y+1],v=g[y+2],h=n*f+l*m+i*v;g[y+0]=255-h,g[y+1]=255-h,g[y+2]=255-h,g[y+3]=255}e.putImageData(u,0,0)}}function y(e,t,a,r,o){if(!o){for(var n=e.canvas,l=n.width,i=n.height,s=e.getImageData(0,0,l,i),d=s.data,c=0,u=d.length;c<u;c+=4){var g=d[c+0],y=d[c+1],p=d[c+2],f=255-g+(255-y)+(255-p);d[c+0]=f/3,d[c+1]=f/3,d[c+2]=120,d[c+3]=255}e.putImageData(s,0,0)}var m="自定滤镜算法参考如下:\n/***************************************************************************\n*  var canvas = context.canvas;\n*  var width = canvas.width;\n*  var height = canvas.height;\n*  var imageData = context.getImageData(0, 0, width, height);\n*  var pix = imageData.data;\n*  for (var i = 0, n = pix.length; i < n; i += 4) {\n*      var r = pix[i + 0];\n*      var g = pix[i + 1];\n*      var b = pix[i + 2];\n*      var v = (255 - r) + (255 - g) + (255 - b);\n*      pix[i + 0] = v / 3; // Red\n*      pix[i + 1] = v / 3; // Green\n*      pix[i + 2] = 120; // Blue\n*      pix[i + 3] = 255; // Alpha\n*  }\n*  context.putImageData(imageData, 0, 0);\n***************************************************************************/";I===!1&&console.log("%c "+m,"color:blue;font-size:14px;"),I=!0}var p=(a(1),a(7)),f=a(32),m=a(6),v=a(20),h={gray:l,blue:i,pink:s,teal:d,green:c,yellow:u,black:g,g20:y},I=!1;e.exports={setImageFilter:r,removeImageFilter:o,getImageFilter:n}},function(e,t,a){function r(e){var t=p.getMapObj(e.mapId),a=e.sourceLayerId+"-"+e.targetLayerId,r=v.getLayer({mapId:e.mapId,layerId:a});return r||(r=new y.layer.Vector({source:new y.source.Vector({wrapX:!1})}),r.set("mapId",e.mapId),r.setZIndex(2e3),r.set("layerId",a),r.set("sourceLayerId",e.sourceLayerId),r.set("sourceLayerType",e.sourceLayerType),r.set("targetLayerId",e.targetLayerId),r.set("targetLayerType",e.targetLayerType),t.addLayer(r)),r}function o(e){var t=h.getLayer({mapId:e.mapId,layerId:e.sourceLayerId}),a=h.getLayer({mapId:e.mapId,layerId:e.targetLayerId});if(t&&a){var o=r(e);h.addEffectLayer({layer:t,effectLayer:o}),h.addEffectLayer({layer:a,effectLayer:o}),e.datas.forEach(function(t){n(e,o,t)});var l=e.sourceLayerId+"-"+e.targetLayerId,i=function(e){var t=p.getMapObj(e.mapId),a=t.getLayers().getArray(),r=S.find(a,function(e){if(e&&e.get("layerId")===l)return e});if(r&&r.getSource()){var o=r.getSource().getFeatures();!!o&&o.forEach(function(t){var a=t.get("arrow");a&&setTimeout(function(){var r=t.getGeometry(),o=a.getGeometry(),n=t.get("coordinates"),l=d(n[0],n[1],e.mapId);r.setCoordinates([n[0],l]),o.setCoordinates(l)},500)})}};b.onZoomChange({mapId:e.mapId,id:l,callbackfunc:i})}}function n(e,t,a){"POLYGON"!==e.targetLayerType&&i(a,e).then(function(r){l(a,e,r).then(function(o){var n=s(o,r,a,e);t.getSource().addFeatures(n)})})}function l(e,t,a){var r=m.defer();if(e.sourceLngLat){var o=[Number(e.sourceLngLat[0]),Number(e.sourceLngLat[1])];return r.resolve(o),r.promise}if(e.sourceGeoId){var n=I.getBsHandler(t.sourceLayerType),l={mapId:t.mapId,layerId:t.sourceLayerId,layerType:t.sourceLayerType,geoId:e.sourceGeoId,targetPoint:a};if(!n)return;return n.getLineLonLat(l,function(e){e?r.resolve(e):r.reject(e)}),r.promise}}function i(e,t){var a=m.defer();if(e.targetLngLat){var r=[Number(e.targetLngLat[0]),Number(e.targetLngLat[1])];return a.resolve(r),a.promise}if(e.targetGeoId){var o=I.getBsHandler(t.targetLayerType),n={mapId:t.mapId,layerId:t.targetLayerId,layerType:t.targetLayerType,geoId:e.targetGeoId};if(!o)return;return o.getLineLonLat(n,function(e){e?a.resolve(e):a.reject(e)}),a.promise}}function s(e,t,a,r){var o,n=y.proj.fromLonLat(e),l=y.proj.fromLonLat(t),i=[];o=r.lineType?1===r.lineType[0]?[0]:[r.lineType[0]]:[0];var s=new y.Feature({geometry:new y.geom.LineString([n,l]),businessType:f.BUSINESSTYPE.LINE,mapId:r.mapId}),d=new y.style.Style({fill:new y.style.Fill({color:a.fillColor?a.fillColor:"#000"}),stroke:new y.style.Stroke({color:a.strokeColor?a.strokeColor:"#000",width:a.strokeWidth?a.strokeWidth:1,lineDash:o})});if(s.setStyle(d),s.setId(a.geoId),s.set("sourceGeoId",a.sourceGeoId),s.set("targetGeoId",a.targetGeoId),s.set("coordinates",[n,l]),i.push(s),r.isArrow){var c=u(a,e,t,r.mapId,s);s.set("arrow",c),i.push(c)}return i}function d(e,t,a){var r=p.getMapObj(a),o=r.getPixelFromCoordinate(e),n=r.getPixelFromCoordinate(t),l=o[0],i=o[1],s=n[0],d=n[1],c=7,u=s-l>=0?-1:1,g=d-i>=0?-1:1,y=Math.atan2(d-i,s-l),f=s+u*c*Math.abs(Math.cos(y)),m=d+g*c*Math.abs(Math.sin(y));return r.getCoordinateFromPixel([f,m])}function c(e,t){var a=t[0]-e[0],r=t[1]-e[1];return-Math.atan2(r,a)+Math.PI/2}function u(e,t,a,r,o){var n=c(t,a),l=d(t,a,r);o.getGeometry().setCoordinates([t,l]);var i=new y.Feature({geometry:new y.geom.Point(l)});return i.setStyle(new y.style.Style({image:new y.style.RegularShape({fill:new y.style.Fill({color:e.strokeColor||"#000000"}),stroke:new y.style.Stroke({color:e.strokeColor||"#000000",width:e.strokeWidth||1}),points:3,radius:8,rotation:n,angle:0})})),i.setId(e.geoId+"_arrow"),i.set("coordinates",l),i}function g(e){var t=e.sourceLayerId+"-"+e.targetLayerId,a=v.getLayer({mapId:e.mapId,layerId:t});a&&a.getSource().clear()}var y=a(3),p=a(6),f=a(7),m=a(63),v=a(32),h=a(29),I=a(28),b=a(11),S=a(1);e.exports={drawLine:o,removeLine:g}},function(e,t){"use strict";function a(){this.state_=o.WAITING,this.callbacks={},this.results={},this.done=!1}function r(){var e=new a;return{promise:e,resolve:function(t){e.resolve(t)},reject:function(t){e.reject(t)},each:function(t,a){return e.each(t,a)}}}var o={};o.RESOLVED="resolved",o.REJECTED="rejected",o.WAITING="waiting",a.prototype.resolve=function(e){this.done||(this.done=!0,this.state_=o.RESOLVED,this.results.resolved=e,this.next_())},a.prototype.reject=function(e){this.done||(this.done=!0,this.state_=o.REJECTED,this.results.rejected=e,this.next_())},a.prototype.then=function(e,t){return e&&(this.callbacks.onResovled=e),t&&(this.callbacks.onRejected=t),this.nextPromise||(this.nextPromise=new a),this.next_(),this.nextPromise},a.prototype.next_=function(){this.nextPromise||(this.nextPromise=new a),this.state_===o.RESOLVED&&this.callbacks.onResovled&&this.callbacks.onResovled(this.results.resolved,this.nextPromise),this.state_===o.REJECTED&&this.callbacks.onRejected&&this.callbacks.onRejected(this.results.rejected,this.nextPromise)},a.prototype.each=function(e,t){function r(e,a,r){r.then(function(e){n++,i[a]=e,s.push(e),n===l&&o.resolve(s)},function(e){n++,i[a]=e,d.push(e),n===l&&o.resolve(s)}),t(e,a,r)}var o=this,n=0,l=e.length,i=new Array(l),s=[],d=[];if(0===l)o.resolve(s);else for(var c=0;c<l;c++){var u=new a;r(e[c],c,u)}return this},e.exports={defer:r}},function(e,t,a){function r(e){this.gisLayerMgrId="gis_layer_manager_id_",this.mapId=e.mapId,this.isShow=e.isShow;var t=e.attributes||{},a=this.gisLayerMgrId+this.mapId;t.id=a,t.hasOwnProperty("class")||(t["class"]="gis_layer_manager");var r=l.createDom({tagName:"div",attributes:t});l.getDom(a)&&l.getDom(this.mapId).removeChild(l.getDom(a)),l.getDom(this.mapId).appendChild(r);var i=o(this.mapId,a);r.appendChild(i);var s=n(r,this.mapId);if(r.appendChild(s),!this.isShow){var d=l.getDom(this.gisLayerMgrId+this.mapId);l.getDom(this.mapId).removeChild(d)}}function o(e,t){var a=l.createDom({tagName:"div",attributes:{"class":"switcher"},text:"+"}),r=function(){var r=l.getDom(t);if(r)if("+"===a.innerText){var o=n(r,e);r.appendChild(o),r.lastChild.style.display="block",a.innerText="-"}else r.lastChild.style.display="none",a.innerText="+"};return i.add(a,"click",r),a}function n(e,t){var a;return document.querySelector(".gis_layer_manager > .layer_list")&&(a=document.querySelector(".gis_layer_manager > .layer_list"),e.removeChild(a)),a=l.createDom({tagName:"div",attributes:{"class":"layer_list"}}),s.isEmpty()||s.keys.forEach(function(e){if(e&&u.endsWith(e,"_"+t)){var r=l.createDom({tagName:"div",attributes:{"class":"layer"}});a.appendChild(r);var o=l.createDom({tagName:"div",attributes:{"class":"controller"}}),n=l.createDom({tagName:"input",attributes:{type:"checkbox","class":"checkbox",name:"layer_name",checked:!0}});o.appendChild(n),r.appendChild(o);var s=e.lastIndexOf("_"),g=e.substring(0,s),y=l.createDom({tagName:"div",attributes:{"class":"layer_name",title:g},text:g.length>25?g.substring(0,25):g});r.appendChild(y);var p=l.createDom({tagName:"div",attributes:{"class":"z_index_btn_box"}}),f=l.createDom({tagName:"div",attributes:{"class":"btn"}}),m=l.createDom({tagName:"div",attributes:{"class":"btn"}});p.appendChild(f),p.appendChild(m),r.appendChild(p);var v=function(e){e.target.checked?d.setVisible({mapId:t,layerIds:[g],isShow:!0}):d.setVisible({mapId:t,layerIds:[g],isShow:!1})};i.add(n,"click",v);var h=0,I=c.getMapObj(t),b=I.getLayers().getLength(),S=function(a){d.setLayerZIndex({mapId:t,layerId:e.substring(0,e.lastIndexOf("_")),zIndex:a})};i.add(f,"click",function(){h!==b&&(h+=1),S(h)}),i.add(m,"click",function(){h-=1,S(h)})}}),a}var l=a(10),i=a(65),s=a(4),d=a(5),c=a(6),u=a(1);e.exports={layerManager:r}},function(e,t){function a(e){for(var t in e)return!1;return!0}function r(e,t){for(var a=0,r=e.length;a<r;)t(a,e[a])?a=0:a++}function o(e,t){var r=e.listeners[t]._handler_;e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent("on"+t,r),delete e.listeners[t],a(e.listeners)&&delete e.listeners}function n(e,t,a){e.listeners=e.listeners||{};var r=e.listeners[t]=e.listeners[t]||[];r.push(a),r._handler_||(r._handler_=function(t){for(var a,o=t||window.event,n=0;a=r[n++];)a.call(e,o)},e.addEventListener?e.addEventListener(t,r._handler_,!1):e.attachEvent("on"+t,r._handler_))}function l(e,t,a){if(e.listeners){var n=e.listeners&&e.listeners[t];n&&(r(n,function(e,t){if(t==a)return n.splice(e,1)}),0==n.length&&o(e,t))}}function i(e,t){try{if(e.dispatchEvent){var a=document.createEvent("Event");a.initEvent(t,!0,!0),e.dispatchEvent(a)}else e.fireEvent&&e.fireEvent("on"+t)}catch(r){console.error(r.getMessage())}}e.exports={add:n,remove:l,dispatch:i}},function(e,t,a){var r=a(3),o=a(1),n=a(4),l=a(5),i=a(8),s=a(7),d=a(10),c=null,u=[],g=function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(l.createLayer(e),a=n.get(t)),c=a.getSource(),y(e)},y=function(e){var t=[],a=e.datas,n=i.getExtent(e.mapId);(o.isValid(a)||a.length>0)&&(a.forEach(function(e){var a=r.proj.fromLonLat(e.coordinate);if(r.extent.containsCoordinate(n,a)){var o=new r.geom.Point(a),l=new r.Feature({geometry:o,businessType:s.BUSINESSTYPE.LEGEND_RANGE,data:e});l.setId(e.id),l.set("legendVal",e.legendVal);var i=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new r.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});l.setStyle(i),l.set("foreverStyle",i),l.set("radius",e.radius?e.radius:5),l.set("strokeWidth",e.strokeWidth?e.strokeWidth:1),t.push(l)}}),c.addFeatures(t),u=t),p(e)},p=function(e){var t=e.legendData,a=e.mapId,o=d,n=null,l=o.getDom(a).getElementsByClassName("layer_legend_container_for_one_map");l&&l.length>0?n=l[0]:(n=o.createDom({tagName:"div",attributes:{"class":"layer_legend_container_for_one_map"}}),o.getDom(a).appendChild(n));var i=o.createDom({tagName:"div",attributes:{"class":"one_legend_range__box_one_layer"}});if(!document.querySelector(".layer_legend_container_for_one_map").hasChildNodes("measure-close-legend")){var s=o.createDom({tagName:"div",attributes:{id:"closeEvent","class":"measure-close-legend"}});n.insertBefore(s,n.childNodes[0]),s.onclick=function(){n.style.display="none",o.getDom(a).removeChild(n)}}n.querySelector(".one_legend_range__box_one_layer")&&n.removeChild(n.querySelector(".one_legend_range__box_one_layer")),n.appendChild(i),t.forEach(function(e){var t=o.createDom({tagName:"div",attributes:{"class":"one_legend_line"}});t.style.cursor="pointer",t.id=e.val,i.appendChild(t),t.onclick=function(){var e=t.getAttribute("id").split(",");u.forEach(function(a){var o=a.get("legendVal");if(parseFloat(e[0])<=o&&o<parseFloat(e[1]))if(0===a.get("opacity"))a.set("opacity",1),a.setStyle(a.get("foreverStyle")),t.style.borderLeftWidth="0px",t.childNodes[0].style.backgroundColor=t.childNodes[0].id;else{a.set("opacity",0);var n=new r.style.Style({image:new r.style.Circle({radius:a.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:a.get("strokeWidth")})})});a.setStyle(n),t.style.borderLeftWidth="2px",t.style.borderLeftStyle="solid",t.style.borderLeftColor="#00BFFF",t.childNodes[0].style.backgroundColor="gray"}})};var a=o.createDom({tagName:"div"});a.style.width="8px",a.style.height="8px",a.style.marginTop="9px",a.style.marginLeft="10px",a.style.marginRight="10px",a.style.backgroundColor=e.color,a.style.borderRadius="100px",a.style.webkitBorderRadius="100px",a.style.mozBorderRadius="100px",a.id=e.color,t.appendChild(a);var n=o.createDom({tagName:"div"});n.innerHTML=e.title?e.title:e.text,t.appendChild(n)})};e.exports={addFeature:g,setLayerData:y,createLegend:p}},function(e,t,a){var r=a(3),o=a(1),n=a(4),l=a(5),i=a(8),s=a(7),d=a(10),c=null,u=[],g=function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(l.createLayer(e),a=n.get(t)),c=a.getSource(),y(e)},y=function(e){var t=[],a=e.datas,n=i.getExtent(e.mapId);(o.isValid(a)||a.length>0)&&(a.forEach(function(e){
var a=r.proj.fromLonLat(e.coordinate);if(r.extent.containsCoordinate(n,a)){var o=new r.geom.Point(a),l=new r.Feature({geometry:o,businessType:s.BUSINESSTYPE.LEGEND_SLIDER,data:e});l.setId(e.id),l.set("legendVal",e.legendVal);var i=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new r.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});l.setStyle(i),l.set("foreverStyle",i),l.set("radius",e.radius?e.radius:5),l.set("strokeWidth",e.strokeWidth?e.strokeWidth:1),t.push(l)}}),c.addFeatures(t),u=t),p(e)},p=function(e){var t=(e.legendData,e.mapId),a=d,n=o.getBrowserType(),l=null,i=a.getDom(t).getElementsByClassName("layer_legend_container_for_one_map");i&&i.length>0?l=i[0]:(l=a.createDom({tagName:"div",attributes:{"class":"layer_legend_container_for_one_map"}}),a.getDom(t).insertBefore(l,a.getDom(t).childNodes[0]));var s=a.createDom({tagName:"div",attributes:{"class":"one_legend_box_one_layer_slider"}});if(!document.querySelector(".layer_legend_container_for_one_map").hasChildNodes("measure-close-legend")){var c=a.createDom({tagName:"div",attributes:{id:"closeEvent","class":"measure-close-legend"}});l.insertBefore(c,l.childNodes[0]),c.onclick=function(){l.style.display="none",a.getDom(t).removeChild(l)}}l.querySelector(".one_legend_box_one_layer_slider")&&l.removeChild(l.querySelector(".one_legend_box_one_layer_slider")),l.appendChild(s);var g="",y="";n.webkit?(g="slider_left_chrome",y="slider_right_chrome"):n.mozilla?(g="slider_left_Firefox",y="slider_right_Firefox"):n.msie&&(g="slider_left_MsIE",y="slider_right_MsIE");var p=a.createDom({tagName:"div",attributes:{"class":g}});s.appendChild(p);var f=a.createDom({tagName:"input",attributes:{type:"range",step:1,min:1,max:e.legendData.length,value:1,zIndex:2}});f.title=1,p.appendChild(f);var m=function(e){var t=e.inputLeftVal,a=e.inputRightVal;u.forEach(function(e){var o=e.get("legendVal");if(t<=o&&o<=a)e.setStyle(e.get("foreverStyle"));else{var n=new r.style.Style({image:new r.style.Circle({radius:e.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:e.get("strokeWidth")})})});e.setStyle(n)}})},v=function(e){u.forEach(function(t){if(t.get("legendVal")===e)t.setStyle(t.get("foreverStyle"));else if(t.get("legendVal")!==e){var a=new r.style.Style({image:new r.style.Circle({radius:t.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:t.get("strokeWidth")})})});t.setStyle(a)}})},h=function(e){var t=e.sliderInputColor;if(t.children)for(var a=0,r=t.children.length;a<r;a++){var o=t.children[a];o.style.backgroundColor=o.title,a!==e.legendVal-1&&(o.style.backgroundColor="gray")}},I=function(e){var t=e.sliderInputColor;if(t.children)for(var a=0,r=t.children.length;a<r;a++){var o=t.children[a];o.style.backgroundColor=o.title,a>=e.legendVal[0]-1&&a<=e.legendVal[1]-1||(o.style.backgroundColor="gray")}};f.onchange=function(){var e=parseFloat(this.value),t=parseFloat(L.value);this.title=e,e>=t?(L.value=e,t=e,v(e),h({sliderInputColor:b,legendVal:e})):e<t&&(m({inputLeftVal:e,inputRightVal:t}),I({sliderInputColor:b,legendVal:[e,t]})),a.getDom(".legend_label_div_class")[0].innerHTML=e+" ~ "+t};var b=a.createDom({tagName:"div",attributes:{"class":"slider_color"}});s.appendChild(b),e.legendData.forEach(function(t){var r=a.createDom({tagName:"div",attributes:{title:t.color}}),o=255/e.legendData.length;r.style.backgroundColor=t.color,r.style.height=o+"px",r.style.width="100%",b.appendChild(r)});var S=a.createDom({tagName:"div",attributes:{"class":y}});s.appendChild(S);var L=a.createDom({tagName:"input",attributes:{type:"range",step:1,min:1,max:e.legendData.length,value:e.legendData.length,zIndex:2}});L.title=e.legendData.length,S.appendChild(L),L.onchange=function(){var e=parseFloat(this.value),t=parseFloat(f.value);this.title=e,e<=t?(f.value=e,t=e,v(e),h({sliderInputColor:b,legendVal:e})):e>t&&(m({inputLeftVal:t,inputRightVal:e}),I({sliderInputColor:b,legendVal:[t,e]})),a.getDom(".legend_label_div_class")[0].innerHTML=t+" ~ "+e};var w=a.createDom({tagName:"div",attributes:{"class":"legend_label_div_class"},text:parseFloat(f.value)+" ~ "+parseFloat(L.value)});s.appendChild(w);var T=a.createDom({tagName:"div",attributes:{"class":"legend_label_low_div_class"},text:"Low"});s.appendChild(T);var E=a.createDom({tagName:"div",attributes:{"class":"legend_label_high_div_class"},text:"High"});s.appendChild(E)};e.exports={addFeature:g,setLayerData:y}},function(e,t,a){var r=a(3),o=a(4),n=a(7),l=a(1),i=a(5),s=a(6),d=new Map;d.set("refreshLayerManager_key",[]);var c=function(e){var t,a=e.layerId+"_"+e.mapId,l=null,s=e.clusterStyle||{},d=s.strokeColor||"#aaaaaa",c=s.fillColor||"#3399cc",u=void 0!==s.strokeWidth?s.strokeWidth:1;t=void 0===e.defaultVisibleLevel?n.DefaultLayerVisibleLevel.SITE:e.defaultVisibleLevel,0===u&&(d=c);var g=s.fontColor||"#ffffff",y=s.radius||20,p=s.distance||50,f=e.label?e.label:e.layerId;if(u<0)return void console.warn("strokeWidth 必须大于等于0");if(y<=0)return void console.warn("radius 必须大于0");if(p<=0)return void console.warn("distance 必须大于0");void 0===e.isClusterVariableSize&&(e.isClusterVariableSize=!1),e.distance=p;var m=function(t,a){var o=t.get("features"),n=o.length;if(n>1){var l=0;return l=e.isClusterVariableSize?y+n:y,[new r.style.Style({image:new r.style.Circle({radius:l,fill:new r.style.Fill({color:c}),stroke:new r.style.Stroke({color:d,width:u})}),text:new r.style.Text({text:n.toString(),fill:new r.style.Fill({color:g})})})]}var i=o[0].get("property");return[new r.style.Style({image:new r.style.Circle({radius:i.radius,fill:new r.style.Fill({color:i.fillColor}),stroke:new r.style.Stroke({color:i.strokeColor,width:i.strokeWidth})}),text:new r.style.Text({fill:new r.style.Fill({color:g})})})]};o.containsKey(a)?l=o.get(a):(i.createLayer(e),l=o.get(a)),l.setZIndex(n.Z_INDEX.SITE),l.setStyle(m),l.set("type",n.CUSTOMTYPE.LAYERIMGTYPE),l.set("businessType","POINTCLUSTER"),l.set("params.label",f),l.set("state.showLabel",!!e.showLabel),l.set("layerId",e.layerId),l.set("layer_id",e.layerId),l.set("legendName",e.legendName),l.set("defaultVisibleLevel",t)},u=function(e){var t=e.layerId+"_"+e.mapId,a=e.datas,i=o.get(t),c=null,u=void 0===e.isCluster||e.isCluster;if(i&&(i.set("legendName",e.legendName),e.label&&i.set("params.label",e.label),c=u===!0?i.getSource().getSource():i.getSource()),l.isValid(a)||a.length>0){var g=[];a.forEach(function(e){var t=r.proj.fromLonLat(e.coordinate),a=new r.Feature({geometry:new r.geom.Point(t),property:{fillColor:e.fillColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,radius:e.radius||5},data:e,businessType:n.BUSINESSTYPE.POINTER_CLUSTER});a.setId(e.id),a.set("id",e.id),a.set("data",e),g.push(a)}),c&&c.addFeatures(g)}if(d.get("refreshLayerManager_key").length<10){var y=new r.layer.Vector;s.getMapObj(e.mapId).addLayer(y),d.get("refreshLayerManager_key").push(y)}else{var p=d.get("refreshLayerManager_key");p&&p.length>0&&p.forEach(function(t,a){s.getMapObj(e.mapId).removeLayer(t),d.get("refreshLayerManager_key").splice(a,1)})}};e.exports={addLayer:c,setLayerData:u}},function(e,t,a){function r(e){for(var t=e.length,a=[],r=t-1;r>=0;r--)a.push(e[r]);return a}function o(e){for(var t=[],a=[e[0].coordinate],o=0;o<e.length;o++){var l=e[o].coordinate,d=e[o].angel,c=e[o].azimuth,u=e[o].radius,g=e[o].fillColor,y=e[o].strokeColor,p=e[o].opacity,f=s.createSector(l[0],l[1],u,c,d),m=f.slice(0,f.length-2),v=r(a),h=m.concat(v);a=m;var I=[];h.forEach(function(e){var t=n.proj.transform(e,i.PROJ.EPSG_4326,i.PROJ.EPSG_3857);I.push(t)});var b=new n.geom.Polygon([I]),S=new n.Feature({geometry:b}),L=g.substring(0,g.length-1),w="rgba"+L+","+p+")",T="rgb"+y,E=new n.style.Style({fill:new n.style.Fill({color:w}),stroke:new n.style.Stroke({color:T,width:1})});S.setStyle(E),t.push(S)}return t}var n=a(3),l=a(6),i=(a(1),a(4),a(7)),s=a(47),d=a(32),c=function(e){var t=null,a=e.mapId,r="radarLayer_"+a,o=l.getMapObj(a),s={mapId:a,layerId:r};return d.getLayer(s)?t=d.getLayer(s):(t=new n.layer.Vector,t.set("type",i.CUSTOMTYPE.LAYERIMGTYPE),t.set("map",o),t.set("layerId",r),o.addLayer(t)),t},u=function(e){var t=e.mapId,a=e.datas,r=l.getMapObj(t);if(null!=r){var i=c(e);if(null==i.getSource()){var s=new n.source.Vector({wrapX:!1});i.setSource(s)}o(a).forEach(function(e){i.getSource().addFeature(e)})}};e.exports={addRadar:u}},function(e,t,a){var r=a(3),o=a(6),n=a(1),l=a(4),i=a(7),s=a(5),d=function(e){var t=e.mapId,a=e.layerId+"_"+t,s=o.getMapObj(t);if(n.isValid(l.get(a)))return l.get(a);var d=new r.layer.Vector({source:new r.source.Vector({wrapX:!1})});return d.set("type",i.CUSTOMTYPE.LAYERTYPE),d.set("map",s),d.set("layerId",a),s.addLayer(d),l.put(a,d),d},c=function(e){var t=d(e),a=e.mapId,n=e.layerId,l=e.geoId,c=e.shadowColor,u=e.shadowOpacity,g=e.coordinates;if(e.geoId){var y={layerId:n,mapId:a,featureId:l},p=s.getFeatureById(y);g=p.getGeometry().getCoordinates()}var f=o.getMapObj(a);if(null!=f){var m=new r.source.Vector,v=r.proj.fromLonLat([180,89.99]),h=r.proj.fromLonLat([180,-89.99]),I=r.proj.fromLonLat([-180,-89.99]),b=r.proj.fromLonLat([-180,89.99]),S=[v,h,I,b],L=[];e.geoId?L=g:g.forEach(function(e){var t=r.proj.transform(e,i.PROJ.EPSG_4326,i.PROJ.EPSG_3857);L.push(t)}),L.push(L[0]);var w=new r.geom.LinearRing(L),T=new r.geom.Polygon([S]),E=new r.Feature({geometry:T,type:"bgPolygon",geoId:l});E.setId(l),m.addFeature(E),T.setCoordinates([S]),T.appendLinearRing(w);var k,C;k=null==c?"(50,50,50)":c,C=null==u?.3:u;var x=k.substring(0,k.length-1),O="rgba"+x+","+C+")",_=new r.style.Style({fill:new r.style.Fill({color:O}),stroke:new r.style.Stroke({color:"rgba(255,0,0,0)",width:1})});t.setSource(m),t.setStyle(_),f.addLayer(t)}};e.exports={renderShadowArea:c}},function(e,t,a){var r=a(3),o=a(4),n=a(7),l=a(1),i=a(5),s=new Map,d=new Map,c=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=null;s.set(t,[]),d.set(t,[]),o.containsKey(a)?r=o.get(a):(i.createLayer(e),r=o.get(a)),e.source=r.getSource(),u(e),g(e)},u=function(e){var t=e.datas,a=e.source;if(l.isValid(t))for(var o=0,i=t.length;o<i;o++){for(var s=[],d=t[o].coordinates,c=t[o].style,u=0,g=d.length;u<g;u++){var y=r.proj.fromLonLat([d[u][0],d[u][1]]);s.push(y)}var p=new r.Feature({geometry:new r.geom.LineString(s),businessType:n.BUSINESSTYPE.TRACK_SHOW_LINE});if(c&&c.lineStrokeColor){var f=new r.style.Style({stroke:new r.style.Stroke({color:c.lineStrokeColor,width:c.lineStrokeWidth?c.lineStrokeWidth:3})});p.setStyle(f)}a.addFeature(p);var m=s.filter(function(e,t,a){return t>a.length-3}),v=m[1][0]-m[0][0],h=m[1][1]-m[0][1],I=-Math.atan2(h,v)+Math.PI/2,b=new r.style.Style({image:new r.style.RegularShape({fill:new r.style.Fill({color:c?c.lineStrokeColor:"blue"}),stroke:new r.style.Stroke({color:c?c.lineStrokeColor:"blue",width:1}),points:3,radius:10,rotation:I,angle:0})}),S=new r.Feature({geometry:new r.geom.Point(m[1]),businessType:n.BUSINESSTYPE.TRACK_SHOW_LINE});S.setStyle(b),a.addFeature(S)}},g=function(e){d.get(e.mapId).push(e);var t=e.datas,a=e.source,i=0;i=e.speedRate?500*e.speedRate:500;var c=e.isKeepTrack,u=e.mapId;if(l.isValid(t))for(var g=function(t,l,d){var g=o,y=u+d,p=g.get(y)||0,f=t.length,m=[],v=0,h=setInterval(function(){if(p<f){var o=t[p],i=1e3;if(!o)return;o.length>2&&(i=o[2]);var s=r.proj.fromLonLat([o[0],o[1]]),d=new r.geom.Point(s);if(v+=500,i<v){var u=new r.Feature({geometry:d,businessType:n.BUSINESSTYPE.TRACK_SHOW}),I=null;I=l?new r.style.Style({image:new r.style.Circle({fill:new r.style.Fill({color:l.fillColor||"#319FD3"}),radius:l.radius||5,stroke:new r.style.Stroke({color:l.strokeColor||"#ff0",width:l.strokeWidth||1})})}):new r.style.Style({image:new r.style.Circle({fill:new r.style.Fill({color:e.fillColor||"#319FD3"}),radius:e.radius||5,stroke:new r.style.Stroke({color:e.strokeColor||"#ff0",width:e.strokeWidth||1})})}),u.setStyle(I),c||(m.forEach(function(e){a.removeFeature(e)}),m=[]),a.addFeature(u),m.push(u),p===f-1&&(c?clearInterval(h):p=-1),g.put(y,p),v=0,p++}}},i);s&&s.get(u).push(h)},y=0,p=t.length;y<p;y++){var f=t[y],m=f.style||null;g(f.coordinates,m,f.uniqueIdentify)}},y=function(e){s.size>0&&s.get(e).length>0&&s.get(e).forEach(function(e){clearInterval(e)})},p=function(e){var t=d.get(e),a=t[t.length-1];if(a){var r=a.source.getFeatures();a.isKeepTrack||r.forEach(function(e){n.BUSINESSTYPE.TRACK_SHOW===e.get("businessType")&&a.source.removeFeature(e)}),g(a)}},f=function(e){var t=o;t.keys.forEach(function(a){a.startsWith(e)&&t.put(a,t.get(a)-1)}),p(e)},m=function(e){var t=o;t.keys.forEach(function(a){a.startsWith(e)&&t.put(a,t.get(a)+1)}),p(e)};e.exports={addTackShow:c,pause:y,start:p,pre:f,next:m}},function(e,t,a){var r=a(3),o=a(6),n=(a(1),a(4),a(7)),l=(a(29),a(32)),i=function(e){var t,a=e.mapId,i="convergeCellLayer_"+a,s=o.getMapObj(a),d={mapId:a,layerId:i};return l.getLayer(d)?t:(t=new r.layer.Image({source:new r.source.ImageCanvas({canvasFunction:e.canvasFunction,projection:"EPSG:3857"})}),t.set("type",n.CUSTOMTYPE.LAYERIMGTYPE),t.set("map",s),t.set("layerId",i),s.addLayer(t),void 0)},s=function(e){var t,a=e.mapId,n="convergeCellLayer_"+a,i=o.getMapObj(a),s={mapId:a,layerId:n};l.getLayer(s)&&(t=l.getLayer(s),t.setSource(new r.source.ImageCanvas({canvasFunction:null,projection:"EPSG:3857"})),i.removeLayer(t),t=null)},d=function(e){function t(e,t,a,r){var o,n,l=[],i=Math.floor(Math.abs(t/r));return o=t>=0?i*Math.abs(r):-i*Math.abs(r),l.push(o),n=i%2===0?Math.ceil(Math.abs(e/a))*Math.abs(a):Math.ceil(Math.abs(e/a)-.5)*Math.abs(a)+.5*Math.abs(a),e<=0&&(n=-n),l.push(n),l}function a(e,a,o){for(var n,i,d,c,y=Math.sqrt(3)*l/2,p=(o[2]-o[0])/e,f=(-o[3]+o[1])/a,m=2*f/3,v=t(o[0],o[3],p,f),h=v[1],I=v[0],b=(h-o[0])/p*2*y,S=(I-o[3])/f*1.5*l,L=0;L<a;L++)for(var w=0;w<e;w++){L%2===0?(d=b+2*y*w,n=h+p*w):(d=b+y+2*y*w,n=h+.5*p+p*w),c=S+1.5*l*L,i=I+f*L;var T=0;s.forEach(function(e){var t=r.proj.fromLonLat(e),a=t[0]-n,o=t[1]-i;Math.abs(o)>=Math.abs(m)||Math.abs(a)>=Math.abs(p)/2||Math.abs(m)-Math.abs(o)>Math.abs(a)/Math.sqrt(3)&&(T+=1)}),u(d,c,T),g(d,c,T)}}var n,l=(o.getMapObj(e.mapId),e.radius),s=e.data,d=e.color,c=e.step,u=function(e,t,a){for(var r,o=0;o<=d.length;o++)a>c*o&&a<=c*(o+1)&&(r=d[o]);void 0===r&&(r="rgba(255,255,255,0)");var i=Math.sqrt(3)/2*l;n.beginPath(),n.lineWidth=1,n.fillStyle=r,n.moveTo(e,t-l),n.lineTo(e+i,t-l/2),n.lineTo(e+i,t+l/2),n.lineTo(e,t+l),n.lineTo(e-i,t+l/2),n.lineTo(e-i,t-l/2),n.fill(),n.closePath()},g=function(e,t,a){a>0&&(n.textAlign="center",n.textBaseline="middle",n.font="15px Arial",n.fillStyle="white",n.fillText(a,e,t))},y=function(e,t,r){var o=e/(Math.sqrt(3)*l),n=t/(1.5*l);a(o,n,r)},p=function(e,t,a,r,o){this.canvas||(this.canvas=document.createElement("canvas"));var l=r[0],i=r[1];return this.canvas.setAttribute("width",l),this.canvas.setAttribute("height",i),n=this.canvas.getContext("2d"),y(l,i,e),this.canvas},f={mapId:e.mapId,canvasFunction:p};i(f)};e.exports={convergeForCell:d,removeConverge:s}},function(e,t,a){var r=a(3),o=a(6),n=(a(1),a(4),a(7)),l=(a(29),a(32)),i=function(e){var t,a=e.mapId,i="convergeGridLayer_"+a,s=o.getMapObj(a),d={mapId:a,layerId:i};return l.getLayer(d)||(t=new r.layer.Image({source:new r.source.ImageCanvas({canvasFunction:e.canvasFunction,projection:"EPSG:3857"})}),t.set("type",n.CUSTOMTYPE.LAYERIMGTYPE),t.set("map",s),t.set("layerId",i),s.addLayer(t)),t},s=function(e){var t,a=e.mapId,n="convergeGridLayer_"+a,i=o.getMapObj(a),s={mapId:a,layerId:n};l.getLayer(s)&&(t=l.getLayer(s),t.setSource(new r.source.ImageCanvas({canvasFunction:null,projection:"EPSG:3857"})),i.removeLayer(t),t=null)},d=function(e){function t(e,t){var a;return a=e>=0?Math.ceil(Math.abs(e/t))*Math.abs(t):-Math.ceil(Math.abs(e/t))*Math.abs(t)}function a(e,a,o){for(var n=(o[2]-o[0])/e,i=(-o[3]+o[1])/a,c=n/2,u=i/2,p=t(o[0],n),f=t(o[3],i),m=0;m<e;m++)for(var v=0;v<a;v++){var h=p+n*m,I=f+i*v,b=0;d.forEach(function(e){var t=r.proj.fromLonLat(e);t[0]>=h-c&&t[0]<h+c&&t[1]<=I-u&&t[1]>I+u&&(b+=1)});var S=(p-o[0])/n*50,L=(f-o[3])/i*50,w=S+l*m,T=L+s*v;g(w,T,b),y(w,T,b)}}var n,l=(o.getMapObj(e.mapId),e.width),s=e.height,d=e.data,c=e.color,u=e.step,g=function(e,t,a){var r;n.strokeStyle="rgba(0,0,255,0.1)";for(var o=0;o<=c.length;o++)a>u*o&&a<=u*(o+1)&&(r=c[o]);void 0===r&&(r="rgba(255,255,255,0)"),n.beginPath(),n.fillStyle=r,n.fillRect(e-l/2,t-s/2,l,s),n.fill(),n.closePath()},y=function(e,t,a){a>0&&(n.textAlign="center",n.textBaseline="middle",n.font="15px Arial",n.fillStyle="white",n.fillText(a,e,t))},p=function(e,t,r){var o=e/l,n=t/s;a(o,n,r)},f=function(e,t,a,r,o){this.canvas||(this.canvas=document.createElement("canvas"));var l=r[0],i=r[1];return this.canvas.setAttribute("width",l),this.canvas.setAttribute("height",i),n=this.canvas.getContext("2d"),p(l,i,e),this.canvas},m={mapId:e.mapId,canvasFunction:f};i(m)};e.exports={convergeForGrid:d,removeConverge:s}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=null,r=N.get(e.mapId),o=r.getView().getZoom(),n=e.defaultVisibleLevel||P.DefaultLayerVisibleLevel.CELL;N.containsKey(t)?a=N.get(t):(M.createLayer(e),a=N.get(t)),a.set("businessType","editLayer"),a.set("defaultVisibleLevel",n),a.set("legendName",e.legendName),A=a.getSource(),o<n&&a.setVisible(!1),l(e)}function o(e){var t=null,a=e.layerId+"_"+e.mapId,r=N.get(a);return r.set("legendName",e.legendName),r&&(t=r.getSource()),t}function n(e){for(var t=e.length,a=t-1;a>0;a--)for(var r=0;r<a;r++)if(e[r].radius>e[r+1].radius){var o=e[r];e[r]=e[r+1],e[r+1]=o}return e}function l(e){A=o(e);var t=e.datas;if(F.isValid(t)||t.length>0)for(var a=0;a<t.length;a++){var r=t[a].cellInfo;A.addFeature(d(t[a]));for(var l={},i=0;i<r.length;i++)l[r[i].azimuth.toString()]?l[r[i].azimuth.toString()].push(r[i]):(l[r[i].azimuth.toString()]=[],l[r[i].azimuth.toString()].push(r[i]));for(var s in l)l[s].length>1&&n(l[s]);for(var s in l)if(l[s].length>0)for(var u=l[s].length-1;u>=0;u--)A.addFeature(c(l[s][u]))}}function i(e){var t=N.get(e.mapId),a=e.isOpen,r=e.type,n=t.getInteractions().item(2),l=!1;e.callback;if(A=o({mapId:e.mapId,layerId:e.layerId}),a){if(k&&C&&G)return;var i=null;k=t.on("pointerdown",function(e){var a=[];t.forEachFeatureAtPixel(e.pixel,function(e){e&&"siteAndCell"===e.get("businessType")&&(n.setActive(!1),l=!0,a.push(e))}),a.length>0&&(i=a[0])}),C=t.on("pointerdrag",function(t){if(l)if("site"===i.get("type")){if("translate"===r){i.getGeometry().setCoordinates(t.coordinate);var a=i.get("data").coordinates;i.get("data").coordinates=_.proj.toLonLat(t.coordinate),i.set("nowLatlon",t.coordinate);var o=i.get("data").cellInfo;if(o&&o.length>0)for(var n=0;n<o.length;n++){var s=A.getFeatureById(o[n].cellId);o[n].coordinates[0]===a[0]&&o[n].coordinates[1]===a[1]?s&&(v(t,s),E(e.mapId,e.layerId,i,s)):s&&E(e.mapId,e.layerId,i,s)}}}else if("cell"===i.get("type"))if("translate"===r){var d=A.getFeatureById(i.get("data").belongSite);v(t,i),E(e.mapId,e.layerId,d,i)}else h(t,i)}),G=t.on("pointerup",function(){i&&(n.setActive(!0),l=!1,i=null)})}else t.unByKey(k),t.unByKey(C),t.unByKey(G),k=null,C=null,G=null}function s(e,t){if(A=o(e),t)if(Array.isArray(t)&&t.length>0){for(var a=[],r=0;r<t.length;r++)a.push(d(t[r]));A.addFeatures(a)}else A.addFeature(d(t))}function d(e){var t=new _.geom.Point(_.proj.fromLonLat(e.coordinates)),a=new _.Feature({geometry:t,businessType:"siteAndCell",type:"site",data:e});a.setId(e.siteId);var r=new _.style.Style({image:new _.style.Circle({radius:e.radius?e.radius:5,fill:new _.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new _.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});return a.setStyle(r),a}function c(e){var t,a=e.radius,r=e.azimuth,o=e.angle,n=e.cellType,l=_.proj.fromLonLat([e.coordinates[0],e.coordinates[1]]),i=null;"arrow"===n?i=R.createArrow(l[0],l[1],a,r,o):"sector"===n?i=R.createSector(l[0],l[1],a,r,o):"triangle"===n&&(i=R.createTriangle(l[0],l[1],a,r,o));var s=new _.geom.LinearRing(i),d=new _.geom.Polygon([s.getCoordinates()]);t=new _.Feature({geometry:d,businessType:"siteAndCell",type:"cell",data:e}),t.setId(e.cellId);var c=new _.style.Style({fill:new _.style.Fill({color:e.fillColor||"#836FFF"}),stroke:new _.style.Stroke({color:e.strokeColor||"#76EEC6",width:e.strokeWidth||2})});return t.setStyle(c),t}function u(e,t){if(A=o(e),t){var a=null;if(Array.isArray(t)&&t.length>0){for(var r=[],l=0;l<t.length;l++)r.push(c(t[l])),a=A.getFeatureById(r[l].belongSite),a.get("data").cellInfo.push(t[l]);A.addFeatures(r)}else{a=A.getFeatureById(t.belongSite);for(var i=a.get("data").cellInfo,s=!0,d=[],l=0;l<i.length;l++)t.azimuth===i[l].azimuth&&(s=!1,d.push(i[l]));if(s)A.addFeature(c(t)),i.push(t);else{for(var l=0;l<d.length;l++){var u=A.getFeatureById(d[l].cellId);u&&A.removeFeature(u)}d.push(t);for(var g=n(d),l=g.length-1;l>=0;l--)A.addFeature(c(g[l]));i.push(t)}}}}function g(e,t){if(A=o(e),t)if(Array.isArray(t)&&t.length>0)for(var a=0;a<t.length;a++)A.removeFeature(A.getFeatureById(t[a]));else A.removeFeature(A.getFeatureById(t))}function y(e,t){var a=e.get("data").cellInfo;if(a&&a.length>0)for(var r=0;r<a.length;r++)a[r].cellId===t&&a.splice(r,1)}function p(e,t){if(A=o(e),t){var a,r,n=null;if(Array.isArray(t)&&t.length>0)for(var l=0;l<t.length;l++)r=A.getFeatureById(t[l]),n=A.getFeatureById(t[l]+"_line"),r&&(A.removeFeature(r),a=A.getFeatureById(r.get("data").belongSite),a&&y(a,t[l])),n&&A.removeFeature(n);else r=A.getFeatureById(t),n=A.getFeatureById(t+"_line"),r&&(A.removeFeature(r),a=A.getFeatureById(r.get("data").belongSite),a&&y(a,t)),n&&A.removeFeature(n)}}function f(e,t){if(e&&t){var a=e.get("data");F.mixin(a,t);var r=_.proj.fromLonLat(a.coordinates),o=new _.style.Style({image:new _.style.Circle({radius:a.radius,fill:new _.style.Fill({color:a.fillColor}),stroke:new _.style.Stroke({color:a.strokeColor,width:a.strokeWidth})})});e.setStyle(o),e.getGeometry().setCoordinates(r),e.set("data",a)}}function m(e,t){if(A=o(t),e&&t){var a=e.get("data");F.mixin(a,t);var r=a.radius,l=a.azimuth,i=a.angle,s=a.cellType,d=_.proj.fromLonLat(a.coordinates),u=null;"arrow"===s?u=R.createArrow(d[0],d[1],r,l,i):"sector"===s?u=R.createSector(d[0],d[1],r,l,i):"triangle"===s&&(u=R.createTriangle(d[0],d[1],r,l,i));var g=new _.style.Style({fill:new _.style.Fill({color:a.fillColor||"#836FFF"}),stroke:new _.style.Stroke({color:a.strokeColor||"#76EEC6",width:a.strokeWidth||2})});e.getGeometry().setCoordinates([u]),e.setStyle(g),e.set("data",a);for(var y=A.getFeatureById(e.get("data").belongSite),p=y.get("data").cellInfo,f=!0,m=[],v=0;v<p.length;v++)l===p[v].azimuth&&(f=!1,m.push(p[v]));if(!f){for(var v=0;v<m.length;v++){var h=A.getFeatureById(m[v].cellId);h&&A.removeFeature(h)}for(var I=n(m),v=I.length-1;v>=0;v--)A.addFeature(c(I[v]))}}}function v(e,t){var a,r=t.get("data").radius;"sector"===t.get("data").cellType?a=R.createSector(e.coordinate[0],e.coordinate[1],r,t.get("data").azimuth,t.get("data").angle):"arrow"===t.get("data").cellType?a=R.createArrow(e.coordinate[0],e.coordinate[1],r,t.get("data").azimuth,t.get("data").angle):"triangle"===t.get("data").cellType&&(a=R.createTriangle(e.coordinate[0],e.coordinate[1],r,t.get("data").azimuth,t.get("data").angle)),t.getGeometry().setCoordinates([a]),t.get("data").coordinates=_.proj.toLonLat(e.coordinate),t.set("nowLatlon",e.coordinate)}function h(e,t){var a=t.get("data"),r=_.proj.fromLonLat(a.coordinates),o=180*Math.atan((e.coordinate[0]-r[0])/(e.coordinate[1]-r[1]))/Math.PI;o+=e.coordinate[1]-r[1]>0?360:180,o>360&&(o-=360);var n;"sector"===t.get("data").cellType?n=R.createSector(r[0],r[1],a.radius,o,a.angle):"arrow"===t.get("data").cellType?n=R.createArrow(r[0],r[1],a.radius,o,a.angle):"triangle"===t.get("data").cellType&&(n=R.createTriangle(r[0],r[1],a.radius,o,a.angle)),t.getGeometry().setCoordinates([n]),t.get("data").azimuth=o}function I(e,t){A=o(e);var a=A.getFeaturesInExtent(t);if(a&&a.length>0)for(var r=0;r<a.length;r++)if("site"===a[r].get("type")){g(e,a[r].getId());var n=a[r].get("data").cellInfo;if(n&&n.length>0)for(var l=0;l<n.length;l++)p(e,n[l].cellId)}else"cell"===a[r].get("type")&&p(e,a[r].getId())}function b(e){var t=N.get(e.mapId),a=e.isOpen,r=t.getInteractions().item(2),n=e.callback;A=o({mapId:e.mapId,layerId:e.layerId});var l,i=!1;if(a){if(x&&O&&D)return;var s=A.getFeaturesInExtent(e.extent),d=[];if(s&&s.length>0)for(var c=0;c<s.length;c++)"site"===s[c].get("type")&&d.push(s[c]);var u=null;x=t.on("pointerdown",function(e){var a=[];t.forEachFeatureAtPixel(e.pixel,function(e){e&&"siteAndCell"===e.get("businessType")&&(r.setActive(!1),i=!0,a.push(e))}),a.length>0&&(l=a[0]),u=e.coordinate}),O=t.on("pointerdrag",function(t){if(i&&l)for(var a=t.coordinate[0]-u[0],r=t.coordinate[1]-u[1],o=0;o<s.length;o++)if("site"===s[o].get("type")){var n=_.proj.fromLonLat(s[o].get("data").coordinates);s[o].getGeometry().setCoordinates([n[0]+a,n[1]+r]),s[o].set("nowLatlon",[n[0]+a,n[1]+r]);for(var d=s[o].get("data").cellInfo,c=0;c<d.length;c++){var g=A.getFeatureById(d[c].cellId);T(e.mapId,e.layerId,s[o],g)}}else if("cell"===s[o].get("type")){var y,p=s[o].get("data"),f=_.proj.fromLonLat(p.coordinates);"sector"===p.cellType?y=R.createSector(f[0]+a,f[1]+r,p.radius,p.azimuth,p.angle):"arrow"===p.cellType?y=R.createArrow(f[0]+a,f[1]+r,p.radius,p.azimuth,p.angle):"triangle"===p.cellType&&(y=R.createTriangle(f[0]+a,f[1]+r,p.radius,p.azimuth,p.angle)),s[o].getGeometry().setCoordinates([y]),s[o].set("nowLatlon",[f[0]+a,f[1]+r]);var m=A.getFeatureById(s[o].get("data").belongSite);T(e.mapId,e.layerId,m,s[o])}else"line"===s[o].get("type")}),D=t.on("pointerup",function(e){for(var t=e.coordinate[0]-u[0],a=e.coordinate[1]-u[1],o=0;o<s.length;o++)if("site"===s[o].get("type")){var d=_.proj.fromLonLat(s[o].get("data").coordinates);s[o].get("data").coordinates=_.proj.toLonLat([d[0]+t,d[1]+a])}else if("cell"===s[o].get("type")){var c=s[o].get("data"),g=_.proj.fromLonLat(c.coordinates);c.coordinates=_.proj.toLonLat([g[0]+t,g[1]+a])}else if("line"===s[o].get("type")){var y=s[o].get("data").coordinates,p=[[y[0][0]+t,y[0][1]+a],[y[1][0]+t,y[1][1]+a]];s[o].get("data").coordinates=p}r.setActive(!0),i=!1,n(),l=null})}else t.unByKey(x),t.unByKey(O),t.unByKey(D),x=null,O=null,D=null}function S(e){L({mapId:e.mapId,layerId:e.layerId});var t=e.features,a=e.style?e.style:{};A=o({mapId:e.mapId,layerId:e.layerId});var r={strokeColor:"rgba(0,0,0,1)",strokeWidth:2,fillColor:"rgba(255,255,0,0.8)",radius:5};F.mixin(a,r);var n=new _.style.Style({fill:new _.style.Fill({color:a.fillColor}),stroke:new _.style.Stroke({color:a.strokeColor,width:a.strokeWidth})});if(t&&t.length>0)for(var l=0;l<t.length;l++)if("site"===t[l].get("type")){var i=new _.style.Style({image:new _.style.Circle({radius:t[l].get("data").radius,fill:new _.style.Fill({color:a.fillColor}),stroke:new _.style.Stroke({color:a.strokeColor,width:a.strokeWidth})})});t[l].setStyle(i)}else"cell"===t[l].get("type")&&t[l].setStyle(n);A.set("higthLight",t)}function L(e){A=o({mapId:e.mapId,layerId:e.layerId});var t=A.get("higthLight");if(t&&t.length>0)for(var a=0;a<t.length;a++)if("site"===t[a].get("type")){var r=new _.style.Style({image:new _.style.Circle({radius:t[a].get("data").radius,fill:new _.style.Fill({color:t[a].get("data").fillColor}),stroke:new _.style.Stroke({color:t[a].get("data").strokeColor,width:t[a].get("data").strokeWidth})})});t[a].setStyle(r)}else if("cell"===t[a].get("type")){var n=new _.style.Style({fill:new _.style.Fill({color:t[a].get("data").fillColor}),stroke:new _.style.Stroke({color:t[a].get("data").strokeColor,width:t[a].get("data").strokeWidth})});t[a].setStyle(n)}A.set("higthLight",null)}function w(e,t){A=o({mapId:e.mapId,layerId:e.layerId});for(var a=A.getFeatures(),r=t,n=[],l=0;l<a.length;l++)A.removeFeature(a[l]),n.push(a[l].get("data"));r&&"function"==typeof r&&r(n)}function T(e,t,a,r){A=o({mapId:e,layerId:t});var n=A.getFeatureById(r.get("data").cellId+"_line"),l=a.get("nowLatlon")?a.get("nowLatlon"):_.proj.fromLonLat(a.get("data").coordinates),i=r.get("nowLatlon")?r.get("nowLatlon"):_.proj.fromLonLat(r.get("data").coordinates),s=new _.geom.LineString([l,i]);if(n)n.setGeometry(s),n.get("data").coordinates=[l,i];else{var d=new _.style.Style({fill:new _.style.Fill({color:[0,0,0,.8]}),stroke:new _.style.Stroke({color:[0,0,0,.8],width:2})}),c=new _.Feature({geometry:s,businessType:"siteAndCell",type:"line",data:{coordinates:[l,i]}});c.setId(r.get("data").cellId+"_line"),c.setStyle(d),A.addFeature(c)}}function E(e,t,a,r){A=o({mapId:e,layerId:t});var n=A.getFeatureById(r.get("data").cellId+"_line"),l=_.proj.fromLonLat(a.get("data").coordinates),i=_.proj.fromLonLat(r.get("data").coordinates),s=new _.geom.LineString([l,i]);if(n)n.setGeometry(s),n.get("data").coordinates=[l,i];else{var d=new _.style.Style({fill:new _.style.Fill({color:[0,0,0,.8]}),stroke:new _.style.Stroke({color:[0,0,0,.8],width:2})}),c=new _.Feature({geometry:s,businessType:"siteAndCell",type:"line",data:{coordinates:[l,i]}});c.setId(r.get("data").cellId+"_line"),c.setStyle(d),A.addFeature(c)}}var k,C,x,O,_=a(3),N=a(4),P=a(7),M=a(5),F=a(1),R=a(47),A=null,G=null,D=null;e.exports={addSiteAndCell:r,moveFeature:i,moveFeatures:b,addSite:s,addCell:u,deleteSite:g,deleteCell:p,editCell:m,editSite:f,deleteSiteByExtent:I,removeHightLight:L,hightLight:S,refreshLayer:w,siteAndCellLine:E}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=d.get(e.mapId),r=a.getView().getZoom(),o=e.defaultVisibleLevel||c.DefaultLayerVisibleLevel.POLYGON,l=!e.isShow||e.isShow,i=e.label?e.label:e.layerId;if(!d.containsKey(t)){var u=new s.layer.Vector({source:new s.source.Vector({wrapX:!1})});d.put(t,u),u.set("type",c.CUSTOMTYPE.LAYERTYPE),u.set("map",a),u.set("layerId",t),u.set("layer_id",e.layerId),u.set("params.label",i),u.set("state.showLabel",!!e.showLabel),u.set("businessType",c.BUSINESSTYPE.POLYGON),u.set("legendName",e.legendName),u.setZIndex(c.Z_INDEX.POLYGON),u.set("multiple",!!e.multiple),u.set("defaultVisibleLevel",o),u.setVisible(l),r<o&&u.setVisible(!1),a.addLayer(u)}y.addClickCallback(e.mapId,"business_vector_polygon_event_id",function(t){var a=t.feature;n("click",{mapId:e.mapId,layerId:e.layerId,feature:a})},e.layerId)}function o(e){var t=[],a=e.datas,r=u.getLayer(e);if(e.label&&r.set("params.label",e.label),g.isValid(a)||a.length>0){r.set("state.showLabel",!0),r.set("legendName",e.legendName);var o=r.getSource();a.forEach(function(a){var o=a.coordinates,n=a.fontStyle+" "+a.fontSize+" "+a.fontFamily,l=void 0!==a.strokeWidth?a.strokeWidth:2,i=void 0!==a.labelStrokeWidth?a.labelStrokeWidth:1,d=new s.geom.Polygon([o]),u=s.extent.getCenter(d.getExtent()),g={fillColor:a.fillColor?a.fillColor:"rgba(255,0,255,0.3)",strokeColor:"black",strokeWidth:2,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff"},y=new s.Feature({geometry:d.transform(c.PROJ.EPSG_4326,c.PROJ.EPSG_3857),labelPoint:s.proj.fromLonLat(u),businessType:c.BUSINESSTYPE.POLYGON,data:a,layerId:e.layerId,mapId:e.mapId,select:a.hightLight?a.hightLight:g});if(a.hightLight)for(var p in g)a.hightLight[p]?a.hightLight[p]:a.hightLight[p]=g[p];y.setId(a.id),y.set("layer",r),y.set("vectorType",c.BUSINESSTYPE.POLYGON);var f=new s.style.Style({fill:new s.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new s.style.Stroke({color:a.strokeColor||"#000",width:l}),text:new s.style.Text({text:a.label?a.label:"",fill:new s.style.Fill({color:a.labelFillColor||"black"}),font:"undefined undefined undefined"!==n?n:"normal 14px Arial",stroke:new s.style.Stroke({color:a.labelStrokeColor||"#ffffff",width:i})})}),m=new s.style.Style({fill:new s.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new s.style.Stroke({color:a.strokeColor||"#000",width:l})});y.setStyle(f),y.set("defaultStyle",f),y.set("shapeStyle",m),y.set("state.showLabel",!0),d&&d.getArea()>0&&t.push(y)}),o.addFeatures(t)}}function n(e,t){var a=fusiongis.BaseLayer.getLayer({mapId:t.mapId,layerId:t.layerId});if(a){var r=a.get("highLightFeatrue");if(r)for(var o=0;o<r.length;o++){var n=a.getSource().getFeatureById(r[o].getId());if(n){var l=n.get("data"),i=l.fontStyle+" "+l.fontSize+" "+l.fontFamily,d=new s.style.Style({fill:new s.style.Fill({
color:l.fillColor||"rgba(0,0,0,0)"}),stroke:new s.style.Stroke({color:l.strokeColor||"#000",width:void 0!==l.strokeWidth?l.strokeWidth:2}),text:new s.style.Text({text:l.label||"",font:"undefined undefined undefined"!==i?i:"normal 14px Arial",fill:new s.style.Fill({color:l.labelFillColor||"black"}),stroke:new s.style.Stroke({color:l.labelStrokeColor||"#ffffff",width:void 0!==l.labelStrokeWidth?l.labelStrokeWidth:1})})});n.setStyle(d)}}var u=[];if(e===c.HTYPE.CLICK)if(t.feature){var g=t.feature.get("select"),l=t.feature.get("data"),i=l.fontStyle+" "+l.fontSize+" "+l.fontFamily,d=new s.style.Style({stroke:new s.style.Stroke({width:g.strokeWidth,color:g.strokeColor}),fill:new s.style.Fill({color:g.fillColor}),text:new s.style.Text({text:l.label||"",font:"undefined undefined undefined"!==i?i:"normal 14px Arial",fill:new s.style.Fill({color:g.labelFillColor}),stroke:new s.style.Stroke({color:g.labelStrokeColor,width:void 0!==l.labelStrokeWidth?l.labelStrokeWidth:1})})});t.feature.setStyle(d),u.push(t.feature),a.set("highLightFeatrue",u)}else a.set("highLightFeatrue",[]);else e===c.HTYPE.VECTOR&&(t.geoIds.map(function(e){var t=a.getSource().getFeatureById(e),r=t.get("select"),o=t.get("data"),n=o.fontStyle+" "+o.fontSize+" "+o.fontFamily,l=new s.style.Style({fill:new s.style.Fill({color:r.fillColor}),stroke:new s.style.Stroke({color:r.strokeColor,width:r.strokeWidth}),text:new s.style.Text({text:o.label||"",font:"undefined undefined undefined"!==n?n:"normal 14px Arial",fill:new s.style.Fill({color:r.labelFillColor}),stroke:new s.style.Stroke({color:r.labelStrokeColor,width:void 0!==o.labelStrokeWidth?o.labelStrokeWidth:1})})});t.setStyle(l),u.push(t)}),a.set("highLightFeatrue",u))}}function l(e,t){var a=u.getLayer({mapId:e.mapId,layerId:e.layerId});if(!a&&"POLYGON"!==e.sourceLayerType)return void t();var r,o=a.getSource().getFeatureById(e.geoId).getGeometry(),n=o.getCoordinates()[0],l=(n[0][0]-e.targetPoint[0])*(n[0][0]-e.targetPoint[0])+(n[0][1]-e.targetPoint[1])*(n[0][1]-e.targetPoint[1]),i=0;n.forEach(function(t,a){i=(t[0]-e.targetPoint[0])*(t[0]-e.targetPoint[0])+(t[1]-e.targetPoint[1])*(t[1]-e.targetPoint[1]),l>i&&(l=i,r=a)}),t(n[r])}function i(e){var t=u.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var s=a(3),d=a(4),c=a(7),u=a(29),g=a(1),y=(a(31),a(32),a(11));e.exports={addLayer:r,setLayerData:o,highlight:n,getLineLonLat:l,setShowLabel:i}},function(e,t,a){function r(e,t,a){var r=e.get("map"),l=r.getTarget(),i=e.get("layer_id"),s=e.get("businessType");g.removeHighlight({mapId:l,layerId:i,hTypes:["click"]}),t===d.HTYPE.CLICK?o(l,i,s,t,a):t===d.HTYPE.VECTOR&&n(l,i,s,t,a,e)}function o(e,t,a,r,o){var n,i,s=o.geometry,d=50,c=[];i=o.lonLat[0]-d/2,n=o.lonLat[0]+d/2,c.push([i,s[1]]),c.push([n,s[1]]),c.push([n,s[3]]),c.push([i,s[3]]);var u=new l.Feature({geometry:new l.geom.Polygon([c]),mapId:e,layerId:t,layerType:a,hType:r}),y=new l.style.Style({stroke:new l.style.Stroke({width:2,color:"black"})});u.setStyle(y);var p=g.getHLayer({mapId:e,layerId:t});p.getSource().addFeature(u)}function n(e,t,a,r,o,n){var i=[];o.coordinates.forEach(function(e){i.push({x:e[0],y:e[1]})}),u.postJSON({url:d.GisRootUrl+"/gridManager/queryGridInfo?cacheKey="+n.get("imgToken"),data:JSON.stringify({points:i,imgToken:n.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n,i,s=o.geometry,d=50,c=[];i=o.centerPoint[0]-d/2,n=o.centerPoint[0]+d/2,c.push([i,s[1]]),c.push([n,s[1]]),c.push([n,s[3]]),c.push([i,s[3]]);var u=new l.Feature({geometry:new l.geom.Polygon([c]),mapId:e,layerId:t,layerType:a,hType:r}),g=new l.style.Style({stroke:new l.style.Stroke({width:2,color:"black"})});return u.setStyle(g),u}),i=g.getHLayer({mapId:e,layerId:t});i.getSource().addFeatures(n)}},failure:function(e){console.log(e)}})}var l=a(3),i=a(8),s=a(4),d=a(7),c=a(29),u=a(14),g=a(31),y=a(11),p=a(6),f=a(5),m=function(e){var t=e.layerId+"_"+e.mapId,a=s.get(e.mapId),o=a.getView().getZoom(),n=e.defaultVisibleLevel||d.DefaultLayerVisibleLevel.GRID;if(!s.containsKey(t)){var i=new l.layer.Tile({source:new l.source.TileWMS({wrapX:!1})}),c=new l.layer.Image({source:new l.source.ImageWMS({wrapX:!1})});i.set("imageLayer",c),i.setZIndex(d.Z_INDEX.GRID),i.set("type",d.CUSTOMTYPE.LAYERTILETYPE),i.set("businessType",d.BUSINESSTYPE.GRID),i.set("params.label",e.label),i.set("layerId",t),i.set("map",a),i.set("layer_id",e.layerId),i.set("defaultVisibleLevel",n),e.multiple&&i.set("multiple",e.multiple),s.put(t,i),o<n&&i.setVisible(!1)}y.addClickCallback(e.mapId,"business_Dgrid_event_id",function(t){var a=f.getLayer({mapId:e.mapId,layerId:e.layerId});if(a&&8!==a.get("gridType")){var o=p.getMapObj(e.mapId);h(o,a,t.e,function(t){t?t&&t.length>0&&r(a,"click",t[0]):g.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)},v=function(e){var t=e.imgTokenParam,a=e.imgToken,r=e.mapId,o=e.layerId,n=e.gridType?e.gridType:void 0,i=e.layers?e.layers:void 0,s=!e.ISSOLIDGRID||e.ISSOLIDGRID,u=p.getMapObj(r),g=c.getLayer({mapId:r,layerId:o});if(g){var y;e.label&&g.set("label",e.label),8===n||s===!1?(y=new l.source.ImageWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:n,LAYERS:i,IMGTOKEN:a,VERSION:"1.1.1",ISSOLIDGRID:s,cacheKey:a},wrapX:!1}),u.addLayer(g.get("imageLayer")),g.get("imageLayer").setSource(y),g.set("imgToken",a),g.set("gridType",n),g.set("imgTokenParam",t)):(y=new l.source.TileWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:n,LAYERS:i,IMGTOKEN:a,VERSION:"1.1.1",ISSOLIDGRID:s,cacheKey:a},wrapX:!1}),u.addLayer(g),g.setSource(y),g.set("imgToken",a),g.set("gridType",n),g.set("imgTokenParam",t))}},h=function(e,t,a,r){var o=i.getExtent(e.getTarget()),n={geometry:{x:a.coordinate[0],y:a.coordinate[1]},tolerance:1,mapExtent:o,imgToken:t.get("imgToken")};u.postJSON({url:d.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(n),success:function(a){var o=JSON.parse(a),n=o.status,l=o.data&&o.data.length>0&&o.data[0];1===n.code&&l?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:l.centerPoint,geometry:l.geometry,extentInfo:l.extentInfo,geoId:l.id,geoName:l.name}]):r([])},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:m,setLayerData:v,getClickData:h,highlight:r}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=u.get(e.mapId),r=a.getView().getZoom(),o=e.defaultVisibleLevel||g.DefaultLayerVisibleLevel.CELL;if(!u.containsKey(t)){var i=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});i.setZIndex(g.Z_INDEX.CELL),i.set("type",g.CUSTOMTYPE.LAYERIMGTYPE),i.set("businessType","DCELL"),i.set("params.label",e.label),i.set("state.showLabel",!!e.showLabel),i.set("layerId",t),i.set("map",a),i.set("layer_id",e.layerId),i.set("defaultVisibleLevel",o),e.multiple&&i.set("multiple",e.multiple),u.put(t,i),a.addLayer(i),r<o&&i.setVisible(!1)}v.addClickCallback(e.mapId,"business_Dservice_cell_event_id",function(t){if(t.layer&&"DCELL"===t.layer.get("businessType")){var a=h.getMapObj(e.mapId);n(a,t.layer,t.e,function(a){a?l(t.layer,"click",a[0]):m.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)}function o(e){var t=y.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("imgToken",e.imgToken),t.set("imgTokenLabel",e.imgTokenLabel),t.set("params.imgTokenLabel",e.imgTokenLabel),e.label&&t.set("params.label",e.label),t.set("state.showLabel",!!e.showLabel);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=a.slice(0,a.indexOf(":")),o={VERSION:"1.1.1",imgToken:a,FCName:r};t&&(t.getSource().setUrl(g.GisRootUrl+"/common/mapRender/export"),t.getSource().updateParams(o))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o,n,l,i;if(a.coordinate){i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),l=t.get("params.imgToken");var s=(l.slice(0,l.indexOf(":")),{geometry:i,tolerance:.1,mapExtent:n,imgToken:l});o=g.GisRootUrl+"common/mapRender/identify"}f.get({url:o,data:p.getParameterString(s),success:function(o){if(!o)return void r([]);if(o=JSON.parse(o),!o||!o.data||!o.data.length)return void r([]);var n=p.sortBy(o.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),l=n[0].extentInfo.radius;n=n.filter(function(e){return e.extentInfo.radius===l}),n.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var i=n.map(function(r){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.coordinate,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name}});r(i)},failure:function(){"function"==typeof r&&r([])}})}function l(e,t,a,r){var o,n=e.get("map"),l=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(m.removeHighlight({mapId:l,layerId:s,hTypes:["click"]}),t===g.HTYPE.CLICK){var u=JSON.parse(a.geometry),y=new c.geom.LineString(u);o=new c.Feature({geometry:new c.geom.Polygon([y.getCoordinates()]),mapId:l,layerId:s,layerType:d,hType:t});var p=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});o.setStyle(p);var f=m.getHLayer({mapId:l,layerId:s});f.getSource().addFeature(o)}else t===g.HTYPE.VECTOR&&i(e,a,function(e){if(e){var a=[],n=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});e.map(function(e){o=new c.Feature({geometry:new c.geom.Polygon([JSON.parse(e.geometry)]),mapId:l,layerId:s,layerType:d,hType:t}),o.setStyle(n),a.push(o)});var i=m.getHLayer({mapId:l,layerId:s});i.getSource().addFeatures(a),r&&r(e)}})}function i(e,t,a){var r=e.get("params.imgToken"),o=r.slice(0,r.indexOf(":")),n=g.GisRootUrl+"/common/mapRender/query?FCName="+o;f.postJSON({url:n,data:JSON.stringify({idValue:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){console.log(e),a(null)}})}function s(e,t){var a,r=y.getLayer({mapId:e.mapId,layerId:e.layerId});return r?void i(r,{geoIds:[e.geoId]},function(e){e&&(a=e[0].extentInfo.circleCenter,a=c.proj.fromLonLat(a),t(a))}):void t()}function d(e){var t=y.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),u=a(4),g=a(7),y=a(29),p=a(1),f=a(14),m=a(31),v=a(11),h=a(6);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:l,getLineLonLat:s,setShowLabel:d}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=u.getMapObj(e.mapId),r=a.getView().getZoom(),o=e.defaultVisibleLevel||y.DefaultLayerVisibleLevel.SITE;if(!g.containsKey(t)){var i=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});g.put(t,i),i.setZIndex(y.Z_INDEX.SITE),i.set("type",y.CUSTOMTYPE.LAYERIMGTYPE),i.set("businessType",y.BUSINESSTYPE.SITE),i.set("params.label",e.label),i.set("state.showLabel",!!e.showLabel),i.set("layerId",t),i.set("map",a),i.set("layer_id",e.layerId),i.set("defaultVisibleLevel",o),i.set("multiple",e.multiple),a.addLayer(i),r<o&&i.setVisible(!1)}h.addClickCallback(e.mapId,"business_Dservice_site_event_id",function(t){if(t.layer&&t.layer.get("businessType")===y.BUSINESSTYPE.SITE){var a=u.getMapObj(e.mapId);n(a,t.layer,t.e,function(a){a?l(t.layer,"click",a[0]):v.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})})}},e.layerId)}function o(e){var t=p.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("state.showLabel",!!e.showLabel),e.label&&t.set("params.label",e.label);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=a.slice(0,a.indexOf(":")),o={VERSION:"1.1.1",imgToken:a,Fcname:r};t&&(t.getSource().setUrl(y.GisRootUrl+"/common/mapRender/export"),t.getSource().updateParams(o))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o=t.get("params.imgToken"),n=o.slice(0,o.indexOf(":")),l=y.GisRootUrl+"/common/mapRender/identify?FCName="+n,i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),s=e.getView().calculateExtent(e.getSize()).join(","),d={geometry:i,tolerance:1,mapExtent:s,imgToken:o};m.get({url:l,data:f.getParameterString(d),success:function(o){if(!o)return void r([]);if(o=JSON.parse(o),!o||!o.data||!o.data.length)return void r([]);var n=o.data,l=n.map(function(r){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.coordinate,geometry:r.geometry,geoId:r.id,geoName:r.name}});r(l)},failure:function(){console.log("grid clickFun error!"),r([])}})}function l(e,t,a,r){var o,n=e.get("map"),l=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(v.removeHighlight({mapId:l,layerId:s}),t===y.HTYPE.CLICK){var u=a.geometry;o=new c.Feature({geometry:new c.geom.Point(u),mapId:l,layerId:s,layerType:d,hType:t});var g=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(g);var p=v.getHLayer({mapId:l,layerId:s});p.getSource().addFeature(o)}else t===y.HTYPE.VECTOR&&i(e,a,function(e){var a;if(e){a=e[0].geometry,o=new c.Feature({geometry:new c.geom.Point(a),mapId:l,layerId:s,layerType:d,hType:t});var n=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(n);var i=v.getHLayer({mapId:l,layerId:s});i.getSource().addFeature(o),r&&r(e)}})}function i(e,t,a){var r=e.get("params.imgToken"),o=r.slice(0,r.indexOf(":")),n=y.GisRootUrl+"/common/mapRender/query?FCName="+o;m.postJSON({url:n,data:JSON.stringify({id:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){console.log(e),a(null)}})}function s(e){var t,a=p.getLayer({mapId:e.mapId,layerId:e.sourceLayerId});if(a)return i(a,{geoIds:e.layerId,imgToken:a.get("params.imgToken")},function(e){e&&(t=e.extentInfo.circleCenter)}),t}function d(e){var t=p.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),u=a(6),g=a(4),y=a(7),p=a(29),f=a(1),m=a(14),v=a(31),h=a(11);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:l,getLineLonLat:s,setShowLabel:d}},function(e,t,a){function r(e,t){var a;return e.layers.forEach(function(e){e.layerType===t&&(a=e.layerId)}),a}var o=(a(3),a(7)),n=a(43),l=a(44),i=a(42),s=(a(76),a(78),a(77)),d=function(e,t){var a=e.layers.map(function(e){return e.layerType}),d=e.layers[0].layerType,t=t,c={geometryType:e.geometryType.toLocaleLowerCase(),fcName:e.fcName,styleParam:e.styleParam,renderParam:e.renderParam};fusiongis.OriginalAjax.postJSON({url:fusiongis.Constant.GisRootUrl+"/common/mapRender/getImgToken?FCName="+e.fcName,data:JSON.stringify(c),success:function(c){if(c){var u=JSON.parse(c),g=u.status,y=u.data;if(1===g.code){var p={mapId:e.mapId,layerId:e.layers[0].layerId,defaultVisibleLevel:e.layers[0].defaultVisibleLevel,imgToken:y.imgToken,imgTokenLabel:y.imgTokenLabel,showLabel:e.layers[0].showLabel,label:e.layers[0].label},f=y.legendInfo||{},m={mapId:e.mapId,layerId:e.layerId,imgToken:y.imgToken,imgTokenLabel:y.imgTokenLabel,legendInfo:f,label:f.legendName,byPercent:f.byPercent};d===o.BUSINESSTYPE.POINT?(m.businessType=o.BUSINESSTYPE.POINT,n.addLayer(p),n.setLayerData(p)):d===o.BUSINESSTYPE.POLYGON?(m.businessType=o.BUSINESSTYPE.POLYGON,i.addLayer(p),i.setLayerData(p)):d===o.BUSINESSTYPE.LINE?(m.businessType=o.BUSINESSTYPE.LINE,l.addLayer(p),l.setLayerData(p)):a.indexOf(o.BUSINESSTYPE.CELL)>-1&&a.indexOf(o.BUSINESSTYPE.SITE)>-1&&(m.businessType=o.BUSINESSTYPE.CELL,s.addLayer({mapId:p.mapId,layerId:r(e,"CELL"),imgToken:p.imgToken,label:p.label,imgTokenLabel:p.imgTokenLabel,showLabel:p.showLabel}),s.setLayerData({mapId:p.mapId,layerId:r(e,"CELL"),imgToken:p.imgToken,label:p.label,imgTokenLabel:p.imgTokenLabel,showLabel:p.showLabel})),fusiongis.Legend.createLegend(m)}}t&&"function"==typeof t&&t(u)},failure:function(e){console.log(e),t&&"function"==typeof t&&t(null)}})};e.exports={render:d}},function(e,t,a){var r=(a(3),a(7),function(e,t){var t=t,a={commonParam:e.commonParam,renderParam:{legendInfo:1===e.commonParam.isUserDefinedLegend?e.legendInfo:{}},queryParam:e.queryParam,geoParams:e.geoParams};fusiongis.OriginalAjax.postJSON({url:fusiongis.Constant.GisRootUrl+"/gridManager/getImgToken",data:JSON.stringify(a),success:function(e){if(e){var a=JSON.parse(e);t&&"function"==typeof t&&t(a)}},failure:function(e){console.log(e),t&&"function"==typeof t&&t(null)}})});e.exports={getImageToken:r}},function(e,t,a){var r,o,n,l,i,s=a(3),d=a(8),c=a(6),u=function(e,t,a){if("undefined"==typeof google){var r=document.createElement("script"),o="http:";"file:"!==location.protocol&&(o=location.protocol);var n=t||"en-US",l=o+"//maps.google.com/maps/api/js?v=3&language="+n+"&key="+e;document.querySelector("#google-api-load-yet")?r.setAttribute("src","http://www.huawei.com/Assets/CBG/js/Huawei.Personalization.CBG.js?ver=1"):(r.setAttribute("src",l),r.setAttribute("id","google-api-load-yet")),r.onload=function(){a(!0)},r.onerror=function(){a(!1)},document.body.appendChild(r)}else a(!0)},g=function(e,t,a){var r=new google.maps.StreetViewService;r.getPanorama({location:e,radius:t?t:50},function(e,t){t===google.maps.StreetViewStatus.OK&&a(e.location.pano)})},y=function(e,t){o||(o=document.getElementById(e).cloneNode(!1),o.id="sv"+e,document.body.appendChild(o)),f(e,function(a){g(a.latLng,t.radius,function(a){if(r)r.setPano(a);else{p(e,"open",t.style),d.refreshMaps([e]);var n={addressControlOptions:{position:google.maps.ControlPosition.BOTTOM_CENTER},linksControl:!1,panControl:!1,enableCloseButton:!1,pano:a};r=new google.maps.StreetViewPanorama(o,n),1===t.isPanochanged&&m(e)}})})},p=function(e,t,a){var r=document.getElementById(e),n=document.getElementById("$$customMap_"+e),l=r?r.clientWidth:n.clientWidth,i=r?r.clientHeight:n.clientHeight;"open"===t?(n?(n.style.width=Math.ceil(l/2)+"px",n.style.padding="0px",n.style.margin="0px",n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.border="0px"):r&&(r.style.width=Math.ceil(l/2)+"px",r.style.padding="0px",r.style.margin="0px",r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.border="0px"),o.style.width=Math.ceil(l/2)+"px",o.style.height=i+"px",o.style.padding="0px",o.style.margin="0px",o.style.position="absolute",o.style.right="0px",o.style.top="0px",o.style.border="0px"):o&&(document.body.removeChild(o),r.style.width=l+"px",n&&(n.style.width=l+"px"),o=null)},f=function(e,t){var a=c.getMapObj(e);i||(i=new s.layer.Vector({layerName:"street_view",source:new s.source.Vector({wrapX:!1}),opacity:.8,style:new s.style.Style({fill:new s.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new s.style.Stroke({color:"#ff0000",width:2}),image:new s.style.Circle({radius:7,fill:new s.style.Fill({color:"#ff0000"})})})}),a.addLayer(i)),l&&(n&&i.getSource().clear(),a.unByKey(l),l=null),l=a.on("singleclick",function(e){var a=s.proj.toLonLat(e.coordinate);n&&i.getSource().clear(),n=new s.Feature({geometry:new s.geom.Point(e.coordinate),name:"street_view_marker"}),n.setId("street_view_marker");var r=new s.source.Vector({features:[n]});i.setSource(r),t({latLng:{lat:a[1],lng:a[0]}})}),a.set("clickEventKey",l)},m=function(e){google.maps.event.addListener(r,"position_changed",function(){var t=r.getPosition();v(e,{lng:t.lng(),lat:t.lat()}),d.setMapCenter({mapId:e,coordinate:[t.lng(),t.lat()],opt_projection:"EPSG:3857"})})},v=function(e,t){c.getMapObj(e);if(i){var a=i.getSource().getFeatureById("street_view_marker"),r=a.getGeometry(),o=s.proj.fromLonLat([t.lng,t.lat]);r.setCoordinates(o)}},h=function(e){var t=c.getMapObj(e);r&&(r=null,p(e,"close",void 0),d.refreshMaps([e])),i&&(n=null,t.removeLayer(i),t.unByKey(t.get("clickEventKey")),i=null,l=null)};e.exports={loadGoogleAPI:u,loadGoogleStreetView:y,closeGoogleStreetView:h}},function(e,t,a){function r(e){var t=l.getMapObj(e.mapId);this.drag=new i.Drag(e),t.addInteraction(this.drag)}function o(e){var t=l.getMapObj(e);t.removeInteraction(this.drag)}var n=a(3),l=a(6),i={};i.Drag=function(e){this.handleDownEvent=e.handleDownEvent,this.handleDragEvent=e.handleDragEvent,this.handleMoveEvent=e.handleMoveEvent,this.handleUpEvent=e.handleUpEvent,this.cursor_=e.cursor||"pointer",this.type=e.type,this.featureId=e.featureId,n.interaction.Pointer.call(this,{handleDownEvent:i.Drag.prototype.handleDownEvent,handleDragEvent:i.Drag.prototype.handleDragEvent,handleMoveEvent:i.Drag.prototype.handleMoveEvent,handleUpEvent:i.Drag.prototype.handleUpEvent}),this.coordinate_=null,this.feature_=null,this.previousCursor_=void 0},n.inherits(i.Drag,n.interaction.Pointer),i.Drag.prototype.handleDownEvent=function(e){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){return e});return a&&(this.coordinate_=e.coordinate,this.feature_=a),this.handleDownEvent&&"function"==typeof this.handleDownEvent&&this.handleDownEvent({evt:e,feature:a}),!!a},i.Drag.prototype.handleDragEvent=function(e){if(this.featureId){if(this.feature_.getId()!==this.featureId)return!1;var t=e.coordinate[0]-this.coordinate_[0],a=e.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(t,a);var o=r.getExtent();this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1];var l=this.feature_.get("layer"),i=this.feature_.getId();if(l){var s=l.get("datas");if(s&&s.length>0)for(var d=0,c=s.length;d<c;d++)if(i===s[d].id){s[d].coordinate=n.proj.toLonLat(e.coordinate);break}}this.handleDragEvent&&"function"==typeof this.handleDragEvent&&this.handleDragEvent({evt:e,extent:o,feature:this.feature_})}else{var t=e.coordinate[0]-this.coordinate_[0],a=e.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(t,a);var o=r.getExtent(),l=this.feature_.get("layer"),i=this.feature_.getId();if(l){var s=l.get("datas");if(s&&s.length>0)for(var d=0,c=s.length;d<c;d++)if(i===s[d].id){s[d].coordinate=n.proj.toLonLat(e.coordinate);break}}this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1],this.handleDragEvent&&"function"==typeof this.handleDragEvent&&this.handleDragEvent({evt:e,extent:o,feature:this.feature_})}},i.Drag.prototype.handleMoveEvent=function(e){if(this.cursor_){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){return e}),r=e.map.getTargetElement();a?r.style.cursor!=this.cursor_&&(this.previousCursor_=r.style.cursor,r.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0),this.handleMoveEvent&&"function"==typeof this.handleMoveEvent&&this.handleMoveEvent({evt:e,feature:a})}},i.Drag.prototype.handleUpEvent=function(e){return this.coordinate_=null,this.feature_=null,this.handleMoveEvent&&"function"==typeof this.handleMoveEvent&&this.handleMoveEvent(e),!1},e.exports={addDrag:r,removeDrag:o}},function(e,t,a){var r=a(84),o=a(85),n=a(6);e.exports={measure:function(e){if("geoLine"===e.measureType){if(e.isOpen)return r.measureLine(e);r.clearLastLine(e.mapId)}"geoArea"===e.measureType&&o.measureArea(e)},isMeasuring:function(e){var t=n.getMapObj(e.mapId);if(!t)return!1;var a=e.measureType||"geoLine";return!!t.get("state.measure."+a)}}},function(e,t,a){function r(e){var t=x.getMapObj(e.mapId);if(!t.get("state.drawing")){var a=t.getTarget(),r=w(e.mapId),l=new k.Collection;l.on("change:length",function(t){for(var r=l.getArray(),n=P[a],i=n[n.length-1],s=0;s<r.length;s++)r[s].get("type")||(r[s].set("type",i),r[s].setStyle(o(e)))});var s=t.get("measureLine.Layer");s||(s=new k.layer.Vector({source:new k.source.Vector({features:l,wrapX:!1}),style:new k.style.Style({stroke:new k.style.Stroke({color:"#0099ff",width:3})})}),s.setMap(t),s.set("layer_id","measure-line-layer-id"),t.set("measureLine.Layer",s)),L(e.mapId,r),n(e,t,s,r),fusiongis.Events.addClickCallback(a,"measure-distance-click-event",function(o){var n=o.e,l=!0;e.clickCallback&&(l=e.clickCallback({mapId:a,coordinate:n.coordinate})),l!==!1&&(b(n,t,r),i(n.coordinate,t,r,e))},"measure-line-layer-id")}}function o(e){return new k.style.Style({stroke:new k.style.Stroke({color:e.strokeColor||"#0099ff",width:e.strokeWidth||3})})}function n(e,t,a,r){var o=t.getTarget();t.set("state.drawing",!0),t.set("state.measure.geoLine",!0);var n=O.getIntactByName(o,R);n?n.setActive(!0):(n=new k.interaction.Draw({source:a.getSource(),type:"LineString"}),n.set("name",R),t.addInteraction(n)),m(t,r);var i=null,s=n.on("drawstart",function(e){var a=e.feature;t.set("measureLine.drawLineSketch",a),l(e.feature.getGeometry().getCoordinates()[0],t,r);var o=a.getGeometry().on("change",function(e){h(e,t,r),i=S(e.target)});t.set("measureLine.sketchChange",o)}),u=n.on("drawend",function(a){fusiongis.Events.removeClickCallback(o,"measure-distance-click-event");var l=a.feature.getGeometry().getCoordinates();d(l[l.length-1],t,r),v(o,r),p(o,n),"0 m"===i&&(c(t,r),i=null),setTimeout(function(){n.setActive(!1),t.set("state.drawing",!1),t.set("state.measure.geoLine",!1),e.endCallback&&e.endCallback({mapId:o,coordinates:l})},0)});t.set("measureLine.drawStart",s),t.set("measureLine.drawEnd",u)}function l(e,t,a){var r=document.createElement("div");r.className="measure-tooltip mile",r.style.zIndex=O.getPopupZIndex(t.getTarget()),r.innerHTML=N.prop("measure.message.start");var o=new k.Overlay({element:r,offset:[10,-15]});o.set("type",a),o.setPosition(e),t.addOverlay(o)}function i(e,t,a,r){var o=O.getIntactByName(t.getTarget(),R);if(o.getActive()){var n=t.get("measureLine.PointLayer");n||(n=new k.layer.Vector({source:new k.source.Vector({wrapX:!1}),layerId:"point"}),t.set("measureLine.PointLayer",n)),n.setMap(t);var l=new k.Feature(new k.geom.Point(e));l.set("type",a),l.setStyle(s(r)),n.getSource().addFeature(l)}}function s(e){return new k.style.Style({image:new k.style.Circle({radius:e.pointRadius||4,fill:new k.style.Fill({color:e.pointFillColor||"#ffffff"}),stroke:new k.style.Stroke({color:e.pointStrokeColor||"#0099ff",width:e.pointStrokeWidth||2})})})}function d(e,t,a){var r=document.createElement("div");r.className="measure-close",r.style.zIndex=O.getPopupZIndex(t.getTarget());var o=new k.Overlay({element:r,offset:[12,-4]});o.set("type",a),o.setPosition(e),t.addOverlay(o),_.on(r,"click",function(){c(t,a)})}function c(e,t){g(e,t),u(e,t),f(e,t)}function u(e,t){var a=e.get("measureLine.Layer");a&&O.delFeatureByType(a.getSource(),t)}function g(e,t){var a=e.getTarget(),r=e.getOverlays().getArray().slice(0);if(r.forEach(function(a){var r=a.get("type");r&&r===t&&e.removeOverlay(a)}),P[a]){var o=P[a].indexOf(t);o>-1&&P[a].splice(o,1)}M[a]&&M[a][t]&&M[a][t].splice(0)}function y(e){var t=O.getIntactByName(e,R);if(t){var a=C.last(P[e]),r=x.getMapObj(e);c(r,a),p(e,t),r.get("state.drawing")&&(t.setActive(!1),r.set("state.drawing",!1),r.set("state.measure.geoLine",!1),r.set("measureLine.drawLineSketch",null))}}function p(e,t){var a=x.getMapObj(e);k.Observable.unByKey(a.get("measureLine.sketchChange")),t.unByKey(a.get("measureLine.drawStart")),t.unByKey(a.get("measureLine.drawEnd"))}function f(e,t){var a=e.get("measureLine.PointLayer");a&&O.delFeatureByType(a.getSource(),t)}function m(e,t){var a=document.createElement("div");a.innerHTML=N.prop("measure.message.startHelper"),a.className="measure-tooltip";var r=new k.Overlay({element:a,offset:[55,55],positioning:"center-left"});r.set("type",t),r.set("name",t+"_helpTooltip"),e.addOverlay(r),a.parentNode.style.zIndex=O.getPopupZIndex(e.getTarget())+100}function v(e,t){var a=O.getOverlayByName(e,t+"_helpTooltip"),r=a.get("element");a.setOffset([-7,-30]);var o=r.innerHTML,n=o.indexOf("<br>");o=o.slice(0,n),r.innerHTML=o,r.parentNode.style.zIndex=O.getPopupZIndex(e);var l=C.last(M[e][t]);if(void 0!==l){var i=O.getOverlayByName(e,l);x.getMapObj(e).removeOverlay(i)}}function h(e,t,a){var r=e.target,o=t.getTarget(),n=S(r),l=r.getLastCoordinate(),i=O.getOverlayByName(o,a+"_helpTooltip");i.get("element").innerHTML=I(n),i.setPosition(l)}function I(e){var t=N.prop("measure.message.total")+e;return t=t+"<br>"+N.prop("measure.message.helper")}function b(e,t,a){var r=document.createElement("div");r.className="measure-tooltip mile";var o=t.get("measureLine.drawLineSketch");if(o){var n=o.getGeometry(),l=S(n);if("0"===l.slice(0,1))return;r.innerHTML=l,r.style.zIndex=O.getPopupZIndex(t.getTarget()),r.setAttribute("actId",a);var i=new k.Overlay({element:r,offset:[10,-15],positioning:"bottom-center"});i.set("type",a),i.set("name",T(t.getTarget(),a)),i.setPosition(e.coordinate),t.addOverlay(i)}}function S(e){var t,a=e.getCoordinates();t=0;for(var r=0,o=a.length-1;r<o;++r){var e=new k.geom.LineString([a[r],a[r+1]]);t+=e.getLength()}var n;return n=t>1e3?Math.round(t/1e3*1e3)/1e3+" km":Math.round(1e3*t)/1e3+" m"}function L(e,t){M[e]||(M[e]={}),M[e][t]||(M[e][t]=[])}function w(e){var t=E("measure_act_");return P[e]||(P[e]=[]),P[e].push(t),t}function T(e,t){var a=E("measure_ov_");return M[e][t].push(a),a}function E(e){var t=e+F;return F+=1,t}var k=a(3),C=a(1),x=a(6),O=a(32),_=a(10),N=a(13),P={},M={},F=1,R="distanceMeasure";new k.style.Style({image:new k.style.Circle({radius:4,fill:new k.style.Fill({color:"#ffffff"}),stroke:new k.style.Stroke({color:"#0099ff",width:2})})});e.exports={measureLine:r,clearLastLine:y}},function(e,t,a){function r(e,t){var a=n(e);a.set("state.drawing",t),a.set("state.measure.geoArea",t)}function o(e){var t=n(e);return t.get("state.drawing")}function n(e){return T.getMapObj(e)}function l(e){var t=N.uniqueId("measureArea_act_");return O[e]||(O[e]=[]),O[e].push(t),t}function i(e){var t=e.mapId,a=n(t);if(a&&!o(t)){var i=l(t),c=d(t),u=s(t,i,c);u.setActive(!0);var g=a.on("pointermove",function(a){y(t,a,e)});return a.set("KEYS.MEASURE_AREA_PMOVE",g),r(t,!0),i}}function s(e,t,a){var r=n(e);if(r){c(e,t);var o=E.getIntactByName(e,"areaMeasure");return o||(o=new L.interaction.Draw({type:"Polygon"}),o.set("name","areaMeasure"),o.on("drawend",function(t){f(t,e,o);var a=t.feature.getGeometry().getCoordinates()[0];a.pop(a[a.length-1]);var r=a.slice(1),n=!1;if(r.length>1)for(var l=0;l<r.length-1;l++)r[l][0]===r[l+1][0]&&r[l][1]===r[1][1]||(n=!0);n&&d(e).getSource().addFeature(t.feature)}),o.on("drawstart",function(e){o.set("STATE.MEASURE.START",!0)}),r.addInteraction(o)),o.set("actId",t),o}}function d(e){var t=E.getLayer({mapId:e,layerId:"measureArea"});return t||(t=new L.layer.Vector({layerId:"measureArea",source:new L.source.Vector({wrapX:!1}),style:new L.style.Style({stroke:new L.style.Stroke({color:"#0099ff",width:3})})}),n(e).addLayer(t)),t}function c(e,t){var a=document.createElement("div");a.className="measure-tooltip",a.innerHTML=C.prop("measure.message.startHelper");var r=new L.Overlay({element:a,offset:[120,85],positioning:"bottom-center"});r.set("type",t),r.set("name",t+"_helper"),n(e).addOverlay(r),a.parentNode.style.zIndex=E.getPopupZIndex(e)}function u(e,t){var a=E.getOverlayByName(e,t+"_helper"),r=a.get("element");a.setOffset([-7,-10]);var o=r.innerHTML,n=o.indexOf("<br>");o=o.slice(0,n),r.innerHTML=o}function g(e,t){var a=E.getIntactByName(e,"areaMeasure"),r=document.createElement("div");r.className="measure-close",k.on(r,"click",function(){h(e,t)});var o=new L.Overlay({element:r,offset:[15,6],positioning:"bottom-center"});o.set("name",t+"_close"),o.set("type",t),n(e).addOverlay(o);var l=N.getSketchCoords(a),i=l[l.length-2];o.setPosition(i)}function y(e,t,a){if(!t.dragging){var r=E.getIntactByName(e,"areaMeasure");if(r){var o=N.last(O[e]),n=E.getOverlayByName(e,o+"_helper"),l=n.get("element");n.setPosition(t.coordinate),r.getActive()===!1&&r.setActive(!0);var i=N.getSketchFeature(r);if(i){i.getStyle()||i.setStyle(p(a));var s=i.getGeometry(),d=m(s);r.set("measureOutput",d),
l.innerHTML=v(d)}}}}function p(e){return new L.style.Style({stroke:new L.style.Stroke({color:e.strokeColor||"#0099ff",width:e.strokeWidth||3})})}function f(e,t,a,o){var l=a.get("actId");u(t,l),g(t,l);var i=n(t).get("KEYS.MEASURE_AREA_PMOVE");i&&n(t).unByKey(i),e.feature.set("type",l),o&&o(t,l);var s=a.get("measureOutput"),d="0 m<sup>2</sup>";s===d&&b(t,l),setTimeout(function(){r(t,!1),a.setActive(!1)},0)}function m(e){var t,a=e.clone().transform("EPSG:3857","EPSG:4326"),r=a.getLinearRing(0).getCoordinates();t=Math.abs(_.geodesicArea(r));var o;return o=t>1e6?Math.round(t/1e6*100)/100+" km<sup>2</sup>":Math.round(100*t)/100+" m<sup>2</sup>"}function v(e){var t=C.prop("measureArea.message.total")+e;return t=t+"<br>"+C.prop("measure.message.helper")}function h(e,t){I(e,t),b(e,t)}function I(e,t){var a=E.getLayer({mapId:e,layerId:"measureArea"});a&&E.delFeatureByType(a.getSource(),t)}function b(e,t){var a=n(e),r=a.getOverlays().getArray().slice(0);if(r.forEach(function(e){var r=e.get("type");r&&r===t&&a.removeOverlay(e)}),O[e]){var o=O[e].indexOf(t);o>-1&&O[e].splice(o,1)}}function S(e){if(e.isOpen)return i(e)}var L=a(3),w=a(1),T=a(6),E=a(32),k=a(10),C=a(13),x=1,O={},_=new L.Sphere(6378137),N={isNull:function(e){return null===e},last:function(e){if(e)return e[e.length-1]},uniqueId:function(e){var t=e+x;return x+=1,t},getSketchCoords:function(e){var t;for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];w.isArray(r)&&r.length>0&&w.isArray(r[0])&&(t=r)}return t},getSketchFeature:function(e){var t;for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];r instanceof L.Feature&&r.getGeometry()&&r.getGeometry()instanceof L.geom.Polygon&&(t=r)}return t}};e.exports={measureArea:S}},function(e,t,a){function r(e,t){var a=Math.sqrt(Math.pow(e,2)/(1+Math.pow(e,2)));return 360>=360-t&&360-t>=180&&(a=-a),a}function o(e,t){var a=Math.sqrt(1/(1+Math.pow(e,2)));return 270>=360-t&&360-t>=90&&(a=-a),a}function n(e,t,a,n){var l=e,s=t,d=l[0]-s[0],c=l[1]-s[1],u=p.proj.toLonLat(s),g=p.proj.fromLonLat([180,u[1]]),y=new p.geom.LineString([g,s,l]),f=i(y),m=c/d,v=r(m,f),h=o(m,f),I=a*v*.25,b=a*h*.25;n.push([s[0]+b,s[1]+I])}function l(e){var t=Math.PI*e/180;return t}function i(e){var t,a=e.getCoordinates(),r=a.length-1;if(!(r<2)){var o=p.proj.toLonLat(a[0]),n=p.proj.toLonLat(a[1]),i=p.proj.toLonLat(a[2]),s=l(o[1]-n[1])*l(i[0]-n[0])-l(i[1]-n[1])*l(o[0]-n[0]),d=l(o[1]-n[1])*l(i[1]-n[1])+l(o[0]-n[0])*l(i[0]-n[0]),c=Math.atan2(s,d)*(180/Math.PI);return c<0?360+c:c}return t=0}function s(e){var t=e.getCoordinates(),a=t.slice(0,2),r=t.slice(1),o=new p.geom.LineString(a),n=new p.geom.LineString(r),l=o.getLength(),i=n.getLength();return l<=i?l:i}function d(e,t,a){var r=document.createElement("div");r.className="measure-close";var o=new p.Overlay({element:r,offset:[0,-7]});r.id=v,o.tag=v,o.setPosition(a),f.getMapObj(e).addOverlay(o);var n=v;$(".measure-close").on("click",function(){Number(this.id)===n&&c(e,t,n)})}function c(e,t,a){u(t,a),g(e,a)}function u(e,t){for(var a=e.getSource().getFeatures(),r=0;r<a.length;r++)a[r].tag==t&&e.getSource().removeFeature(a[r])}function g(e,t){var a=f.getMapObj(e).getOverlays().getArray().slice(0);a.forEach(function(a){a.tag==t&&f.getMapObj(e).removeOverlay(a)})}function y(e,t){var a=null,r=null,o=null,l=null,u=null;t||(t="#0099ff");var g=f.getMapObj(e);if(!g.get("state.drawing")){var y=g.getInteractions();if(y.forEach(function(e){"have"==e.get("measureAngle")&&(l="have",u=e)}),"have"===l)return u.setActive(!0),g.set("state.drawing",!0),void g.set("state.measure.geoAngle",!0);var h=new p.Collection;h.on("change:length",function(e){var t=h.getArray();t[t.length-1].tag=v});var I=f.getMapObj(e);a=new p.source.Vector,r=new p.layer.Vector({source:a,style:new p.style.Style({fill:new p.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new p.style.Stroke({color:t,width:2}),image:new p.style.Circle({radius:7,fill:new p.style.Fill({color:"#0099ff"})})})}),g.set("state.drawing",!0),g.set("state.measure.geoAngle",!0),o=new p.interaction.Draw({minPoints:3,source:a,features:h,type:"LineString",style:new p.style.Style({fill:new p.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new p.style.Stroke({color:t,width:2}),image:new p.style.Circle({radius:5,stroke:new p.style.Stroke({color:t}),fill:new p.style.Fill({color:"#0099ff"})})})}),o.set("measureAngle","have"),I.addInteraction(o),I.addLayer(r),o.on("drawend",function(l){v+=1;var u=l.feature,y=u.getGeometry(),f=y.getCoordinates().slice(0,3);l.feature.getGeometry().setCoordinates(f);var h=i(y);d(e,r,l.feature.getGeometry().getLastCoordinate());var b,S=y.getCoordinates(),L=S[0],w=S[1],T=S[2],E=L[0]-w[0],k=L[1]-w[1],C=T[0]-w[0],x=T[1]-w[1],O=Math.sqrt(Math.pow(E,2)+Math.pow(k,2)),_=Math.sqrt(Math.pow(C,2)+Math.pow(x,2));if(b=O>=_?_:O,0!==b){var N=p.proj.toLonLat(w),P=p.proj.fromLonLat([N[0],85]),M=[];n(L,w,b,M),M.push(w),n(T,w,b,M);var F=new p.geom.LineString(M),R=new p.geom.LineString([P,w,M[2]]),A=i(R),G=i(F),D=A-G/2,j=s(F),V=6.5*j/7/1e5,Y=m.createSector(N[0],N[1],V,D,G),B=Y.slice(2,Y.length-2),U=[];U.push(M[2]),B.forEach(function(e){var t=p.proj.fromLonLat(e);U.push(t)}),U.push(M[0]);var W=new p.geom.LineString(U),H=new p.Feature({geometry:W});H.tag=v,H.setStyle(new p.style.Style({fill:new p.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new p.style.Stroke({color:t,width:1}),text:new p.style.Text({font:"12px Calibri,sans-serif",text:h.toFixed(2),fill:new p.style.Fill({color:"black"})}),image:new p.style.Circle({radius:7,fill:new p.style.Fill({color:"#ffcc33"})})})),a.addFeature(H),u=null}setTimeout(function(){0===b&&c(e,r,v),g.set("state.drawing",!1),g.set("state.measure.geoArea",!1),I.removeInteraction(o)},0)},this)}}var p=a(3),f=a(6),m=a(47),v=0;e.exports={measureAngle:y}},function(e,t,a){function r(e){if(e)return e[e.length-1]}function o(e){return O.getMapObj(e)}function n(e){var t=e+F;return F+=1,t}function l(e,t){var a=o(e).getInteractions().getArray();return P.find(a,function(e){return e.get("name")===t})}function i(e,t){e&&e.getFeatures().forEach(function(a){a.get("type")===t&&e.removeFeature(a)})}function s(e){var t=n("drawGeo_act_");return R[e]||(R[e]=[]),R[e].push(t),t}function d(e){var t;for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];P.isArray(r)&&r.length>0&&P.isArray(r[0])&&(t=r)}return t}function c(e){var t=e.mapId,a=e.type,r=o(t);if(!r.get("state.drawing")){var n=s(t),l=h(t,a,n);if(l){l.setActive(!0),f(t,!1);var i=l.get("endKey");i&&l.unByKey(i),r.set("state.drawing",!0),r.set("state.draw."+e.type,!0),i=l.on("drawend",function(a){u(e,n,l,a),fusiongis.Events.removeClickCallback(t,"draw-geometry-click-event")}),l.set("endKey",i),e.clickCallback&&fusiongis.Events.addClickCallback(t,"draw-geometry-click-event",function(t){var a=t.e,r={coordinate:a.coordinate,evt:a};e.clickCallback(r)},"tempGeometryLayer_"+t)}}}function u(e,t,a,r){var n=e.mapId,l=e.type,i=o(n);r.feature.set("type",t),r.feature.setStyle(y(e));var s=p(r,a,l),d=s[1],c=s[0];if(e.showCloseIcon){var u=[];if(c)for(var v=0;v<c.length-1;v++)u=c[v].concat(c[v+1]);var h=P.unique(u);h.length<=2&&h.length>0?m(n,t,void 0,l):m(n,t,d,l)}a.setActive(!1);var I=i.get("Keys.DrawGeometryClick");if(I&&a.unByKey(I),e.endCallback){var S={},w=[];if(e.type===A.Circle){var T=r.feature.getGeometry();S={center:T.getCenter(),radius:T.getRadius(),lastCoordinate:T.getLastCoordinate()}}else if(e.type===A.Polygon){var E=r.feature.getGeometry().getCoordinates()[0],k=E.slice(1),C=!1;if(k.length>1)for(var v=0;v<k.length-1;v++)k[v][0]===k[v+1][0]&&k[v][1]===k[1][1]||(C=!0);setTimeout(function(){C||(L(n,t),b(n,t)),i.set("state.drawing",!1),i.set("state.draw."+e.type,!1)},0),setTimeout(function(){f(n,!0)},500),S=N.transform(E,3857,4326)}else if(e.type===A.Point)S=r.feature.getGeometry().getCoordinates(),S=N.transform(S,3857,4326);else if(e.type===A.LineString){S=r.feature.getGeometry().getCoordinates();for(var v=0;v<S[0].length-1;v++)w=S[v].concat(S[v+1]);if(w=P.unique(w),w.length<=2)return setTimeout(function(){g(e,i,n,t)},0),void setTimeout(function(){f(n,!0)},500);S=N.transform(S,3857,4326)}else S=r.feature.getGeometry().getCoordinates();"function"==typeof e.endCallback&&e.endCallback({mapId:n,actId:t,coordinates:S})}g(e,i,n,t),setTimeout(function(){f(n,!0)},500)}function g(e,t,a,r){e.showGeometry||b(a,r),t.set("state.drawing",!1),t.set("state.draw."+e.type,!1)}function y(e){return new x.style.Style({fill:new x.style.Fill({color:e.fillColor||"rgba(255, 255, 255, 0.2)"}),stroke:new x.style.Stroke({color:e.strokeColor||"#0099FF",width:e.strokeWidth||3}),image:new x.style.Circle({radius:e.imageRadius||7,fill:new x.style.Fill({color:e.imageFillColor||"#0099FF"}),stroke:new x.style.Stroke({color:e.imageStrokeColor||"#FFFFFF",width:e.imageStrokeWidth||1})})})}function p(e,t,a){var o=e.feature.getGeometry(),n=d(t);if(a===A.Point){var l=o.getCoordinates();return[n,l]}if(a===A.LineString){var l=o.getCoordinates();return[n,r(l)]}if(a===A.Polygon){var l=o.getCoordinates(),i=l[0];return[n,i[i.length-2]]}return a===A.Circle?[n,r(n)]:a===A.Square?[n,r(n)]:a===A.Box?[n,r(n)]:void 0}function f(e,t){var a=o(e).getInteractions().getArray();a.forEach(function(e){e instanceof x.interaction.DoubleClickZoom&&e.setActive(!!t)})}function m(e,t,a,r){var n=document.createElement("div");n.className="measure-close",n.mapId=e,n.actId=t,_.on(n,"click",function(){I(this.mapId,this.actId);var a="";"Point"===r?a="tempPoint":"LineString"===r?a="tempLine":"Polygon"===r&&(a="tempPolygon");var o=M.get(a+"_"+e);if(o){var n=o.getSource(),l=fusiongis.Highlight.getHLayer({mapId:e,layerId:o.get("layer_id")}),i=n.getFeatureById(t),s=l.getSource().getFeatures()[0];i&&n.removeFeature(i),s&&l.getSource().removeFeature(s)}});var l=new x.Overlay({element:n,offset:[15,6],positioning:"bottom-center"});l.set("name",t+"_close"),l.set("type",t),o(e).addOverlay(l),l.setPosition(a)}function v(e){var t=M.get("tempGeometryLayer_"+e);return t||(t=new x.layer.Vector({layerId:"tempGeometryLayer",type:"tempGeometryLayer",source:new x.source.Vector,style:new x.style.Style({fill:new x.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new x.style.Stroke({color:"#0099FF",width:3}),image:new x.style.Circle({radius:7,fill:new x.style.Fill({color:"#0099FF"})})}),opacity:0}),M.put("tempGeometryLayer_"+e,t),o(e).addLayer(t)),t}function h(e,t,a){var r=o(e),n=l(e,"geometryDrawer");if(n){if(t===n.get("drawType"))return n.set("actId",a),n;r.removeInteraction(n)}var i=t;if("None"!==t){var s,d;"Square"===t?(i="Circle",s=x.interaction.Draw.createRegularPolygon(4)):"Box"===t&&(i="LineString",d=2,s=function(e,t){t||(t=new x.geom.Polygon(null));var a=e[0],r=e[1];return t.setCoordinates([[a,[a[0],r[1]],r,[r[0],a[1]],a]]),t}),n=new x.interaction.Draw({name:"geometryDrawer",actId:a,source:!!v(e)&&v(e).getSource(),type:i,geometryFunction:s,maxPoints:d}),n.set("name","geometryDrawer"),n.set("actId",a),n.set("drawType",t),r.addInteraction(n)}return n}function I(e,t){b(e,t),L(e,t)}function b(e,t){var a=v(e);a&&i(a.getSource(),t)}function S(e){var t=v(e);t.getSource().clear()}function L(e,t){var a=o(e),r=a.getOverlays().getArray().slice(0);if(r.forEach(function(e){var r=e.get("type");r&&r===t&&a.removeOverlay(e)}),R[e]){var n=R[e].indexOf(t);n>-1&&R[e].splice(n,1)}}function w(e){var t=o(e),a=R[e];if(a||!a.length){var r=t.getOverlays().getArray().slice(0);r.forEach(function(e){var r=e.get("type");r&&a.indexOf(r)>-1&&t.removeOverlay(e)}),a.splice(0,a.length)}}function T(e){S(e),w(e)}function E(e){var t=l(e,"geometryDrawer");if(t&&t.getActive()){t.setActive(!1);var a=t.get("actId");a&&I(e,a)}}function k(e){var t=e.mapId,a=o(t);a&&(e.isOpen?c(e):(E(t),a.set("state.drawing",!1),a.set("state.draw."+e.type,!1)))}function C(e){var t=O.getMapObj(e.mapId);if(!t)return!1;var a=e.type||"Point";return!!t.get("state.draw."+a)}var x=a(3),O=a(6),_=a(10),N=a(32),P=a(1),M=(a(13),a(4)),F=1,R={},A={Point:"Point",LineString:"LineString",Polygon:"Polygon",Circle:"Circle",Square:"Square",Box:"Box"};e.exports={DrawTypes:A,drawGeometry:k,isDrawing:C,clearGeometryDraw:T}},function(e,t,a){var r=a(3),o=a(4),n=a(5),l=a(7),i=a(20),s=function(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml");else if(window.ActiveXObject)for(var t=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],a=0;a<t.length;a++)try{if(e=new ActiveXObject(t[a]))break}catch(r){}return e},d=function(e){var t="search_result_inner_layer_id",a=e.mapId,i=t+"_"+a,s=e.coordinate,d=e.imgUrl,c=null;o.containsKey(i)?c=o.get(i):(e.layerId=t,n.createLayer(e),c=o.get(i));var u=c.getSource(),g=r.proj.fromLonLat(s),y=new r.geom.Point(g),p=new r.Feature({geometry:y}),f=new r.style.Style({image:new r.style.Icon({src:d||l.GisResourceURL+"search/search-result-icon.png"})});p.setStyle(f),u.clear(),u.addFeature(p)},c=function(e){var t=o.get("search_result_inner_layer_id_"+e);t&&t.getSource().clear()},u=function(e){var t=s(),a="http:";"file:"!==location.protocol&&(a=location.protocol);var r=encodeURI(a+"//nominatim.openstreetmap.org/search?q="+e.address+"&format=json&polygon=1&addressdetails=1&num="+Math.random());t.open("GET",r,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),t.onreadystatechange=function(){if(4==t.readyState)if(200==t.status){var a=t.responseText,r=JSON.parse(a),o=[];r&&r.length>0?r.forEach(function(e){var t=e.address,a=e.boundingbox;o.push({centerLonLat:[parseFloat(e.lon),parseFloat(e.lat)],displayName:e.display_name,type:e.type,placeId:e.place_id,city:t.city,country:t.country,countryCode:t.country_code,postCode:t.postcode,bbox:[parseFloat(a[2]),parseFloat(a[0]),parseFloat(a[3]),parseFloat(a[1])]})}):o.push({displayName:"Sorry, we do not found the information you want"}),e.callback&&"function"==typeof e.callback&&e.callback(o)}else console.log("search location failed")},t.send()},g=function(e){e&&e.key&&i.loadGoogleAPI(e.key,e.language,function(t){if(t){var a=new google.maps.Geocoder;a.geocode({address:e.address},function(t,a){if(a==google.maps.GeocoderStatus.OK){var r=[];t&&t.length>0?t.forEach(function(e){var t=[];e.geometry.bounds&&(t=[e.geometry.bounds.b.b,e.geometry.bounds.f.f,e.geometry.bounds.b.f,e.geometry.bounds.f.b]),r.push({centerLonLat:[parseFloat(e.geometry.location.lng()),parseFloat(e.geometry.location.lat())],displayName:e.formatted_address,bbox:t})}):r.push({displayName:"Sorry, we do not found the information you want"}),e.callback&&"function"==typeof e.callback&&e.callback(r)}else alert("Geocode was not successful for the following reason: "+a)})}})},y=function(e){e.serviceVendor===l.Search_Engine.OSM?u(e):e.serviceVendor===l.Search_Engine.GOOGLE&&g(e)};e.exports={searchLocal:y,addMarker:d,clearMarker:c}},function(e,t,a){function r(e){var t=s.getMapObj(e.mapId),a=e.type?e.type:"all",r=e.callback,o=[],n=d.getLayer({mapId:e.mapId,layerId:"tempPolygon_"+e.mapId});n||fusiongis.Polygon.addLayer({mapId:e.mapId,layerId:"tempPolygon",defaultVisibleLevel:3}),fusiongis.Geometry.drawGeometry({mapId:e.mapId,type:fusiongis.Geometry.DrawTypes.Box,isOpen:!0,showCloseIcon:!1,endCallback:function(e){console.log(e);for(var n=[],l=0;l<e.coordinates[0].length;l++)n.push(ol.proj.transform(e.coordinates[0][l],"EPSG:3857","EPSG:4326"));var i=new ol.geom.Polygon([e.coordinates[0]]);if(i.getArea()>0){var s=i.getExtent(),d=t.getLayers();d.forEach(function(e){var t=e.get("businessType");if(t){var r=[];"all"===a?r=e.getSource().getFeaturesInExtent(s):a===t&&(r=e.getSource().getFeaturesInExtent(s)),o=o.concat(r)}}),r&&"function"==typeof r&&r({extext:s,features:o})}}})}function o(e){var t=e.callback,a=fusiongis.Geometry.DrawTypes.Box,r=void 0===e.drawType?a:e.drawType;fusiongis.Geometry.drawGeometry({mapId:e.mapId,type:r,isOpen:!0,showCloseIcon:!1,endCallback:function(a){console.log(a);var o="";if("Box"==r){var n=[];a.coordinates[0].forEach(function(e){n.push(ol.proj.toLonLat(e))}),o=n.join("-")}else o=a.coordinates.join("-");var s=o.replace(/,/g," "),d=s.replace(/-/g,",");l.postJSON({url:i.GisRootUrl+"/mapRender/contains",data:JSON.stringify({polygon:"POLYGON(("+d+"))",imgToken:e.imgToken}),success:function(e){var a=JSON.parse(e),r=a.status;1===r.code&&t(a)},failure:function(e){t({msg:e})}})}})}function n(e){var t=e.callback,a=fusiongis.Geometry.DrawTypes.Box,r=void 0===e.drawType?a:e.drawType;fusiongis.Geometry.drawGeometry({mapId:e.mapId,type:r,isOpen:!0,showCloseIcon:!1,endCallback:function(a){console.log(a);var o=[];"Box"==r?a.coordinates[0].forEach(function(e){o.push(ol.proj.toLonLat(e))}):o=a.coordinates,l.postJSON({url:i.GisRootUrl+"/spatialAnalysis/contain/geomContainFcos",data:JSON.stringify({containFcObject:{cordinates:o,geometryId:"1",geometryType:"POLYGON"},containedFcObjectIdList:[],featureClassNameContained:e.featureClassNameContained}),success:function(e){var a=JSON.parse(e),r=a.status;1===r.code&&t(a)},failure:function(e){t({msg:e})}})}})}var l=a(14),i=a(7),s=a(6),d=a(32),i=a(7),c=function(e,t,a){1===e?l.postJSON({url:i.GisRootUrl+"/spatialAnalysis/contain/geomContainGeoms",data:JSON.stringify({containFcObject:t.containFcObject,containedFcObjectList:t.containedFcObjectList}),success:function(e){a(e)},failure:function(e){a({msg:e})}}):2===e?l.postJSON({url:i.GisRootUrl+"/spatialAnalysis/contain/fcosContainFcos",data:JSON.stringify({containFcObjectId:t.containFcObjectId,containedFcObjectIdList:t.containedFcObjectIdList,featureClassNameContain:t.featureClassNameContain,featureClassNameContained:t.featureClassNameContained}),success:function(e){a(e)},failure:function(e){a({msg:e})}}):3===e?l.postJSON({url:i.GisRootUrl+"/spatialAnalysis/contain/geomContainFcos",data:JSON.stringify({containFcObject:t.containFcObject,containedFcObjectIdList:t.containedFcObjectIdList,featureClassNameContained:t.featureClassNameContained}),success:function(e){a(e)},failure:function(e){a({msg:e})}}):4===e&&fusiongis.OriginalAjax.postJSON({url:fusiongis.Constant.GisRootUrl+"/spatialAnalysis/contain/fcosContainGeoms",data:JSON.stringify({containFcObjectId:t.containFcObjectId,featureClassNameContain:t.featureClassNameContain,containedFcObjectList:t.containedFcObjectList}),success:function(e){a(e)},failure:function(e){a({msg:e})}})};e.exports={seachFeature:c,seachFeatures:r,searchByImgToken:o,searchBackStage:n}},function(e,t,a){function r(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("state");r?i(e):l(e)}var o=a(3),n=a(6),l=function(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("graticule");r||(r=new o.Graticule({strokeStyle:new o.style.Stroke({color:"#3B78FD",width:2,lineDash:[.5,4]}),targetSize:e.cellWidth||100}),a.set("graticule",r)),a.set("state",!0),r.setMap(a)},i=function(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("graticule");r&&(a.set("state",!1),r.setMap(null))};e.exports={addGraticule:l,removeGraticule:i,toggleGraticule:r}},function(e,t,a){function r(e,t){function a(e,t,a){var r=[],n=e+"_"+t,i=null;if(l.containsKey(n)){i=l.get(n);var s=i.getSource(),d=s.getFeatures();return d.forEach(function(e){var t=e.getGeometry().getCoordinates()[0],n=o.extent.containsCoordinate(a,t[t.length-1]);if(n){var l=e.getId(),i=t[t.length-1],s=t.slice(0,t.length-1),d={cellId:l,centerPoint:i,points:s};r.push(d)}}),r}}var r=e.layerId,i=e.mapId,s=e.isOpen,d=n.getMapObj(i),c=new o.source.Vector({wrapX:!1}),u=i+"_select",g=l.get(u),y=function(e,t){t||(t=new o.geom.Polygon(null));var a=e[0],r=e[1];return t.setCoordinates([[a,[a[0],r[1]],r,[r[0],a[1]],a]]),t};if(g)return g.setActive(s),void d.set("state.drawing",s);g=new o.interaction.Draw({source:c,type:"LineString",geometryFunction:y,maxPoints:2,style:new o.style.Style({fill:new o.style.Fill({color:"rgba(255, 255, 255, 0)"}),stroke:new o.style.Stroke({color:"rgba(255, 0, 0, 0.5)",width:2}),image:new o.style.Circle({radius:5,stroke:new o.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new o.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}),l.put(u,g);var p=function(e,t){var a=e[0]<=t[0]?e[0]:t[0],r=e[0]>=t[0]?e[0]:t[0],o=e[1]<=t[1]?e[1]:t[1],n=e[1]>=t[1]?e[1]:t[1];return[a,o,r,n]};g.on("drawend",function(e){var o=e.feature.getGeometry(),n=o.getCoordinates()[0],l=n[0],s=n[2],d=p(l,s),c=a(r,i,d);t&&"function"==typeof t&&t(c)},this),d.set("state.drawing",!0),d.addInteraction(g)}var o=a(3),n=a(6),l=a(4);e.exports={selectMode:r}},function(e,t,a){var r=a(3),o=a(6),n=a(4),l=a(7),i=function(e){var t=e.layerId,a=e.mapId,o=e.style.type?e.style.type:1;fusiongis.LineAdd.addLineType(e),e.numberOfPoints=500;var i,s,d,c,u,g=fusiongis.Curve.addCurve(e),y=new r.Feature,p=new r.Feature,f=new r.Feature,m=new r.Feature,v=new r.Feature,h=new r.Feature,I=null,b=0,S=0;if(1===o){var L=new r.style.Style({image:new r.style.Circle({radius:e.style.width[0]?e.style.width[0]:4,fill:new r.style.Fill({color:e.style.color[0]?e.style.color[0]:[255,255,255,1]})})}),w=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[1]?e.style.color[1]:[255,255,255,.9],width:e.style.width[1]?e.style.width[1]:5})}),T=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[2]?e.style.color[2]:[255,255,255,.8],width:e.style.width[2]?e.style.width[2]:4})}),E=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[3]?e.style.color[3]:[255,255,255,.7],width:e.style.width[3]?e.style.width[3]:3})}),k=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[4]?e.style.color[4]:[255,255,255,.6],width:e.style.width[4]?e.style.width[4]:2})}),C=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[5]?e.style.color[5]:[255,255,255,.5],width:e.style.width[5]?e.style.width[5]:1})});y.setStyle(L),p.setStyle(w),f.setStyle(T),m.setStyle(E),v.setStyle(k),h.setStyle(C);var x=n.get(t+"_"+a);x.getSource().addFeature(y),x.getSource().addFeature(p),x.getSource().addFeature(f),x.getSource().addFeature(m),x.getSource().addFeature(v),x.getSource().addFeature(h)}else if(2===o){var x=n.get(t+"_"+a);x.getSource().addFeature(p)}setInterval(function(){if(b<g.length-1){var t=g[b],a=g[b+1],n=a[0]-t[0],L=a[1]-t[1],w=Math.atan2(L,n);S=w>=0?2*Math.PI-w:-1*w}1===o?(b<454?(i=new r.geom.Point(r.proj.fromLonLat(g[b+45])),s=new r.geom.LineString(g.slice(b+36,b+45)),d=new r.geom.LineString(g.slice(b+27,b+36)),c=new r.geom.LineString(g.slice(b+18,b+27)),u=new r.geom.LineString(g.slice(b+9,b+18)),I=new r.geom.LineString(g.slice(b,b+9))):(s=new r.geom.LineString(g.slice(b+45,g.length-b-45)),d=new r.geom.LineString(g.slice(b+36,g.length-b-36)),c=new r.geom.LineString(g.slice(b+27,g.length-b-27)),u=new r.geom.LineString(g.slice(b+18,g.length-b-18)),I=new r.geom.LineString(g.slice(b+9,g.length-b-9))),y.setGeometry(i),h.setGeometry(I),v.setGeometry(u),m.setGeometry(c),f.setGeometry(d),p.setGeometry(s)):2===o?(i=new r.geom.Point(r.proj.fromLonLat(g[b])),p.setGeometry(i),p.setStyle(new r.style.Style({image:new r.style.Icon({src:l.GisResourceURL+"plane.png",size:e.style.size,imgSize:e.style.imgSize,opacity:e.style.opacity,rotation:S})}))):console.warn("no support!"),b=(b+2)%g.length},e.time)},s=function(e){var t=e.mapId,a=e.layerId+"_"+e.mapId,r=null;if(n.containsKey(a)){r=n.get(a);var l=o.getMapObj(t);l.removeLayer(r),n.remove(a),r=null}};e.exports={addMigrationMap:i,removeMigrationMap:s}},function(e,t,a){var r=a(3),o=a(4),n=a(6),l=function(e,t){var a=new r.geom.Circle(r.proj.fromLonLat(e),t);return a},i=function(e){var t=new r.style.Style({stroke:new r.style.Stroke({color:e,width:2}),fill:new r.style.Fill({color:"rgba(255,255,255,0)"})});return t},s=function(e){var t,a=e.layerId,s=e.mapId,d=e.center,c=e.RGB,u=e.bubbleRadius,g=c[0],y=c[1],p=c[2],f=n.getMapObj(s),m=f.getView();t=u*m.getResolution();var v,h,I,b,S,L,w=o.get(a+"_"+s),T=w.getSource(),E=new r.Feature,k=new r.Feature,C=new r.Feature,x=new r.Feature,O=new r.Feature,_=[E,k,C,x,O],N=new r.Feature,P=new r.Feature,M=new r.Feature,F=new r.Feature,R=new r.Feature,A=[N,P,M,F,R],G=new r.Feature;v=l(d,.1*t),b=i("rgba(255,255,255,0)"),h=l(d,.55*t),S=i("rgba(255,255,255,0)"),I=l(d,.85*t),L=i("rgba(255,255,255,0)"),E.setGeometry(v),E.setStyle(b),N.setGeometry(h),N.setStyle(S),G.setGeometry(I),G.setStyle(L),_.forEach(function(e){T.addFeature(e)}),A.forEach(function(e){T.addFeature(e)}),T.addFeature(G);var D=1;setInterval(function(){t=u*m.getResolution();var e=(u-2)*m.getResolution(),a=(u-4)*m.getResolution(),r=(u-6)*m.getResolution(),o=(u-8)*m.getResolution(),n=1,s=.15,c=.1,f=.1,w=.45,T=n-(D-1)*s,_=n-(D-1)*c-w,A=1-.05*(D-1)-.75,j=f+s*(D-1),V=f*D+w,Y=.05*(D-1)+.85;v=l(d,j*t);var B="rgba("+g+","+y+","+p+","+T+")";b=i(B);var U=l(d,j*e),W="rgba("+g+","+y+","+p+","+.8*T+")",H=i(W),J=l(d,j*a),Z="rgba("+g+","+y+","+p+","+.6*T+")",z=i(Z),K=l(d,j*r),X="rgba("+g+","+y+","+p+","+.4*T+")",q=i(X),Q=l(d,j*o),$="rgba("+g+","+y+","+p+","+.2*T+")",ee=i($);k.setGeometry(U),k.setStyle(H),C.setGeometry(J),C.setStyle(z),x.setGeometry(K),x.setStyle(q),O.setGeometry(Q),O.setStyle(ee),h=l(d,V*t);var te="rgba("+g+","+y+","+p+","+_+")";S=i(te);var ae=l(d,V*e),re="rgba("+g+","+y+","+p+","+.8*_+")",oe=i(re),ne=l(d,V*a),le="rgba("+g+","+y+","+p+","+.6*_+")",ie=i(le),se=l(d,V*r),de="rgba("+g+","+y+","+p+","+.4*_+")",ce=i(de),ue=l(d,V*o),ge="rgba("+g+","+y+","+p+","+.2*_+")",ye=i(ge);P.setGeometry(ae),P.setStyle(oe),M.setGeometry(ne),M.setStyle(ie),F.setGeometry(se),F.setStyle(ce),R.setGeometry(ue),R.setStyle(ye),I=l(d,Y*t);var pe="rgba("+g+","+y+","+p+","+A+")";L=i(pe),E.setGeometry(v),E.setStyle(b),N.setGeometry(h),N.setStyle(S),G.setGeometry(I),G.setStyle(L),D=(D+1)%5,0===D&&D++},400)},d=function(e){var t=e;t.center=e.coordinates[e.coordinates.length-1],fusiongis.LineAdd.addLineType(e),s(t)},c=function(e){var t=e.mapId,a=e.layerId+"_"+e.mapId,r=null;if(o.containsKey(a)){r=o.get(a);var l=n.getMapObj(t);l.removeLayer(r),o.remove(a),r=null}};e.exports={addBubbleMap:d,removeBubbleMap:c}},function(e,t,a){var r=a(7),o=a(14),n=a(1),l=function(e,t){var a={mapId:e.mapId,layerId:e.layerId};o.postJSON({url:r.PolygonQuery.GET_THIESSEN_POLYGONLAYER_INFO,data:JSON.stringify({featureClassName:e.featureClassName,columnName:e.columnName,operator:e.operator,value:e.value}),success:function(r){var o=JSON.parse(r);if(o&&o.data&&1===o.status.code){var l=o.data.fcObjectList;l&&(l.forEach(function(e,t){for(var a=[],r=n.htmlDecode(e.geometry),o=r.substr(9),l=o.substr(0,o.indexOf(")")),i=l.split(","),s=0;s<i.length;s++){var d=i[s].split(" "),c=parseFloat(d[0]),u=parseFloat(d[1]);a.push([c,u])}e.coordinates=a,e.id=e.fcObjectId}),a.datas=l,fusiongis.Map.setMapCenter({mapId:e.mapId,coordinate:a.datas[0].coordinates[0]}),fusiongis.Polygon.addLayer(a),fusiongis.Polygon.setLayerData(a),t&&t(l))}},fail:function(e){console.log("get feature on thiessenPolygon layer fail:"+e)}})};e.exports={getPolygonFeatureInfo:l}},function(e,t){function a(e,t){var a=r(e,t);if(!a)for(var o=0;o<t.length;o++){var n=t[o];if(a=l(n,e))break}return a}function r(e,t){var a,r,l,i,s,d,c,u,g=!1,y=o(e),p=o(t);e:for(var f=1;f<y.length;f++){a=y[f-1],r=a.x1,l=a.x2,i=a.y1,s=a.y2;for(var m=1;m<p.length&&(d=p[m-1],!(d.x1>l));m++)if(!(d.x2<r)&&(c=d.y1,u=d.y2,!(Math.min(c,u)>Math.max(i,s))&&!(Math.max(c,u)<Math.min(i,s))&&n(a,d))){g=!0;break e}}return g}function o(e){function t(e,t){return e.x1-t.x1}for(var a,r,o=e.length-1,n=new Array(o),l=1;l<e.length;l++)a=e[l-1],r=e[l],a.x<r.x?n[l]={x1:a.x,y1:a.y,x2:r.x,y2:r.y}:n[l]={x1:r.x,y1:r.y,x2:a.x,y2:a.y};return n.sort(t)}function n(e,t,a){var r=a&&a.point,o=a&&a.tolerance,n=!1,l=e.x1-t.x1,s=e.y1-t.y1,d=e.x2-e.x1,c=e.y2-e.y1,u=t.y2-t.y1,g=t.x2-t.x1,y=u*d-g*c,p=g*s-u*l,f=d*s-c*l;if(0==y)0==p&&0==f&&(n=!0);else{var m=p/y,v=f/y;if(m>=0&&m<=1&&v>=0&&v<=1)if(r){var h=e.x1+m*d,I=e.y1+m*c;n={x:h,y:I}}else n=!0}if(o){var b;if(n){if(r){var S,h,I,L=[e,t];e:for(var w=0;w<2;++w){S=L[w];for(var T=1;T<3;++T)if(h=S["x"+T],I=S["y"+T],b=Math.sqrt(Math.pow(h-n.x,2)+Math.pow(I-n.y,2)),b<o){n.x=h,n.y=I;break e}}}}else{var E,k,h,I,C,x,L=[e,t];e:for(var w=0;w<2;++w){E=L[w],k=L[(w+1)%2];for(var T=1;T<3;++T)if(C={x:E["x"+T],y:E["y"+T]},x=i(C,k),x.distance<o){n=!r||{x:C.x,y:C.y};break e}}}}return n}function l(e,t){function a(e,t){var a=0;return t>0&&(a=parseFloat(e.toPrecision(t))),a}function r(e,t,a,r,o){return(e-o)*((r-t)/(o-a))+r}for(var o,n,l,i,s,d,c,u=14,g=a(e.x,u),y=a(e.y,u),p=(t.length-1,0),f=0;f++;)if(o=t[f],l=a(o.x,u),i=a(o.y,u),n=t[f+1],s=a(n.x,u),d=a(n.y,u),i!=d){if(c=a(r(y,l,i,s,d),u),c==g&&(i<d&&y>=i&&y<=d||i>d&&y<=i&&y>=d)){p=-1;break}c<=g||l!=s&&(c<Math.min(l,s)||c>Math.max(l,s))||(i<d&&y>=i&&y<d||i>d&&y<i&&y>=d)&&++p}else if(y==i&&(l<=s&&g>=l&&g<=s||l>=s&&g<=l&&g>=s)){p=-1;break}var m=p==-1?1:!!(1&p);return m}function i(e,t){var a=s(e,t);return a.distance=Math.sqrt(a.distance),a}function s(e,t){var a,r,o=e.x,n=e.y,l=t.x1,i=t.y1,s=t.x2,d=t.y2,c=s-l,u=d-i,g=(c*(o-l)+u*(n-i))/(Math.pow(c,2)+Math.pow(u,2));return g<=0?(a=l,r=i):g>=1?(a=s,r=d):(a=l+g*c,r=i+g*u),{distance:Math.pow(a-o,2)+Math.pow(r-n,2),x:a,y:r,along:g}}e.exports={intersectsPolygonAndPolygon:a}},function(e,t,a){var r=a(3),o=function(e){var t=e.data;if(t&&t.length>0)for(var a=0;a<t.length;a++){var o=t[a].coordinates,n=[{}],l=new r.geom.Polygon([o]),i=r.extent.getCenter(l.getExtent()),s=i;n[0]={coordinate:s,id:a},fusiongis.Icon.addIcon({layerId:e.layerId,mapId:e.mapId,datas:n})}};e.exports={showPolygonCenterIcon:o}},function(e,t,a){var r=a(3),o=a(29),n=a(6),l=a(4),i=a(7),i=(a(1),a(7)),s=function(e){var t=e.mapId,a=e.layerId,o=a+"_"+t,i=n.getMapObj(t),s=null;if(l.get(o))s=l.get(o);else{var s=new r.layer.Image({source:new r.source.ImageWMS({wrapX:!1})});s.set("layerId",a),s.set("mapId",t),i.addLayer(s),l.put(o,s)}return s},d=function(e){var t=e.mapId,a=e.layerId,n=o.getLayer({mapId:t,layerId:a});if(n){e.label&&n.set("label",e.label),n.set("params.imgToken",e.imgToken),n.set("params.imgTokenLabel",e.imgTokenLabel);var l=e.isShowLabel?e.imgTokenLabel:e.imgToken,s=new r.source.ImageWMS({url:i.GisRootUrl+"/mapRender/export",params:{imgToken:l,VERSION:"1.1.1"},wrapX:!1});n.setSource(s),n.set("imgToken",l)}};e.exports={createLayer:s,setLayerData:d}},function(e,t,a){function r(e){i.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}function o(e,t,a){var o=e.get("map"),s=o.getTarget(),d=e.get("layer_id"),c=e.get("businessType"),u=i.getHLayer({mapId:s,layerId:d});if(r(u),t===l.HTYPE.CLICK){var g=a;if(!g)return;var y=g.clone();y.setStyle(new n.style.Style({fill:new n.style.Fill({color:"red"}),stroke:new n.style.Stroke({color:"rgba(255,215,0)",width:2})})),y.set("mapId",s),y.set("layerId",d),y.set("layerType",c),y.set("hType",t),u.getSource().addFeature(y)}}var n=a(3),l=a(7),i=a(31);e.exports={removeHighlight:r,highlight:o}},function(e,t,a){function r(e){var t=[];return e.forEach(function(e){var a=n.proj.transform(e,i.PROJ.EPSG_4326,i.PROJ.EPSG_3857);t.push(a)}),t}function o(e,t){var a=fusiongis.BaseLayer.getLayer({mapId:t.mapId,layerId:t.layerId});if(a){var r=a.get("highLightFeatrue");if(r)for(var o=0;o<r.length;o++){var l=a.getSource().getFeatureById(r[o].getId());if(l){var s=l.get("lineData"),d=new n.style.Style({stroke:new n.style.Stroke({color:s.strokeColor||"rgba(138,43,226,0.5)",width:s.strokeWidth||3}),text:new n.style.Text({text:s.name,font:"12px Calibri,sans-serif",fill:new n.style.Fill({color:s.fillColor||"rgba(138,43,226,0.5)"}),stroke:new n.style.Stroke({color:s.strokeColor||"rgba(138,43,226,0.5)",width:s.strokeWidth||3})})});l.setStyle(d)}}var c=[];if(e===i.HTYPE.CLICK)if(t.feature){var u=t.feature.get("select"),s=t.feature.get("lineData"),d=new n.style.Style({stroke:new n.style.Stroke({width:u.strokeWidth,color:u.strokeColor}),text:new n.style.Text({text:s.name||"",font:"12px Calibri,sans-serif",fill:new n.style.Fill({color:u.labelFillColor}),stroke:new n.style.Stroke({color:u.labelStrokeColor,width:s.strokeWidth})})});t.feature.setStyle(d),c.push(t.feature),a.set("highLightFeatrue",c)}else a.set("highLightFeatrue",[]);else if(e===i.HTYPE.VECTOR){if(t.geoId){var g=a.getSource().getFeatureById(t.geoId),u=g.get("select"),s=g.get("lineData"),d=new n.style.Style({stroke:new n.style.Stroke({color:u.strokeColor,width:u.strokeWidth}),text:new n.style.Text({text:s.name||"",font:"12px Calibri,sans-serif",fill:new n.style.Fill({color:u.labelFillColor}),stroke:new n.style.Stroke({color:u.labelStrokeColor,width:s.strokeWidth})})});g.setStyle(d),c.push(g)}a.set("highLightFeatrue",c);
}}}var n=a(3),l=(a(6),a(4)),i=a(7),s=a(1),d=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=l.get(t);if(s.isValid(l.get(a)))o=l.get(a);else{var o=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})});e.multiple&&o.set("multiple",e.multiple),o.set("type",i.CUSTOMTYPE.LAYERTYPE),o.set("map",r),o.set("layerId",a),o.set("layer_id",e.layerId),o.set("businessType",i.BUSINESSTYPE.STRAIGHTLINE),o.set("params.label",e.label),o.setZIndex(i.Z_INDEX.LINE),r.addLayer(o),l.put(a,o)}return o},c=function(e,t){var a=e.lineGeoId,l=e.name,s=e.coordinates,c=e.strokeColor,u=e.strokeWidth,g=e.fillColor,y=d(e),p=y.getSource(),f=r(s),m=new n.geom.LineString(f),v={strokeColor:c||"rgba(138,43,226,0.5)",strokeWidth:u||3,labelFillColor:g||"rgba(138,43,226,0.5)",labelStrokeColor:c||"rgba(138,43,226,0.5)"},h=new n.Feature({geometry:m,lineData:e,businessType:i.BUSINESSTYPE.LINE,select:e.hightLight?e.hightLight:v});if(e.hightLight)for(var I in v)e.hightLight[I]?e.hightLight[I]:e.hightLight[I]=v[I];var b=new n.style.Style({stroke:new n.style.Stroke({color:c||"rgba(138,43,226,0.5)",width:u||3}),text:new n.style.Text({text:l,font:"12px Calibri,sans-serif",fill:new n.style.Fill({color:g||"rgba(138,43,226,0.5)"}),stroke:new n.style.Stroke({color:c||"rgba(138,43,226,0.5)",width:u||3})})});h.setStyle(b),h.setId(a),h.set("data",s),p.addFeature(h),t&&t(),fusiongis.Events.addClickCallback(e.mapId,"straightline-click-event",function(t){var a=t.feature;o("click",{mapId:e.mapId,layerId:e.layerId,feature:a})},e.layerId)};e.exports={addLine:c,highlight:o}},function(e,t,a){function r(e,t){var a=!1;return e.forEach(function(e){e.get("layerId")&&e.get("layerId")===t&&(a=!0)}),a}function o(e){var t=e.mapId,a=i.getMapObj(t),o=e.targetLayerId,s=e.targetGeoId,c=e.sourceLayerId,u=e.sourceGeoId,g=e.layerId,y=e.lineGeoId,p=l.get(o+"_"+t),f=l.get(c+"_"+t);if(p&&f){var m=p.getSource().getFeatureById(s),v=f.getSource().getFeatureById(u);if(m&&v){var h=n.proj.toLonLat(n.extent.getCenter(m.getGeometry().getExtent())),I=n.proj.toLonLat(n.extent.getCenter(v.getGeometry().getExtent()));e.coordinates=[h,I],d(e),a.getLayers().on("change:length",function(){if(r(this,o+"_"+t)&&r(this,c+"_"+t));else{var e=l.get(g+"_"+t);if(e){var a=e.getSource().getFeatureById(y),n=e.getSource().getFeatureById(y+"_arrow");a&&e.getSource().removeFeature(a),n&&e.getSource().removeFeature(n)}}})}else console.warn("the feature is undefined")}else console.warn("the layer is undefined")}var n=a(3),l=(a(7),a(4)),i=a(6),s=a(1),d=function(e){1===e.isBezier?fusiongis.Curve.addCurve(e,function(t){1==e.isArrow&&(e.controlCoordinate=t,c(e)),e.color&&g(e)}):fusiongis.LineStraight.addLine(e,function(){1==e.isArrow&&c(e),e.color&&g(e)})},c=function(e){for(var t=[],a=e.coordinates,r=null,o=0;o<a.length;o++)t.push(n.proj.fromLonLat(a[o]));var i=t[t.length-2],s=t[t.length-1],d=new n.geom.Point(s),c=s[0]-i[0],g=s[1]-i[1],y=e.lineGeoId+"_arrow";1===e.isBezier?e.controlCoordinate&&(r=u(e.coordinates,e.controlCoordinate)):r=-Math.atan2(g,c)+Math.PI/2;var p=new n.Feature,f=new n.style.Style({image:new n.style.RegularShape({fill:new n.style.Fill({color:e.fillColor||"#208089"}),stroke:new n.style.Stroke({color:e.strokeColor||"#000",width:e.strokeWidth||1}),cursor:"point",points:3,radius:e.arrowRadius||8,rotation:r,angle:0})});p.setGeometry(d),p.setId(y),p.setStyle(f);var m=l.get(e.layerId+"_"+e.mapId);m&&m.getSource().addFeatures([p])},u=function(e,t){if(t.length>0){var a=e[e.length-1],r=[],o=t.length;r=1===t.length?t[0]:t[o-1];var n=a[0]-r[0],l=a[1]-r[1],i=-Math.atan2(l,n)+Math.PI/2;return i}},g=function(e){var t=null,a=null;fusiongis.BaseLayer.registerMouseEvent(e,function(r){if(r)"LINE"===r.get("businessType")&&(t=r.clone(),a=r,r.setStyle(new n.style.Style({stroke:new n.style.Stroke({color:e.color,width:e.strokeWidth||3})})),e.mouseOverCallback&&"function"==typeof e.mouseOverCallback&&e.mouseOverCallback(r));else{if(t){var o=new n.style.Style({stroke:new n.style.Stroke({color:e.strokeColor,width:e.strokeWidth||3})});a.setStyle(o)}e.mouseLeaveCallback&&"function"==typeof e.mouseLeaveCallback&&e.mouseLeaveCallback()}})},y=function(e){var t=e.get("data").cellType,a=e.get("data").radius,r=e.get("data").azimuth,o=[],l=e.getGeometry();if(l){var i=l.getCoordinates()[0],d=[];if("triangle"===t){for(var c=[],u=i.length,g=0;g<u;g++){for(var y=!0,p=g;p<i.length-1&&(y=!1,i[g]!=i[p+1]);p++);y&&(c=i[g])}for(var f=s.unique(i),g=0,y=!0;g<f.length;y?g++:g)f[g][0]===c[0]&&f[g][1]===c[1]?(f.splice(g,1),y=!1):y=!0;if(2===f.length){var m=(f[0][0]+f[1][0])/2,v=(f[0][1]+f[1][1])/2;d.push(m,v)}}else if("arrow"===t)d=i[3];else{var h=a,I=n.proj.fromLonLat(e.get("data").coordinate),b=Math.PI/2-r/180*Math.PI,S=I[0]+h*Math.cos(b),L=I[1]+h*Math.sin(b);d.push(S,L)}return o=n.proj.toLonLat(d)}},p=function(e){if(2===e.length){var t=n.proj.fromLonLat(e[0]),a=n.proj.fromLonLat(e[1]),r=a[0]-t[0],o=a[1]-t[1],l=180*Math.atan(r/o)/Math.PI;return l!==-90&&90!==l||(l*=-1),l+=o>0?270:90,l>360&&(l-=360),0===l&&(l=360),l}},f=function(e){if(e){for(var t=0,a=e,r=n.proj.fromLonLat(e[0]),o=n.proj.fromLonLat(e[1]),l=0,i=a.length-1;l<i;++l)t+=new n.geom.LineString([r,o]).getLength();var s;return s=Math.round(1e3*t)/1e3+" m"}};e.exports={addLineType:d,clickShowAzimuth:p,showDistance:f,addLineByGeomId:o,getCellApex:y}},function(e,t){var a=function(e){if("POLYGON"===e.layerType){var t=e.coordinates.length;if(2===t){var a=[],r=(e.coordinates[0][0]+e.coordinates[t-1][0])/2,o=(e.coordinates[0][1]+e.coordinates[t-1][1])/2;a=e.coordinates[0][0]===e.coordinates[t-1][0]?[r+1,o]:[r,o+1],e.coordinates.splice(1,0,a),fusiongis.LineAdd.addLineType(e)}}};e.exports={addPolygonBezier:a}},function(e,t,a){var r=a(3),o=a(4),n=a(7),l=a(1),i=a(5),s=a(6),d=function(e){var t=e.layerId+"_"+e.mapId,a=null,r=e.label?e.label:e.layerId;o.containsKey(t)?a=o.get(t):(i.createLayer(e),a=o.get(t)),a.set("type",n.CUSTOMTYPE.LAYERIMGTYPE),a.set("businessType","unChangePolygon"),a.set("params.label",r),a.set("layerId",e.layerId),a.set("layer_id",e.layerId)},c=function(e){var t=e.layerId+"_"+e.mapId,a=e.datas,n=s.getMapObj(e.mapId),i=o.get(t);i.set("datas",a);var d=null;if(i&&(d=i.getSource()),l.isValid(a)||a.length>0){var c=[];a.forEach(function(e){var t=n.getPixelFromCoordinate(r.proj.fromLonLat(e.coordinate)),a=e.height||20,o=e.width||10,l=t[0]-a/2,s=t[0]+a/2,d=t[1]-o/2,u=t[1]+o/2,g=[];g.push(n.getCoordinateFromPixel([l,d])),g.push(n.getCoordinateFromPixel([s,d])),g.push(n.getCoordinateFromPixel([s,u])),g.push(n.getCoordinateFromPixel([l,u])),g.push(n.getCoordinateFromPixel([l,d]));var y=new r.Feature({geometry:new r.geom.Polygon([g]),data:e,businessType:"unChangePolygon",layer:i});y.setId(e.id);var p=new r.style.Style({fill:new r.style.Fill({color:e.fillColor||"rgba(255,255,0,0.1)"}),stroke:new r.style.Stroke({color:e.strokeColor||"#76EEC6",width:e.strokeWidth||2})});y.setStyle(p),c.push(y)}),d&&d.addFeatures(c)}};e.exports={addLayer:d,setLayerData:c}},function(e,t,a){function r(e,t,a){var r=e.width,o=e.height;void 0===t&&(t=r),void 0===a&&(a=o);var n=document.createElement("canvas"),l=n.getContext("2d");return n.width=t,n.height=a,l.drawImage(e,0,0,r,o,0,0,t,a),n}function o(e,t,a,o){return e=r(e,a,o),e.toDataURL(t)}function n(e,t){if(t=t?t:"download",p.getBrowserType().msie){var a=l(e);window.navigator.msSaveBlob(a,t)}else{var r=document.createElement("a");r.href=e,r.download=t;var o=new MouseEvent("click",{bubbles:!0,cancelable:!1,view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});r.dispatchEvent(o)}}function l(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],r=atob(t[1]),o=r.length,n=new Uint8Array(o);o--;)n[o]=r.charCodeAt(o);return new Blob([n],{type:a})}function i(e){e=e.toLowerCase().replace(/jpg/i,"jpeg");var t=e.match(/png|jpeg|bmp|gif/)[0];return"image/"+t}function s(e,t,a,r,l){if(f.canvas&&f.dataURL){"string"==typeof e&&(e=document.getElementById(e)),void 0===r&&(r="png"),l.indexOf("."+r)<0&&(l=l+"."+r),r=i(r);var s=o(e,r,t,a);n(s.replace(r,m),l)}}function d(e){return"string"==typeof e?document.getElementById(e):e}function c(){var e=document.querySelector(".gm-style>div:first-child>div");if(!e)return null;for(var t=e.style.transform,a=t.split(","),r=parseFloat(a[4]),o=parseFloat(a[5]),n=document.querySelectorAll(".gm-style>div:first-child>div"),l=n.length,i=0;i<l;i++){var s=n[i];s.style.transform="none",s.style.left=r,s.style.top=o}return t}function u(e){if(e)for(var t=document.querySelectorAll(".gm-style>div:first-child>div"),a=t.length,r=0;r<a;r++){var o=t[r];o.style.transform=e,o.style.left=0,o.style.top=0}}function g(e,t,a){t=t.split(".");var r=t[t.length-1];t=t[0],e=d(e);var o=c();html2canvas(e,{useCORS:!0,onrendered:function(e){s(e,e.width,e.height,r,t),a&&a(e),u(o)}})}function y(e){g(e.targetId,e.fileName,e.endCallback)}var p=a(1),f=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return{canvas:!!t,imageData:!!t.getImageData,dataURL:!!e.toDataURL,btoa:!!window.btoa}}(),m="image/octet-stream";e.exports={exportImage:y}},function(e,t,a){var r=a(105),o=a(107);e.exports={createExportDataUI:r.createExportDataUI,createExportImageUI:o.createExportImageUI}},function(e,t,a){function r(e){var t=d.createDom({tagName:"div",attributes:{"class":"export_box_header",style:"width: 400px; height: 24px; line-height: 24px; text-indent: 8px; color: #388E8E;border-bottom-style: solid; border-bottom-color: #EBEBEB;border-bottom-width: 1px;"},text:f.prop("components.exportImage.title")});e.appendChild(t);var a=d.createDom({tagName:"div",attributes:{title:f.prop("components.exportImage.closeExportBox"),style:"width: 16px; height: 16px;line-height: 16px;text-align: center; background: #388E8E; color: white; position: absolute;top: 4px; right: 4px;cursor: pointer;text-indent: 0px;"},text:"X"});g.add(a,"click",function(){e.style.display="none"}),t.appendChild(a)}function o(e,t){var a=["--ExportType--","KML","KMZ","Shape","GRD","TAB(Raster)","TAB(Vector)","KML(Raster)"],r=d.createDom({tagName:"div",attributes:{"class":"export_box_body",style:"margin-top: 25px; width: 100%; height: 261px;color: gray;"}});t.appendChild(r);var o=d.createDom({tagName:"div",attributes:{style:"height: 20px; line-height: 20px; margin-bottom: 15px;"}});r.appendChild(o);var l=d.createDom({tagName:"div",attributes:{style:"height:225px;"}});r.appendChild(l);var i=d.createDom({tagName:"span",attributes:{style:"display: block;float: left; text-indent: 18px;"},text:f.prop("components.exportImage.format")});o.appendChild(i);var g=d.createDom({tagName:"select",attributes:{name:"export_file_type","class":"export_file_type",style:"padding: 0 5%; height: 20px; line-height: 20px; outline: none;margin-left: 10px;color: gray;"}});a.forEach(function(e){var t=d.createDom({tagName:"option",attributes:{value:e},text:e});g.appendChild(t)}),o.appendChild(g);var p=d.createDom({tagName:"span",attributes:{style:"display:block;float:left;text-indent:18px;"},text:f.prop("components.exportImage.Layers")});l.appendChild(p);var m=d.createDom({tagName:"div",attributes:{style:"height: 225px;width: 273px;outline:none;border:1px solid #EBEBEB;float:left;margin-left:10px;padding:5px;"}});l.appendChild(m);var v=d.createDom({tagName:"ul",attributes:{style:"list-style: none"}}),h=[],I=y.getLayers(e.mapId);if(I)for(var b=0;b<I.length;b++){var S=I[b];if(S&&S.get("businessType")){var L=S.get("mineLayerName")?S.get("mineLayerName"):S.get("params.label");L&&"Temp Polygon"!==L&&"Temp Point"!==L&&"Temp Line"!==L&&h.push(s(v,L))}}m.appendChild(v);for(var b=0;b<v.childNodes.length;b++)u.get(v.childNodes[b].childNodes[1].innerText)===c.BUSINESSTYPE.GRID&&(v.childNodes[b].style.display="none");n(e)}function n(e){var t=u.get(e.mapId).getTargetElement(),a=t.querySelector(".export_box_body");a&&"--ExportType--"===a.querySelector("select").value?a.querySelector("ul").style.display="none":a.querySelector("ul").style.display="block"}function l(e,t){var a=u.get(e.mapId).getTargetElement(),r=a.querySelector(".export_file_type"),o=d.createDom({tagName:"div",attributes:{"class":"export_box_foot",style:"margin: 30px auto; width: 210px; height: 30px; line-height: 30px;"}});t.appendChild(o);var n=d.createDom({tagName:"div",attributes:{type:"submit",style:"float: left; width: 100px; height: 100%;line-height: 30px; text-align: center; background: #9ACD32;cursor: pointer; margin-right: 10px;font-weight: bold; color: white;"},text:f.prop("components.exportImage.OK")});o.appendChild(n),g.add(n,"click",function(){var o=a.querySelectorAll(".export_layer_checkbox_in_li"),n=function(e){for(var t=[],a=0;a<e.length;a++)e[a].checked&&e[a].value&&t.push(e[a].value);return t}(o);n&&n.length>0&&p.exportFileToClient(e.mapId,r.value,n),t.style.display="none"}),i(r,a);var l=d.createDom({tagName:"div",attributes:{style:"float: left; width: 100px; height: 100%;line-height: 30px; text-align: center; background: #D4D4D4;cursor: pointer; font-weight: bold; color: white;"},text:f.prop("components.exportImage.Cancel")});o.appendChild(l),g.add(l,"click",function(){t.style.display="none"})}function i(e,t){g.add(e,"change",function(){var a=t.querySelectorAll(".export_layer_checkbox_in_li");if(a)for(var r=0;r<a.length;r++){var o=a[r];o.parentNode.style.display="none";var l=o.value.substring(0,o.value.indexOf("(")),i=e.value;"GRC"===i||"GRD"===i||"TAB(Raster)"===i||"KML(Raster)"===i?l===c.BUSINESSTYPE.GRID&&(o.parentNode.style.display="block"):"Shape"!==i&&"KML"!==i&&"KMZ"!==i&&"TAB(Vector)"!==i||l!==c.BUSINESSTYPE.GRID&&(o.parentNode.style.display="block")}n({mapId:t.id})})}function s(e,t){var a=d.createDom({tagName:"li"}),r=d.createDom({tagName:"input",attributes:{type:"radio",name:"exportLayerName",value:t,"class":"export_layer_checkbox_in_li"}});a.appendChild(r),e.appendChild(a);var o=d.createDom({tagName:"label",attributes:{style:"position:relative;top:-4px;"},text:t});return a.appendChild(o),r}var d=a(10),c=a(7),u=a(4),g=a(65),y=a(29),p=a(106),f=a(13),m=function(e){var t=u.get(e.mapId).getTargetElement(),a=t.querySelector(".export_kml_kmz_shape_grd_window");a&&t.removeChild(a);var n=d.createDom({tagName:"div",attributes:{"class":"export_box export_kml_kmz_shape_grd_window",style:"width: 400px; height: 390px;border:1px solid #EBEBEB; background: white; position: absolute; margin-left: -200px; margin-top: -185px; z-index: 1;top: 50%; left: 50%;"}});t.appendChild(n),r(n),o(e,n),l(e,n)};e.exports={createExportDataUI:m}},function(e,t,a){function r(e,t){var a=s.getLayers(e),r=null;return a.forEach(function(e){if(e)if(e.get("mineLayerName")){var a=e.get("mineLayerName");if(a===t[0])return r=e.get("mineLayerImgToken")}else if(e.get("params.label")){var a=e.get("params.label");if(a===t[0])return r=e.get("imgToken")}}),r}function o(e,t,a){var o=r(e,a);if(!o)return console.warn("%c vector layer not support data export","color:red"),!1;var l=null;"KML"===t||"KMZ"===t||"Shape"===t||"TAB(Vector)"===t?l=c:"GRD"!==t&&"GRC"!==t&&"TAB(Raster)"!==t&&"KML(Raster)"!==t||(l=u);var s=i.get(e);if(!s)return!1;var g=d.getExtent(e),y=s.getTargetElement();t.indexOf("TAB")!==-1&&(t="TAB"),t.indexOf("KML")!==-1&&(t="KML");var p={extent:g,imgToken:o,Format:t.toLowerCase()},f="kml_kmz_shape_grd_grc_form_id",m=y.querySelector("."+f);m&&y.removeChild(m);var v=n.createDom({tagName:"form",attributes:{style:"display: none",action:l,method:"post","class":f}});y.appendChild(v);var h=n.createDom({tagName:"input",attributes:{type:"hidden",name:"export",value:JSON.stringify(p)}});v.appendChild(h),v.submit()}var n=a(10),l=a(7),i=a(4),s=a(29),d=a(6),c=l.GisRootUrl+"/vectorManager/data/export",u=l.GisRootUrl+"/gridManager/data/export";e.exports={exportFileToClient:o}},function(e,t,a){var r=a(103),o=a(6),n=a(10),l=a(13),i=function(e){var t=e.mapId,a=o.getMapObj(t).getTargetElement(),i=function(e){var t=document.createElement(e.labelName);return!!e.id&&t.setAttribute("id",e.id),!!e["class"]&&t.setAttribute("class",e["class"]),!!e.title&&t.setAttribute("title",e.title),!!e.style&&t.setAttribute("style",e.style),!!e.value&&t.setAttribute("value",e.value),e.text&&(t.innerHTML=e.text),t},s=i({labelName:"div","class":"export-image-window",style:"width: 400px; height: 140px; position: absolute; top: 50%; left: 50%; margin-left: -200px; margin-top: -70px; border:1px solid #EBEBEB; background: white;"});a.appendChild(s);var d=n.createDom({tagName:"div",attributes:{"class":"export_image_header",style:"width: 400px; height: 24px; line-height: 24px; text-indent: 8px; color: #388E8E; border-bottom-style: solid; border-bottom-color: #EBEBEB;border-bottom-width: 1px;"},text:"export image"});s.appendChild(d);var c=i({labelName:"div","class":"export-image-title",style:"width: 16px; height: 16px;line-height: 16px;text-align: center; background: #388E8E; color: white; position: absolute;top: 4px; right: 4px;cursor: pointer;text-indent: 0px;",text:"X"});d.appendChild(c),c.onclick=function(){a.removeChild(s)};var u=i({labelName:"select","class":"export-image-select",style:"position: absolute;top: 50px;left: 50%;width: 138px;margin-left: -69px;cursor: pointer;"}),g=["--Save Image Type--","PNG","GIF","JPG"];g.forEach(function(e){var t=i({labelName:"option","class":"export-image-select",style:"",value:"--save image type--"===e?"png":e,text:e});u.appendChild(t)}),s.appendChild(u);var y=i({labelName:"div",style:"width: 100px; height: 30px;line-height: 30px;position: absolute;bottom: 10px;left: 95px;background-color:#9ACD32;font-weight:bold;color:white;text-align:center;",text:l.prop("components.exportImage.OK")});s.appendChild(y),y.onclick=function(){s.style.display="none";var e=this.parentNode.querySelector(".export-image-select").value;r.exportImage({targetId:t,fileName:"map."+e}),a.removeChild(s)};var p=i({labelName:"div",style:"width: 100px; height: 30px;line-height: 30px;position: absolute;bottom: 10px;left: 205px;background-color:#D4D4D4;font-weight:bold;color:white;text-align:center;",text:l.prop("components.exportImage.Cancel")});s.appendChild(p),p.onclick=function(){a.removeChild(s)}};e.exports={createExportImageUI:i}},function(e,t,a){var r=a(3),o=a(6),n=null,l=function(e){n||(n=new r.interaction.DragZoom({condition:r.events.condition.always}),o.getMapObj(e.mapId).addInteraction(n)),e.isActive?n.setActive(!0):n.setActive(!1)};e.exports={dragZoomInteraction:l}},function(e,t,a){var r=a(3),o=a(6),n=(a(7),a(4)),l=a(47),i=a(8),s=a(32),d=(a(1),a(13)),c=6378137,u=function(e){var t=e.mapId,a=e.layerId+"_line_"+t,l=e.layerId+"_arrow_"+t,i=null,s=null;n.containsKey(a)||n.containsKey(l)||(i=new r.layer.Vector({source:new r.source.Vector({wrapX:!1})}),s=new r.layer.Vector({source:new r.source.Vector({wrapX:!1})}),i.set("mapId",t),i.set("layerId",e.layerId),i.set("popList",[]),n.put(a,i),o.getMapObj(t).addLayer(i),s.set("mapId",t),s.set("layerId",e.layerId),n.put(l,s),o.getMapObj(t).addLayer(s))},g=function(e){var t=e.layerId+"_line_"+e.mapId,a=e.layerId+"_arrow_"+e.mapId,o=n.get(t),u=n.get(a),g=e.data,y=void 0===e.showBreakPoint||e.showBreakPoint,p=void 0!==e.showStraightIcon&&e.showStraightIcon,f=e.breakPointInterval||3,m=e.straightInterval||1e3,v=e.breakPointStyle||{},h=e.straightStyle||{},I=e.lineStyle||{},b=void 0!==e.showMeasure&&e.showMeasure,S=void 0!==e.isClear&&e.isClear,L=i.getMapObj(e.mapId),w=L.getView().getProjection(),T=new r.Sphere(c),E=[],k=[],C=[];if(g&&g.length>1){for(var x=0;x<g.length;x++){var O=r.proj.fromLonLat(g[x].coordinate);if(C.push(O),x<g.length-1){var _=r.proj.fromLonLat(g[x+1].coordinate),N=_[0]-O[0],P=_[1]-O[1],M=180*Math.atan(N/P)/Math.PI;M!==-90&&90!==M||(M*=-1),M+=P>0?360:180,M>360&&(M-=360);for(var F=new r.geom.LineString([O,_]).getLength(),R=parseInt(F/m),A=0;A<R;A++){var G=Math.PI/2-M/180*Math.PI,D=O[0]+(A+1)*m*Math.cos(G),j=O[1]+(A+1)*m*Math.sin(G);if(p){var V=h.height||500,Y=l.createArrow(D,j,V,M,60),B=new r.geom.LinearRing(Y),U=new r.geom.Polygon([B.getCoordinates()]),W=new r.Feature({geometry:U,data:g[x]}),H=new r.style.Style({fill:new r.style.Fill({color:h.fillColor||"blue"}),stroke:new r.style.Stroke({color:h.strokeColor||"blue",width:h.width||1})});W.setStyle(H),E.push(W)}}var J=v.height||500,Z=l.createArrow(O[0],O[1],J,M,60),z=new r.geom.LinearRing(Z),U=new r.geom.Polygon([z.getCoordinates()]),K=new r.Feature({geometry:U,data:g[x]}),H=new r.style.Style({fill:new r.style.Fill({color:v.fillColor||"blue"}),stroke:new r.style.Stroke({color:v.strokeColor||"blue",width:v.width||1})});K.setStyle(H),x%f===0&&x<=g.length-2&&y&&E.push(K)}}var X=new r.Feature({geometry:new r.geom.LineString(C)}),H=new r.style.Style({stroke:new r.style.Stroke({color:I.strokeColor||"white",width:I.width||2})});X.setStyle(H),k.push(X)}var q=o.get("popList");if(q&&q.length>0){for(var x=0;x<q.length;x++)L.removeOverlay(q[x]);o.set("popList",[])}var Q=0;if(b)for(var x=0;x<C.length-1;x++){var $=r.proj.transform(C[x],w,"EPSG:4326"),ee=r.proj.transform(C[x+1],w,"EPSG:4326"),te=T.haversineDistance($,ee);Q+=te;var ae;ae=te>100?Math.round(te/1e3*100)/100+"km":Math.round(100*te)/100+"m";var re=document.createElement("div");if(re.className="measure-tooltip mile",x===C.length-2){var oe;oe=Q>100?Math.round(Q/1e3*100)/100+"km":Math.round(100*Q)/100+"m",re.innerHTML=ae+";"+d.prop("measure.message.total")+oe}else re.innerHTML=ae;re.style.zIndex=s.getPopupZIndex(L.getTarget());var ne=new r.Overlay({element:re,offset:[-5,-1],positioning:"top-center"});ne.setPosition(C[x+1]),L.addOverlay(ne),q.push(ne)}if(S){if(!!o&&o.getSource().clear(),!!u&&u.getSource().clear(),q.length>0)for(var x=0;x<q.length;x++)L.removeOverlay(q[x]);q=[]}!!o&&o.getSource().addFeatures(k),!!u&&u.getSource().addFeatures(E)};e.exports={addLayer:u,setLayerData:g}},function(e,t,a){function r(e){var t=e,a=0;return e<-180?(a=Math.abs(parseInt((e+180)/360))+1,t+=360*a):e>180&&(a=Math.abs(parseInt((e-180)/360))+1,t-=360*a),t}function o(e,t,a){var r=!0,o=1113190*(90-Math.abs(t));return a>o&&(r=!1),r}var n=a(3),l=a(4),i=a(7),s=function(e){var t=e.callback,a=e.mapId,s=e.layerId,d=e.dataList,c=s+i.Joiner.UNDERLINE+a,u=l.get(a),g=null;l.containsKey(c)?g=l.get(c):(g=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})}),l.put(c,g),u.addLayer(g)),function(){var e=new n.interaction.Select({layers:[g],wrapX:!1});u.addInteraction(e);var a=new n.interaction.Translate({features:e.getFeatures()});u.addInteraction(a),a.on("translateend",function(e){var a=e.features.getArray()[0],o=n.proj.transformExtent(a.getGeometry().getExtent(),i.PROJ.EPSG_3857,i.PROJ.EPSG_4326);o[0]=r(o[0]),o[2]=r(o[2]),t&&"function"==typeof t&&(Math.abs(o[1])<90&&Math.abs(o[3])<90?t({extent:o}):console.warn("the circle out of range"))});var o=new n.interaction.Modify({features:e.getFeatures()});u.addInteraction(o);var l=!1,s=null;o.on("modifystart",function(e){var a=e.features;if(a&&a.getArray().length>0){var o=a.getArray()[0];if(0==l){var d=o.getGeometry().getExtent(),c=n.extent.getCenter(d);s=u.on("pointermove",function(e){var t=e.coordinate,a=new n.geom.LineString([c,t]),r=a.getLength(),l=new n.geom.Circle(c,r),i=new n.geom.Polygon.fromCircle(l,1e3);o.setGeometry(i)}),l=!0}else if(u.unByKey(s),l=!1,s=null,t&&"function"==typeof t){var g=n.proj.transformExtent(o.getGeometry().getExtent(),i.PROJ.EPSG_3857,i.PROJ.EPSG_4326);g[0]=r(g[0]),g[2]=r(g[2]),Math.abs(g[1])<90&&Math.abs(g[3])<90?t({extent:g}):console.warn("the circle out of range")}}})}(),function(){!!d&&d.forEach(function(e){if(!(e.radius>0))return void console.warn("radius must be greater than 0");var a=e.coordinate[0],l=e.coordinate[1];if(a>180||a<-180)return void console.warn("lon must between -180 at 180");if(l>=90||l<=-90)return void console.warn("lat must between -90 at 90");var s=o(a,l,e.radius);if(!s)return void console.warn("the circle out of range");var d=new n.geom.Circle(n.proj.fromLonLat(e.coordinate),e.radius),c=new n.Feature({geometry:new n.geom.Polygon.fromCircle(d,1e3)});if(c.setId(e.id),g.getSource().addFeature(c),c.setStyle(function(){return new n.style.Style({fill:new n.style.Fill({color:"rgba(33, 150, 243, .6)"}),stroke:new n.style.Stroke({color:"#ff0",width:1})})}),t&&"function"==typeof t){var u=n.proj.transformExtent(c.getGeometry().getExtent(),i.PROJ.EPSG_3857,i.PROJ.EPSG_4326);u[0]=r(u[0]),u[2]=r(u[2]),Math.abs(u[1])<90&&Math.abs(u[3])<90?t({extent:u}):console.warn("the circle out of range")}})}()},d=function(e,t){var a=e.layerId+i.Joiner.UNDERLINE+e.mapId,r=l.get(a);if(r&&r instanceof n.layer.Vector){var o=r.getSource().getFeatures();arguments[1]&&arguments[1]===!0?r.getSource().clear():o.forEach(function(t){t.getId()===e.featureId&&r.getSource().removeFeature(t)})}};e.exports={circle:s,removeGeometry:d}},function(e,t,a){var r=a(7),o=a(14),n=function(e){o.postJSON({url:r.CustomQuery.GET_FEATURE_INFO,data:JSON.stringify(e.requestParam),success:function(t){var a=JSON.parse(t);if(a&&0===a.State.resultCode){var r=a.datas;r&&e.callback&&"function"==typeof e.callback&&e.callback(r)}},failure:function(e){console.log("get feature on custom layer fail:"+e)}})},l=function(e){o.postJSON({url:r.CustomQuery.GET_LAYER_INFO,data:null,success:function(t){var a=JSON.parse(t);if(a&&0===a.State.resultCode){var r=a.datas;r&&e&&"function"==typeof e&&e(r)}},failure:function(e){console.log("get custom layers fail:"+e)}})},i=function(e){o.get({url:r.CustomQuery.GET_COMMON_LAYER_INFO,data:null,success:function(t){var a=JSON.parse(t);a&&1===a.status.code&&a.data&&e&&"function"==typeof e&&e(a.data)},failure:function(e){console.log("get common layers fail:"+e)}})},s=function(e){var t=e.callback;o.postJSON({url:r.CustomQuery.GET_FEATURE_IN_COMMON_LAYER,data:JSON.stringify(e.requestParam),success:function(e){var a=JSON.parse(e);if(a&&1===a.status.code){var r=a.data;r&&t&&"function"==typeof t&&t(r)}},failure:function(e){console.log("get common layers fail:"+e)}})};e.exports={getLayerInfo:l,getFeatureInfo:n,getCommonLayerInfo:i,getFeatureInCommonLayer:s}},function(e,t,a){function r(e){var t=e.coordinate,a=e.sourceProj,r=e.targetProj;return 4===t.length?n.proj.transformExtent(t,a,r):2===t.length?n.proj.transform(t,a,r):n.proj.transform(t,a,r)}function o(){return r({coordinate:[-180,-87,180,87],sourceProj:l.PROJ.EPSG_4326,targetProj:l.PROJ.EPSG_3857})}var n=a(3),l=a(7);e.exports={Transform:{transform:r},Extent:{mapMaxExtent:o},transform:r}},function(e,t,a){function r(e){var t=function(t){var a=e.querySelector(".layer-name").querySelector("select");t.forEach(function(e){a.appendChild(function(){var t=e.layerName;return c.createDom({tagName:"option",attributes:{value:t,title:t},text:!!t&&t.substring(0,30)})}())})},a=[];fusiongis.CustomQuery.getLayerInfo(function(e){t(e)}),fusiongis.CustomQuery.getCommonLayerInfo(function(e){var a=[];!!e&&e.forEach(function(e){a.push({layerName:e.name})}),t(a)}),function(){a=a.concat([{layerName:"layer_name_empty_"},{layerName:"layer_name_site_"},{layerName:"layer_name_cell_"},{layerName:"layer_name_polygon_"}])}();var r=c.createDom({tagName:"div",attributes:{"class":"layer-name"}});e.appendChild(r),r.appendChild(function(){return c.createDom({tagName:"span",text:f.prop("search.layerName")+"："})}()),r.appendChild(function(){var e=c.createDom({tagName:"select",attributes:{name:"layerName"}});return a.forEach(function(t){e.appendChild(function(){var e=t.layerName;return"layer_name_site_"===e?e=f.prop("search.site"):"layer_name_cell_"===e?e=f.prop("search.cell"):"layer_name_polygon_"===e?e=f.prop("search.systemPolygon"):"layer_name_empty_"===e&&(e="--"+f.prop("search.choose")+"--"),c.createDom({tagName:"option",attributes:{value:t.layerName},text:e})}())}),e}());var n=r.querySelector("select");n&&(n.onchange=function(){o(e,this.value)})}function o(e,t){var a=e.querySelector(".layer-attr"),r=e.querySelector(".layer-val");a||(a=c.createDom({tagName:"div",attributes:{"class":"layer-attr"}}),e.insertBefore(a,r)),a.innerHTML="",a.appendChild(function(){return c.createDom({tagName:"span",text:f.prop("search.propertyName")+"："})}()),function(){var e=c.createDom({tagName:"select",attributes:{name:"layerAttr"}});a.appendChild(e);var r=function(t){t.forEach(function(t,a){var r=c.createDom({tagName:"option",attributes:{value:t},text:t});e.appendChild(r)})};"layer_name_site_"===t||"layer_name_cell_"===t||"layer_name_polygon_"===t?r(["id","name"]):(y.postJSON({url:u.CustomQuery.GET_ATTR_IN_COMMON_LAYER,data:JSON.stringify({featureClassName:t}),success:function(e){var t=JSON.parse(e);if(t&&1===t.status.code){var a=t.data;if(a){var o=[];a.forEach(function(e){o.push(e.columnName)}),r(o)}}},failure:function(e){console.warn("get attribute in layer failed: "+e)}}),y.postJSON({url:u.CustomQuery.GET_ATTR_INFO,data:JSON.stringify({services:[{name:"getCustomLayersInfo",param:{}}]}),success:function(e){var a=JSON.parse(e);if(a&&1===a.status.code){var o=a.data;if(o&&o.layers){var n=[];o.layers.forEach(function(e){e&&t===e.layerName&&e.defualtField&&n.push(e.defualtField)}),r(n)}}},failure:function(e){console.warn("get attribute in layer failed: "+e)}}))}()}function n(e,t,a){var r=c.createDom({tagName:"div",attributes:{"class":"layer-val"}});a.appendChild(r),r.appendChild(function(){return c.createDom({tagName:"span",text:f.prop("search.propertyValue")+"："})}());var o=c.createDom({tagName:"input",attributes:{type:"search"}});r.appendChild(o),r.appendChild(function(){var r=c.createDom({tagName:"div",attributes:{"class":"searchBtn"}});return r.onclick=function(){if(!o.value)return console.warn("Search box does not contain a null value!!!"),!1;var r=a.querySelector(".layer-name").querySelector("select").value,n=a.querySelector(".layer-attr").querySelector("select").value,i=t.querySelector(".featureList");i&&t.removeChild(i);var s=c.createDom({tagName:"div",attributes:{"class":"featureList"}});t.appendChild(s);var d=c.createDom({tagName:"div",attributes:{"class":"head"},text:f.prop("search.elementList")});s.appendChild(d);var u=c.createDom({tagName:"div",attributes:{"class":"close"},text:"X"});d.appendChild(u),u.onclick=function(){t.removeChild(s)};var g=c.createDom({tagName:"div",attributes:{"class":"content"}});s.appendChild(g),fusiongis.CustomQuery.getFeatureInfo({requestParam:{loadAll:!0,nameFilter:o.value,criteria:r,start:0,limit:50},callback:function(t){!!t&&t.forEach(function(t){var a=t.data.gid,r=t.name,o="";r&&a?o=r+" "+a:r&&!a?o=r:!r&&a&&(o=a);var n=t.data.points.toString(),i=c.createDom({tagName:"div",attributes:{id:a,coordinate:n,title:o},text:o});g.appendChild(i),l(e,i)})}}),fusiongis.CustomQuery.getFeatureInCommonLayer({requestParam:{featureClassName:r,columnName:n,value:[o.value],operator:"like"},callback:function(t){if(t&&t.fcObjectList){var a=t.fcObjectList;a.forEach(function(t){if(!t)return!1;var a=t.fcObjectId||t.attributeList.SECTOREQMKEY||t.attributeList.POLYGONID||t.attributeList.SITEKEY||t.attributeList.BTSNAME,r=t.attributeList&&t.attributeList.name||t.attributeList.CELLNAME||t.attributeList.POLYGONNAME||t.attributeList.NOdEBNAME||t.attributeList.ENODEBNAME||t.attributeList.BTSNAME,o="";r&&a?o=r+" "+a:r&&!a?o=r:!r&&a&&(o=a);var n=p.htmlDecode(t.geometry),i=function(){var e=p.getWKTFromText(n),t=e.coordinates,a=e.geoType;return{coordinate:t,geomType:a}}(),s=c.createDom({tagName:"div",attributes:{id:a,coordinate:i.coordinate,geomType:i.geomType,title:o},text:o});g.appendChild(s),l(e,s)})}}})},r}())}function l(e,t){t&&(t.onclick=function(a){a.stopPropagation();var r=t.getAttributeNode("coordinate").value,o=t.getAttributeNode("geomtype").value;if(!r)return!1;var n=0,l=0;if(r.indexOf("[[")!==-1&&r.indexOf("]]")!==-1){var i=r.substring(2,r.length-2);if(i.indexOf("],[")){var s=i.split("],["),d=s[0].split(",");n=parseFloat(d[0]),l=parseFloat(d[1])}else{var d=i.split(",");n=parseFloat(d[0]),l=parseFloat(d[1])}n&&l&&fusiongis.Map.setMapCenter({mapId:e,coordinate:[n,l],zoom:o&&"Point"===o?17:void 0})}else if(r.indexOf(",")!=-1){var d=r.split(","),n=parseFloat(d[0]),l=parseFloat(d[1]);n&&l&&fusiongis.Map.setMapCenter({mapId:e,coordinate:[n,l],zoom:o&&"Point"===o?17:void 0})}})}function i(e,t,a){for(var r=t.querySelectorAll(".tab-item"),o=function(e,a){t.querySelector(e)&&(t.querySelector(e).style.display="block"),t.querySelector(a)&&(t.querySelector(a).style.display="none");
},n=0;n<r.length;n++){var l=r[n];l.onclick=function(){var t=this.classList;if("tab-online"===t[0])o(".content-online",".content-offline");else if("tab-offline"===t[0]){var r=e.querySelector(".content-offline");r||(r=c.createDom({tagName:"div",attributes:{"class":"content-offline content"}}),e.appendChild(r)),a(r),o(".content-offline",".content-online")}}}}function s(e,t,a,r,o,n){fusiongis.Search.searchLocal({serviceVendor:r,address:o.value,key:window.sessionStorage?sessionStorage.getItem("key"):Cookie.read("key"),callback:function(r){!!r&&r.forEach(function(r){var o=r.centerLonLat,l=r.displayName,i=r.bbox,s=c.createDom({tagName:"div",attributes:{title:l},text:l.substring(0,25)+"..."});a.appendChild(s),s.onclick=function(){i.length?fusiongis.Map.setExtent({mapId:e,extent:i}):fusiongis.Map.setMapCenter({coordinate:o,zoom:10,mapId:e}),fusiongis.Search.clearMarker(e),fusiongis.Search.addMarker({mapId:e,coordinate:o,imgUrl:n||fusiongis.Constant.GisResourceURL+"search/search-result-icon.png"}),t.style.display="none"}})}})}function d(e){e.appendChild(function(){var e=c.createDom({tagName:"div",attributes:{"class":"tab"}});return e.appendChild(function(){return c.createDom({tagName:"div",attributes:{"class":"tab-online tab-item"},text:f.prop("search.online")})}()),e.appendChild(function(){return c.createDom({tagName:"div",attributes:{"class":"border"}})}()),e.appendChild(function(){return c.createDom({tagName:"div",attributes:{"class":"tab-offline tab-item"},text:f.prop("search.offline")})}()),e}())}var c=a(10),u=a(7),g=a(4),y=a(14),p=a(1),f=a(13),m=function(e){var t=e.mapId,a=g.get(t).getTargetElement(),o=null;!function(){o=a.querySelector(".search");var e=80,t=a.querySelector(".export-image")&&a.querySelector(".export-image").style.display,r=a.querySelector(".map-mode")&&a.querySelector(".map-mode").style.display;"block"!==t&&"block"!==r||(e=110),"block"===t&&"block"===r&&(e=140);var n=function(){o=c.createDom({tagName:"div",attributes:{"class":"search",style:"right: "+e+"px"}}),a.appendChild(o)};o&&a.removeChild(o),n()}(),function(){var e=c.createDom({tagName:"div",attributes:{"class":"header"},text:f.prop("search.title")});o.appendChild(e);var t=c.createDom({tagName:"div",attributes:{"class":"close-btn"},text:"X"});e.appendChild(t),t.onclick=function(){a.removeChild(o)}}();var l=c.createDom({tagName:"div",attributes:{"class":"body"}});o.appendChild(l),d(l),function(){var a=c.createDom({tagName:"div",attributes:{"class":"content-online content"}});l.appendChild(a);var r=c.createDom({tagName:"div",attributes:{"class":"header"}});a.appendChild(r);var n=c.createDom({tagName:"input",attributes:{type:"search"}});r.appendChild(n);var i=c.createDom({tagName:"div",attributes:{"class":"searchBtn"},title:f.prop("search.click.search")});r.appendChild(i);var d=c.createDom({tagName:"div",attributes:{"class":"body"}});a.appendChild(d),i.onclick=function(){d.innerHTML="";var a=function(){var e=void 0,a=g.get(t),r=a.getLayers(),o=r.item(0);return o&&o.get("mapType")&&(e=o.get("mapType")),e}(),r=document.getElementById("$$customMap_"+t);r&&(a="GOOGLE"),a?s(t,o,d,a,n,e.imgUrl):d.innerHTML=f.prop("search.current.map.not.support")}}(),i(l,o,function(e){e.innerHTML="",r(e),n(t,o,e)})};e.exports={createSearchUI:m}},function(e,t,a){var r=a(3),o=a(6),n=a(4),l=a(7),i=(a(1),function(e){var t=e.mapId,a=e.layerId,i=a+"_"+t,s=o.getMapObj(t),d=s.getView().getZoom(),c=e.defaultVisibleLevel||l.DefaultLayerVisibleLevel.HEAT_MAP,u=e.label?e.label:e.layerId,g=null;return n.get(i)?g=n.get(i):(g=new r.layer.Image({opacity:e.opacity||.7}),g.set("layerId",a),g.set("mapId",t),g.set("businessType",l.BUSINESSTYPE.HEAT_MAP),g.set("defaultVisibleLevel",c),g.set("params.label",u),s.addLayer(g),n.put(i,g)),d<c&&g.setVisible(!1),g}),s=function(e){var t="https://127.0.0.1:11251/fusiongis";t+="/heatmap.do";var a=o.getMapObj(e),n=o.getExtent(e),l=[n[0],n[1]],i=[n[2],n[3]],s=r.proj.toLonLat(l),d=r.proj.toLonLat(i),c=a.getSize();return t=t+"?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&FORMAT=image%2Fpng&TRANSPARENT=true&minx="+s[0]+"&miny="+s[1]+"&maxx="+d[0]+"&maxy="+d[1]+"&width="+c[0]+"&height="+c[1]+"&featureClassName=m49ed41dd3c2b4b6ab03baed853e7a2fc_places"},d=function(e){var t=e.mapId,a=e.layerId,l=a+"_"+t,i=n.get(l),d=o.getMapObj(t),c=null,u=s(t);c=new r.source.ImageStatic({projection:"EPSG:3857",url:u,imageExtent:o.getExtent(t)}),!!i&&i.setSource(c),d.on("moveend",function(){var e=s(t);c=new r.source.ImageStatic({projection:"EPSG:3857",url:e,imageExtent:o.getExtent(t)}),!!i&&i.setSource(c)});var g=d.getView();g.on("change:resolution",function(){var e=s(t);c=new r.source.ImageStatic({projection:"EPSG:3857",url:e,imageExtent:o.getExtent(t)}),!!i&&i.setSource(c)})};e.exports={createLayer:i,addServiceHeatMap:d}},function(e,t,a){var r=(a(3),function(e){if(!e)return!1;e[0].length>0&&e[0][0][0]!==e[0][e[0].length-1][0]&&e[0][0][1]!==e[0][e[0].length-1][1]&&e[0].push(e[0][0]);var t={type:"Feature",properties:{fill:"#00f"},geometry:{type:"Polygon",coordinates:e}};return t}),o=function(e,t){var a=r(e),o=r(t),n=turf.union(a,o);if(n&&n.geometry){var l=n.geometry;return{type:l.type,coordinates:function(){return"Polygon"===l.type?l.coordinates[0]:"MultiPolygon"===l.type?l.coordinates:void 0}()}}return{}};e.exports={getUnionPolygonCoordinates:o}},function(e,t,a){var r=(a(3),function(e){if(!e)return!1;e[0].length>0&&e[0][0][0]!==e[0][e[0].length-1][0]&&e[0][0][1]!==e[0][e[0].length-1][1]&&e[0].push(e[0][0]);var t={type:"Feature",properties:{fill:"#00f"},geometry:{type:"Polygon",coordinates:e}};return t}),o=function(e,t){var a=r(e),o=r(t),n=turf.intersect(a,o);if(n&&n.geometry){var l=n.geometry;return{type:l.type,coordinates:function(){return"Point"===l.type?l.coordinates:"Polygon"===l.type?l.coordinates[0]:void 0}()}}return{}};e.exports={getIntersectPolyCoordinates:o}},function(e,t,a){var r=(a(3),function(e){if(!e)return!1;e[0].length>0&&e[0][0][0]!==e[0][e[0].length-1][0]&&e[0][0][1]!==e[0][e[0].length-1][1]&&e[0].push(e[0][0]);var t={type:"Feature",properties:{fill:"#00f"},geometry:{type:"Polygon",coordinates:e}};return t}),o=function(e,t){var a=r(e),o=r(t),n=turf.difference(a,o);if(n&&n.geometry){var l=n.geometry;return{type:l.type,coordinates:l.coordinates}}return{}};e.exports={getDiffPolyCoordinates:o}},function(e,t,a){function r(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("state");r?i(e):l(e)}var o=a(3),n=a(6),l=function(e){var t=e.mapId,a=e.distance?e.distance:1e6,r=e.lineColor?e.lineColor:[0,100,250,.6],l=e.lineWidth?e.lineWidth:1.5,i=e.lineDash?e.lineDash:[2,5],s=n.getMapObj(t),d=new o.source.Vector({wrapX:!1}),c=new o.layer.Vector({id:"myLayer",source:d});c.set("id","myLayer"),s.addLayer(c);for(var u=o.proj.fromLonLat([180,0])[0],g=o.proj.fromLonLat([0,85])[1],y=2*u,p=2*g,f=Math.round(p/a),m=Math.round(y/a),v=new o.style.Style({stroke:new o.style.Stroke({width:l,color:r,lineDash:i})}),h=[],I=0,b={},S=0;S<=f;S++)b=new o.Feature,b.setGeometry(new o.geom.LineString([[-u,-g+I],[u,-g+I]])),I+=a,b.setStyle(v),h.push(b);for(var L=0,S=0;S<=m;S++)b=new o.Feature,b.setGeometry(new o.geom.LineString([[-u+L,g],[-u+L,-g]])),L+=a,b.setStyle(v),h.push(b);c.getSource().addFeatures(h),s.set("state",!0)},i=function(e){var t=e.mapId,a=n.getMapObj(t),r=a.getLayers();r.forEach(function(e){"myLayer"==e.get("id")&&(a.removeLayer(e),a.set("state",!1))})};e.exports={addGrid:l,removeGrid:i,toggleGrid:r}},function(e,t,a){var r=a(3),o=a(6),n=function(e){for(var t=e.mapId,a=e.points,n=new r.source.Vector({wrapX:!1}),l=new r.layer.Vector({source:n}),i=[],s=new r.Feature,d=a.length,c=0;c<d;c++)a[c]=r.proj.fromLonLat(a[c]);var u=new r.geom.Polygon([a]),g=new r.style.Style({stroke:new r.style.Stroke({width:1.5,color:[255,255,0,1]}),fill:new r.style.Fill({color:[0,255,0,.7]})});s.setGeometry(u),s.setStyle(g),i.push(s),n.addFeatures(i);var y=o.getMapObj(t);if(y.addLayer(l),d>=4&&a[0][0]===a[d-1][0]&&a[0][1]===a[d-1][1])for(var c=1;c<d-2;c++){for(var p=c+1;p<d-1;p++)if(a[c][0]===a[p][0]&&a[c][1]===a[p][1])return void console.log("该多边形自相交");c==d-3&&console.log("该多边形不自相交")}};e.exports={judgeConnection:n}},function(e,t,a){function r(e){for(var t,a,r,n,l,i=(new o.format.GeoJSON).readFeatures(e),s=[],d=0;d<i.length;d++)n=i[d].getId(),t=i[d].getProperties().name,a=i[d].getGeometry().getType(),r=i[d].getGeometry().getCoordinates(),l={id:n,name:t,type:a,coordinates:r[0]},s.push(l);return s}var o=a(3);e.exports={getDataByGeoJson:r}},function(e,t){},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=l.getMapObj(e.mapId),r=e.label?e.label:e.layerId;if(!i.containsKey(t)){var o=new n.layer.Tile({source:new n.source.XYZ({wrapX:!1})});o.set("map",a),o.set("layerId",t),o.set("layer_id",e.layerId),o.set("params.label",r),o.set("legendName",e.legendName),o.set("businessType",s.BUSINESSTYPE.GRID),o.setZIndex(s.Z_INDEX.GRID),i.put(t,o),a.addLayer(o)}}function o(e){var t=e.layerId+"_"+e.mapId,a=i.get(t);a&&(a.set("legendName",e.legendName),a.getSource().setUrl(e.url))}var n=a(3),l=a(6),i=a(4),s=a(7);a(1),a(32),a(11);e.exports={addLayer:r,setLayerData:o}},function(e,t,a){var r=a(14);e.exports={setHeader:function(){var e=location.search,t=new Object;if(e.indexOf("?")!=-1)for(var a=e.substr(1),o=a.split("&"),n=0;n<o.length;n++)t[o[n].split("=")[0]]=o[n].split("=")[1];t.hasOwnProperty("devMode")||t.devMode||r.setHeader()}()}}]);