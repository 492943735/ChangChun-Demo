var fusiongis=function(e){function t(r){if(a[r])return a[r].exports;var o=a[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var a={};return t.m=e,t.c=a,t.p="./build",t(0)}([function(e,t,a){var r=a(1),o=a(2),n=a(64),i=r.extend({},o,n),l=a(5),s=a(65),d=r.extend({},l,s);e.exports={Constant:a(7),Algorithm:a(48),AdminRegion:a(66),BaseLayer:d,BLayerManager:a(39),BubbleCircle:a(67),Bubble:a(68),GradientCircle:a(69),Cell:a(47),Chart:a(70),Curve:a(74),FigTense:a(75),GridDensity:a(76),HeatMap:a(77),Highlight:a(43),Icon:a(78),Icon2Label:a(79),InfoPop:a(80),ImageFilter:a(81),Line:a(82),LayerManager:a(84),LegendRange:a(85),LegendSlider:a(86),PointCluster:a(87),Radar:a(88),RenderShadowArea:a(89),SetVectorLayerData:a(65),TrackShow:a(90),ConvergeCell:a(91),ConvergeGrid:a(92),BubbleCircleLabel:a(59),FontStyle:a(60),Legend:i,Grid:a(50),BCell:a(46),BsiteAndCell:a(93),BSite:a(49),BLine:a(54),CirclePoint:a(44),Point:a(42),Polygon:a(45),ServicePoint:a(52),ServiceLine:a(53),ServicePolygon:a(51),VectorPolygon:a(94),DGrid:a(95),DBCell:a(96),DBSite:a(97),DServicePoint:a(57),DServiceLine:a(58),DServicePolygon:a(56),Render:a(98),RenderToken:a(99),Events:a(11),Map:a(8),AcrossLine:a(21),GStreetView:a(100),Overlay:a(12),Popup:a(9),Measure:a(101),MeasureAngle:a(104),Geometry:a(105),Search:a(106),SearchObject:a(107),Graticule:a(108),SelectMode:a(109),Migration:a(110),BubbleLine:a(111),PolygonQuery:a(112),InterSectPolygons:a(113),ShowPolygonCenterIcon:a(114),ThiessenPolygon:a(115),ContributionPlotOnLine:a(116),LineStraight:a(55),LineAdd:a(117),PolygonBezier:a(118),UnChangePolygon:a(119),Util:r,DomUtil:a(10),OlUtil:a(16),I18n:a(13),ImageUtil:a(120),OriginalAjax:a(14),ExportUI:a(121),DragZoomInteraction:a(125),GPSNavigation:a(126),HashMap:a(4),RenderGeometry:a(127),CustomQuery:a(128),Transform:a(129),SearchUI:a(130),ServiceHeatMap:a(131),Union:a(132),Intersect:a(133),Difference:a(134),SecondaryMesh:a(135),IntersectSelf:a(136),AnalysisGeoJson:a(137),Buffer:a(138),Drag:a(139),XYZLayer:a(140),PreLoad:a(141),TrackPlay:a(142),TrackPlayer:a(143),RoadMain:a(144),IconCluster:a(145),Wms:a(146),ArcgisTileLayer:a(36),ServiceLayer:a(147),FilterFeature:a(148),layerFilterHighLight:a(149),CircleLabel:a(150),MuliPoint:a(61)}},function(e,t){function a(e){if(e&&k(e)){var t=[];if("function"==typeof arguments[1]){for(var a=arguments[1],r=e.length,o=[],n=0;n<r;n++){var i=a(e[n],n);o.push({source_pos:n,value:i})}for(var l=0;l<r;l++)for(var s=l;s<r;s++)if(o[l].value>o[s].value){var d=o[l];o[l]=o[s],o[s]=d}for(var c=0;c<r;c++)t.push(e[o[c].source_pos]);return t}if(k(arguments[1])&&arguments[1].length===e.length){var g=arguments[1];return t.length=g.length,g.forEach(function(a,r){t[a]=e[r]}),t}}}function r(e,t){if(e&&k(e)){for(var a=e.length,r=[],o=0;o<a;o++){var n=t(e[o],o);r.push({source_pos:o,value:n})}for(var i=0;i<a;i++)for(var l=i;l<a;l++)if(r[i].value>r[l].value){var s=r[i];r[i]=r[l],r[l]=s}for(var d=new Array(a),c=0;c<a;c++)d[r[c].source_pos]=c;return d}}function o(e){if(!e||!k(e))return[];for(var t=e.length,a=[],r=0;r<t;r++)a=a.concat(e[r]);return a}function n(e){var t=[];for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];if(null!==r&&"function"!=typeof r){var o;if("object"==typeof r&&r.constructor===Array){for(var n,i=[],l=0,s=r.length;l<s;l++)n=r[l],i.push(encodeURIComponent(null===n||void 0===n?"":n));o=i.join(",")}else o=encodeURIComponent(r);t.push(encodeURIComponent(a)+"="+o)}}return t.join("&")}function i(){for(var e=arguments,t=e[0],a=1,r=e.length;a<r;a++)for(var o=e[a],n=Object.keys(o),i=0,l=n.length;i<l;i++){var s=n[i];"undefined"!==o[s]&&null!==o[s]&&(t[s]=o[s])}return t}function l(e){if(k(e)){for(var t=[],a=0,r=e.length;a<r;a++)void 0!==e[a]&&null!==e[a]&&t.push(e[a]);return t}}function s(e){if(k(e))return e[e.length-1]}function d(e,t){if(e&&k(e)){for(var a={},r=0,o=e.length;r<o;r++){var n=t(e[r]);a[n]||(a[n]=[]),a[n].push(e[r])}return a}}function c(e,t){if(e&&k(e)){e=a(e,t);for(var r=[],o=null,n=0,i=e.length;n<i;n++){var l=t(e[n]);o!==l&&(o=l,r.push([])),s(r).push(e[n])}return r}}function g(e){e.sort(function(e,t){return e>t?1:e<t?-1:0})}function u(e){e.sort(function(e,t){return e>t?-1:e<t?1:0})}function y(e){if(e&&"number"==typeof e.length){for(var t=[],a=0,r=e.length;a<r;a++)t.push(e[a]);return t}}function p(e,t){return e.indexOf(t)===e.length-t.length}function m(e){for(var t,a,r={},o=[],n=(e.length,0);n<e.length;n++)t=e[n],a=typeof t,r[t]?r[t].indexOf(a)<0&&(r[t].push(a),o.push(t)):(r[t]=[a],o.push(t));return o}String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},String.prototype.removeDot=function(){for(var e=this;e.indexOf(".")>-1;)e=e.replace(".","");return e};var f=function(){var e={};return e.mozilla=/firefox/.test(navigator.userAgent.toLowerCase()),e.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),e.opera=/opera/.test(navigator.userAgent.toLowerCase()),e.msie=/msie/.test(navigator.userAgent.toLowerCase())||!!navigator.userAgent.match(/Trident.*rv\:11\./),e},v=function(e){return void 0!==e&&null!==e},h=function(){for(var e=[],t="0123456789abcdef",a=0;a<36;a++)e[a]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var r=e.join("");return r},I=function(e){return Object.assign({},e)},S=function(e,t){for(var a in t)Object.assign(e,t[a]);return e},b=function(e,t){for(var a in t)e[a]=t[a]},L=function(e,t){return void 0!==e.find(function(e,a,r){return e===t})},T=function(e,t){return e.findIndex(function(e,a,r){return e===t})},w=function(e){return"."===e.substring(0,1)?document.getElementsByClassName(e.substring(1)):document.getElementById(e)},E=function(e,t){return e.hasOwnProperty(t)},C=function(e,t){var a=[],r=e[0],o=e[1],n=e[2],i=e[3],l=t-1,s=(n-r)/2,d=(i-o)/2,c=r-s*l,g=o-d*l,u=n+s*l,y=i+d*l;return a[0]=c,a[1]=g,a[2]=u,a[3]=y,a},k=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},x=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},P=function(e){return e===Object(e)},_=function(e,t){if(k(e)||e.length){if(e.find)return e.find(t);for(var a,r=e.length,o=0;o<r;o++)if(t(e[o])){a=e[o];break}return a}},O=function(e){var t=document.createElement("div");t.innerHTML=e;var a=t.innerText||t.textContent;return t=null,a},M=function(e){return e?JSON.parse(this.htmlDecode(JSON.stringify(e))):e},N=function(e){var t=new ol.format.WKT;if(e){var a=t.readFeature(e);return!!a.getGeometry()&&{geoType:a.getGeometry().getType(),coordinates:a.getGeometry().getCoordinates()}}},F=function(e){var t;return e instanceof Array&&e.forEach(function(e){e instanceof Array?e.forEach(function(e){t=e instanceof Array?"Polygon":"LineString"}):t="Point"}),t},A=function(e){var t="",a=0,r=e.replace(/\),\(/g,"&").replace(/\s/g,","),o=r.split(",");return o.forEach(function(e,r){e.indexOf("&")>0?(a=0,t=t+e+" "):a%2===0&&r<o.length-1?t=t+e+" ":r<o.length-1?t=t+e+",":t+=e,a++}),t=t.replace(/\&/g,"),(")},R=function(e){var t,a=new ol.format.WKT,r=F(e);if("Polygon"===r)t=new ol.Feature({geometry:new ol.geom.Polygon(e)});else{if("LineString"!==r)return!1;t=new ol.Feature({geometry:new ol.geom.LineString(e)})}var o=a.writeFeature(t);return A(o)},G=function(e,t){var a=[],r=!0,o=e,n=t,i=[],l=[];o=o.split(";"),n=n.split(";");for(var s=0;s<o.length;s++){var d=parseFloat(o[s].split(",")[0]),c=parseFloat(o[s].split(",")[1]);i.push([d,c])}for(var s=0;s<n.length;s++){var d=parseFloat(n[s].split(",")[0]),c=parseFloat(n[s].split(",")[1]);l.push([d,c])}for(var g=0;g<i.length;g++)for(var u=(g+1)%i.length,y=0;y<l.length;y++){var p=(y+1)%l.length,m=this.getCrossPoint_(i[g],i[u],l[y],l[p]);m&&a.push(m)}for(var f=0;f<i.length;f++)this.isPointInPolygon_(l,i[f])&&a.push(i[f]);for(var v=0;v<l.length;v++)this.isPointInPolygon_(i,l[v])&&a.push(l[v]);return a.length<=0&&(r=!1),r},D=function(e,t){var a=[],r=!1,o=e,n=t,i=[],l=[];o=o.split(";"),n=n.split(";");for(var s=0;s<o.length;s++){var d=parseFloat(o[s].split(",")[0]),c=parseFloat(o[s].split(",")[1]);i.push([d,c])}for(var s=0;s<n.length;s++){var d=parseFloat(n[s].split(",")[0]),c=parseFloat(n[s].split(",")[1]);l.push([d,c])}for(var g=0;g<i.length;g++)this.isPointInPolygon_(l,i[g])&&a.push(i[g]);return a.length==i.length&&(r=!0),r},j=function(e,t,a){return(e[0]-a[0])*(t[1]-a[1])-(t[0]-a[0])*(e[1]-a[1])},Y=function(e,t,a,r){var o=!1;if(e==a&&t==r||t==a||t==r||e==r||(t[1]-e[1])*(a[0]-r[0])-(a[1]-r[1])*(t[0]-e[0])==0)return o;var n=[];n.push(0),n.push(0);var i=new ol.geom.Point(n);return i[0]=((t[0]-e[0])*(a[0]-r[0])*(a[1]-e[1])-a[0]*(t[0]-e[0])*(a[1]-r[1])+e[0]*(t[1]-e[1])*(a[0]-r[0]))/((t[1]-e[1])*(a[0]-r[0])-(t[0]-e[0])*(a[1]-r[1])),i[1]=((t[1]-e[1])*(a[1]-r[1])*(a[0]-e[0])-a[1]*(t[1]-e[1])*(a[0]-r[0])+e[1]*(t[0]-e[0])*(a[1]-r[1]))/((t[0]-e[0])*(a[1]-r[1])-(t[1]-e[1])*(a[0]-r[0])),i[0]=i[0].toFixed(11),i[1]=i[1].toFixed(12),(i[0]-e[0])*(i[0]-t[0])<=0&&(i[0]-a[0])*(i[0]-r[0])<=0&&(i[1]-e[1])*(i[1]-t[1])<=0&&(i[1]-a[1])*(i[1]-r[1])<=0?o=!0:a[0]==r[0]&&a[1]!=r[1]&&e[1]==t[1]&&e[0]!=t[0]?o=!0:e[0]==r[0]&&e[1]!=r[1]&&t[1]==a[1]&&t[0]!=a[0]?o=!0:(e[0]==t[0]&&e[1]!=t[1]||e[1]==t.y&&e[0]!=t.x)&&(o=!0),n=null,o},B=function(e,t,a,r,o,n,i,l){var s,d,c,g,u,y={x:null,y:null,onLine1:!1,onLine2:!1};return s=(l-n)*(a-e)-(i-o)*(r-t),0===s?null!==y.x&&null!==y.y&&y:(d=t-n,c=e-o,g=(i-o)*d-(l-n)*c,u=(a-e)*d-(r-t)*c,d=g/s,c=u/s,y.x=e+d*(a-e),y.y=t+d*(r-t),d>=0&&d<=1&&(y.onLine1=!0),c>=0&&c<=1&&(y.onLine2=!0),!(!y.onLine1||!y.onLine2)&&[y.x,y.y])},U=function(e){var t=[];return e.forEach(function(a){e.forEach(function(e){for(var r=0;r<a.length-1;r++)for(var o=0;o<e.length-1;o++)if(a!==e||1!==Math.abs(r-o)&&Math.abs(r-o)!==a.length-2){var n=B(a[r][0],a[r][1],a[r+1][0],a[r+1][1],e[o][0],e[o][1],e[o+1][0],e[o+1][1]);n&&t.push(n)}})}),t},V=function(e,t){var a=0;if($.isArray(e)&&$.isArray(t)){var r=new ol.Sphere(GisUtil.DEF_R);a=r.haversineDistance(e,t)}return a},H=function(e,t){var a=t[0],r=t[1],o=null;o="string"==typeof e?W(e):e;for(var n=0,i=o.length,l=i-1,s=0;s<i;l=s++){if(GisUtil.EPSILON>Math.abs(o[l][0]-a)&&GisUtil.EPSILON>Math.abs(o[l][1]-r))return!0;if(z(t,o[l],o[s]))return!0;var d=o[l][0]-a,c=o[l][1]-r,g=o[s][0]-a,u=o[s][1]-r,y=Math.atan2(u,g)-Math.atan2(c,d),p=d*u-g*c;y=J(y,p),n+=y}return Math.abs(2*Math.PI-n)<GisUtil.EPSILON||Math.abs(n+2*Math.PI)<GisUtil.EPSILON},W=function(e){for(var t=e.split(";"),a=[],r=0,o=t.length-1;r<o;r++){var n=t[r];if(goog.isDefAndNotNull(n)){var i=n.split(",");a.push(i)}}return a},z=function(e,t,a){var r=e[0],o=e[1],n=t[0],i=t[1],l=a[0],s=a[1],d=Math.max(i,s),c=Math.min(i,s),g=Math.max(n,l),u=Math.min(n,l);if(o>=c&&o<=d&&r>=u&&r<=g){var y=(n-r)*(s-o)-(l-r)*(i-o);return Math.abs(y)<GisUtil.EPSILON}return!1},J=function(e,t){return e=Math.abs(e),e>Math.PI&&(e=2*Math.PI-e),t>0&&(e=0-e),e},K=function(e){var t=[],a=Z(e),r=e[0];t.push(r);for(var o,n=.01;n<=1;n+=.01)o=a(n),t.push(o);return o=a(1),r[0]==o[0]&&r[1]==o[1]||t.push(o),t},Z=function(e){function t(e){for(var t=[1,e],a=2,r=Math.floor(e/2);a<=r;a++)t[a]=t[a-1]*(e-a+1)/a;for(;a<=e;)t[a]=t[e-a++];return t}var a=e.length-1,r=t(a);return function(t){var o=a;if(1==t)return e[a];for(var n=1-t,i=Math.pow(n,o),l=t/n,s=e[0],d=s[0]*i,c=s[1]*i,g=1;g<=o;g++){i=i/r[g-1]*l*r[g];var u=e[g];d+=u[0]*i,c+=u[1]*i}return[d,c]}},q=function(e,t,a,r,o,n){var i=Math.atan(.1)/Math.PI*180,l=e+(a-e)*n,s=t+(r-t)*n,d=X(l-e,s-t,-i,o),c=l,g=s,u=l-d[0],y=s-d[1],p=X(l-e,s-t,i,o),m=l,f=s,v=l-p[0],h=s-p[1],I=[e,t],S=[a,r],b=[];b.push(I),b.push(S);var L=[c,g],T=[u,y];b.push(L),b.push(T);var w=[m,f],E=[v,h];return b.push(w),b.push(E),b},X=function(e,t,a,r){var o=[],n=e*Math.cos(a)-t*Math.sin(a),i=e*Math.sin(a)+t*Math.cos(a),l=Math.sqrt(n*n+i*i);return n=n/l*r,i=i/l*r,o[0]=n,o[1]=i,o},Q=function(e){return 0<=e&&e<90?1:90<=e&&e<180?4:180<=e&&e<270?3:270<=e&&e<360?2:void 0},ee=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml");else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}return e},te=function(e){for(var t,a,r=e.length,o=0,n=2,i="",l=0;l<r;l++)a=e.charCodeAt(l),o+=a<128?1:a<2048?2:a<65536?3:a<2097152?4:a<67108864?5:6;t=new Uint8Array(o);for(var s=0,d=0;s<o;d++)a=e.charCodeAt(d),a<128?t[s++]=a:a<2048?(t[s++]=192+(a>>>6),t[s++]=128+(63&a)):a<65536?(t[s++]=224+(a>>>12),t[s++]=128+(a>>>6&63),t[s++]=128+(63&a)):a<2097152?(t[s++]=240+(a>>>18),t[s++]=128+(a>>>12&63),t[s++]=128+(a>>>6&63),t[s++]=128+(63&a)):a<67108864?(t[s++]=248+(a>>>24),t[s++]=128+(a>>>18&63),t[s++]=128+(a>>>12&63),t[s++]=128+(a>>>6&63),t[s++]=128+(63&a)):(t[s++]=252+a/1073741824,t[s++]=128+(a>>>24&63),t[s++]=128+(a>>>18&63),t[s++]=128+(a>>>12&63),t[s++]=128+(a>>>6&63),t[s++]=128+(63&a));for(var c=t.length,g=0,s=0;s<c;s++)n=s%3,s>0&&4*s/3%76===0&&(i+="\r\n"),g|=t[s]<<(16>>>n&24),2!==n&&t.length-s!==1||(i+=String.fromCharCode(ae(g>>>18&63),ae(g>>>12&63),ae(g>>>6&63),ae(63&g)),g=0);return i.substr(0,i.length-2+n)+(2===n?"":1===n?"=":"==")},ae=function(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65},re=function(e,t){var a=e[0],r=e[1],o=t[0],n=t[1];return n>=r&&o>=a?1:n>=r&&o<a?2:n<r&&o<=a?3:n<r&&o>=a?4:void 0},W=function(e){for(var t=e.split(";"),a=[],r=0,o=t.length-1;r<o;r++){var n=t[r];if(goog.isDefAndNotNull(n)){var i=n.split(",");a.push(i)}}return a},J=function(e,t){return e=Math.abs(e),e>Math.PI&&(e=2*Math.PI-e),t>0&&(e=0-e),e},oe=function(e,t,a,r,o,n){var i=10,l=n/i,s=i*Math.PI/180,d=Math.PI/2-(o+n/2)/180*Math.PI,c=0,g=0,u=[];u.push([t,a]);for(var y=0;y<=l;++y)c=t+r*Math.cos(d),g=e?a+r*Math.sin(d)*Math.cos(a*Math.PI/180):a+r*Math.sin(d),u.push([c,g]),d+=s;return u.push([t,a]),u},ne=function(e,t,a,r,o,n){var i=Math.sqrt(Math.pow(r-t,2)+Math.pow(o-a,2)),l=i/(2*Math.sin(n/2/180*Math.PI)),s=Math.atan((o-a)/(t-r)),d=5,c=0,g=0,u=[],y=[],p=!1;if(0==n)return u.push([t,a]),u.push([r,o]),u;n>180&&(n=360-n,p=!0);var m,f=n/d,v=d*Math.PI/180,h=Math.PI/2-(s+n/2/180*Math.PI),I=Math.max(t,r);m=I==t?a:o;for(var S=I-l*Math.cos(h),b=m-l*Math.sin(h),L=0;L<=f;++L)if(c=S+l*Math.cos(h),g=b+l*Math.sin(h),p){var T=o-a,w=-(r-t),E=a*r-o*t,C=T*c+w*g+E,k=c-2*T*C/(T*T+w*w),x=g-2*w*C/(T*T+w*w);if(u.push([k,x]),h+=v,h>n/180*Math.PI+Math.PI/2-(s+n/2/180*Math.PI))break}else if(u.push([c,g]),h+=v,h>n/180*Math.PI+Math.PI/2-(s+n/2/180*Math.PI))break;if(t<r){u[0]=[r,o],u[u.length-1]=[t,a];for(var P=u.length-1;P>=0;P--)y.push(u[P]);return y}return u[0]=[t,a],u[u.length-1]=[r,o],u},ie=function(e,t,a,r){var o=[],n=[],i=[],l=null,s=e[0]-t[0],d=e[1]-t[1];if(Math.abs(s)>Math.abs(d)&&(l=s<0?8:16),l=d<0?1:4,o.push(e),a>0){var c=[];4==l||16==l?(c.push(t[0]-e[0]),c.push(t[1]-e[1])):(c.push(t[0]-e[0]),c.push(t[1]-e[1]));var g=Math.sqrt(c[0]*c[0]+c[1]*c[1]);g<=.1&&(r=.001);var u=.05,y=t[0]-e[0],p=t[1]-e[1],m=e[0]+y*u,f=e[1]+p*u,v=e[0]+y*(1-u),h=e[1]+p*(1-u),I=r*c[0]/g,S=r*c[1]/g;a%2==0?(n.push(m+a/2*(-1*S)),n.push(f+a/2*I),i.push(v+a/2*(-1*S)),i.push(h+a/2*I)):(n.push(m+a/2*S),n.push(f+a/2*(-1*I)),i.push(v+a/2*S),i.push(h+a/2*(-1*I))),o.push(n),o.push(i)}return o.push(t),o},le=function(e,t,a,r,o){var n=Math.PI/2-o/180*Math.PI,i=0,l=0;return i=t+r*Math.cos(n),l=e?a+r*Math.sin(n)*Math.sin(a*Math.PI/180):a+r*Math.sin(n),{lon:i,lat:l}},se=function(e,t,a,r,o,n){var i=[],l=a,s=a,d=n*Math.PI/180/2,c={px:e,py:t};i.push({px:c.px,py:c.py});for(var g=0;g<2*r-1;g++)g%2===0?(c.px=e+(g+1)*l*Math.cos(d)-s/2*g,c.py=t-l*Math.sin(d),i.push({px:c.px,py:c.py})):(c.px=e+(g+1)*l*Math.cos(d)-g/2*s,c.py=t-.5*s*Math.tan(d),i.push({px:c.px,py:c.py}));c.px=e+2*r*l*Math.cos(d)-(r-1)*s,c.py=t,i.push({px:c.px,py:c.py});for(var u=2*r-2;u>=0;u--)u%2===0?(c.px=e+(u+1)*l*Math.cos(d)-s/2*u,c.py=t+l*Math.sin(d),i.push({px:c.px,py:c.py})):(c.px=e+(u+1)*l*Math.cos(d)-u/2*s,c.py=t+.5*s*Math.tan(d),i.push({px:c.px,py:c.py}));for(var y,p,m=Math.PI*(.5-o/180),f=[],v=0;v<i.length;v++)y=e+(i[v].px-e)*Math.cos(m)-(i[v].py-t)*Math.sin(m),p=t+(i[v].py-t)*Math.cos(m)+(i[v].px-e)*Math.sin(m),f.push([y,p]);return f},de=function(e,t,a,r,o,n){var i=a,l=a,s=n*Math.PI/180/2,d=Math.PI*(.5-o/180),c=e+(2*r*i*Math.cos(s)-(r-1)*l)*Math.cos(d),g=t+(2*r*i*Math.cos(s)-(r-1)*l)*Math.sin(d);return{lon:c,lat:g}},ce=function(e,t,a,r,o){var n=[],i=0,l=o/180*Math.PI,s=t,d=a;n.push([s,d]);var c=0,g=0;o>=90?(i=l-.5*Math.PI,c=r*Math.cos(i)+s,g=e?d-r*Math.sin(i)*Math.cos(d*Math.PI/180):d-r*Math.sin(i)):(c=r*Math.sin(l)+s,g=e?r*Math.cos(l)*Math.cos(d*Math.PI/180)+d:r*Math.cos(l)+d);var u=0,y=0;o>=90?(i=210/180*Math.PI-l,u=s-r*Math.cos(i),y=e?d-r*Math.sin(i)*Math.cos(d*Math.PI/180):d-r*Math.sin(i)):(i=l-30/180*Math.PI,u=r*Math.cos(i)+s,y=e?d-r*Math.sin(i)*Math.cos(d*Math.PI/180):d-r*Math.sin(i)),n.push([u,y]);var p=0,m=0;o>=90?(i=210/180*Math.PI-l,p=c-r*Math.cos(i),m=e?g-r*Math.sin(i)*Math.cos(d*Math.PI/180):g-r*Math.sin(i)):(i=120/180*Math.PI-l,p=c+r*Math.sin(i),m=e?g-r*Math.cos(i)*Math.cos(d*Math.PI/180):g-r*Math.cos(i)),n.push([p,m]);var f=0,v=0;o>=90?(i=l-.5*Math.PI,f=s+2*r*Math.cos(i),v=e?d-2*r*Math.sin(i)*Math.cos(d*Math.PI/180):d-2*r*Math.sin(i)):(i=l,f=2*r*Math.sin(i)+s,v=e?2*r*Math.cos(i)*Math.cos(d*Math.PI/180)+d:2*r*Math.cos(i)+d),n.push([f,v]);var h=0,I=0;o>=90?(i=l-60/180*Math.PI,h=c+r*Math.sin(i),I=g+r*Math.cos(i),I=e?g+r*Math.cos(i)*Math.cos(d*Math.PI/180):g+r*Math.cos(i)):(h=c-r*Math.cos(30/180*Math.PI+l),I=e?g+r*Math.sin(30/180*Math.PI+l)*Math.cos(d*Math.PI/180):g+r*Math.sin(30/180*Math.PI+l)),n.push([h,I]);var S=0,b=0;return o>=90?(i=150/180*Math.PI-l,S=s+r*Math.cos(i),b=e?d+r*Math.sin(i)*Math.cos(d*Math.PI/180):d+r*Math.sin(i)):(S=c-r*Math.cos(l-30/180*Math.PI),b=e?g+r*Math.sin(l-30/180*Math.PI)*Math.cos(d*Math.PI/180):g+r*Math.sin(l-30/180*Math.PI)),n.push([S,b]),n.push([s,d]),n},ge=function(e,t,a,r,o,n){for(var i=n*Math.PI/180,l=Math.PI/2-(o+n/2)/180*Math.PI,s=0,d=0,c=[],g=0;g<2;++g)s=t+r*Math.cos(l),d=e?a+r*Math.sin(l)*Math.cos(a*Math.PI/180):a+r*Math.sin(l),c.push([s,d]),l+=i;return c.push([t,a]),c},ue=function(e,t,a,r,o,n){var i=Math.PI/2-o/180*Math.PI,l=Math.cos(n/2)*r,s=0,d=0;return s=t+l*Math.cos(i),d=e?a+l*Math.sin(i)*Math.sin(a*Math.PI/180):a+l*Math.sin(i),{lon:s,lat:d}},ye=function(e,t,a){var r=e[0][0],o=e[0][1],n=e[1][0],i=e[1][1],l=goog.isDefAndNotNull(t)?t:.2,s=goog.isDefAndNotNull(a)?a:1,d=n-r>=0?1:-1,c=Math.PI/6,g=r+(n-r)*s,u=o+(i-o)*s,y=Math.atan((i-o)/(n-r)),p=y+Math.PI-c,m=y+Math.PI+c,f=g+d*Math.cos(p)*l,v=u+d*Math.sin(p)*l,h=g+d*Math.cos(m)*l,I=u+d*Math.sin(m)*l;return[[f,v],[g,u],[h,I]]},pe=function(e,t){var a=t[0]-e[0],r=t[1]-e[1],o=0;return a>0&&r>0?o=Math.PI/2-Math.atan(r/a):a>0&&0===r?o=Math.PI/2:a>0&&r<0?o=Math.PI/2+Math.atan(Math.abs(r)/a):0===a&&r<0?o=Math.PI:a<0&&r<0?o=3*Math.PI/2-Math.atan(r/a):a<0&&0===r?o=3*Math.PI/2:a<0&&r>0?o=3*Math.PI/2+Math.atan(r/Math.abs(a)):0===a&&r>0&&(o=2*Math.PI),o},me=function(e,t,a){var r,o;return a>0&&a<Math.PI/2?(r=e[0]+Math.sin(a)*t,o=e[1]+Math.cos(a)*t):a===Math.PI/2?(r=e[0]+t,o=e[1]):a>Math.PI/2&&a<Math.PI?(r=e[0]+Math.cos(a-Math.PI/2)*t,o=e[1]-Math.sin(a-Math.PI/2)*t):a===Math.PI?(r=e[0],o=e[1]-t):a>Math.PI&&a<3*Math.PI/2?(r=e[0]-Math.cos(3*Math.PI/2-a)*t,o=e[1]-Math.sin(3*Math.PI/2-a)*t):a===3*Math.PI/2?(r=e[0]-t,o=e[1]):a>3*Math.PI/2&&a<2*Math.PI?(r=e[0]-Math.cos(a-3*Math.PI/2)*t,o=e[1]+Math.sin(a-3*Math.PI/2)*t):0!==a&&a!==2*Math.PI||(r=e[0],o=e[1]+t),[r,o]},fe=function(e,t){var a=e,r=t;a.forEach(function(e,t){if("string"==typeof e){var a=document.getElementById(e);if(!a)return;var o;o=r&&0!==r.length?document.getElementById(r[t]):document.body,a.objContainer=o,a.orig_index=a.style.zIndex}a.onmousedown=function(e){this.style.cursor="move",this.style.zIndex=1e3;var t=document;e||(e=window.event);var r=e.clientX-document.body.scrollLeft-a.offsetLeft,o=e.clientY-document.body.scrollTop-a.offsetTop;t.onmousemove=function(e){e||(e=window.event);var t=e.clientX-document.body.scrollLeft-r,n=e.clientY-document.body.scrollTop-o;t<0?t=0:t>a.objContainer.offsetWidth-a.offsetWidth&&(t=a.objContainer.offsetWidth-a.offsetWidth),n<0?n=0:n>a.objContainer.offsetHeight-a.offsetHeight&&(n=a.objContainer.offsetHeight-a.offsetHeight),a.style.left=t+"px",a.style.top=n+"px"},t.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a.style.cursor="",a.style.zIndex=a.orig_index}},a.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a.style.cursor="",a.style.zIndex=a.orig_index}})},ve=function(e,t,a,r){var o=720,n=2*Math.PI/720,i=0,l=[];if(a<r)for(var s=0;s<o;s++)i=s*n,i>=a&&i<=r&&l.push(webgis.GisUtil.calEndPointCoords(e,t,i));if(a>r){for(var d=[],c=[],g=0;g<o;g++)i=g*n,i>=a&&i<=2*Math.PI&&d.push(webgis.GisUtil.calEndPointCoords(e,t,i)),i>=0&&i<=r&&c.push(webgis.GisUtil.calEndPointCoords(e,t,i));l=d.concat(c)}return l},he=function(e,t,a,r,o){var n=null,i=null;if(o||this.IsRectCross_(e,t,a,r)){var l,s;return l=(r[0]-a[0])*(e[1]-t[1])-(t[0]-e[0])*(a[1]-r[1]),s=(e[1]-a[1])*(t[0]-e[0])*(r[0]-a[0])+a[0]*(r[1]-a[1])*(t[0]-e[0])-e[0]*(t[1]-e[1])*(r[0]-a[0]),n=s/l,l=(e[0]-t[0])*(r[1]-a[1])-(t[1]-e[1])*(a[0]-r[0]),s=t[1]*(e[0]-t[0])*(r[1]-a[1])+(r[0]-t[0])*(r[1]-a[1])*(e[1]-t[1])-r[1]*(a[0]-r[0])*(t[1]-e[1]),i=s/l,[n,i]}},Ie=function(e,t,a){var r=document.createElement("input");return r.setAttribute("type",e),r.setAttribute("value",t),r.setAttribute("id",a),r},Se={PI:3.141592653589793,x_pi:52.35987755982988,delta:function(e,t){var a=6378245,r=.006693421622965943,o=this.transformLat(t-105,e-35),n=this.transformLon(t-105,e-35),i=e/180*this.PI,l=Math.sin(i);l=1-r*l*l;var s=Math.sqrt(l);return o=180*o/(a*(1-r)/(l*s)*this.PI),n=180*n/(a/s*Math.cos(i)*this.PI),{lat:o,lon:n}},gcj_encrypt:function(e,t){if(this.outOfChina(e,t))return{lat:e,lon:t};var a=this.delta(e,t);return{lat:e+a.lat,lon:t+a.lon}},gcj_decrypt:function(e,t){if(this.outOfChina(e,t))return{lat:e,lon:t};var a=this.delta(e,t);return{lat:e-a.lat,lon:t-a.lon}},gcj_decrypt_exact:function(e,t){for(var a,r,o=.01,n=1e-9,i=o,l=o,s=e-i,d=t-l,c=e+i,g=t+l,u=0;;){a=(s+c)/2,r=(d+g)/2;var y=this.gcj_encrypt(a,r);if(i=y.lat-e,l=y.lon-t,Math.abs(i)<n&&Math.abs(l)<n)break;if(i>0?c=a:s=a,l>0?g=r:d=r,++u>1e4)break}return{lat:a,lon:r}},bd_encrypt:function(e,t){var a=t,r=e,o=Math.sqrt(a*a+r*r)+2e-5*Math.sin(r*this.x_pi),n=Math.atan2(r,a)+3e-6*Math.cos(a*this.x_pi);return bdLon=o*Math.cos(n)+.0065,bdLat=o*Math.sin(n)+.006,{lat:bdLat,lon:bdLon}},bd_decrypt:function(e,t){var a=t-.0065,r=e-.006,o=Math.sqrt(a*a+r*r)-2e-5*Math.sin(r*this.x_pi),n=Math.atan2(r,a)-3e-6*Math.cos(a*this.x_pi),i=o*Math.cos(n),l=o*Math.sin(n);return{lat:l,lon:i}},mercator_encrypt:function(e,t){var a=20037508.34*t/180,r=Math.log(Math.tan((90+e)*this.PI/360))/(this.PI/180);return r=20037508.34*r/180,{lat:r,lon:a}},mercator_decrypt:function(e,t){var a=t/20037508.34*180,r=e/20037508.34*180;return r=180/this.PI*(2*Math.atan(Math.exp(r*this.PI/180))-this.PI/2),{lat:r,lon:a}},distance:function(e,t,a,r){var o=6371e3,n=Math.cos(e*this.PI/180)*Math.cos(a*this.PI/180)*Math.cos((t-r)*this.PI/180),i=Math.sin(e*this.PI/180)*Math.sin(a*this.PI/180),l=n+i;l>1&&(l=1),l<-1&&(l=-1);var s=Math.acos(l),d=s*o;return d},outOfChina:function(e,t){return t<72.004||t>137.8347||(e<.8293||e>55.8271)},transformLat:function(e,t){var a=-100+2*e+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*this.PI)+20*Math.sin(2*e*this.PI))/3,a+=2*(20*Math.sin(t*this.PI)+40*Math.sin(t/3*this.PI))/3,a+=2*(160*Math.sin(t/12*this.PI)+320*Math.sin(t*this.PI/30))/3},transformLon:function(e,t){var a=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*this.PI)+20*Math.sin(2*e*this.PI))/3,a+=2*(20*Math.sin(e*this.PI)+40*Math.sin(e/3*this.PI))/3,a+=2*(150*Math.sin(e/12*this.PI)+300*Math.sin(e/30*this.PI))/3}},be=function(){"undefined"!=typeof Storage?this.sessionStorage=sessionStorage:console.warn("抱歉！您的浏览器不支持 Web Storage ...")};be.prototype.set=function(e,t){this.sessionStorage.setItem(e,t)},be.prototype.get=function(e){return this.sessionStorage.getItem(e)},e.exports={getBrowserType:f,isValid:v,getUUID:h,cloneObj:I,mergeObj:S,mixin:b,isInArray:L,getIndexInArray:T,getDom:w,isPropertyInObj:E,extentTimes:C,isArray:k,isFinite:x,isObject:P,find:_,getParameterString:n,sortBy:a,sortedIndex:r,flatten:o,extend:i,compact:l,last:s,groupBy:d,sortGroupBy:c,sortAsc:g,sortDesc:u,toArray:y,endsWith:p,unique:m,htmlDecode:O,objectDecode:M,getWKTFromText:N,isPolygonIntersect:G,isPolygonAInPolygonB:D,multi:j,isIntersection:Y,lineIntersects:B,polygonIntersectCount:U,calcDistanceBetweenLonLat:V,isInsidePolygon:H,isPointInLine:z,curvePoint:K,bezierCurve:Z,curveLineArr:q,isPolygonAInPolygonB:D,getAngleQuadrant:Q,createXMLHttpRequest:ee,strToBase64:te,uint6ToB64:ae,getPointQuadrant:re,parsePointStrToLocationArray:W,modifyAngle:J,getSectorArr:oe,getCurve:ne,brokenLine:ie,getSectorVertex:le,getRhombusArr:se,getRhombusVertex:de,getHexagonArr:ce,getTriangleArr:ge,getTriangleVertex:ue,getArrowCoords:ye,calAzimuthVal:pe,calEndPointCoords:me,calArcCoords:ve,getCrossPoint_:he,createInputElement:Ie,translateVertexToWKT:R,transformGPS:Se,dragBox:fe,sessionStorageObj:be}},function(e,t,a){var r=a(3),o=a(1),n=a(4),i=a(5),l=a(8),s=a(7),d=a(10),c=null,g=[],u=function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(i.createLayer(e),a=n.get(t)),c=a.getSource(),y(e)},y=function(e){var t=[],a=e.datas;l.getExtent(e.mapId);(o.isValid(a)||a.length>0)&&(a.forEach(function(e){var a=r.proj.fromLonLat(e.coordinate),o=new r.geom.Point(a),n=new r.Feature({geometry:o,businessType:s.BUSINESSTYPE.LEGEND,data:e});n.setId(e.id),n.set("legendVal",e.legendVal);var i=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new r.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});n.setStyle(i),n.set("foreverStyle",i),n.set("radius",e.radius?e.radius:5),n.set("strokeWidth",e.strokeWidth?e.strokeWidth:1),t.push(n)}),c.addFeatures(t),g=t),p(e)},p=function(e){var t=e.legendData,a=e.mapId,o=d,n=null,i=o.getDom(a).getElementsByClassName("layer_legend_container_for_one_map");i&&i.length>0?n=i[0]:(n=o.createDom({tagName:"div",attributes:{"class":"layer_legend_container_for_one_map"}}),o.getDom(a).appendChild(n));var l=o.createDom({tagName:"div",attributes:{"class":"one_legend_box_one_layer"}});if(!document.querySelector(".layer_legend_container_for_one_map").hasChildNodes("measure-close-legend")){var s=o.createDom({tagName:"div",attributes:{id:"closeEvent","class":"measure-close-legend"}});n.insertBefore(s,n.childNodes[0]),s.onclick=function(){n.style.display="none",o.getDom(a).removeChild(n)}}n.querySelector(".one_legend_box_one_layer")&&n.removeChild(n.querySelector(".one_legend_box_one_layer")),n.appendChild(l),t.forEach(function(e){var t=o.createDom({tagName:"div",attributes:{"class":"one_legend_line"}});t.style.cursor="pointer",t.id=e.val,l.appendChild(t),t.onclick=function(){var e=t.getAttribute("id");g.forEach(function(a){if(a.get("legendVal")===parseFloat(e))if(0===a.get("opacity"))a.set("opacity",1),a.setStyle(a.get("foreverStyle")),t.style.borderLeftWidth="0px",t.childNodes[0].style.backgroundColor=t.childNodes[0].id;else{a.set("opacity",0);var o=new r.style.Style({image:new r.style.Circle({radius:a.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:a.get("strokeWidth")})})});a.setStyle(o),t.style.borderLeftWidth="2px",t.style.borderLeftStyle="solid",t.style.borderLeftColor="#00BFFF",t.childNodes[0].style.backgroundColor="gray"}})};var a=o.createDom({tagName:"div"});a.style.width="8px",a.style.height="8px",a.style.marginTop="9px",a.style.marginLeft="10px",a.style.marginRight="10px",a.style.backgroundColor=e.color,a.style.borderRadius="100px",a.style.webkitBorderRadius="100px",a.style.mozBorderRadius="100px",a.id=e.color,t.appendChild(a);var n=o.createDom({tagName:"div"});n.innerHTML=e.title?e.title:e.text,t.appendChild(n)})};e.exports={addFeature:u,setLayerData:y}},function(e,t){e.exports=ol},function(e,t){var a=new Array,r=new Array,o=function(e,t){var o=!1,n=this.getIndex(e);return n==-1?(a.push(e),r.push(t),o=!0):r[n]=t,o},n=function(e){var t=!1;try{for(var o=0;o<a.length;o++)if(a[o]==e){a.splice(o,1),r.splice(o,1);break}t=!0}catch(n){t=!1}return t},i=function(e){var t=-1;try{for(var r=0;r<a.length;r++)if(a[r]==e){t=r;break}}catch(o){t=-1}return t},l=function(e){var t=!1;try{for(var r=0;r<a.length;r++)a[r]==e&&(t=!0)}catch(o){t=!1}return t},s=function(e){try{for(var t=0;t<a.length;t++)if(a[t]==e)return r[t]}catch(o){return null}},d=function(){return a.length},c=function(){return 0==a.length},g=function(){var e=!0;try{a=[],r=[]}catch(t){e=!1}return e};e.exports={put:o,remove:n,getIndex:i,containsKey:l,clear:g,get:s,size:d,isEmpty:c,keys:a,vals:r}},function(e,t,a){function r(e){if(e.layerId&&e.mapId){var t=m.getLayer(e);t.setOpacity(e.opacity),m.setEffectLayerOpacity(t,e.opacity)}}function o(e){var t=m.getLayer(e);if(t){var a=t.getSource().getFeatureById(e.geoId);if(a){t.getSource()&&t.getSource().removeFeature(a);var r=p.getLayer({mapId:e.mapId,layerId:e.layerId+"&&&highlight"});if(r&&r.getSource()){var o=r.getSource().getFeatureById(e.geoId);o&&r.getSource().removeFeature(o)}}}}function n(e){var t=d.getMapObj(e.mapId);if(!t){var a,r=D(e);return a=e.isBusiness?r.filter(function(e){return e.get("businessType")}):r,a.map(function(e){return{layerId:e.get("layerId"),visible:e.getVisible(),zIndex:e.getZIndex(),dataType:e.get("dataType"),layerType:e.get("businessType"),layerData:e.get("layerData")}})}}function i(e,t){var a=d.getMapObj(e.mapId);if(a){a.get("pointermoveKey")&&a.unByKey(a.get("pointermoveKey"));var r=a.on("pointermove",function(e){var r=a.getEventPixel(e.originalEvent),o=a.hasFeatureAtPixel(r),n=a.forEachFeatureAtPixel(e.pixel,function(e){if(o)return e});n?t&&"function"==typeof t&&t(n):t&&"function"==typeof t&&t(null)});a.set("pointermoveKey",r)}}function l(e){if(e.mapId){var t=d.getMapObj(e.mapId);t&&t.getLayers().on("change:length",function(t){e.lengthChangeCallback&&"function"==typeof e.lengthChangeCallback&&e.lengthChangeCallback({layerCount:t.target.getLength(),layerIds:function(){var a=[];return t.target.getArray()&&t.target.getArray().length>0&&t.target.getArray().forEach(function(t){a.push(t.get("layer_id")?t.get("layer_id"):void 0),t&&(t.on("change:visible",function(){e.visibleChangeCallback&&"function"==typeof e.visibleChangeCallback&&e.visibleChangeCallback(t.get("layer_id")?t.get("layer_id"):void 0)}),t.on("change:opacity",function(){e.opacityChangeCallback&&"function"==typeof e.opacityChangeCallback&&e.opacityChangeCallback(t.get("layer_id")?t.get("layer_id"):void 0)}))}),a}()})})}}var s=a(3),d=a(6),c=a(8),g=a(4),u=a(7),y=a(1),p=a(16),m=a(41),f=a(11),v=new Map,h={Point:[new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:"#319FD3"}),radius:5,stroke:new s.style.Stroke({color:"#ff0",width:1})})})],Circle:[new s.style.Style({fill:new s.style.Fill({color:"#319FD3"}),stroke:new s.style.Stroke({color:"#ff0",width:1})})],Polygon:[new s.style.Style({fill:new s.style.Fill({color:"#319FD3"}),stroke:new s.style.Stroke({color:"#ff0",width:1})})],LineString:[new s.style.Style({stroke:new s.style.Stroke({color:"#2C89E8",width:3})})],MultiPolygon:[new s.style.Style({stroke:new s.style.Stroke({color:"#2C89E8",width:3})})]},I=function(e,t){var a=e.getStyleFunction();return a?a.call(e,t):h[e.getGeometry().getType()]},S=function(e){var t=e.strokeColor,a=e.fillColor,r=e.strokeWidth;return[new s.style.Style({image:new s.style.Circle({radius:e.radius,fill:new s.style.Fill({color:a}),stroke:new s.style.Stroke({color:t,width:r})}),text:new s.style.Text({text:e.label,fill:new s.style.Fill({color:"white"})})})]},b=function(e,t){var a=e.get("features"),r=a.length,o={};return r>1?(o.radius=10*r*.4,o.label=r.toString(),o.strokeColor="white",o.strokeWidht=1*r*.4,o.fillColor="rgba(250,139,46, 0.9)"):o=a[0].get("property"),S(o)},L=function(e,t){var a=e.get("features"),r=a.length,o={};return r>1?(o.radius=15,o.label=r.toString(),o.strokeColor="white",o.strokeWidht=1*r*.4,o.fillColor="rgba(250,139,46, 0.9)"):o=a[0].get("property"),S(o)},T=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=e.isCluster,o=d.getMapObj(t),n=void 0==e.isShow||e.isShow,i=e.label?e.label:e.layerId;
if(!y.isValid(g.get(a))){var l=null;if(r){var c=new s.source.Cluster({distance:e.distance?e.distance:20,source:new s.source.Vector({wrapX:!1}),wrapX:!1});l=e.isClusterVariableSize?new s.layer.Vector({source:c,style:b}):new s.layer.Vector({source:c,style:L})}else l=new s.layer.Vector({source:new s.source.Vector({wrapX:!1}),style:I});l.set("type",u.CUSTOMTYPE.LAYERTYPE),l.set("map",o),l.set("layerId",a),l.set("params.label",i),l.set("layer_id",e.layerId),l.set("isShow",n),o.addLayer(l),g.put(a,l)}},w=function(e){var t=e.mapId,a=d.getMapObj(t),r=e.layerIds;if(a&&r&&r.length>0)for(var o=0;o<r.length;o++){var n=r[o]+"_"+t,i=g.get(n);if(i){if(i.get("mineLegendID")){var l=i.get("mineLegendID"),s=a.getTargetElement().querySelector("."+l);s&&s.parentNode&&s.parentNode.removeChild(s)}i.get("isCustomMap")&&c.destroyCustomMap(t);var u=i.get("clickId");void 0!=u&&f.removeClickCallback(t,u);var y=i.get("UIclickId");void 0!=y&&f.removeClickCallback(t,y),m.removeEffectLayer({mapId:t,layer:i}),a.removeLayer(i),g.remove(n)}}},E=function(e){var t=d.getMapObj(e.mapId),a=t.get("paramObj").UI;if(t){var r=e.layerIds;y.isValid(r)&&r.length>0&&r.forEach(function(t){var r=g.get(t+"_"+e.mapId);y.isValid(r)&&(1==a?r.set("ui_isShow",e.isShow):"discovery"==a?(r.setVisible(e.isShow),m.setEffectLayerVisible(r,e.isShow),r.set("discovery",e.isShow)):(r.setVisible(e.isShow),m.setEffectLayerVisible(r,e.isShow)))})}},C=function(e){var t=e.mapId,a=e.layerId,r=e.zIndex,o=m.getLayer({mapId:t,layerId:a});o.setZIndex(r)},k=function(e){var t=e.mapId,a=e.layerId,r=m.getLayer({mapId:t,layerId:a});return!!r&&r.getZIndex()},x=function(e){var t=e.mapId,a=e.layerId,r=!1,o=d.getMapObj(t),n=o.getLayers();return n.forEach(function(e,t,o){e.get("layerId")===a&&(r=!0)}),r},P=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=e.featureId,o=g.get(a).getSource(),n=o.getFeatureById(r);n&&o.removeFeature(n)},_=function(e){var t=e.layerId+u.Joiner.UNDERLINE+e.mapId;return e.featureId&&g.get(t).getSource().getFeatureById(e.featureId)},O=function(e){var t=e.layerId+"_"+e.mapId,a=e.callbackfunc,r=t&&g.get(t);r&&a&&(r.set("UIclickId","event_from_user_custom_"+t),f.addClickCallback(e.mapId,"event_from_user_custom_"+t,a,e.layerId))},M=function(e){var t=e.layerId+"_"+e.mapId,a=e.callbackfunc,r=t&&g.get(t);r&&a&&(r.zoomCallback=a)},N=function(e){var t=e.layerId+u.Joiner.UNDERLINE+e.mapId,a=g.get(t);e.hasOwnProperty("callbackfunc")&&a&&(a.mouseoverCallback=e.callbackfunc)},F=function(e){var t=e.layerId+u.Joiner.UNDERLINE+e.mapId,a=g.get(t);e.hasOwnProperty("callbackfunc")&&a&&(a.rightClickCallback=e.callbackfunc)},A=function(e){var t=u.LAST_CLICK_FEATURE;void 0===g.get(t)&&g.put(t,[]);var a=_(e);a&&a.getStyle()&&g.get(t).push({feature:a,style:a.getStyle()});var r=new s.style.Style({fill:new s.style.Fill({color:e.fillColor||"red"}),stroke:new s.style.Stroke({color:e.strokeColor||"yellow",width:2})});a.setStyle(r)},R=function(e){var t=e.layerId+"_"+e.mapId,a=e.featureId,r=e.opacity,o=g.get(t).getSource().getFeatureById(a),n=o.getStyle(),i=n.getFill().a,l=i.split(",");l.pop(),l.push(r);var d=l.toLocaleString()+")",c=new s.style.Style({fill:new s.style.Fill({color:d})});o.setStyle(c)},G=function(e){var t=g.get(e.layerId+"_"+e.mapId);t&&(t.refreshDataCallback=e.refreshDataCallback)},D=function(e){var t="_"+e,a=[];return g.keys.forEach(function(e){e&&y.endsWith(e,t)&&a.push(g.get(e))}),a},j=function(e){for(var t=d.getMapObj(e),a=t.getLayers(),r=a.getArray(),o=r.length,n=o-1;n>=0;n--){var i=r[n];i&&t.removeLayer(i),g.remove(i.get("layerId"))}},Y=function(e,t){var a=e.getGeometry().getType(),r=null,o=null,n=null;switch(a){case"Point":t&&t.star&&(r=new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:t.starFillColor}),radius:t.radius,stroke:new s.style.Stroke({color:t.starStrokeColor,width:t.width})})})),t&&t.now&&(o=new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:t.nowFillColor}),radius:t.radius,stroke:new s.style.Stroke({color:t.nowStrokeColor,width:t.width})})})),t&&t.end&&(n=new s.style.Style({image:new s.style.Circle({fill:new s.style.Fill({color:t.endFillColor}),radius:t.radius,stroke:new s.style.Stroke({color:t.endStrokeColor,width:t.width})})}));break;case"Polygon":t&&t.star&&(r=new s.style.Style({fill:new s.style.Fill({color:t.starFillColor}),stroke:new s.style.Stroke({color:t.starStrokeColor,width:t.width})})),t&&t.now&&(o=new s.style.Style({fill:new s.style.Fill({color:t.nowFillColor}),stroke:new s.style.Stroke({color:t.nowStrokeColor,width:t.width})})),t&&t.end&&(n=new s.style.Style({fill:new s.style.Fill({color:t.endFillColor}),stroke:new s.style.Stroke({color:t.endStrokeColor,width:t.width})}));break;case"LineString":t&&t.star&&(r=new s.style.Style({fill:new s.style.Fill({color:t.starFillColor}),stroke:new s.style.Stroke({color:t.starStrokeColor,width:t.width})})),t&&t.now&&(o=new s.style.Style({fill:new s.style.Fill({color:t.nowFillColor}),stroke:new s.style.Stroke({color:t.nowStrokeColor,width:t.width})})),t&&t.end&&(n=new s.style.Style({fill:new s.style.Fill({color:t.endFillColor}),stroke:new s.style.Stroke({color:t.endStrokeColor,width:t.width})}))}return{starStyle:r,nowStyle:o,endStyle:n}},B=function(e){var t=e.mapId,a=e.layerId,r=_({mapId:t,layerId:a,featureId:e.featureId});if(r){var o=e.timestamp||800,n=r.get("data").radius,i=e.starFillColor||"blue",l=e.nowFillColor||"red",s=e.endFillColor||"yellow",d=e.starStrokeColor||"red",c=e.nowStrokeColor||"blue",g=e.endStrokeColor||"green",y="flickerFeature_"+a+u.Joiner.UNDERLINE+t,p="feature_"+a+u.Joiner.UNDERLINE+t;v.has(y)||v.set(y,[]),v.has(p)||v.set(p,new Map);var m=setInterval(function(){var e=Y(r,{starFillColor:i,starStrokeColor:d,radius:n,width:2,star:"star"}).starStyle,t=Y(r,{nowFillColor:l,nowStrokeColor:c,radius:n,width:2,now:"now"}).nowStyle,a=Y(r,{endFillColor:s,endStrokeColor:g,radius:n,width:2,end:"end"}).endStyle,o="customStyle",u=r.get(o);u===s?(r.setStyle(t),r.set(o,l)):u===l?(r.setStyle(e),r.set(o,i)):(r.setStyle(a),r.set(o,s))},o);return v.get(y).push(m),v.get(p).set(m,r),m}},U=function(e){var t=e.layerId,a=e.mapId,r="flickerFeature_"+t+"_"+a,o="feature_"+t+"_"+a,n=function(e){var t=v.get(o).get(e),a=t.get("defaultStyle");t.setStyle(a)};v.get(r).length&&(e.intervals&&e.intervals.length>0?v.get(r).forEach(function(t){e.intervals.forEach(function(e){e===t&&(clearInterval(t),n(t))})}):v.get(r).forEach(function(e){clearInterval(e),n(e)}))},V=function(e){e&&e.getSource()&&e.getSource().clear()},H=function(e){var t=(e.mapId,e.layerId,e.minShowLevel),a=e.maxShowLevel,r=m.getLayer(e);void 0!=r&&(void 0!=t&&r.set("minShowLevel",parseInt(t)),void 0!=a&&r.set("maxShowLevel",parseInt(a)))};e.exports={createLayer:T,removeLayer:w,getLayer:m.getLayer,setVisible:E,setLayerOpacity:r,setLayerZIndex:C,getLayerZIndex:k,isLayerExist:x,getLayers:D,getLayersInfo:n,clearLayers:j,removeGeometry:o,setLayerVisibleLevel:H,removeFeatureById:P,clearFeatureOnLayer:V,clearFeatureFlicker:U,getFeatureById:_,setGeometryOpacity:R,highLight:A,flickerFeature:B,registerClick:O,registerMove:G,registerZoom:M,registerMouseHover:N,registerRightClick:F,registerMouseEvent:i,registerLayerChange:l}},function(e,t,a){var r=a(4),o=a(7),n=a(3),i=function(e){var t=r.get(e);return t&&t instanceof n.Map?t:void 0},l=function(e,t){var a=r.get(e),i=a.getView().calculateExtent(a.getSize());return t?n.proj.transformExtent(i,o.PROJ.EPSG_3857,o.PROJ.EPSG_4326):i};e.exports={getMapObj:i,getExtent:l}},function(e,t){var a={OSM_MAP:"OSM_MAP",HUAWEI_MAP:"HUAWEI_MAP",BING_MAP:"BING_MAP",GOOGLE_MAP:"GOOGLE_MAP",WMS_MAP:"WMS_MAP",ARCGISTILE_LAYER:"ARCGISTILE_LAYER",NAVER_MAP:"NAVER_MAP",TIANDI_MAP:"TIANDI_MAP",BAIDU_MAP:"BAIDU_MAP",GOOGLE_ROAD_MAP:"GOOGLE_ROAD_MAP",GAODE_MAP:"GAODE_MAP",YAHOO_MAP:"YAHOO_MAP",OFFLINE_MAP:"OFFLINE_MAP"},r={EPSG_4326:"EPSG:4326",EPSG_3857:"EPSG:3857"},o={SCALELINE:"scaleLine",MOUSEPOSITION:"mousePosition",ZOOMCONTENT:"zoomContent",OVERVIEWMAP:"overviewMap"},n={DEFAULT_PROJECTION:"EPSG:3857",DEFAULT_UNITS:"metric",DEFAULT_ZOOM:10,DEFAULT_MIN_ZOOM:0,DEFAULT_MAX_ZOOM:17,DEFAULT_CENTER:[116.38229370117188,39.90868283513285]},i="lastClickFeature",l={BUBBLE:"BUBBLE",BUBBLE_CIRCLE:"BUBBLE_CIRCLE",BUBBLE_CIRCLE_LABEL:"BUBBLE_CIRCLE_LABEL",POINTER_CLUSTER:"POINTER_CLUSTER",TRACK_SHOW:"TRACK_SHOW",TRACK_SHOW_LINE:"TRACK_SHOW_LINE",ICON:"ICON",ICONWITH2LABEL:"ICONWITH2LABEL",ICON2LABEL:"ICON2LABEL",VECTOR_CELL:"VECTOR_CELL",LEGEND:"LEGEND",LEGEND_RANGE:"LEGEND_RANGE",LEGEND_SLIDER:"LEGEND_SLIDER",ADMIN_REGION:"ADMIN_REGION",CELLSITE:"CELLSITE",CELL:"CELL",GRID:"GRID",CIRCLEPOINT:"CIRCLEPOINT",MARKPOINT:"MARKPOINT",LINE:"LINE",POLYGON:"POLYGON",DPOLYGON:"DPOLYGON",SITE:"SITE",POINT:"POINT",SERVICEPOLYGON:"SERVICEPOLYGON",SERVICEPOINT:"SERVICEPOINT",SERVICELINE:"SERVICELINE",HEAT_MAP:"HEAT_MAP",STRAIGHTLINE:"STRAIGHTLINE",BEZIERLINE:"BEZIERLINE",ICON_FONT_STYLE:"ICON_FONT_STYLE",BUBBLE_CIRCLE_LABEL:"BUBBLE_CIRCLE_LABEL",DLINE:"DLINE",DPOINT:"DPOINT",DCELL:"DCELL",MULTIPOINT:"MULTIPOINT"},s={MAPTYPE:"ol.Map",LAYERTYPE:"ol.layer.Vector",LAYERTILETYPE:"ol.layer.Tile",LAYERIMGTYPE:"ol.layer.Image",LAYERHEATTYPE:"ol.layer.Heatmap",SOURCETYPE:"ol.source.Vector"},d={EN:"en",ZH:"zh",ES:"es"},c={POINT:"POINT",LINE:"LINE",POLYGON:"POLYGON"},g={OSM:"OSM",GOOGLE:"GOOGLE"},u={BASELAYER:0,GRID:100,POLYGON:300,CELL:400,SITE:450,RADAR:500,TEMPPOLYGON:600,LINE:800,LANDMARKER:850,ROUTEPOINT:900,MARKER:1e3},y="/fusiongisaccess",p={IMGTOKENURL:y+"/gridManager/getImgToken",EXPORTURL:y+"/gridManager/export",GET_GRIDINFO:y+"/gridManager/getGridInfo",QUERY_GRIDINFO:y+"/gridManager/queryGridInfo",MAPRENDER_EXPORT:y+"/mapRender/export"},m={GET_FEATURE_INFO:y+"/custommap/v1/getfeatureinfo",GET_LAYER_INFO:y+"/custommap/v1/getlayerinfo",GET_ATTR_INFO:y+"/customMap.do",GET_COMMON_LAYER_INFO:y+"/resource/v1/getspatialdatalist",GET_ATTR_IN_COMMON_LAYER:y+"/spatialdata/v1/queryFieldsInfo",GET_FEATURE_IN_COMMON_LAYER:y+"/spatialdata/v1/Query"},f={GET_THIESSEN_POLYGONLAYER_INFO:y+"/spatialdata/v1/Query"},v={CLICK:"click",SINGLE:"single",MULlTI:"multi",VECTOR:"vector",SERVICE:"service"},h={NE:["CELL","SITE"]},I={UNDERLINE:"_",SHORT_TERM:"-"},S={CELL:0,SITE:0,POLYGON:0,GRID:0,HEAT_MAP:0},b={HYBRID:"hybrid",ROADMAP:"roadmap",SATELLITE:"satellite",TERRAIN:"terrain"},L={ROAD:"Road",AERIAL:"Aerial",AERIALWITHLABELS:"AerialWithLabels",BIRDSEYE:"Birdseye",BIRDSEYEWITHLABELS:"BirdseyeWithLabels",COLLINSBART:"CollinsBart",ORDNANCESURVEY:"OrdnanceSurvey"};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame,e.exports={MAPTYPE:a,PROJ:r,CONTROL_TYPE:o,MAPPROPERTY:n,LAST_CLICK_FEATURE:i,BUSINESSTYPE:l,CUSTOMTYPE:s,I18N:d,LAYERTYPE:c,Search_Engine:g,Z_INDEX:u,URL:p,HTYPE:v,GisRootUrl:y,layerGroup:h,Joiner:I,DefaultLayerVisibleLevel:S,CustomQuery:m,PolygonQuery:f,GoogleMapTypes:b,BingMapTypes:L,GisResourceURL:function(){var e=function(e){var t=document.createElement("div");t.innerHTML=e;var a=t.innerText||t.textContent;return t=null,a},t=document.scripts;return t=t[t.length-1].src.substring(0,t[t.length-1].src.lastIndexOf("/")+1),e(t+"resources/imgs/")}(),GlobalVariable:{}}},function(e,t,a){function r(e){var t=null,a=e.mapId,r=e.layerId,o=e.mapType,c=e.url,g=e.key,u=e.mapName,y=e.layers,p=e.version,m=e.language,I=e.controls,S=e.controlStyles||{scaleLine:"vGisWeb_scale-line-gis",mousePosition:"vGisWeb_mouse-position-gis"},T=e.isMapCutting,Y=e.initCallback,V=function(t){var a=[];for(var r in t){var o=S[r];if("overviewMap"!=r){var n=L[r](o,e.overViewMapTipLabel,e);a.push(n)}}return a}(I);if(!v.containsKey(a)){var H=w.createView(e);if(t=new f.Map({renderer:"canvas",target:a,view:H,controls:f.control.defaults({zoomOptions:{className:"vGisWeb_olZoom_custom",zoomInTipLabel:fusiongis.I18n.prop("map.zoomIn"),zoomOutTipLabel:fusiongis.I18n.prop("map.zoomOut")},attributionOptions:{collapsible:!0}}).extend(V),loadTilesWhileInteracting:!1,loadTilesWhileAnimating:!1})){t.set("mineView",H),t.set("type",h.CUSTOMTYPE.MAPTYPE),t.set("currentMapType",o),t.set("paramObj",e),(new B.sessionStorageObj).set("currentMapType",o),v.put(a,t);var W=t.getTargetElement();W&&W.setAttribute("class",W.className+" map_background"),Y&&"function"==typeof Y&&Y(),d(a,e),t.getLayers().on("change:length",function(e){e.target.getArray()&&e.target.getArray().length>0&&e.target.getArray().forEach(function(e){e&&e.on("change:visible",function(){var a=e.getVisible(),r=e.get("layer_id"),o=r+"&&&highlight",n=U.getLayer({mapId:t.getTarget(),layerId:o});void 0!=n&&null!=n&&n.setVisible(a)})})})}if(t=v.get(a)){var z="base_layer";switch(o){case h.MAPTYPE.OSM_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,x.createLayer({mapId:a,layerId:r,layer_id:z}));break;case h.MAPTYPE.HUAWEI_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,_.createLayer({mapId:a,url:c,key:g,layerId:r,layer_id:z}));break;case h.MAPTYPE.WMS_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,O.createLayer({mapId:a,url:c,layers:y,version:p,layerId:r,layer_id:z,mapName:u,title:e.title||"",isMapCutting:T}));break;case h.MAPTYPE.BING_MAP:t.getLayers().insertAt(0,P.createLayer({mapId:a,key:g,layerId:r,layer_id:z,layers:y})),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.BING_MAP,bingMapKey:g});break;case h.MAPTYPE.GOOGLE_MAP:g?C.loadGoogleAPI(g,m,function(a){a&&(window.sessionStorage&&sessionStorage.setItem("key",g),C.createCustomMap(e),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GOOGLE_MAP,bingMapKey:void 0}))}):console.error("load google api failed...");break;case h.MAPTYPE.NAVER_MAP:t.getLayers().insertAt(0,M.createLayer({mapId:a,layerId:r,layer_id:z}));break;case h.MAPTYPE.TIANDI_MAP:var J=fusiongis.BaseLayer.getLayer({mapId:a,layerId:z+"_marker"});J&&J instanceof f.layer.Tile&&t.removeLayer(J),t.getLayers().insertAt(0,N.createRoadLayer({mapId:a,layerId:z,layer_id:z})),t.getLayers().insertAt(1,N.createMarkerLayer({mapId:a,layerId:z+"_marker",layer_id:z+"_marker"})),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.TIANDI_MAP});break;case h.MAPTYPE.BAIDU_MAP:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.BAIDU_MAP}),t.getLayers().insertAt(0,F.createLayer({mapId:a,layerId:r,layer_id:z}));break;case h.MAPTYPE.GOOGLE_ROAD_MAP:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GOOGLE_ROAD_MAP}),t.getLayers().insertAt(0,A.createLayer({mapId:a,layerId:r,layer_id:z}));break;case h.MAPTYPE.GAODE_MAP:g?k.loadGaodeAPI(g,m,function(a){a&&(window.sessionStorage&&sessionStorage.setItem("key",g),k.createCustomMap(e),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GAODE_MAP,gaodeMapKey:g}))}):console.error("load gaode api failed...");break;case h.MAPTYPE.YAHOO_MAP:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.YAHOO_MAP}),t.getLayers().insertAt(0,R.createLayer({mapId:a,layerId:r,layer_id:z}));break;case h.MAPTYPE.ARCGISTILE_LAYER:t.getLayers().insertAt(0,G.createArcgisTileLayer({mapId:a,layerId:r,layer_id:z,url:c})),E.mapTypeToolbar({mapObj:t});break;default:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.OSM_MAP}),t.getLayers().insertAt(0,x.createLayer({mapId:a,layer_id:z,layerId:r}))}q(e),n(a),b.mapClick(a,e),d(a,e),s(a),b.zoomChangeEvent(t),b.centerChangeEvent(t),void 0==I||I.hasOwnProperty("overviewMap")||j.monitorLayers(e),t.set("statistics",{}),Z(e,t),i(a),l(a),t.addLayer(new f.layer.Vector({source:new f.source.Vector({wrapX:!1})})),t&&void 0!=I&&I.hasOwnProperty("overviewMap")&&setTimeout(function(){D.addMinMap(e)},3e3)}}}function o(e){var t=e.mapId,a=S.getMapObj(t);if(a.get("customMap")){a.unset("customMap");var r=a.get("customCenterKey"),o=a.get("customResolutionKey");r&&a.unByKey(r),o&&a.unByKey(o)}var n=document.getElementById("$$customMap_"+t);n&&n.parentNode&&n.parentNode.removeChild(n)}function n(e){var t=v.get(e),a=new H.mouseHoverHeartBeat,r=new B.sessionStorageObj;t.on("pointermove",function(o){var n=t.getEventPixel(o.originalEvent),i=t.hasFeatureAtPixel(n);document.getElementById(e).style.cursor=i?"pointer":"";var l=o.coordinate;if(H.isServiceLayer(t))return I.removeSuspensionPopup(e),void a.beat(t,n,e);var s=t.forEachFeatureAtPixel(n,function(e,t){if(i)return e});if(s){if(void 0===r.get(e+"vectorFeature"))r.set(e+"vectorFeature",s);else if(void 0!==r.get(e+"vectorFeature")){if(r.get(e+"vectorFeature")===s)return;r.set(e+"vectorFeature",s)}var d,c=s.get("features");if(d=c&&c instanceof Array&&1===c.length?c[0].get("layer"):s.get("layer"),d&&d.hasOwnProperty("mouseoverCallback")&&"function"==typeof d.mouseoverCallback){var g=s.getGeometry().getExtent(),u=f.extent.getCenter(g),y=null,p=!1;if(s.set("eCoordinates",f.proj.toLonLat(l)),s.get("data"))y=s.get("data");else{var m=s.get("features");m&&(m.lenght>1&&(p=!0),y=m[0].get("data"))}d.get("layerId")&&d.get("layerId").indexOf("&&&highlight")>-1?(d.mouseoverCallback({centerCoordinate:u,lonLat:f.proj.toLonLat(u),mapId:e,layerId:d.get("layerId").replace(/&&&highlight/g,""),eCooordinate:s.get("eCoordinates"),tipCoordinates:s.get("tipCoordinates"),infor:y,position:f.proj.toLonLat(u)}),W.set("lastMouseOverFeature",s.getId())):(I.removeSuspensionPopup(e),W.set("lastMouseOverFeature",null)),v.keys.filter(function(e){return!!e&&e.indexOf(t.getTarget())===e.length-t.getTarget().length}).forEach(function(t){var a=v.get(t);if(a&&a instanceof f.layer.Layer){var r=a;if(r.hasOwnProperty("mouseoverCallback")&&"function"==typeof r.mouseoverCallback){var o=r.get("layerId"),n=t.substr(0,t.length-(e.length+1));if(r.getSource()&&r.getSource().getFeatures()){var i=r.getSource().getFeatures();if(i.length>0)for(var l=0;l<i.length;l++){var d={centerCoordinate:u,lonLat:f.proj.toLonLat(u),mapId:e,layerId:n,eCooordinate:s.get("eCoordinates"),tipCoordinates:s.get("tipCoordinates"),infor:y,isCluster:p,position:f.proj.toLonLat(u)},c=s.get("features");if(c&&c instanceof Array&&1===c.length&&c[0].get("layer").get("layerId")===o)return r.mouseoverCallback(d),void W.set("lastMouseOverFeature",s.getId());if(!c&&i[l].getId()===s.getId()&&s.get("layer").get("layerId")===o){if(W.get("lastMouseOverFeature")===s.getId())return;r.mouseoverCallback(d),W.set("lastMouseOverFeature",s.getId())}}}}}})}else I.removeSuspensionPopup(e),W.set("lastMouseOverFeature",null)}else I.removeSuspensionPopup(e),W.set("lastMouseOverFeature",null)})}function i(e){var t=v.get(e);if(t){var a=[];t.on("pointerdrag",function(r){for(var o=function(){var e=[];return v.vals.forEach(function(t,a){t instanceof f.Map&&e.push(v.keys[a])}),e}(),n=0;n<o.length;n++)v.keys.filter(function(e){e&&e.indexOf(o[n])===e.length-o[n].length&&a.push(e)});a.forEach(function(a){var r=v.get(a),o=v.get("nowLink");if((o!==!1&&void 0!==o||a.indexOf(e)!==-1)&&r&&r instanceof f.layer.Layer&&r.get("businessType")){var n=r.get("businessType");n===h.BUSINESSTYPE.VECTOR_CELL&&"GOOGLE_MAP"===t.get("currentMapType")&&r.get("hideWhenPan")&&r.setVisible(!1)}})})}}function l(e){var t=v.get(e);if(t){var a=[];t.on("pointerup",function(e){var r=function(){var e=[];return v.vals.forEach(function(t,a){t instanceof f.Map&&e.push(v.keys[a])}),e}();setTimeout(function(){for(var e=0;e<r.length;e++)v.keys.filter(function(t){t&&t.indexOf(r[e])===t.length-r[e].length&&a.push(t)});a.forEach(function(e){var a=v.get(e);if(a&&a instanceof f.layer.Layer&&a.get("businessType")){var r=a.get("businessType");if(r===h.BUSINESSTYPE.VECTOR_CELL&&"GOOGLE_MAP"===t.get("currentMapType")&&a.get("hideWhenPan")){a.setVisible(!0);var o=t.getView().getCenter();o=f.proj.toLonLat(o);var n=[o[0]+1e-10,o[1]+1e-10];n=f.proj.fromLonLat(n),t.getView().setCenter(n)}}})},800)})}}function s(e){var t=v.get(e);if(t){var a=t.getSize(),r=t.getView(),o=t.get("paramObj");t.on("moveend",function(){var n=r.calculateExtent(a);f.proj.transformExtent(n,h.PROJ.EPSG_3857,h.PROJ.EPSG_4326);v.keys.filter(function(t){return!!t&&t.indexOf(e)===t.length-e.length}).forEach(function(e){var a=v.get(e);if(a&&a instanceof f.layer.Layer&&(m(t,a),a.get("businessType"))){var r=a.get("businessType");if(r===h.BUSINESSTYPE.VECTOR_CELL){var o=a.get("layer_id"),n=t.getTarget(),i=a.get("noChangeRadius");i&&(fusiongis.Cell.clear({mapId:n,layerId:o}),a.get("datas")&&fusiongis.Cell.setLayerData({mapId:n,layerId:o,datas:a.get("datas"),noChangeRadius:i}))}else if("BUBBLE_CIRCLE_LABEL"===r){var l=a.get("isRadiuChange");if(l){fusiongis.BubbleCircleLabel.clear({mapId:t.getTarget(),layerId:a.get("layer_id")});var s=a.get("datas"),o=a.get("layer_id"),d=a.get("tipAzimth"),c=a.get("isDis");a.get("datas")&&fusiongis.BubbleCircleLabel.setLayerData({mapId:t.getTarget(),layerId:o,datas:s,isRadiuChange:l,tipAzimth:d,isDis:c}),fusiongis.BubbleCircleLabel.zoomChangeHightlight({mapId:t.getTarget(),layerId:o+"&&&highlight"})}}}}),v.keys.filter(function(t){return!!t&&t.indexOf(e)===t.length-e.length}).forEach(function(e){var a=v.get(e);if(a&&a instanceof f.layer.Layer){var r=a.get("businessType");if(void 0!=r&&o.multiple&&a.hasOwnProperty("refreshDataCallback")&&"function"==typeof a.refreshDataCallback){var i=a.get("multiple"),l=t.getView().getZoom(),s=a.get("minShowLevel"),d=a.get("maxShowLevel");i&&s<=l&&d>=l&&X({mapObj:t,layer:a,extent3857:n,multiple:i||1})}}}),t.set("lastZoom",r.getZoom())})}}function d(e,t){var a=v.get(e);if(a){var r=a.getSize(),o=document.querySelector("#"+e).querySelector(".vGisWeb_olZoom_custom");if(o){var n=document.querySelector("#"+e).querySelector(".vGisWeb_custom_zoom_ctrl");if(!n){var i=Y.createDom({tagName:"div",attributes:{"class":"vGisWeb_custom_zoom_ctrl"},text:ee(e)});o.insertBefore(i,o.childNodes[0])}var l=a.getView(),s=l.get("linkedMapIds");l&&l.on("change:resolution",function(t){var a=l.calculateExtent(r),o=f.proj.transformExtent(a,h.PROJ.EPSG_3857,h.PROJ.EPSG_4326);if(s.length>0)for(var n=0;n<s.length;n++){var i=document.querySelector("#"+s[n]).querySelector(".vGisWeb_custom_zoom_ctrl");i&&(i.innerHTML=l.getZoom())}else{var d=document.querySelector("#"+e).querySelector(".vGisWeb_custom_zoom_ctrl");d&&(d.innerHTML=l.getZoom())}v.keys.filter(function(t){return!!t&&t.indexOf(e)===t.length-e.length}).forEach(function(t){var a=v.get(t);if(a&&a instanceof f.layer.Layer){if(a.get("businessType")){var r=a.get("businessType");if(r===h.BUSINESSTYPE.VECTOR_CELL){var n=a.get("layer_id"),i=a.get("noChangeRadius");i&&(fusiongis.Cell.clear({mapId:e,layerId:n}),a.get("datas")&&fusiongis.Cell.setLayerData({mapId:e,layerId:n,datas:a.get("datas"),noChangeRadius:i}))}r===h.BUSINESSTYPE.STRAIGHTLINE&&fusiongis.LineAdd.setNewCoordinate(a,e)}a.hasOwnProperty("zoomCallback")&&"function"==typeof a.zoomCallback&&a.zoomCallback({extent:o,zoom:l.getZoom()})}})})}}}function c(e){var t=e.mapId,a=S.getMapObj(t),r=a.get("paramObj");if(e=B.extend({},r,e),r.mapType===e.mapType){if(e.mapType===h.MAPTYPE.BING_MAP){var o="base_layer";U.removeLayer({mapId:t,layer_id:o});var n=P.createLayer({mapId:t,layerId:e.layerId,layer_id:o,key:e.key,layers:e.layers});a.addLayer(n)}e.mapType===h.MAPTYPE.GOOGLE_MAP&&C.updateCustomMap(e),e.mapType===h.MAPTYPE.GAODE_MAP&&k.updateCustomMap(e)}}function g(e){var t=v.keys,a=[];return t.forEach(function(t){var r=v.get(t);r instanceof f.Map&&("map"!==e&&e?"id"===e&&a.push(t):a.push(r))}),a}function u(e){var t=fusiongis.HashMap.containsKey(e);return t}function y(e){var t=document.getElementById(e.mapId),a=t.getElementsByTagName("div");for(var r in a)if("vGisWeb_olZoom_custom ol-unselectable ol-control"==a[r].className)var o=a[r];e.showZoom?o.style.display="block":o.style.display="none"}function p(e,t){var a=document.getElementById(e),r=a.getElementsByClassName("map_type_toolbar_container")[0];t?r.style.display="block":r.style.display="none"}function m(e,t){var a=t.get("isShow"),r=t.get("ui_isShow"),o=e.get("paramObj").UI,n=t.get("discovery"),i=t.get("layerManagerCheckBoxClick"),l=e.getView().getZoom();if(void 0!=i){if(t.setVisible(i),0==i){if(0==r){if(e.getTargetElement()){var s=e.getTargetElement().querySelectorAll(".vGisWeb_component .layerItem");if(s&&s.length>0)for(var d=0;d<s.length;d++){var c=s[d],g=!!c&&c.querySelectorAll(".visible_check")[0];t.get("layer_id")===g.layerId&&(c.querySelectorAll(".visible_check")[0].checked=r)}}return}return}}else if(void 0!=a){if(t.setVisible(a),"discovery"==o&&0==n)return void t.setVisible(!1);if(!a){if(e.getTargetElement()){var s=e.getTargetElement().querySelectorAll(".vGisWeb_component .layerItem");if(s&&s.length>0)for(var d=0;d<s.length;d++){var c=s[d],g=!!c&&c.querySelectorAll(".visible_check")[0];t.get("layer_id")===g.layerId&&(c.querySelectorAll(".visible_check")[0].checked=a)}}return}}if(void 0==r){if("discovery"!=o||0!=n){var u=0,y=function(e){var t=h.MAPPROPERTY.DEFAULT_MAX_ZOOM;return void 0!=e.get("paramObj").maxZoom&&(t=parseInt(e.get("paramObj").maxZoom)),t}(e),p=!1;if(u=isNaN(t.get("minShowLevel"))||void 0==t.get("minShowLevel")?h.MAPPROPERTY.DEFAULT_MIN_ZOOM:t.get("minShowLevel"),y=isNaN(t.get("maxShowLevel"))||void 0==t.get("maxShowLevel")?y:t.get("maxShowLevel"),u<=l&&l<=y&&(p=!0),t.setVisible(p),"discovery"!=o&&e.getTargetElement()){var s=e.getTargetElement().querySelectorAll(".vGisWeb_component .layerItem");if(s&&s.length>0)for(var d=0;d<s.length;d++){var c=s[d],g=!!c&&c.querySelectorAll(".visible_check")[0],m=g.layerId,f=c.querySelectorAll(".visible_check")[0].checked,v=t.get("minShowLevel"),I=t.get("maxShowLevel");t.get("layer_id")===m&&(void 0==v&&void 0==I||isNaN(v)&&isNaN(I)?0==f&&t.setVisible(!1):c.querySelectorAll(".visible_check")[0].checked=p)}}}}else if(t.setVisible(r),e.getTargetElement()){var s=e.getTargetElement().querySelectorAll(".vGisWeb_component .layerItem");if(s&&s.length>0)for(var d=0;d<s.length;d++){var c=s[d],g=!!c&&c.querySelectorAll(".visible_check")[0];t.get("layer_id")===g.layerId&&(c.querySelectorAll(".visible_check")[0].checked=r)}}}var f=a(3),v=a(4),h=a(7),I=a(9),S=a(6),b=a(11),L=a(19),T=a(20),w=a(22),E=a(23),C=a(24),k=a(26),x=a(27),P=a(28),_=a(29),O=a(30),M=a(31),N=a(32),F=a(33),A=a(34),R=a(35),G=a(36),D=a(37),j=a(39),Y=a(10),B=a(1),U=a(16),V=a(14),H=a(63),W=new Map,z=function(e){var t=h.MAPTYPE.OSM_MAP;V.postJSON({url:fusiongis.Constant.GisRootUrl+"/mapCfgView.do",data:JSON.stringify({subject:{param:{},formatter:{date:""}},services:[{name:"getMapSource",param:{}}]}),success:function(a){if(a){var o=JSON.parse(a);if(o&&1===o.status.code&&o.data){var n=o.data,i=n.mapFormat,l=B.htmlDecode(n&&n.mapService),s=B.htmlDecode(n&&n.mapService),d=n&&n.mapLayer,c=B.htmlDecode(n&&n.mapName),g=!1;3===i||4===i||5===i||9===i||20===i?(t=h.MAPTYPE.WMS_MAP,n.tileStatus&&1===n.tileStatus&&(g=!0)):t=101===n.mapFormat?h.MAPTYPE.OSM_MAP:102===n.mapFormat?h.MAPTYPE.GOOGLE_MAP:103===n.mapFormat?h.MAPTYPE.BING_MAP:105===n.mapFormat?h.MAPTYPE.HUAWEI_MAP:106===n.mapFormat?h.MAPTYPE.TIANDI_MAP:107===n.mapFormat?h.MAPTYPE.ARCGISTILE_LAYER:h.MAPTYPE.OSM_MAP,20===n.mapFormat?(s=fusiongis.Constant.GisRootUrl+"/offlineMap/customServer?MAPNAME="+c+"&LAYERS="+d,g&&(s="/fusiongisaccess/offlineMap/service/tms/1.0.0/"+n.mapName+"/@900913/{z}/{x}/{-y}.png?mapName="+n.mapName)):3===n.mapFormat?(s=fusiongis.Constant.GisRootUrl+"/offlineMap/planetServer",c=void 0):4===n.mapFormat?(s=fusiongis.Constant.GisRootUrl+"/offlineMap/shapeServer",c=void 0):5===n.mapFormat?(s=fusiongis.Constant.GisRootUrl+"/offlineMap/RailwayServer",c=void 0):9===n.mapFormat&&(s=fusiongis.Constant.GisRootUrl+"/offlineMap/customMap?MAPNAME="+c+"&LAYERS="+d);var u=e.defaultZoom;void 0!=n&&void 0!=n.centerPoint&&(u=void 0!=n.centerPoint.zoom?n.centerPoint.zoom:void 0),r({mapId:e.mapId,layerId:e.layerId,center:void 0!=n?void 0!=n.centerPoint?[n.centerPoint.longitude,n.centerPoint.latitude]:e.center:void 0,defaultZoom:u,minZoom:e.minZoom,maxZoom:e.maxZoom,mapType:t,url:void 0!=e.url?e.url:s,key:void 0!=e.key?e.key:l,layers:void 0!=e.layers?e.layers:d,mapName:void 0!=e.mapName?e.mapName:c?c:void 0,version:e.version?e.version:"1.1.1",language:e.language?e.language:"zh-CH",linkage:!!e.linkage&&e.linkage,controls:e.controls?e.controls:void 0,controlStyles:e.controlStyles?e.controlStyles:void 0,initCallback:e.initCallback?e.initCallback:void 0,rightClickCallback:e.rightClickCallback?e.rightClickCallback:void 0,isMapCutting:g})}else{var u=e.defaultZoom;if(void 0!=o.data){var n=o.data;void 0!=n.centerPoint&&(u=void 0!=n.centerPoint.zoom?n.centerPoint.zoom:void 0),r({mapId:e.mapId,layerId:e.layerId,center:void 0!=n?void 0!=n.centerPoint?[n.centerPoint.longitude,n.centerPoint.latitude]:e.center:void 0,defaultZoom:u,minZoom:e.minZoom,maxZoom:e.maxZoom,mapType:e.mapType?e.mapType:h.MAPTYPE.OSM_MAP,url:e.url?e.url:void 0,key:e.key?e.key:void 0,layers:e.layers?e.layers:[],mapName:void 0!=e.mapName?e.mapName:c?c:void 0,version:e.version?e.version:"1.1.1",language:e.language?e.language:"zh-CH",linkage:!!e.linkage&&e.linkage,controls:e.controls?e.controls:void 0,controlStyles:e.controlStyles?e.controlStyles:void 0,initCallback:e.initCallback?e.initCallback:void 0,rightClickCallback:e.rightClickCallback?e.rightClickCallback:void 0})}}}},failure:function(t){r({mapId:e.mapId,layerId:e.layerId,center:e.center,defaultZoom:e.defaultZoom,minZoom:e.minZoom,maxZoom:e.maxZoom,mapType:e.mapType?e.mapType:h.MAPTYPE.OSM_MAP,url:e.url?e.url:void 0,key:e.key?e.key:void 0,layers:e.layers?e.layers:[],mapName:void 0!=e.mapName?e.mapName:void 0,version:e.version?e.version:"1.1.1",language:e.language?e.language:"zh-CH",linkage:!!e.linkage&&e.linkage,controls:e.controls?e.controls:void 0,controlStyles:e.controlStyles?e.controlStyles:void 0,initCallback:e.initCallback?e.initCallback:void 0,rightClickCallback:e.rightClickCallback?e.rightClickCallback:void 0})}})},J=function(e){V.postJSON({url:fusiongis.Constant.GisRootUrl+"/mapCfgView.do",data:JSON.stringify({subject:{param:{},formatter:{date:""}},services:[{name:"mapSourceList",param:{}}]}),success:function(t){if(t){var a=JSON.parse(t),r=[],o=null;if(a&&1===a.status.code&&a.data){for(var n=a.data.mapSourceList,i=0;i<n.length;i++){var l=n[i],s=l.mapFormat,d=B.htmlDecode(l&&l.mapService),c=B.htmlDecode(l&&l.mapService),g=l&&l.mapLayer,u=B.htmlDecode(l&&l.mapName);o=3===s||4===s||5===s||9===s||20===s?h.MAPTYPE.WMS_MAP:101===l.mapFormat?h.MAPTYPE.OSM_MAP:102===l.mapFormat?h.MAPTYPE.GOOGLE_MAP:103===l.mapFormat?h.MAPTYPE.BING_MAP:105===l.mapFormat?h.MAPTYPE.HUAWEI_MAP:107===l.mapFormat?h.MAPTYPE.ARCGISTILE_LAYER:h.MAPTYPE.OSM_MAP,20===l.mapFormat?c=fusiongis.Constant.GisRootUrl+"/offlineMap/customServer?MAPNAME="+u+"&LAYERS="+g:3===l.mapFormat?(c=fusiongis.Constant.GisRootUrl+"/offlineMap/planetServer",u=void 0):4===l.mapFormat?(c=fusiongis.Constant.GisRootUrl+"/offlineMap/shapeServer",u=void 0):5===l.mapFormat?(c=fusiongis.Constant.GisRootUrl+"/offlineMap/RailwayServer",u=void 0):9===l.mapFormat&&(c=fusiongis.Constant.GisRootUrl+"/offlineMap/customMap?MAPNAME="+u+"&LAYERS="+g),r.push({mapFormat:l.mapFormat,mapName:u,mapLayer:g,url:c,mapType:o,key:d,timeMaker:l.timeMaker})}e&&"function"==typeof e&&e(r)}}},failure:function(t){e([]),console.log("离线地图信息获取失败,返回"+t)}})},K=function(e){e.UI?r(e):z(e)},Z=function(e,t){t&&t.getViewport()&&(t.getViewport().oncontextmenu=function(a){var r=t.getTarget();a.preventDefault();var o=t.getEventPixel(a),n=t.hasFeatureAtPixel(o);document.getElementById(r).style.cursor=n?"pointer":"";var i=t.forEachFeatureAtPixel(t.getEventPixel(a),function(e){if(n)return e});i?v.keys.filter(function(e){return e.indexOf(r)===e.length-r.length}).forEach(function(o){var l=v.get(o);if(l&&l instanceof f.layer.Layer){var s=l;if(s.hasOwnProperty("rightClickCallback")&&"function"==typeof s.rightClickCallback){var d=o.substring(0,o.indexOf(r)-1);n&&d===i.get("layerId")&&s.rightClickCallback({mapId:e.mapId,layerId:d,layerType:s.get("businessType"),popupPosition:f.proj.toLonLat(t.getEventCoordinate(a)),lonLat:f.proj.toLonLat(f.extent.getCenter(i.getGeometry().getExtent())),geoId:i.getId(),points:!!i.getProperties()&&!!i.getProperties().data&&i.getProperties().data.coordinates})}}}):e.rightClickCallback&&"function"==typeof e.rightClickCallback&&(fusiongis.Popup.removeContextMenu(),e.rightClickCallback({mapId:e.mapId,popupPosition:f.proj.toLonLat(t.getEventCoordinate(a))}))})},q=function(e){var t=S.getMapObj(e.mapId);if(t&&e.mapType&&e.mapType===h.MAPTYPE.GOOGLE_MAP){
var a=C.createCustomMap(e);t.set("customMap",a)}},X=function(e){var t=e.extent3857,a=B.extentTimes(t,e.multiple),r=e.layer,o=function(){var e=r.get("lastExtent");return void 0==e?(r.set("lastExtent",a),!0):!f.extent.containsExtent(e,t)}();o&&(r.set("lastExtent",a),r.refreshDataCallback({extent:f.proj.transformExtent(a,h.PROJ.EPSG_3857,h.PROJ.EPSG_4326)}))},$=function(e){if(e&&e.length>0){var t;for(t=0;t<e.length;t++){var a=e[t];if(S.getMapObj(a)){var r=S.getMapObj(a).getViewport();if(r){r.parentNode&&r.parentNode.removeChild(r);for(var o=v.keys.length;o>0;o--){var n=v.keys[o];n&&n.substring(n.lastIndexOf("_")+1)===a&&n!==a&&v.remove(n)}v.remove(a)}}}}},Q=function(e){var t=null,a=e.zoom,r=e.mapId,o=e.layerId,n=e.geoId,i=v.get(r),l=i&&i.getView(),s=o+h.Joiner.UNDERLINE+r,d=v.get(s);if(e.coordinate)t=f.proj.fromLonLat(e.coordinate);else if(n){var c=f.proj.fromLonLat([108,39]);if(d.get("imgToken")||d.get("params.imgToken")){var g=d.get("imgToken")||d.get("params.imgToken"),u=g.slice(0,g.indexOf(":"));V.postJSON({url:h.GisRootUrl+"/mapRender/query?FCName="+u,data:JSON.stringify({id:[n],imgToken:g}),success:function(e){if(e){var t=JSON.parse(e);1===t.status.code&&t.data&&(l||t.data[0].centerPoint)&&(l.setCenter(f.proj.fromLonLat(t.data[0].centerPoint)),a&&l.setZoom(a))}},failure:function(e){}})}else c=function(){var e=v.get(o+h.Joiner.UNDERLINE+r),t=e&&e.getSource()&&e.getSource().getFeatureById(n);return t&&f.extent.getCenter(t.getGeometry().getExtent())}();t=c}if(l&&l){if(i&&i.get("mineCustomMap")){var y=i.get("mineCustomMap"),p=new google.maps.LatLng(e.coordinate[1],e.coordinate[0]);y.setCenter(p),void 0!==a&&null!==a&&y.setZoom(a)}t&&l.setCenter(t),void 0!==a&&null!==a&&l.setZoom(a)}},ee=function(e){return S.getMapObj(e).getView().getZoom()},te=function(e,t){var a=v.get(e),r=a.getView().calculateExtent(a.getSize());return t?f.proj.transformExtent(r,h.PROJ.EPSG_3857,h.PROJ.EPSG_4326):r},ae=function(e){if(e&&e instanceof Array)for(var t=0;t<e.length;t++)S.getMapObj(e[t])&&S.getMapObj(e[t]).updateSize()},re=function(e,t){var a=S.getMapObj(e).getView().getCenter();return f.proj.toLonLat(a,t)},oe=function(e){var t=e.mapId,a=null,r=S.getMapObj(t);e.extent?a=f.proj.transformExtent(e.extent,h.PROJ.EPSG_4326,h.PROJ.EPSG_3857):V.postJSON({url:h.GisRootUrl+"/getMapExtent/extent?FCName="+e.fcName,data:JSON.stringify({geoParams:{fcName:e.fcName}}),success:function(e){if(e){var t=JSON.parse(e);if(t&&t.status&&1===t.status.code&&t.data){var r=t.data.mapExtent;if(0===r.length)return;a=r}}},failure:function(e){console.log(e)}}),!!a&&r.getView().fit(a,r.getSize())},ne=function(e){var t=S.getMapObj(e.mapId),a=t.get("paramObj");e=B.extend({},a,e);var r=t.getView();if(e.center&&e.center instanceof Array){if(e.center[0]===a.center[0]&&e.center[1]===a.center[1])return;r.setCenter(f.proj.fromLonLat(e.center))}if(e.defaultZoom){if(e.defaultZoom===a.defaultZoom)return;r.setZoom(e.defaultZoom)}if(e.maxZoom||e.minZoom){if(e.maxZoom===a.maxZoom&&e.minZoom===a.minZoom)return;var o=r.get(h.MAPPROPERTY.DEFAULT_MAX_ZOOM),n=r.get(h.MAPPROPERTY.DEFAULT_MAX_ZOOM);r.set(h.MAPPROPERTY.DEFAULT_MAX_ZOOM,e.maxZoom||o),r.set(h.MAPPROPERTY.DEFAULT_MIN_ZOOM,e.minZoom||n)}},ie=function(e){for(var t=S.getMapObj(e.mapId),a=t.getControls().getArray(),r=a.length;r>0;r--)t.removeControl(a[r]);var o=e.controlStyles?e.controlStyles:{scaleLine:"vGisWeb_scale-line-gis",mousePosition:"vGisWeb_mouse-position-gis"},n=f.control.defaults({zoomOptions:{className:"vGisWeb_olZoom_custom_un"},attributionOptions:{collapsible:!0}}).getArray(),i=e.controls;for(var l in i)void 0!=l&&null!=l&&void 0!=i[l]&&null!=i[l]&&"function"==typeof L[i[l]]&&n.push(L[i[l]](o[l]));n.forEach(function(e){void 0===e&&null===e||t.addControl(e)})},le=function(e){},se=function(e){var t=S.getMapObj(e.mapId),a=e.mapId,r=t.get("paramObj");r.center=f.proj.toLonLat(t.getView().getCenter()),e=B.extend({},r,e),o(e);var n="base_layer",i=fusiongis.BaseLayer.getLayer({mapId:e.mapId,layerId:n+"_marker"});switch(i&&i instanceof f.layer.Tile&&t.removeLayer(i),U.removeLayer({mapId:a,layer_id:n}),e.mapType){case h.MAPTYPE.OSM_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,x.createLayer({mapId:a,layerId:e.layerId,layer_id:n}));break;case h.MAPTYPE.HUAWEI_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,_.createLayer({mapId:a,url:e.url,key:e.key,layerId:e.layerId,layer_id:n}));break;case h.MAPTYPE.BING_MAP:if(!e.key)return void console.warn("bing map api license invalid, please enter valid key!");t.getLayers().insertAt(0,P.createLayer({mapId:a,layerId:e.layerId,layer_id:n,key:e.key,layers:e.layers})),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.BING_MAP,bingMapKey:e.key});break;case h.MAPTYPE.WMS_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,O.createLayer({mapId:a,url:e.url,layers:e.layers,layerId:e.layerId,layer_id:n,version:e.version,mapName:e.mapName,title:e.title||""}));break;case h.MAPTYPE.NAVER_MAP:E.mapTypeToolbar({mapObj:t}),t.getLayers().insertAt(0,M.createLayer({mapId:a,layerId:e.layerId,layer_id:n}));break;case h.MAPTYPE.TIANDI_MAP:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.TIANDI_MAP}),"Road"==e.layers?t.getLayers().insertAt(0,N.createRoadLayer({mapId:a,layerId:n,layer_id:n})):"Satellite"==e.layers?t.getLayers().insertAt(0,N.createSatelliteLayer({mapId:a,layerId:n,layer_id:n})):t.getLayers().insertAt(0,N.createRoadLayer({mapId:a,layerId:n,layer_id:n})),t.getLayers().insertAt(1,N.createMarkerLayer({mapId:a,layerId:n+"_marker",layer_id:n}));break;case h.MAPTYPE.ARCGISTILE_LAYER:t.getLayers().insertAt(0,G.createArcgisTileLayer({mapId:a,layerId:e.layerId,layer_id:n,url:e.url}));break;case h.MAPTYPE.GOOGLE_MAP:e&&e.key?C.loadGoogleAPI(e.key,e.language,function(a){a&&(window.sessionStorage&&sessionStorage.setItem("key",e.key),C.createCustomMap(e),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GOOGLE_MAP}))}):console.warn("load google api failed...");break;case h.MAPTYPE.BAIDU_MAP:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.BAIDU_MAP}),t.getLayers().insertAt(0,F.createLayer({mapId:a,layerId:e.layerId,layer_id:n}));break;case h.MAPTYPE.GOOGLE_ROAD_MAP:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GOOGLE_ROAD_MAP}),t.getLayers().insertAt(0,A.createLayer({mapId:a,layerId:e.layerId,layer_id:n}));break;case h.MAPTYPE.GAODE_MAP:e&&e.key?k.loadGaodeAPI(e.key,e.language,function(a){a&&(window.sessionStorage&&sessionStorage.setItem("key",e.key),k.createCustomMap(e),E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.GAODE_MAP,gaodeMapKey:e.key}))}):console.warn("load gaode api failed...");break;case h.MAPTYPE.YAHOO_MAP:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.YAHOO_MAP}),t.getLayers().insertAt(0,R.createLayer({mapId:a,layerId:e.layerId,layer_id:n}));break;default:E.mapTypeToolbar({mapObj:t,mapType:h.MAPTYPE.OSM_MAP}),t.getLayers().insertAt(0,x.createLayer({mapId:a,layerId:e.layerId,layer_id:n}))}},de=function(e){var t={center:ne,defaultZoom:ne,minZoom:ne,maxZoom:ne,proj:le,mapType:se,layers:c,controls:ie};for(var a in e)t.hasOwnProperty(a)&&t[a]&&"function"==typeof t[a]&&t[a](e);var r=e.mapId,o=S.getMapObj(r);o.set("currentMapType",e.mapType),(new B.sessionStorageObj).set("currentMapType",e.mapType);var n=o.get("paramObj");if(e=B.extend({},n,e),o.set("paramObj",e),o){var i=o.get("paramObj").controls;void 0!=i&&i.hasOwnProperty("overviewMap")&&setTimeout(function(){D.addMinMap(o.get("paramObj"))},3e3)}},ce=function(e){V.postJSON({url:fusiongis.Constant.GisRootUrl+"/mapCfgView.do",data:JSON.stringify({subject:{param:{},formatter:{date:""}},services:[{name:"getMapSource",param:{}}]}),success:function(t){if(t){var a=JSON.parse(t);if(a&&1===a.status.code&&a.data){var r=a.data,o=r.mapFormat,n=B.htmlDecode(r&&r.mapService),i=B.htmlDecode(r&&r.mapService),l=r&&r.mapLayer,s=B.htmlDecode(r&&r.mapName),d=void 0;if(d=3===o||4===o||5===o||9===o||20===o?h.MAPTYPE.WMS_MAP:101===a.data.mapFormat?h.MAPTYPE.OSM_MAP:102===a.data.mapFormat?h.MAPTYPE.GOOGLE_MAP:103===a.data.mapFormat?h.MAPTYPE.BING_MAP:105===a.data.mapFormat?h.MAPTYPE.HUAWEI_MAP:106===a.data.mapFormat?h.MAPTYPE.TIANDI_MAP:107===a.data.mapFormat?h.MAPTYPE.ARCGISTILE_LAYER:h.MAPTYPE.OSM_MAP,20===a.data.mapFormat?i=fusiongis.Constant.GisRootUrl+"/offlineMap/customServer?MAPNAME="+s+"&LAYERS="+l:3===a.data.mapFormat?(i=fusiongis.Constant.GisRootUrl+"/offlineMap/planetServer",s=void 0):4===a.data.mapFormat?(i=fusiongis.Constant.GisRootUrl+"/offlineMap/shapeServer",s=void 0):5===a.data.mapFormat?(i=fusiongis.Constant.GisRootUrl+"/offlineMap/RailwayServer",s=void 0):9===a.data.mapFormat&&(i=fusiongis.Constant.GisRootUrl+"/offlineMap/customMap?MAPNAME="+s+"&LAYERS="+l),e&&"function"==typeof e){var c=void 0,g=void 0;!function(){a.data&&a.data.centerPoint&&(a.data.centerPoint.zoom&&(g=a.data.centerPoint.zoom),a.data.centerPoint.longitude&&a.data.centerPoint.latitude&&(c=[a.data.centerPoint.longitude,a.data.centerPoint.latitude]))}(),e({status:1,message:"get current map information success!",mapType:d,mapFormat:o,url:i,key:n,layers:l?l:[],mapName:s?s:void 0,center:c,zoom:g})}}else e&&"function"==typeof e&&e({status:0,message:t})}},failure:function(e){console.log("%c get current map information fail----mapCfgView.do","font-size: 12px;color: red;")}})},ge=function(e){var t=v.get(e);if(t){var a=t.getControls().getArray();a.forEach(function(e){e instanceof f.control.Attribution&&t.removeControl(e)})}};e.exports={createMap:K,destroyCustomMap:o,getMapObj:S.getMapObj,removeMap:$,setMapCenter:Q,getZoom:ee,getExtent:te,getCenter:re,setExtent:oe,refreshMaps:ae,mapAssociate:T.mapAssociate,getMapList:g,isMapExist:u,updateMap:de,setZoomVisible:y,mapTypeVisible:p,getOffLineMapUrls:J,getCurrentMapInfo:ce,removeAttributionContrl:ge}},function(e,t,a){var r=a(3),o=a(10),n=a(6),i=(a(1),[]),l=null,s=null,d=function(e){var t=e.content,a=r.proj.fromLonLat(e.position),l=e.mapId,s=void 0===e.showCloseButton||e.showCloseButton,d="ol-popupContainer-id"+l,c=o.getDom(d);c&&c.parentNode.removeChild(c);var u=void 0==e.radius?"ol-popupContainer-class-radius":"ol-popupContainer-class",y=o.createDom({tagName:"div",attributes:{id:d,"class":u}}),p=o.createDom({tagName:"a",attributes:{id:"ol-popupClose-id","class":"ol-popupClose-class",href:"#"}}),m=o.createDom({tagName:"div",attributes:{id:"ol-popupContent-id"}});t&&("string"==typeof t?m.innerHTML=t:"object"==typeof t&&m.appendChild(t)),y.appendChild(p),y.appendChild(m),document.body.appendChild(y),s?p.style.display="block":p.style.display="none";var f=new r.Overlay({element:y,autoPan:!0,autoPanAnimation:{duration:250},autoPanMargin:15});return f.featureCenter=a,f.mapId=l,f.set("type","popup_in_frame_folder"),g(l),n.getMapObj(l).addOverlay(f),i.push(f),y.style.display="block",p.style.position="absolute",p.style.top="2px",p.style.right="8px",p.onclick=function(){g(l)},f.setPosition(a),f},c=function(e){var t=e.content,a=r.proj.fromLonLat(e.position),i=e.mapId,s="ol-susPopupContainer-id"+i,d=o.getDom(s);d&&d.parentNode.removeChild(d);var c=o.createDom({tagName:"div",attributes:{id:s,"class":"ol-susPopupContainer-class"}}),g=o.createDom({tagName:"div",attributes:{id:"ol-susPopupContent-id"}});"string"==typeof t?g.innerHTML=t:g.appendChild(t),c.appendChild(g),document.body.appendChild(c),l&&n.getMapObj(i).removeOverlay(l);var u=new r.Overlay({element:c,position:a,mapId:i,autoPan:!0,autoPanAnimation:{duration:250},autoPanMargin:15});n.getMapObj(i).addOverlay(u),l=u,c.style.display="block"},g=function(e){i&&i.length>0&&i.forEach(function(t,a,r){void 0!=t&&t.mapId===e&&"popup_in_frame_folder"==t.get("type")&&(n.getMapObj(e).removeOverlay(t),r.splice(a,1))})},u=function(e){l&&n.getMapObj(e).removeOverlay(l)},y=function(e){var t=r.proj.fromLonLat(e.position),a=e.mapId,o=n.getMapObj(a),i=e.element;s=new r.Overlay({element:i,positioning:"top-left",position:t,autoPan:!0,autoPanAnimation:{duration:250},autoPanMargin:15}),s.setMap(o),fusiongis.Events.addClickCallback(a,"popup-click-event",function(){s.setPosition(void 0)})},p=function(){s&&s.setPosition(void 0)};e.exports={addPopup:d,removePopup:g,getPopups:function(){return i},addSuspensionPopup:c,removeSuspensionPopup:u,addContextMenu:y,removeContextMenu:p}},function(e,t,a){function r(e,t,a){e.addEventListener(t,a)}function o(e,t,a){e.removeEventListener(t,a)}var n=a(4),i=a(1),l=function(e){return"."===e.substring(0,1)?document.getElementsByClassName(e.substring(1)):document.getElementById(e)},s=function(e){var t=e.tagName,a=e.attributes,r=e.text,o=document.createElement(t);for(var n in a)o.setAttribute(n,a[n]);return void 0!=r&&(o.innerHTML=r),o},d=function(e){var t=e.mapId,a=e.dom,r=void 0,o=void 0,l=void 0,d=void 0,c=function(){if(e.style){var t=e.style;r=t.top+"px"||void 0,o=t.bottom+"px"||void 0,d=t.right+"px"||void 0,l=t.left+"px"||void 0}var a=[];return r&&a.push("top: "+r),o&&a.push("bottom: "+o),d&&a.push("right: "+d),l&&a.push("left: "+l),a.join(";")+";"}(),g=!!t&&n.get(t),u=function(){return!!(g&&g instanceof ol.Map)||(console.error("map init failed, please load map before!!!"),!1)}();if(u){var y=g.getTargetElement(),p=s({tagName:"div",attributes:{id:i.getUUID(),style:"position: absolute;z-index: 1000;"+c}});y.appendChild(p),a&&p.appendChild(a)}};e.exports={on:r,off:o,getDom:l,createDom:s,appendExtendNode:d}},function(e,t,a){function r(e){var t=u.getMapObj(e.mapId);if(t){var a=t.get("zoomCallbackList"),r=e.callbackfunc;r&&"function"==typeof r&&(e.id&&(r.id=e.id),a&&a.push(e.callbackfunc))}}function o(e){e.get("zoomCallbackList")||e.set("zoomCallbackList",[]),e.getView().on("change:resolution",function(e){var t=e.target,a=t.get("linkedMapIds");a&&a.forEach(function(a){var r={mapId:a,zoom:t.getZoom(),lonLat:g.proj.toLonLat(t.getCenter())},o=u.getMapObj(a);if(o){var n=o.get("zoomCallbackList");n.forEach(function(t){t(r,e)})}})})}function n(e){var t=u.getMapObj(e.mapId);if(t){var a=t.get("centerCallbackList"),r=e.callbackfunc;r&&"function"==typeof r&&(e.id&&(r.id=e.id),a&&a.push(e.callbackfunc))}}function i(e){e&&(e.get("centerCallbackList")||e.set("centerCallbackList",[]),e.getView().on("change:center",function(t){var a=t.target,r=a.get("linkedMapIds");r.forEach(function(a){var r={mapId:a,lonLat:g.proj.toLonLat(e.getView().getCenter())},o=u.getMapObj(a);if(o){var n=o.get("centerCallbackList");n.forEach(function(e){e(r,t)})}})}))}function l(e,t){u.getMapObj(e);return void 0!=t.eventDC?void p.mapClick(e,t):void m.mapClick(e,t)}function s(e){var t=u.getMapObj(e);t.get("clickHandle")&&(t.unByKey(t.get("clickHandle")),t.set("clickHandle",null))}function d(e,t,a,r){var o=u.getMapObj(e);if(void 0!==t&&"function"==typeof a){o.get("callbackList")&&(o.get("callbackList")[t.toString()]=a);var n=function(){if(r)return y.get(r+"_"+e)}();o.get("eventKeyANDEventLayerObj")&&(o.get("eventKeyANDEventLayerObj")[t.toString()]=n)}}function c(e,t){var a=u.getMapObj(e);void 0!==t&&void 0!=a.get("callbackList")&&(delete a.get("callbackList")[t.toString()],delete a.get("eventKeyANDEventLayerObj")[t.toString()])}var g=a(3),u=a(6),y=(a(12),a(9),a(13),a(7),a(4)),p=(a(14),a(1),a(15)),m=a(17),f=(a(18),a(16)),v=(f.closeDrawAndMeasure,f.transformLonLat,function(e){var t=e.mapId,a=e.callback,r=u.getMapObj(t);if(r){var o=r.getTargetElement().querySelector(".toolbar-container");o&&(o.onclick=function(e){var t=e.target,r="";r=t.className.indexOf("Gray")!==-1||t.className.indexOf("exportData")!==-1?t.parentElement.parentElement.parentElement.id:t.parentElement.parentElement.id,a&&"function"==typeof a&&a({mapId:r,domId:t.classList[t.classList.length-1]})})}});e.exports={zoomChangeEvent:o,centerChangeEvent:i,onZoomChange:r,onCenterChange:n,registerDomEvent:v,mapClick:l,mapUnClick:s,addClickCallback:d,removeClickCallback:c}},function(e,t,a){function r(e){return u.getMapObj(e)}function o(e,t){var a=r(e).getOverlays().getArray();return y.find(a,function(e){return e.get("name")===t})}function n(e,t,a){var r=e.getBoundingClientRect(),o=t-r.left,n=a-r.top;e.style.left=e.offsetLeft+o+"px",e.style.top=e.offsetTop+n+"px"}function i(e){isNaN(e.position[0])&&isNaN(e.position[1])||(this.setOptions(e),this.setElement())}function l(e){var t=e.mapId,a=r(t);if(a){var n=o(t,"popup-default");n&&a.removeOverlay(n);var l=new i(e),s=new g.Overlay({element:l.element,autoPan:!0,autoPanAnimation:{duration:250},autoPanMargin:15});s.set("type","popups"),s.set("name","popup-default"),s.setPosition(g.proj.fromLonLat(e.position)),s.popover=l,a.addOverlay(s),l.show()}}function s(e){var t=r(e);t&&d(e,"popups",function(e){e.popover&&e.popover.destroy()})}function d(e,t,a){var o=r(e).getOverlays().getArray().slice(0);o.forEach(function(o){o.get("type")===t&&(a&&a(o),r(e).removeOverlay(o))})}function c(e,t){var a=r(e);if(a){var n=o(e,t);n&&(n.popover&&n.popover.destroy(),a.removeOverlay(n))}}var g=a(3),u=a(6),y=a(1),p=a(10);i.prototype.setOptions=function(e){this.options=e,this.title=e.title?e.title:""},i.prototype.setElement=function(){var e=document.createElement("div");e.className="gisCovery-popup",e.style.minWidth="100px";var t=document.createElement("div");t.className="gisCovery-popup-header";var a=document.createElement("div");a.className="gisCovery-popup-title",a.innerHTML=this.title,t.appendChild(a);var r=document.createElement("div");r.className="gisCovery-popup-close",r.innerHTML="✖",t.appendChild(r);var o=document.createElement("div");o.className="gisCovery-popup-content",this.options.contentClass&&o.classList.add(this.options.contentClass),this.options.contentId&&(o.id=this.options.contentId),"string"==typeof this.options.content?o.innerHTML=this.options.content:o.appendChild(this.options.content);var n=document.createElement("div");n.className="gisCovery-popup-arrow",e.appendChild(t),e.appendChild(o),e.appendChild(n),this.headerElement=t,this.contentElement=o,this.arrowElement=n,this.element=e;var i=this;p.on(r,"click",function(){c(i.options.mapId,"popup-default")})},i.prototype.getPosition=function(e){return e=e||this.element.parentNode,e.getBoundingClientRect()},i.prototype.getCalculatedOffset=function(e,t,a,r){return"bottom"===e?{top:t.top+t.height,left:t.left+t.width/2-a/2}:"top"===e?{top:t.top-r,left:t.left+t.width/2-a/2}:"left"===e?{top:t.top+t.height/2-r/2,left:t.left-a}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},i.prototype.show=function(){var e=this.getPosition(),t=this.element,a=t.offsetWidth,r=t.offsetHeight,o=this.getCalculatedOffset("top",e,a,r);n(t,o.left,o.top+5)},i.prototype.destroy=function(){this.element=null,this.headerElement=null,this.contentElement=null,this.arrowElement=null};var m=function(e,t){if("object"==typeof e&&e instanceof Array){var a=o(t,"popup-default");a.setOffset(e)}},f=function(e,t,a,r){var n=o(r,"popup-default");if(n&&(void 0===e?n.setPosition(e):(t&&(e=transfrom(e)),n.setPosition(e))),a){var i=mapView.getCenter(),l=y.getPointQuadrant(i,e);1===l?n.setPositioning("top-right"):2===l?n.setPositioning("top-left"):3===l?n.setPositioning("bottom-left"):4===l&&n.setPositioning("bottom-right")}},v=function(e,t){var a=o(t,"popup-default");a.setPositioning(e)},h=function(e){var t=o(e,"popup-default");return t},I=function(e){var t=o(e,"popup-default");return t.getElement()};e.exports={addPopup:l,removeAllPopup:s,setInnerHTML:i.prototype.setElement,setOffset:m,setPosition:f,setPositioning:v,getMapTips:h,getPopupElement:I}},function(e,t,a){function r(e){e!==l.ZH&&e!==l.EN&&e!==l.ES||(s=e)}function o(){return s}function n(e){return u[s][e]}var i=a(7),l=i.I18N,s=function(){function e(e){for(var t=0;t<a.length;t++){var r=a[t],o=r.split("=");if(e==o[0].trim()&&o[1])return o[1].trim()}}var t=l.EN;if(document.cookie.indexOf("locale=")===-1)t=l.EN;else{var a=document.cookie.split(";");t=!!e("locale")&&e("locale").slice(0,2),t||(t=!!e("exlocale")&&e("exlocale").slice(0,2)),t||(console.log("%c 通过cooie获取国际化资源是被，系统指定en","color:blue;font-size:14px;"),t=l.EN)}return t}(),d={},c={},g={},u={en:d,zh:c,es:g};c["common.km"]="公里",c["common.m"]="米",c["mapClick.popup.title"]="图层选择",c["measure.message.startHelper"]="单击确定起点",c["measure.message.helper"]="单击确定起点，双击结束",c["measure.message.start"]="起点",c["measure.message.total"]="总长：",c["measure.angle.now"]="当前角度：",c["measureArea.message.total"]="总面积：",c["layerManager.title"]="图层管理",c["LayerLabel.BASELAYER"]="底图",c["LayerLabel.BASELAYER_MARKER"]="底图标签",c["LayerLabel.NE"]="工参",c["components.drawPolygon"]="画多边形",c["components.exportImage.title"]="导出",c["components.exportImage.saveType"]="保存类型：",c["components.exportImage.OK"]="确定",c["components.exportImage.Cancel"]="取消",c["components.exportImage.Layers"]="图层",c["components.exportImage.format"]="格式",c["components.exportImage.closeExportBox"]="关闭导出框界面",c["search.layerName"]="图层名称",c["search.propertyName"]="属性名",c["search.propertyValue"]="属性值",c["search.online"]="在线搜索",c["search.offline"]="离线搜索",c["search.title"]="搜索",c["search.click.search"]="点击搜索",c["search.current.map.not.support"]="当前地图不支持搜索，请使用谷歌或者OSM",c["search.elementList"]="元素列表",c["search.cell"]="小区",c["search.site"]="基站",c["search.systemPolygon"]="系统多边形",c["search.choose"]="请选择",c["toolbar.layerManger"]="图层管理",c["toolbar.exportImage"]="导出图片",c["toolbar.exportData"]="导出数据",c["toolbar.search"]="在线 & 离线 搜索",c["toolbar.lonLatGridLine"]="经纬度栅格线",c["toolbar.drawPolygon"]="画多边形",c["toolbar.drawLine"]="画线",c["toolbar.drawPoint"]="画点",c["toolbar.measureDistance"]="测量距离",c["toolbar.measureArea"]="测量面积",c["toolbar.measureAngle"]="测量角度",c["toolbar.polygonFilter"]="通过多边形过滤要素",c["toolbar.roadMap"]="街道地图",c["toolbar.grayMap"]="灰度地图",c["toolbar.legendSwitch"]="图例开关",c["filterFeature.wind.head.title"]="选择需要过滤的图层",c["filterFeature.wind.close.title"]="点击按钮关闭窗口",c["filterFeature.body.layerId"]="图层ID",c["map.zoomIn"]="放大",c["map.zoomOut"]="缩小",c["imageExport.title"]="图片导出",c["imageExport.exportTypeSel"]="--保存类型--",c["dataExport.title"]="数据导出",c["dataExport.exportTypeSel"]="--导出类型--",c["featureFilter.title"]="--元素过滤--",c["featureFilter.layerTypeSel"]="--请选择图层--",c["MapMsg.mousePositionMsg"]="鼠标的位置在地图范围之外",d["common.km"]="km",d["common.m"]="m",d["mapClick.popup.title"]="Layer Select",d["measure.message.startHelper"]="Click to determine the location.",d["measure.message.helper"]="Click to determine the location<br> or double-click to finish.",d["measure.message.start"]="Start",d["measure.message.total"]="Total Distance:",d["measure.angle.now"]="Current angle ： ",d["measureArea.message.total"]="Total Area：",d["layerManager.title"]="Layer Management",d["LayerLabel.BASELAYER"]="Base Layer",d["LayerLabel.BASELAYER_MARKER"]="Base Layer Maker",d["LayerLabel.NE"]="NE",d["components.drawPolygon"]="Draw Polygon",d["components.exportImage.title"]="Export",d["components.exportImage.saveType"]="Save as:",d["components.exportImage.OK"]="OK",d["components.exportImage.Cancel"]="Cancel",d["components.exportImage.Layers"]="Layers",d["components.exportImage.format"]="format",d["components.exportImage.closeExportBox"]="Close the Export Box interface",d["search.layerName"]="layer name",d["search.propertyName"]="attr_ name",d["search.propertyValue"]="attr_ value",d["search.online"]="Online search",d["search.offline"]="Offline search",d["search.title"]="search",d["search.click.search"]="click search",d["search.current.map.not.support"]="current map not support search, please use osm or google",d["search.elementList"]="element list",d["search.cell"]="cell",d["search.site"]="site",d["search.systemPolygon"]="system polygon",d["search.choose"]="please choose",d["toolbar.layerManger"]="layer manager",d["toolbar.exportImage"]="export image",d["toolbar.exportData"]="export data",d["toolbar.search"]="online & offline search",d["toolbar.lonLatGridLine"]="lonLat grid line",d["toolbar.drawPolygon"]="draw polygon",d["toolbar.drawLine"]="draw line",d["toolbar.drawPoint"]="draw point",d["toolbar.measureDistance"]="measure distance",d["toolbar.measureArea"]="measure area",d["toolbar.measureAngle"]="measure angle",d["toolbar.polygonFilter"]="filter feature by polygon",d["toolbar.roadMap"]="road map",d["toolbar.grayMap"]="gray map",d["toolbar.legendSwitch"]="legend switch",d["filterFeature.wind.head.title"]="The layer you want to filter",d["filterFeature.wind.close.title"]="Click the button to close the window",d["filterFeature.body.layerId"]="layer ID",d["map.zoomIn"]="zoom in",d["map.zoomOut"]="zoom out",d["imageExport.title"]="image export",d["imageExport.exportTypeSel"]="--save image type--",d["dataExport.title"]="data export",d["dataExport.exportTypeSel"]="--Export type--",d["featureFilter.title"]="--feature filter--",d["featureFilter.layerTypeSel"]="--select a layer--",d["MapMsg.mousePositionMsg"]="Position of the mouse on the map range.",g["common.km"]="kilómetro",g["common.m"]="metro",g["mapClick.popup.title"]="Seleccione capa",g["measure.message.startHelper"]="Haga clic en OK para iniciar",g["measure.message.helper"]="Haga clic en OK punto de partida, de dos extremos",g["measure.message.start"]="punto de partida",g["measure.angle.now"]="Current angle : ",g["measure.message.total"]="Longitud total：",g["measureArea.message.total"]="El área total：",g["layerManager.title"]="capa de Gestión",g["LayerLabel.BASELAYER"]="arpillera",g["LayerLabel.NE"]="El trabajo de referencia",g["components.drawPolygon"]="Videos polígono",g["components.exportImage.title"]="exportación",g["components.exportImage.saveType"]="Guardar como tipo：",g["components.exportImage.OK"]="determinar",g["components.exportImage.Cancel"]="cancelado",g["components.exportImage.Layers"]="capas",g["components.exportImage.format"]="formato",g["components.exportImage.closeExportBox"]="Cerrar la caja de interconexión de exportación",e.exports={setLang:r,getLang:o,prop:n}},function(e,t,a){function r(){if("file:"!=location.protocol&&"127.0.0.1"!=location.hostname&&!o.GlobalVariable.csrfToken){var e=n(),t=o.GisRootUrl+"/csrftoken.do";e.open("GET",t,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),e.send(null),e.onreadystatechange=function(){if(4===e.readyState){var t=e.status;if(t>=200&&t<300){var a=e.responseText;if(a){var r=JSON.parse(a);if(1===r.status.code){var n=r._csrf_header,i=r._csrf;o.GlobalVariable.csrfToken=n+"|"+i}}}else console.log("%c fusiongis get csrftoken failed, ajax.setHeader","font-size:14px;color:red")}}}}var o=(a(1),a(7)),n=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml");else if(window.ActiveXObject)for(var t=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],a=0;a<t.length;a++)try{if(e=new ActiveXObject(t[a]))break}catch(r){}return e},i=function(e){var t=n(),a=setTimeout(function(){var r=e.url;e.data&&(r=r+"?"+e.data),t.open("GET",r,!0);var n=o.GlobalVariable.csrfToken;if(n){var i=n.split("|");t.setRequestHeader(i[0],i[1]),t.onreadystatechange=function(){if(4===t.readyState){var r=t.status;r>=200&&r<300?e.success&&"function"==typeof e.success&&e.success(t.responseText):(e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status)),clearTimeout(a)}},t.send(null)}else e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status)},500)},l=function(e){var t=n();if(t)var a=setTimeout(function(){t.open("POST",e.url,!0),t.setRequestHeader("Content-Type","application/json; charset=UTF-8;");var r=o.GlobalVariable.csrfToken;if(r){var n=r.split("|");t.setRequestHeader(n[0],n[1]),t.onreadystatechange=function(){if(4===t.readyState){var r=t.status;r>=200&&r<300?e.success&&"function"==typeof e.success&&e.success(t.responseText):(e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status))}clearTimeout(a)},t.send(e.data)}else e.failure&&"function"==typeof e.failure&&e.failure(t.status),e.fail&&"function"==typeof e.fail&&e.fail(t.status)},500)};e.exports={setHeader:r,get:i,post:l,postJSON:l}},function(e,t,a){function r(e,t){var a=t.everyLayerClickCallback,r=new Map,m=void 0,f=void 0,v=void 0,S=void 0,b=void 0,L=void 0,T=void 0,w=void 0,E=void 0,C=y.getMapObj(e);if(!C.get("clickHandle")){C.set("callbackList",{}),C.set("eventKeyANDEventLayerObj",{});var k=C.on("click",function(t){var y=h(C.getTarget());if(y===!1){var k=C.get("callbackList");return void(k["measure-distance-click-event"]&&k["measure-distance-click-event"]({e:t}))}var x=[],P=[],_=[],O={};C.forEachFeatureAtPixel(t.pixel,function(e){if(e){var a=e.get("features");if(a&&a instanceof Array&&a.length>0&&_.push(e),(e.get("vectorType")===p.BUSINESSTYPE.POINT||e.get("vectorType")===p.BUSINESSTYPE.LINE||e.get("vectorType")===p.BUSINESSTYPE.POLYGON||e.get("vectorType")===p.BUSINESSTYPE.ICON||e.get("vectorType")===p.BUSINESSTYPE.CIRCLEPOINT||e.get("vectorType")===p.BUSINESSTYPE.VECTOR_CELL||e.get("vectorType")===p.BUSINESSTYPE.STRAIGHTLINE||e.get("vectorType")===p.BUSINESSTYPE.MULTIPOINT||"ICON_FONT_STYLE"===e.get("vectorType")||"BUBBLE_CIRCLE_LABEL"===e.get("vectorType")||"unChangePolygon"===e.get("vectorType"))&&!e.get("highlightFeature")){if(e.get("vectorType")===p.BUSINESSTYPE.MULTIPOINT){var r=fusiongis.MuliPoint.getTargetClkPoint(e.get("data"),t.coordinate);e.set("coordinate",r.coordinate),e.set("data_",r)}_.push(e)}x.push(e)}}),P=C.getCoordinateFromPixel(t.pixel),P&&(P=u.proj.toLonLat(P));var k=C.get("callbackList"),M=C.get("eventKeyANDEventLayerObj");if(_.length>0){for(var N=[],F=0;F<_.length;F++){var A=_[F];if(!A)return;var R=(A.get("vectorType"),A.get("layer")),G=A.getGeometry().getExtent(),D=u.extent.getCenter(G),j=u.proj.toLonLat(D),Y={e:t,mapId:e,layerId:!!R&&R.get("layer_id"),layer:A.get("layer"),businessType:R&&R.get("businessType"),feature:A,data:void 0!=A.get("data_")?A.get("data_"):A.get("data"),geoId:void 0!==A.getId()?A.getId():A.get("id"),lonLat:[j[0].toFixed(6),j[1].toFixed(6)],pixLonLat:P,points:I(A)};if(m="yes",r.set("g__vectorFeature",m),1===_.length){var B=_[0].get("features")&&_[0].get("features")instanceof Array&&1===_[0].get("features").length,U=B?_[0].get("features")[0].get("layer"):void 0;Y.layer=B&&U?U:Y.layer,k["point-cluster-click-event"]&&k["point-cluster-click-event"](Y)}N.push(Y)}if(N.length>0)for(var F=0;F<N.length;F++){var V=[],H=[];for(var W in O)H.push(W);if(H.indexOf(N[F].layerId.toString())<0)for(var z=F;z<=N.length-1;z++)N[F].layerId==N[z].layerId&&(V.push(N[z]),O[N[F].layerId]=V)}}for(var J in k)if(void 0!=k[J]&&"function"==typeof k[J]){var A=null;x.length>0&&(A=x[0]);var G=A&&A.getGeometry().getExtent(),D=G&&u.extent.getCenter(G),j=[];D&&(j=u.proj.toLonLat(D));var R=M[J];void 0!=R&&(R.get("businessType")===p.BUSINESSTYPE.GRID?(f="no",r.set("g__getGridInfo",f),o(C,R,A,t,J,function(e){f="yes",r.set("g__getGridInfo",f),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):"DCELL"===R.get("businessType")?(v="no",r.set("g__getdCellInfo",v),n(C,R,A,t,J,function(e){v="yes",r.set("g__getdCellInfo",v),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):"DPOINT"===R.get("businessType")||"SITE"===R.get("businessType")?(S="no",r.set("g_getdSiteInfo",S),i(C,R,A,t,J,function(e){S="yes",r.set("g_getdSiteInfo",S),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):"DLINE"===R.get("businessType")?(b="no",r.set("g_getdLineInfo",b),l(C,R,A,t,J,function(e){b="yes",r.set("g_getdLineInfo",b),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):"DPOLYGON"===R.get("businessType")?(L="no",r.set("g_getdServicePolygonInfo",L),s(C,R,A,t,J,function(e){L="yes",r.set("g_getdServicePolygonInfo",L),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):R.get("businessType")===p.BUSINESSTYPE.SERVICEPOINT?(T="no",r.set("g_getServicePointInfo",T),c(C,R,A,t,J,function(e){T="yes",r.set("g_getServicePointInfo",T),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):R.get("businessType")===p.BUSINESSTYPE.SERVICELINE?(w="no",r.set("g_getServiceLineInfo",w),g(C,R,A,t,J,function(e){w="yes",r.set("g_getServiceLineInfo",w),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):R.get("businessType")===p.BUSINESSTYPE.SERVICEPOLYGON?(E="no",r.set("g_getServicePolygonInfo",E),d(C,R,A,t,J,function(e){E="yes",r.set("g_getServicePolygonInfo",E),e&&e.length>0?O[e[0].layerId]=e:O[e[0].layerId]=[{}]})):"SERVICELAYER"===R.get("businessType")&&fusiongis.ServiceLayer.getServiceLayerInfo(C,R,t,function(e){
e&&e.length>0&&(O[e[0].layerId]=e)}))}var K=void 0;try{K=setInterval(function(){var e=[];r.forEach(function(t,a){e.push({key:a,val:t})});for(var t=e.filter(function(e){return void 0!=e.val}),o=!1,n=[],i=0;i<t.length;i++)o="yes"==t[i].val,n.push(o);o=n.every(function(e){return 1==e}),o&&(void 0!=a&&"function"==typeof a&&a(O),clearInterval(K),m=void 0,f=void 0,v=void 0,S=void 0,b=void 0,L=void 0,T=void 0,w=void 0,E=void 0)},500)}catch(t){console.error(t.message),clearInterval(K)}});C.set("clickHandle",k)}}function o(e,t,a,r,o,n){var i=h(e.getTarget());if(i!==!1){var l=t.get("paramObj");if(void 0==t.get("imgToken"))return void n([{layerId:!!t&&t.get("layer_id")}]);var s={geometry:{x:r.coordinate[0],y:r.coordinate[1]},tolerance:void 0!=l&&void 0!=l.tolerance?l.tolerance:1,mapExtent:e.getView().calculateExtent(e.getSize()),imgToken:t.get("imgToken")},d=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel));m.postJSON({url:p.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(s),success:function(r){if(!r)return void n([{layerId:!!t&&t.get("layer_id")}]);var i=JSON.parse(r);if(!i||!i.data||!i.data.length)return void n([{layerId:!!t&&t.get("layer_id")}]);if(void 0!=i.status&&1==i.status.code)try{var l=i.data.map(function(r){return{mapId:e.getTarget(),layer:t,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),feature:a,lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:d,geometry:r.geometry,geoId:r.id,data:r,extentInfo:r.extentInfo,geoName:r.name,key:o,originalCenterPoint:r.originalCenterPoint}});n(l)}catch(s){n([{layerId:!!t&&t.get("layer_id")}]),console.log(s)}else n([{layerId:!!t&&t.get("layer_id")}])},failure:function(e){n([{layerId:!!t&&t.get("layer_id")}])}})}}function n(e,t,a,r,o,n){var i=h(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([{layerId:!!layerObj&&layerObj.get("layer_id")}]);if(r.coordinate){var l=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),s=e.getView().calculateExtent(e.getSize()).join(","),d=t.get("imgToken");if(void 0==d)return void n([{layerId:!!t&&t.get("layer_id")}]);var c=void 0!=d?d.slice(0,d.indexOf(":")):void 0,g=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),y=t.get("paramObj"),v={geometry:l,tolerance:void 0!=y&&void 0!=y.tolerance?y.tolerance:.1,mapExtent:s,imgToken:d,FCName:c}}m.get({url:p.GisRootUrl+"/common/mapRender/identify",data:f.getParameterString(v),success:function(r){if(!r)return void n([{layerId:!!t&&t.get("layer_id")}]);r=JSON.parse(r);try{if(!r||!r.data||!r.data.length)return void n([{layerId:!!t&&t.get("layer_id")}]);var i=f.sortBy(r.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),l=i[0].extentInfo.radius;i=i.filter(function(e){return e.extentInfo.radius===l}),i.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var s=i.map(function(r){return{mapId:e.getTarget(),layer:t,feature:a,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:g,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o}});"function"==typeof n&&n(s)}catch(d){"function"==typeof n&&n([{layerId:t.get("layer_id")}]),console.log(d)}},failure:function(e){"function"==typeof n&&n([{layerId:t.get("layer_id")}])}})}}function i(e,t,a,r,o,n){var i=h(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([{layerId:!!t&&t.get("layer_id")}]);var l,s,d,c,g;if(s=t.get("imgToken"),void 0==s)return void n([{layerId:!!t&&t.get("layer_id")}]);c=t.get("dw"),g=void 0!=c?p.GisRootUrl+"/mapRender/identify":p.GisRootUrl+"/common/mapRender/identify",d=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),l=e.getView().calculateExtent(e.getSize()).join(",");var y=void 0!=s?s.slice(0,s.indexOf(":")):void 0,v=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),I=t.get("paramObj"),S={geometry:d,tolerance:void 0!=I&&void 0!=I.tolerance?I.tolerance:10,mapExtent:l,imgToken:s,FCName:y};m.get({url:g,data:f.getParameterString(S),success:function(r){if(!r)return void n([{layerId:!!t&&t.get("layer_id")}]);if(r=JSON.parse(r),!r||!r.data||!r.data.length)return void n([{layerId:!!t&&t.get("layer_id")}]);try{var i=r.data.map(function(r){return{mapId:e.getTarget(),layer:t,feature:a,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:void 0!=c?r.centerPoint:u.proj.toLonLat(r.centerPoint),pixLonLat:v,geometry:r.geometry,geoId:r.id,geoName:r.name,key:o}});n(i)}catch(l){void 0!=n&&"function"==typeof n&&n([{layerId:t.get("layer_id")}]),console.log(l)}},failure:function(e){void 0!=n&&"function"==typeof n&&n([{layerId:t.get("layer_id")}])}})}}function l(e,t,a,r,o,n){var i=h(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([{layerId:!!t&&t.get("layer_id")}]);var l,s,d,c;if(s=t.get("imgToken"),void 0==s)return void n([{layerId:!!t&&t.get("layer_id")}]);d=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),l=e.getView().calculateExtent(e.getSize()).join(","),c=void 0!=s?s.slice(0,s.indexOf(":")):void 0;var g=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),y=t.get("paramObj"),v={geometry:d,tolerance:void 0!=y&&void 0!=y.tolerance?y.tolerance:1,mapExtent:l,imgToken:s,FCName:c};m.get({url:p.GisRootUrl+"/common/mapRender/identify",data:f.getParameterString(v),success:function(r){if(!r)return void n([]);if(r=JSON.parse(r),!r||!r.data||!r.data.length)return void n([{layerId:!!t&&t.get("layer_id")}]);try{var i=r.data.map(function(r){return{mapId:e.getTarget(),layer:t,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:g,geometry:r.geometry,geoId:r.id,geoName:r.name,key:o,feature:a}});n(i)}catch(l){n([{layerId:t.get("layer_id")}])}},failure:function(e){n([{layerId:t.get("layer_id")}])}})}}function s(e,t,a,r,o,n){var i=h(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id")}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken");if(void 0==s)return void n([{layerId:t.get("layer_id")}]);var d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:.1,mapExtent:l,imgToken:s,FCName:d};m.get({url:p.GisRootUrl+"/common/mapRender/identify",data:f.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id")}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id")}]);else n([{layerId:t.get("layer_id")}])},failure:function(e){n([{layerId:t.get("layer_id")}])}})}function d(e,t,a,r,o,n){var i=h(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id")}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("params.imgToken");if(void 0==s)return void n([{layerId:t.get("layer_id")}]);var d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:.1,mapExtent:l,imgToken:t.get("params.imgToken"),FCName:d};m.get({url:p.GisRootUrl+"/mapRender/identify",data:f.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id")}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id")}])},failure:function(e){n([{layerId:t.get("layer_id")}])}})}function c(e,t,a,r,o,n){var i=h(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id")}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken");if(void 0==s)return void n([{layerId:t.get("layer_id")}]);var d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:2,mapExtent:l,imgToken:t.get("imgToken"),FCName:d};m.get({url:p.GisRootUrl+"/mapRender/identify",data:f.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id")}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id")}]);else n([{layerId:t.get("layer_id")}])},failure:function(e){n([{layerId:t.get("layer_id")}])}})}function g(e,t,a,r,o,n){var i=h(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id")}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken");if(void 0==s)return void n([{layerId:t.get("layer_id")}]);var d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:10,mapExtent:l,imgToken:t.get("imgToken"),FCName:d};m.get({url:p.GisRootUrl+"/mapRender/identify",data:f.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id")}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id")}])},failure:function(e){n([{layerId:t.get("layer_id")}])}})}var u=a(3),y=a(6),p=(a(12),a(9),a(13),a(7)),m=(a(4),a(14)),f=a(1),v=a(16),h=v.closeDrawAndMeasure,I=v.transformLonLat;e.exports={mapClick:r}},function(e,t,a){function r(e){var t,a,r=e.mapId;e.layerId?(t=e.layerId,a="layerId"):e.layer_id&&(t=e.layer_id,a="layer_id");var o=h.getMapObj(r)?h.getMapObj(r).getLayers().getArray().slice(0):[];return I.find(o,function(e){if(e&&e.get(a)===t)return e})}function o(e){var t,a,r=e.mapId,o=h.getMapObj(r);e.layerId?(t=e.layerId,a="layerId"):e.layer_id&&(t=e.layer_id,a="layer_id");var n=h.getMapObj(r).getLayers().getArray().slice(0);I.find(n,function(e){if(e&&e.get(a)===t)return o.removeLayer(e),e})}function n(e){return isFinite(e)&&null!==e&&e!==!1}function i(e){return n(e)?(e="EPSG:"+e,v.proj.get(e)):"string"==typeof e?(e=e.toUpperCase(),v.proj.get(e)):e instanceof v.proj.Projection?e:null}function l(e,t,a){if(!t||!a)return e;t=i(t),a=i(a);var r=v.proj.getTransform(t,a);return"string"==typeof e[0]||"number"==typeof e[0]?r(e):e.map(function(e){return r(e)})}function s(e){return h.getMapObj(e)}function d(e,t){var a=s(e).getOverlays().getArray().slice(0);return I.find(a,function(e){return e.get("name")===t})}function c(e,t){var a=s(e).getInteractions().getArray().slice(0);return I.find(a,function(e){return e.get("name")===t})}function g(e,t){e&&e.getFeatures().slice(0).forEach(function(a){a.get("type")===t&&e.removeFeature(a)})}function u(e){var t=s(e);if(t){var a=t.get("statistics");return a.popupZIndex?a.popupZIndex+=1:a.popupZIndex=20,a.popupZIndex}}function y(e){var t=new v.geom.Polygon([e]).transform("EPSG:4326","EPSG:3857");return t.getArea()}function p(e){var t=s(e.mapId);if(t&&e.extent&&4===e.extent.length){e.projection||(e.projection="EPSG:4326");var a=i(e.projection),r=v.proj.transformExtent(e.extent,a,"EPSG:3857");return b.fit(r,t.getSize()),b.getZoom()}}function m(e){var t=["geoLine","geoArea","geoAngle"],a=["Point","LineString","Polygon","Square","Box"],r=t.map(function(t,a){return fusiongis.Measure.isMeasuring({mapId:e,measureType:t})}),o=a.map(function(t,a){return fusiongis.Geometry.isDrawing({mapId:e,type:t})}),n=r.concat(o),i=n.filter(function(e,t){return 1==e});return!(i instanceof Array&&i.length>0)}function f(e,t){var a=[];if(2===arguments.length){var r=t.layerType,o=t.geometry;if(o){"String"==typeof o&&(o=JSON.parse(o));var n=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(v.proj.toLonLat(t))}},i=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(v.proj.toLonLat(t))}},l=function(){for(var e=0;e<o.length;e++){var t=o[e];a.push(v.proj.transformExtent(t,"EPSG:3857","EPSG:4326"))}};switch(r){case S.BUSINESSTYPE.GRID:l();break;case S.BUSINESSTYPE.SITE:i();break;case S.BUSINESSTYPE.SERVICEPOINT:i();break;case S.BUSINESSTYPE.CELL:n();break;case S.BUSINESSTYPE.SERVICELINE:n();break;default:n()}}}else{var s=e&&e.getGeometry();if(!s)return;if(s instanceof v.geom.GeometryCollection)return;var d=s.getCoordinates();if(!d)return[];if(s instanceof v.geom.Point)a.push(v.proj.toLonLat(d));else if(s instanceof v.geom.LineString)for(var c=0;c<d.length;c++){var g=d[c];a.push(v.proj.toLonLat(g))}else if(s instanceof v.geom.Polygon)for(var c=0;c<d[0].length;c++){var g=d[0][c];a.push(v.proj.toLonLat(g))}}return a}var v=a(3),h=a(6),I=a(1),S=a(7),b=new v.View;e.exports={getLayer:r,removeLayer:o,transform:l,getOverlayByName:d,getIntactByName:c,delFeatureByType:g,getPopupZIndex:u,getZoomForExtent:p,getPolygonArea:y,closeDrawAndMeasure:m,transformLonLat:f}},function(e,t,a){function r(e,t){var a=new Map,r=void 0,v=void 0,h=void 0,I=void 0,L=void 0,T=void 0,w=void 0,E=void 0,C=void 0,k=y.getMapObj(e);if(!k.get("clickHandle")){k.set("callbackList",{}),k.set("eventKeyANDEventLayerObj",{});var x=k.on("click",function(t){var y=S(k.getTarget());if(y===!1){var x=k.get("callbackList");return void(x["measure-distance-click-event"]&&x["measure-distance-click-event"]({e:t}))}var P=[],_=u.proj.toLonLat(k.getCoordinateFromPixel(t.pixel)),O=[],M={},N=k.hasFeatureAtPixel(t.pixel);N||(p.removeAllPopup(k.getTarget()),m.removePopup(k.getTarget())),k.forEachFeatureAtPixel(t.pixel,function(e){if(e){var t=e.get("vectorType"),a=f.BUSINESSTYPE,r=e.get("features");r&&r instanceof Array&&1===r.length&&O.push(r[0]),t!==a.POINT&&t!==a.LINE&&t!==a.POLYGON&&t!==a.ICON&&t!==a.CIRCLEPOINT&&t!==a.VECTOR_CELL&&t!==a.STRAIGHTLINE&&t!==a.ICON_FONT_STYLE&&t!==a.BUBBLE_CIRCLE_LABEL||e.get("highlightFeature")||O.push(e),P.push(e)}});var x=k.get("callbackList"),F=k.get("eventKeyANDEventLayerObj");if(O.length>0){for(var A=[],R=0;R<O.length;R++){var G=O[R];if(!G)return;var D=(G.get("vectorType"),G.get("layer")),j=G.getGeometry().getExtent(),Y=u.extent.getCenter(j),B=u.proj.toLonLat(Y),U={e:t,mapId:e,layerId:!!D&&D.get("layer_id"),layer:G.get("layer"),businessType:D&&D.get("businessType"),feature:G,data:G.get("data"),geoId:G.getId()?G.getId():G.get("id"),lonLat:[B[0].toFixed(6),B[1].toFixed(6)],pixLonLat:_,points:b(G)};if(r="yes",a.set("g_vectorFeature",r),1===O.length){var V=O[0].get("features")&&O[0].get("features")instanceof Array&&1===O[0].get("features").length,H=V?O[0].get("features")[0].get("layer"):void 0;U.layer=V&&H?H:U.layer,x["point-cluster-click-event"]&&x["point-cluster-click-event"](U)}A.push(U)}if(A.length>0)for(var R=0;R<A.length;R++){var W=[],z=[];for(var J in M)z.push(J);if(z.indexOf(A[R].layerId.toString())<0)for(var K=R;K<=A.length-1;K++)A[R].layerId==A[K].layerId&&(W.push(A[K]),M[A[R].layerId]=W)}}for(var Z in x)if(void 0!=x[Z]&&"function"==typeof x[Z]){var G=null;P.length>0&&(G=P[0]);var j=G&&G.getGeometry().getExtent(),Y=j&&u.extent.getCenter(j),B=[];Y&&(B=u.proj.toLonLat(Y));var D=F[Z];void 0!=D&&(D.get("businessType")===f.BUSINESSTYPE.GRID?(v="no",a.set("g_getGridInfo",v),o(k,D,G,t,Z,function(e){v="yes",a.set("g_getGridInfo",v),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):"DCELL"===D.get("businessType")?(h="no",a.set("g_getdCellInfo",h),n(k,D,G,t,Z,function(e){h="yes",a.set("g_getdCellInfo",h),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):"DPOINT"===D.get("businessType")||"SITE"===D.get("businessType")?(I="no",a.set("g_getdSiteInfo",I),i(k,D,G,t,Z,function(e){I="yes",a.set("g_getdSiteInfo",I),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):"DLINE"===D.get("businessType")?(L="no",a.set("g_getdLineInfo",L),l(k,D,G,t,Z,function(e){L="yes",a.set("g_getdLineInfo",L),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):"DPOLYGON"===D.get("businessType")?(T="no",a.set("g_getdServicePolygonInfo",T),s(k,D,G,t,Z,function(e){T="yes",a.set("g_getdServicePolygonInfo",T),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):D.get("businessType")===f.BUSINESSTYPE.SERVICEPOINT?(w="no",a.set("g_getServicePointInfo",w),c(k,D,G,t,Z,function(e){w="yes",a.set("g_getServicePointInfo",w),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):D.get("businessType")===f.BUSINESSTYPE.SERVICELINE?(E="no",a.set("g_getServiceLineInfo",E),g(k,D,G,t,Z,function(e){E="yes",a.set("g_getServiceLineInfo",E),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):D.get("businessType")===f.BUSINESSTYPE.SERVICEPOLYGON?(C="no",a.set("g_getServicePolygonInfo",C),d(k,D,G,t,Z,function(e){C="yes",a.set("g_getServicePolygonInfo",C),e&&e.length>0?M[e[0].layerId]=e:M[e[0].layerId]=[{}]})):"SERVICELAYER"===D.get("businessType")&&fusiongis.ServiceLayer.getServiceLayerInfo(k,D,t,function(e){e&&e.length>0&&(M[e[0].layerId]=e)}))}var q=void 0;try{q=setInterval(function(){var e=[];a.forEach(function(t,a){e.push({key:a,val:t})});for(var t=e.filter(function(e){return void 0!=e.val}),o=!1,n=[],i=0;i<t.length;i++)o="yes"==t[i].val,n.push(o);if(o=n.every(function(e){return 1==e})){var l=Object.getOwnPropertyNames(M).length;if(l>0)if(1==l){var s=void 0;for(var d in M)if(void 0==s&&(s=M[d][0].pixLonLat),1==M[d].length){var c=M[d][0];"GRID"==c.layerType?void 0!=c.geometry&&(fusiongis.Highlight.removeHighlight({mapId:c.mapId,layerId:c.layerId,hTypes:[f.HTYPE.CLICK]}),fusiongis.Highlight.highlight({mapId:c.mapId,layerId:c.layerId,highlightType:f.HTYPE.CLICK,geometry:c.geometry})):void 0!=c.geoId&&(fusiongis.Highlight.removeHighlight({mapId:c.mapId,layerId:c.layerId,hTypes:[f.HTYPE.VECTOR]}),fusiongis.Highlight.highlight({mapId:c.mapId,layerId:c.layerId,highlightType:f.HTYPE.VECTOR,geoIds:[c.geoId]}));var g=void 0==c.layer?void 0:c.layer.get("UIclickId");if(void 0==g)return void clearInterval(q);x[g]({e:c.e,layer:c.layer,feature:c.feature,featureCenter:c.lonLat,data:c.data,geoId:c.geoId,lonLat:c.lonLat,points:c.points,businessType:c.businessType,layerType:c.businessType,mapId:c.mapId,target:c.mapId,layerId:c.layerId,featureId:c.geoId,pixLonLat:c.pixLonLat})}else if(M[d].length>1){for(var u=M[d][0].mapId,y=M[d][0].layerId,p='<div style="padding: 5px 10px;"><div style="max-width: 200px; max-height: 130px; overflow: auto;font-size: 14px; white-space: nowrap;"  id="'+u+'">',i=0;i<M[d].length;i++){var c=M[d][i],S=c.geoId,b=c.points,k=y+" «» "+S,P=y+"_"+S;p+='<div style="cursor: pointer; height: 25px; line-height: 25px;"id="'+P+'" dir="'+S+'"  geometry="'+b+'">'+k+"</div>"}p+="</div></div>",m.addPopup({mapId:u,position:s,content:p,showCloseButton:!1});var _=document.querySelector("#"+u).querySelector("#"+u).querySelectorAll("div");if(void 0!=_&&_.length>0)for(var i=0;i<_.length;i++){var O=_[i];if(void 0==O)return;O.onclick=function(){var e=fusiongis.BaseLayer.getLayer({mapId:u,layerId:y}).get("layerType");"GRID"==e?void 0!=this.getAttribute("geometry")&&(fusiongis.Highlight.removeHighlight({mapId:u,layerId:y,hTypes:[f.HTYPE.CLICK]}),fusiongis.Highlight.highlight({mapId:u,layerId:y,highlightType:f.HTYPE.CLICK,geometry:this.getAttribute("geometry")})):void 0!=[this.getAttribute("dir")]&&(fusiongis.Highlight.removeHighlight({mapId:u,layerId:y,hTypes:[f.HTYPE.VECTOR]}),fusiongis.Highlight.highlight({mapId:u,layerId:y,highlightType:f.HTYPE.VECTOR,geoIds:[this.getAttribute("dir")]})),m.removePopup(u);for(var t=M[d][0].layer.get("UIclickId"),a=0;a<M[d].length;a++){var r=M[d][a].geoId;if(r==this.getAttribute("dir")){var o=M[d][a];x[t]({e:o.e,layer:o.layer,feature:o.feature,featureCenter:o.lonLat,data:o.data,geoId:o.geoId,lonLat:o.lonLat,points:o.points,businessType:o.businessType,layerType:o.businessType,mapId:o.mapId,target:o.mapId,layerId:o.layerId,featureId:o.geoId,pixLonLat:o.pixLonLat});break}}}}}}else{var u=void 0,p=void 0,N=void 0;for(var d in M){void 0==u&&(u=M[d][0].mapId,p='<div style="padding: 5px 10px;"><div style="max-width: 200px; max-height: 130px; overflow: auto;font-size: 14px; white-space: nowrap;"  id="'+u+'">'),void 0==N&&(N=M[d][0].pixLonLat);var F=M[d];if(void 0!=F&&F.length>0)for(var i=0;i<F.length;i++){var S=F[i].geoId,y=F[i].layerId,b=F[i].points,k=y+" «» "+S,P=y+"_"+S;p+='<div style="cursor: pointer; height: 25px; line-height: 25px;"id="'+P+'" dir="'+S+'" geometry="'+b+'">'+k+"</div>"}}p+="</div></div>",m.addPopup({mapId:u,position:N,content:p,showCloseButton:!1});var _=document.querySelector("#"+u).querySelector("#"+u).querySelectorAll("div");if(void 0!=_&&_.length>0)for(var i=0;i<_.length;i++){var O=_[i];if(void 0==O)return;O.onclick=function(){var e=function(){var e=O.id.indexOf(O.getAttribute("dir")),t=O.id.substring(0,e-1);return t}(),t=fusiongis.BaseLayer.getLayer({mapId:u,layerId:e}).get("layerType");"GRID"==t?void 0!=O.getAttribute("geometry")&&(fusiongis.Highlight.removeHighlight({mapId:u,layerId:e,hTypes:[f.HTYPE.CLICK]}),fusiongis.Highlight.highlight({mapId:u,layerId:function(){var e=O.id.indexOf(O.getAttribute("dir")),t=O.id.substring(0,e-1);return t}(),highlightType:f.HTYPE.CLICK,geometry:O.getAttribute("geometry")})):void 0!=[O.getAttribute("dir")]&&(fusiongis.Highlight.removeHighlight({mapId:u,layerId:e,hTypes:[f.HTYPE.VECTOR]}),fusiongis.Highlight.highlight({mapId:u,layerId:function(){var e=O.id.indexOf(O.getAttribute("dir")),t=O.id.substring(0,e-1);return t}(),highlightType:f.HTYPE.VECTOR,geoIds:[O.getAttribute("dir")]})),m.removePopup(u);for(var a in M){var r=this.id.indexOf(this.getAttribute("dir")),e=this.id.substring(0,r-1);if(e==a){for(var o=M[e][0].layer.get("UIclickId"),n=0;n<M[e].length;n++){var i=M[e][n].geoId;if(i==this.getAttribute("dir")){var l=M[e][n];x[o]({e:l.e,layer:l.layer,feature:l.feature,featureCenter:l.lonLat,data:l.data,geoId:l.geoId,lonLat:l.lonLat,points:l.points,businessType:l.businessType,layerType:l.businessType,mapId:l.mapId,target:l.mapId,layerId:l.layerId,featureId:l.geoId,pixLonLat:l.pixLonLat});break}}break}}}}}clearInterval(q),r=void 0,v=void 0,h=void 0,I=void 0,L=void 0,T=void 0,w=void 0,E=void 0,C=void 0}},500)}catch(t){console.error(t.message),clearInterval(q)}});k.set("clickHandle",x)}}function o(e,t,a,r,o,n){var i=S(e.getTarget());if(i!==!1){var l=t.get("paramObj"),s={geometry:{x:r.coordinate[0],y:r.coordinate[1]},tolerance:void 0!=l&&void 0!=l.tolerance?l.tolerance:1,mapExtent:e.getView().calculateExtent(e.getSize()),imgToken:t.get("imgToken")},d=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel));v.postJSON({url:f.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(s),success:function(r){if(!r)return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);var i=JSON.parse(r);if(!i||!i.data||!i.data.length)return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);if(void 0!=i.status&&1==i.status.code)try{var l=i.data.map(function(r){return{mapId:e.getTarget(),layer:t,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),feature:a,lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:d,geometry:r.geometry,geoId:r.id,data:r,extentInfo:r.extentInfo,geoName:r.name,key:o,originalCenterPoint:r.originalCenterPoint}});n(l)}catch(s){n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]),console.log(s)}else n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}])},failure:function(a){n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}])}})}}function n(e,t,a,r,o,n){var i=S(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([{layerId:!!layerObj&&layerObj.get("layer_id"),mapId:e.getTarget()}]);if(r.coordinate)var l=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),s=e.getView().calculateExtent(e.getSize()).join(","),d=t.get("imgToken"),c=void 0!=d?d.slice(0,d.indexOf(":")):void 0,g=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),y=t.get("paramObj"),p={geometry:l,tolerance:void 0!=y&&void 0!=y.tolerance?y.tolerance:.1,mapExtent:s,imgToken:d,FCName:c};v.get({url:f.GisRootUrl+"/common/mapRender/identify",data:h.getParameterString(p),success:function(r){if(!r)return void n([{layerId:!!layerObj&&layerObj.get("layer_id"),mapId:e.getTarget()}]);r=JSON.parse(r);try{if(!r||!r.data||!r.data.length)return void n([{layerId:!!layerObj&&layerObj.get("layer_id"),mapId:e.getTarget()}]);var i=h.sortBy(r.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),l=i[0].extentInfo.radius;i=i.filter(function(e){return e.extentInfo.radius===l}),i.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var s=i.map(function(r){return{mapId:e.getTarget(),layer:t,feature:a,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:g,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o}});"function"==typeof n&&n(s)}catch(d){"function"==typeof n&&n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]),console.log(d)}},failure:function(a){"function"==typeof n&&n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}})}}function i(e,t,a,r,o,n){var i=S(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);var l,s,d,c,g;s=t.get("imgToken"),c=t.get("dw"),g=void 0!=c?f.GisRootUrl+"/mapRender/identify":f.GisRootUrl+"/common/mapRender/identify",d=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),l=e.getView().calculateExtent(e.getSize()).join(",");var y=void 0!=s?s.slice(0,s.indexOf(":")):void 0,p=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),m=t.get("paramObj"),I={geometry:d,tolerance:void 0!=m&&void 0!=m.tolerance?m.tolerance:10,mapExtent:l,imgToken:s,FCName:y};v.get({url:g,data:h.getParameterString(I),success:function(r){if(!r)return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);if(r=JSON.parse(r),!r||!r.data||!r.data.length)return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);try{var i=r.data.map(function(r){return{mapId:e.getTarget(),layer:t,feature:a,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:void 0!=c?r.centerPoint:u.proj.toLonLat(r.centerPoint),pixLonLat:p,geometry:r.geometry,geoId:r.id,geoName:r.name,key:o}});n(i)}catch(l){void 0!=n&&"function"==typeof n&&n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]),console.log(l)}},failure:function(a){void 0!=n&&"function"==typeof n&&n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}})}}function l(e,t,a,r,o,n){var i=S(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);var l,s,d,c;s=t.get("imgToken"),d=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),l=e.getView().calculateExtent(e.getSize()).join(","),c=void 0!=s?s.slice(0,s.indexOf(":")):void 0;var g=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),y=t.get("paramObj"),p={geometry:d,tolerance:void 0!=y&&void 0!=y.tolerance?y.tolerance:1,mapExtent:l,imgToken:s,FCName:c};v.get({url:f.GisRootUrl+"/common/mapRender/identify",data:h.getParameterString(p),success:function(r){if(!r)return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);if(r=JSON.parse(r),!r||!r.data||!r.data.length)return void n([{layerId:!!t&&t.get("layer_id"),mapId:e.getTarget()}]);try{var i=r.data.map(function(r){return{mapId:e.getTarget(),layer:t,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:g,geometry:r.geometry,geoId:r.id,geoName:r.name,key:o,feature:a}});n(i)}catch(l){n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}},failure:function(a){n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}})}}function s(e,t,a,r,o,n){var i=S(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:.1,mapExtent:l,imgToken:s,FCName:d};v.get({url:f.GisRootUrl+"/common/mapRender/identify",data:h.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);else n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])},failure:function(a){n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}})}function d(e,t,a,r,o,n){var i=S(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("params.imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:.1,mapExtent:l,imgToken:t.get("params.imgToken"),FCName:d};v.get({url:f.GisRootUrl+"/mapRender/identify",data:h.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])},failure:function(a){n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}})}function c(e,t,a,r,o,n){var i=S(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:2,mapExtent:l,imgToken:t.get("imgToken"),FCName:d};v.get({url:f.GisRootUrl+"/mapRender/identify",data:h.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),
layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);else n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])},failure:function(a){n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}})}function g(e,t,a,r,o,n){var i=S(e.getTarget());if(i===!1)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:10,mapExtent:l,imgToken:t.get("imgToken"),FCName:d};v.get({url:f.GisRootUrl+"/mapRender/identify",data:h.getParameterString(y),success:function(r){if(!r)return void n([{layerId:t.get("layer_id"),mapId:e.getTarget()}]);var i=JSON.parse(r),l=i.status;if(1===l.code)if(i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}else n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])},failure:function(a){n([{layerId:t.get("layer_id"),mapId:e.getTarget()}])}})}var u=a(3),y=a(6),p=a(12),m=a(9),f=(a(13),a(7)),v=(a(4),a(14)),h=a(1),I=a(16),S=I.closeDrawAndMeasure,b=I.transformLonLat;e.exports={mapClick:r}},function(e,t,a){function r(e){var t=y.getMapObj(e);if(!t.get("clickHandle")){t.set("callbackList",{}),t.set("eventKeyANDEventLayerObj",{});var a=t.on("click",function(a){var r=[],y=[],h=[];t.forEachFeatureAtPixel(a.pixel,function(e){if(e){var t=e.get("features");t&&t instanceof Array&&t.length>0&&h.push(e),e.get("vectorType")!==v.BUSINESSTYPE.POINT&&e.get("vectorType")!==v.BUSINESSTYPE.LINE&&e.get("vectorType")!==v.BUSINESSTYPE.POLYGON&&e.get("vectorType")!==v.BUSINESSTYPE.ICON&&e.get("vectorType")!==v.BUSINESSTYPE.CIRCLEPOINT&&e.get("vectorType")!==v.BUSINESSTYPE.VECTOR_CELL&&e.get("vectorType")!==v.BUSINESSTYPE.STRAIGHTLINE&&"BUBBLE_CIRCLE_LABEL"!==e.get("vectorType")&&"ICON_FONT_STYLE"!==e.get("vectorType")||e.get("highlightFeature")||h.push(e),r.push(e)}}),y=t.getCoordinateFromPixel(a.pixel),y&&(y=u.proj.toLonLat(y));var I=t.get("callbackList"),S=t.get("eventKeyANDEventLayerObj");if(h.length>1){var b,T=!1;if(h.forEach(function(e){"BUBBLE_CIRCLE_LABEL"===e.get("businessType")&&(T=!0,b=e)}),T&&b.get("layer").get("isNotTip")){var w={e:a,layer:b.get("layer"),feature:b};"BUBBLE_CIRCLE_LABEL"===b.get("businessType")&&I["bubble-circle-label-click-event"]&&I["bubble-circle-label-click-event"](w)}else{var E=document.createElement("div"),C=document.createElement("ul");E.appendChild(C),E.style.width="400px",E.style.maxHeight="300px",E.className="clickpop-content",h.forEach(function(t){var r=document.createElement("li"),o=void 0!=t.getId()?t.getId():t.get("id");r.innerHTML=o,r.className="vGisWeb-restrict-line clickpop-line",r.title=o,r.style.cursor="pointer",r.attributes.feature=t,r.onclick=function(){p.removeAllPopup(e);var t={e:a,layer:this.attributes.feature.get("layer"),feature:this.attributes.feature},r=this.attributes.feature.get("businessType");r===v.BUSINESSTYPE.POINT?I.business_vector_point_event_id&&I.business_vector_point_event_id(t):r===v.BUSINESSTYPE.LINE?I.business_line_event_id&&I.business_line_event_id(t):r===v.BUSINESSTYPE.STRAIGHTLINE?I["straightline-click-event"]&&I["straightline-click-event"](t):r===v.BUSINESSTYPE.POLYGON?I.business_vector_polygon_event_id&&I.business_vector_polygon_event_id(t):r===v.BUSINESSTYPE.VECTOR_CELL?I["vector-cell-click-event"]&&I["vector-cell-click-event"](t):"BUBBLE_CIRCLE_LABEL"===r?I["bubble-circle-label-click-event"]&&I["bubble-circle-label-click-event"](t):"ICON_FONT_STYLE"===r&&I["font-style-click-event"]&&I["font-style-click-event"](t)},C.appendChild(r)}),p.addPopup({mapId:e,title:f.prop("mapClick.popup.title"),position:u.proj.toLonLat(a.coordinate),content:E,maxHeight:300,width:280})}}else if(1===h.length){p.removeAllPopup(e);var k=h[0].get("vectorType"),x=h[0].get("features")&&h[0].get("features")instanceof Array&&1===h[0].get("features").length,P=x?h[0].get("features")[0].get("layer"):void 0,_=h[0].get("layer"),O=h[0];if(!O)return;var M=O.getGeometry().getExtent(),N=u.extent.getCenter(M),F=u.proj.toLonLat(N),w={e:a,layer:x&&P?P:h[0].get("layer"),feature:h[0],featureCenter:N,data:O.get("data"),businessType:_&&_.get("businessType"),layerType:_&&_.get("businessType"),mapId:e,target:e,layerId:!!_&&_.get("layer_id"),featureId:O.getId()?O.getId():O.get("id"),geoId:O.getId()?O.getId():O.get("id"),lonLat:[F[0].toFixed(6),F[1].toFixed(6)],pixLonLat:y,points:L(O)};k===v.BUSINESSTYPE.POINT?I.business_vector_point_event_id&&I.business_vector_point_event_id(w):k===v.BUSINESSTYPE.LINE?I.business_line_event_id&&I.business_line_event_id(w):k===v.BUSINESSTYPE.STRAIGHTLINE?I["straightline-click-event"]&&I["straightline-click-event"](w):k===v.BUSINESSTYPE.POLYGON?I.business_vector_polygon_event_id&&I.business_vector_polygon_event_id(w):k===v.BUSINESSTYPE.VECTOR_CELL?I["vector-cell-click-event"]&&I["vector-cell-click-event"](w):k===v.BUSINESSTYPE.POINTER_CLUSTER?I["point-cluster-click-event"]&&I["point-cluster-click-event"](w):"BUBBLE_CIRCLE_LABEL"===k?I["bubble-circle-label-click-event"]&&I["bubble-circle-label-click-event"](w):"ICON_FONT_STYLE"===k?I["font-style-click-event"]&&I["font-style-click-event"](w):x&&I["point-cluster-click-event"]&&I["point-cluster-click-event"](w)}else p.removeAllPopup(e),m.removePopup(e),I.business_vector_point_event_id&&I.business_vector_point_event_id({}),I["measure-distance-click-event"]&&I["measure-distance-click-event"]({e:a}),I.business_line_event_id&&I.business_line_event_id({}),I.business_vector_polygon_event_id&&I.business_vector_polygon_event_id({}),I["straightline-click-event"]&&I["straightline-click-event"]({}),I["vector-cell-click-event"]&&I["vector-cell-click-event"]({});for(var A in I)if(void 0!=I[A]&&"function"==typeof I[A]){if("business_vector_point_event_id"==A||"business_line_event_id"==A||"business_vector_polygon_event_id"==A||"vector-cell-click-event"==A)continue;var O=null;r.length>0&&(O=r[0]);var M=O&&O.getGeometry().getExtent(),N=M&&u.extent.getCenter(M),F=[];N&&(F=u.proj.toLonLat(N));var _=S[A];if(void 0!=_)if(_.get("businessType")===v.BUSINESSTYPE.GRID)o(t,_,O,a,A,function(t){if(t&&t.length>0){var r=t[0];I[r.key]({e:a,layer:r.layer,feature:r.feature,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:L(void 0,{layerType:v.BUSINESSTYPE.GRID,geometry:r.geometry}),businessType:r.layerType,layerType:r.layerType,mapId:e,target:e,layerId:r.layerId,featureId:r.geoId,pixLonLat:y,originalCenterPoint:r.originalCenterPoint,transportDataToInnerLayer:[{mapId:r.mapId,layer:r.layer,layerId:r.layerId,layerType:r.layerType,geoId:r.geoId,lonLat:r.lonLat,geometry:r.geometry,extentInfo:r.extentInfo,geoName:r.geoName}]})}});else if("DCELL"===_.get("businessType"))n(t,_,O,a,A,function(t){if(t&&t.length>0){var r=t[0];I[r.key]({e:a,layer:r.layer,feature:r.feature,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:L(void 0,{layerType:v.BUSINESSTYPE.CELL,geometry:r.geometry}),businessType:r.layerType,layerType:r.layerType,mapId:e,target:e,layerId:r.layerId,featureId:r.geoId,pixLonLat:y,transportDataToInnerLayer:[{mapId:r.mapId,layer:r.layer,layerId:r.layerId,layerType:r.layerType,geoId:r.geoId,lonLat:r.lonLat,geometry:r.geometry,extentInfo:r.extentInfo,geoName:r.geoName,label:r.label}]})}});else if("DPOINT"===_.get("businessType")||"SITE"===_.get("businessType"))i(t,_,O,a,A,function(t){if(t&&t.length>0){var r=t[0],o=r.layer;I[r.key]({e:a,layer:o,feature:r.feature,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:L(void 0,{layerType:v.BUSINESSTYPE.SITE,geometry:r.geometry}),businessType:r.layerType,layerType:r.layerType,mapId:e,target:e,layerId:r.layerId,featureId:r.geoId,pixLonLat:y,transportDataToInnerLayer:[{mapId:e,layer:o,layerId:r.layerId,layerType:r.layerType,lonLat:r.lonLat,geometry:r.geometry,geoId:r.geoId,geoName:r.geoName,label:r.label}]})}});else if("DLINE"===_.get("businessType"))l(t,_,O,a,A,function(e){if(e&&e.length>0){var t=e[0];I[t.key]({e:a,mapId:t.mapId,layer:t.layer,feature:t.feature,featureCenter:t.lonLat,lonLat:t.lonLat,data:t.data,geoId:t.geoId,layerId:t.layerId,featureId:t.geoId,pixLonLat:y,businessType:t.layerType,transportDataToInnerLayer:[{mapId:t.mapId,layer:t.layer,layerId:t.layerId,layerType:t.layerType,lonLat:t.lonLat,geometry:t.geometry,geoId:t.geoId,geoName:t.geoName,label:t.label}]})}});else if("DPOLYGON"===_.get("businessType"))s(t,_,O,a,A,function(t){if(t&&t.length>0){var r=t[0];I[r.key]({e:a,feature:r.feature,layer:r.layer,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:L(void 0,{layerType:v.BUSINESSTYPE.SERVICEPOLYGON,geometry:r.geometry}),businessType:r.layer&&r.layer.get("businessType"),layerType:r.layer&&r.layer.get("businessType"),mapId:e,target:e,layerId:!!r.layer&&r.layer.get("layer_id"),featureId:r.geoId,pixLonLat:y,transportDataToInnerLayer:[{mapId:e,layer:r.layer,layerId:r.layerId,layerType:r.layerType,lonLat:r.lonLat,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.geoId,geoName:r.geoName,label:r.label}]})}});else if(_.get("businessType")===v.BUSINESSTYPE.SERVICEPOINT)c(t,_,O,a,A,function(t){if(t&&t.length>0){var r=t[0],o=r.layer;I[r.key]({e:a,layer:o,feature:r.feature,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:L(void 0,{layerType:v.BUSINESSTYPE.SERVICEPOINT,geometry:r.geometry}),businessType:o&&o.get("businessType"),layerType:o&&o.get("businessType"),mapId:e,target:e,layerId:!!o&&o.get("layer_id"),featureId:r.geoId,pixLonLat:y,transportDataToInnerLayer:[{lonLat:r.lonLat,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.geoId,geoName:r.geoName}]})}});else if(_.get("businessType")===v.BUSINESSTYPE.SERVICELINE)g(t,_,O,a,A,function(t){if(t&&t.length>0){var r=t[0],o=r.layer;I[r.key]({e:a,layer:o,feature:r.feature,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:L(void 0,{layerType:v.BUSINESSTYPE.SERVICELINE,geometry:r.geometry}),businessType:o&&o.get("businessType"),layerType:o&&o.get("businessType"),mapId:e,target:e,layerId:!!o&&o.get("layer_id"),featureId:r.geoId,pixLonLat:y,transportDataToInnerLayer:[{mapId:e,layer:o,layerId:r.layerId,layerType:r.layerType,lonLat:r.lonLat,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.geoId,geoName:r.geoName,label:r.label}]})}});else if(_.get("businessType")===v.BUSINESSTYPE.SERVICEPOLYGON)d(t,_,O,a,A,function(t){if(t&&t.length>0){var r=t[0],o=r.layer;I[r.key]({e:a,layer:o,feature:r.feature,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:L(void 0,{layerType:v.BUSINESSTYPE.SERVICEPOLYGON,geometry:r.geometry}),businessType:o&&o.get("businessType"),layerType:o&&o.get("businessType"),mapId:e,target:e,layerId:!!o&&o.get("layer_id"),featureId:r.geoId,pixLonLat:y,transportDataToInnerLayer:[{mapId:e,layer:o,layerId:r.layerId,layerType:r.layerType,lonLat:r.lonLat,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.geoId,geoName:r.geoName,label:r.label}]})}});else{var R=function(){if(O)return O.get("features")?1===O.get("features").length?O.get("features")[0].get("id"):void 0:O.getId()?O.getId():O.get("id")},G=function(){if(O)return O.get("features")?1===O.get("features").length?O.get("features")[0].get("data"):void 0:O.get("data")},D={e:a,layer:_,feature:O,data:G(),businessType:_&&_.get("businessType"),layerType:_&&_.get("businessType"),mapId:e,geoId:R(),featureId:R(),layerId:!!_&&_.get("layer_id"),featureCenter:N,lonLat:F?F:[108,34],pixLonLat:y,points:O&&O.getGeometry()&&L(O)};O&&O.getGeometry&&O.getGeometry().getArea&&(D.area=O.getGeometry().getArea()),O&&O.get("layer")&&O.get("layer").get("layer_id")===_.get("layer_id")&&I[A](D)}}});t.set("clickHandle",a)}}function o(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){var l=e.getView().calculateExtent(e.getSize()),s=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),d=t.get("paramObj"),c={geometry:{x:r.coordinate[0],y:r.coordinate[1]},tolerance:void 0!=d&&void 0!=d.tolerance?d.tolerance:1,mapExtent:l,imgToken:t.get("imgToken")};h.postJSON({url:v.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(c),success:function(r){if(!r)return void n([]);var i=JSON.parse(r);if(!i||!i.data||!i.data.length)return void n([]);if(void 0!=i.status&&1==i.status.code){var l=i.data.map(function(r){return{mapId:e.getTarget(),layer:t,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),feature:a,lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:s,geometry:r.geometry,geoId:r.id,data:r,extentInfo:r.extentInfo,geoName:r.name,key:o,originalCenterPoint:r.originalCenterPoint}});n(l)}else n([])},failure:function(e){n([])}})}}function n(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([]);var l,s,d,c;if(r.coordinate){d=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),l=e.getView().calculateExtent(e.getSize()).join(","),s=t.get("imgToken"),c=void 0!=s?s.slice(0,s.indexOf(":")):void 0;var g=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),y=t.get("paramObj"),p={geometry:d,tolerance:void 0!=y&&void 0!=y.tolerance?y.tolerance:.1,mapExtent:l,imgToken:s,FCName:c}}h.get({url:v.GisRootUrl+"/common/mapRender/identify",data:I.getParameterString(p),success:function(r){if(!r)return void n([]);if(r=JSON.parse(r),!r||!r.data||!r.data.length)return void n([]);var i=I.sortBy(r.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),l=i[0].extentInfo.radius;i=i.filter(function(e){return e.extentInfo.radius===l}),i.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var s=i.map(function(r){return{mapId:e.getTarget(),layer:t,feature:a,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:g,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o}});n(s)},failure:function(e){"function"==typeof n&&n([])}})}}function i(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([]);var l,s,d,c,g;s=t.get("imgToken"),c=t.get("dw"),g=void 0!=c?v.GisRootUrl+"/mapRender/identify":v.GisRootUrl+"/common/mapRender/identify",d=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),l=e.getView().calculateExtent(e.getSize()).join(",");var y=void 0!=s?s.slice(0,s.indexOf(":")):void 0,p=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),m=t.get("paramObj"),f={geometry:d,tolerance:void 0!=m&&void 0!=m.tolerance?m.tolerance:2,mapExtent:l,imgToken:s,FCName:y};h.get({url:g,data:I.getParameterString(f),success:function(r){if(!r)return void n([]);if(r=JSON.parse(r),!r||!r.data||!r.data.length)return void n([]);var i=r.data,l=i.map(function(r){return{mapId:e.getTarget(),layer:t,feature:a,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:p,geometry:r.geometry,geoId:r.id,geoName:r.name,key:o}});n(l)},failure:function(e){n([])}})}}function l(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([]);var l,s,d,c;s=t.get("imgToken"),d=JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),l=e.getView().calculateExtent(e.getSize()).join(","),c=void 0!=s?s.slice(0,s.indexOf(":")):void 0;var g=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),y=t.get("paramObj"),p={geometry:d,tolerance:void 0!=y&&void 0!=y.tolerance?y.tolerance:1,mapExtent:l,imgToken:s,FCName:c};h.get({url:v.GisRootUrl+"/common/mapRender/identify",data:I.getParameterString(p),success:function(r){if(!r)return void n([]);if(r=JSON.parse(r),!r||!r.data||!r.data.length)return void n([]);var i=r.data,l=i.map(function(r){return{mapId:e.getTarget(),layer:t,layerId:!!t&&t.get("layer_id"),layerType:!!t&&t.get("businessType"),label:!!t&&t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:g,geometry:r.geometry,geoId:r.id,geoName:r.name,key:o,feature:a}});n(l)},failure:function(e){n([])}})}}function s(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:.1,mapExtent:l,imgToken:s,FCName:d};h.get({url:v.GisRootUrl+"/common/mapRender/identify",data:I.getParameterString(y),success:function(r){if(r){var i=JSON.parse(r),l=i.status;if(1===l.code&&i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:u.proj.toLonLat(r.centerPoint),pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}}},failure:function(e){n([])}})}}function d(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("params.imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:.1,mapExtent:l,imgToken:t.get("params.imgToken"),FCName:d};h.get({url:v.GisRootUrl+"/mapRender/identify",data:I.getParameterString(y),success:function(r){if(r){var i=JSON.parse(r),l=i.status;if(1===l.code&&i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}}},failure:function(e){n([])}})}}function c(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:2,mapExtent:l,imgToken:t.get("imgToken"),FCName:d};h.get({url:v.GisRootUrl+"/mapRender/identify",data:I.getParameterString(y),success:function(r){if(r){var i=JSON.parse(r),l=i.status;if(1===l.code&&i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}}},failure:function(e){n([])}})}}function g(e,t,a,r,o,n){var i=b(e.getTarget());if(i!==!1){if(!t.getVisible())return void n([]);var l=e.getView().calculateExtent(e.getSize()),s=t.get("imgToken"),d=void 0!=s?s.slice(0,s.indexOf(":")):void 0,c=u.proj.toLonLat(e.getCoordinateFromPixel(r.pixel)),g=t.get("paramObj"),y={geometry:JSON.stringify({x:r.coordinate[0],y:r.coordinate[1]}),tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:10,mapExtent:l,imgToken:t.get("imgToken"),FCName:d};h.get({url:v.GisRootUrl+"/mapRender/identify",data:I.getParameterString(y),success:function(r){if(r){var i=JSON.parse(r),l=i.status;if(1===l.code&&i.data&&i.data.length>0){var s=i.data.map(function(r){var n={mapId:e.getTarget(),layer:t,layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:r.centerPoint,pixLonLat:c,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name,key:o,feature:a};return n});n&&"function"==typeof n&&n(s)}}},failure:function(e){n([])}})}}var u=a(3),y=a(6),p=a(12),m=a(9),f=a(13),v=a(7),h=(a(4),a(14)),I=a(1),S=a(16),b=S.closeDrawAndMeasure,L=S.transformLonLat;e.exports={mapClick:r}},function(e,t,a){var r=a(3),o=a(7),n=function(e){return e?new r.control.ScaleLine({className:e}):new r.control.ScaleLine},i=function(e){return new r.control.MousePosition({projection:o.PROJ.EPSG_4326,className:e,coordinateFormat:function(e){var t=e[0],a=e[1];return t>=180||t<=-180||a>=90||a<=-90?fusiongis.I18n.prop("MapMsg.mousePositionMsg"):e}})},l=function(e,t,a){return e?new r.control.ZoomToExtent({extent:r.proj.transformExtent(e,t,a)}):new r.control.ZoomToExtent({extent:r.proj.transformExtent([94.37296875000001,31.667004036130592,131.28703125,44.28205382728058],o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)})};e.exports={scaleLine:n,mousePosition:i,zoomContent:l}},function(e,t,a){function r(e){var t=e.isAssociate,a=e.mapIds;if(a&&a.forEach(function(e){t?(o(e),s.put("nowLink",!0)):(n(e),s.put("nowLink",!1))}),c.length>0){var r,g,u;c.forEach(function(e,t){if(0===t){r=i.getMapObj(e),g=r.getView(),u=r.get("currentMapType");var a=g.getCenter();a=ol.proj.toLonLat(a),a=[a[0]+1e-8,a[1]],a=ol.proj.fromLonLat(a),g.setCenter(a)}if("GOOGLE_MAP"===u){var o=i.getMapObj(e).get("mineCustomMap"),n=ol.proj.toLonLat(g.getCenter());o.setCenter(new google.maps.LatLng(n[1],n[0])),o.setZoom(g.getZoom())}else if("GAODE_MAP"===u){var l=i.getMapObj(e).get("mineCustomMap"),s=ol.proj.toLonLat(g.getCenter());s=d.transformGPS.gcj_encrypt(s[1],s[0]),l.setZoomAndCenter(g.getZoom(),[s.lon,s.lat])}})}e.hasOwnProperty("isOpen")&&l.acrossLine(e)}function o(e){var t=i.getMapObj(e);if(t){t.updateSize(),c.indexOf(e)===-1&&c.push(e);var a=i.getMapObj(c[0]),r=a.getView(),o=t.getView(),n=a.get("currentMapType");if("GOOGLE_MAP"===n){var l=t.get("mineCustomMap");if(!l)return;var s=t.get("customCenterKey"),g=t.get("customResolutionKey");s&&t.unByKey(s),g&&t.unByKey(g);var u=function(e){google.maps.event.trigger(l,"resize");var t=e.target,a=ol.proj.toLonLat(t.getCenter());l.setCenter(new google.maps.LatLng(a[1],a[0]))},y=function(e){var t=e.target;l.setZoom(t.getZoom())},s=r.on("change:center",u),g=r.on("change:resolution",y);t.set("customCenterKey",s),t.set("customResolutionKey",g)}else if("GAODE_MAP"===n){var p=t.get("mineCustomMap");if(!p)return;var s=t.get("customCenterKey"),g=t.get("customResolutionKey");s&&t.unByKey(s),g&&t.unByKey(g);var m=function(e){AMap.event.trigger(p,"resize");var t=e.target,a=ol.proj.toLonLat(t.getCenter());a=d.transformGPS.gcj_encrypt(a[1],a[0]),p.setZoomAndCenter(t.getZoom(),[a.lon,a.lat])},s=r.on("change:center",m),g=r.on("change:resolution",m);t.set("customCenterKey",s),t.set("customResolutionKey",g)}o.setCenter(r.getCenter()),o.setZoom(r.getZoom());var f=r.on("change:center",function(){o.setCenter(r.getCenter())}),v=r.on("change:resolution",function(){o.setZoom(r.getZoom())});void 0==a.get("mapstercenterchangeKey")&&a.set("mapstercenterchangeKey",[]),a.get("mapstercenterchangeKey").push(f),void 0==a.get("mapsterresolutionchangeKey")&&a.set("mapsterresolutionchangeKey",[]),a.get("mapsterresolutionchangeKey").push(v);var h=o.on("change:center",function(){r.setCenter(o.getCenter())}),I=o.on("change:resolution",function(){r.setZoom(o.getZoom())});t.set("fromcenterchangeKey",h),t.set("fromresolutionchangeKey",I)}}function n(e){var t=i.getMapObj(e);if(t){if(t.updateSize(),c.indexOf(e)!==-1&&!(c.length<1)){var a=i.getMapObj(c[0]),r=a.get("currentMapType"),o=a.getView(),n=t.getView();if("GOOGLE_MAP"===r){var l=t.get("mineCustomMap");if(!l)return;var s=l.olViewPropery,g=ol.proj.toLonLat(s.center);l.setCenter(new google.maps.LatLng(g[1],g[0])),l.setZoom(s.zoom);var u=t.get("customCenterKey"),y=t.get("customResolutionKey");u&&t.unByKey(u),y&&t.unByKey(y);var p=function(e){google.maps.event.trigger(l,"resize");var t=e.target,a=ol.proj.toLonLat(t.getCenter());l.setCenter(new google.maps.LatLng(a[1],a[0]))},m=function(e){var t=e.target;l.setZoom(t.getZoom())},u=n.on("change:center",p),y=n.on("change:resolution",m);t.set("customCenterKey",u),t.set("customResolutionKey",y);var f=fusiongis.Map.getMapObj(e).get("mineCustomMap");google.maps.event.trigger(f,"resize");var v=ol.proj.toLonLat(o.getCenter());f.setCenter(new google.maps.LatLng(v[1],v[0])),f.setZoom(o.getZoom())}else if("GAODE_MAP"===r){var h=t.get("mineCustomMap");if(!h)return;var s=h.olViewPropery,v=ol.proj.toLonLat(s.center);v=d.transformGPS.gcj_encrypt(v[1],v[0]),h.setZoomAndCenter(s.zoom(),[v.lon,v.lat]);var u=t.get("customCenterKey"),y=t.get("customResolutionKey");u&&t.unByKey(u),y&&t.unByKey(y);var I=function(e){AMap.event.trigger(h,"resize");var t=e.target,a=ol.proj.toLonLat(t.getCenter());a=d.transformGPS.gcj_encrypt(a[1],a[0]),h.setZoomAndCenter(t.getZoom(),[a.lon,a.lat])},u=n.on("change:center",I),y=n.on("change:resolution",I);t.set("customCenterKey",u),t.set("customResolutionKey",y);var S=fusiongis.Map.getMapObj(e).get("mineCustomMap");AMap.event.trigger(S,"resize"),v=ol.proj.toLonLat(o.getCenter()),v=d.transformGPS.gcj_encrypt(v[1],v[0]),S.setZoomAndCenter(o.getZoom(),[v.lon,v.lat])}if(void 0!=a.get("mapstercenterchangeKey")&&a.get("mapstercenterchangeKey").length>0){for(var b=0;b<a.get("mapstercenterchangeKey").length;b++)a.unByKey(a.get("mapstercenterchangeKey")[b]);a.set("mapstercenterchangeKey",[])}if(void 0!=a.get("mapsterresolutionchangeKey")&&a.get("mapsterresolutionchangeKey").length>0){for(var b=0;b<a.get("mapsterresolutionchangeKey").length;b++)a.unByKey(a.get("mapsterresolutionchangeKey")[b]);a.set("mapsterresolutionchangeKey",[])}t.unByKey(t.get("fromcenterchangeKey")),t.unByKey(t.get("fromresolutionchangeKey"))}}else for(var b in c)c[b]==e&&c.splice(b,1)}var i=a(6),l=a(21),s=a(4),d=a(1),c=[];e.exports={mapAssociate:r}},function(e,t,a){function r(e){var t=e.mapIds;if(e.isOpen){var a=[],r=e.crossLength||30;if(t&&t.length>0)for(var i=0,l=t.length;i<l;i++){var s=t[i],d="crossLineLayer",c=d+"_"+s,g=o.getMapObj(s);if(g){a.push(g);var u=new ol.style.Style({stroke:new ol.style.Stroke({color:e.strokeColor||"#000000",width:e.width||2})}),y=new ol.Feature({geometry:new ol.geom.LineString([[0,0],[1,1]])}),p=new ol.Feature({geometry:new ol.geom.LineString([[0,0],[1,1]])});y.setId(s+"_across"),p.setId(s+"upDown"),y.setStyle(u),p.setStyle(u);var m=new ol.layer.Vector({source:new ol.source.Vector({features:[y,p],wrapX:!1})});g.set("acrossFeature",y),g.set("upDownFeature",p),m.set("id",d),m.set("layer_id",d),n.put(c,m),g.addLayer(m);var f=g.on("pointermove",function(e){this.getTargetElement().style.cursor="default";for(var t=e.pixel,o=this.getCoordinateFromPixel([t[0]+r/2,t[1]]),n=this.getCoordinateFromPixel([t[0]-r/2,t[1]]),i=this.getCoordinateFromPixel([t[0],t[1]+r/2]),l=this.getCoordinateFromPixel([t[0],t[1]-r/2]),s=0;s<a.length;s++)a[s].get("acrossFeature").setGeometry(new ol.geom.LineString([o,n])),a[s].get("upDownFeature").setGeometry(new ol.geom.LineString([i,l]))});g.set("crossLayer",m),g.set("crossLineHandle",f)}}}else if(t&&t.length>0)for(var i=0,l=t.length;i<l;i++){var g=o.getMapObj(t[i]);g&&(g.unByKey(g.get("crossLineHandle")),g.removeLayer(g.get("crossLayer")))}}var o=a(6),n=a(4);e.exports={acrossLine:r}},function(e,t,a){function r(e){var t=function(e){var t=void 0!=e.defaultZoom?e.defaultZoom:n.MAPPROPERTY.DEFAULT_ZOOM,a=void 0!=e.minZoom?e.minZoom:n.MAPPROPERTY.DEFAULT_MIN_ZOOM,r=void 0!=e.maxZoom?e.maxZoom:n.MAPPROPERTY.DEFAULT_MAX_ZOOM,i=void 0!=e.center?o.proj.fromLonLat(e.center):o.proj.fromLonLat(n.MAPPROPERTY.DEFAULT_CENTER);if(a>r){var l=a;a=r,r=l}return t<a?t=a:t>r&&(t=r),{defaulZoom:t,minZoom:a,maxZoom:r,center:i}}(e),a=new o.View({center:t.center,zoom:t.defaulZoom,maxZoom:t.maxZoom,minZoom:t.minZoom,projection:void 0!=e.proj?e.proj:n.PROJ.EPSG_3857});return a.set("linkedMapIds",[e.mapId]),i=e.proj?e.proj:n.PROJ.EPSG_3857,a}var o=a(3),n=a(7),i=n.PROJ.EPSG_3857;e.exports={createView:r,projection:i}},function(e,t,a){var r=a(7),o=(a(4),function(e){var t=document.createElement(e.labelName);return!!e.id&&t.setAttribute("id",e.id),!!e["class"]&&t.setAttribute("class",e["class"]),!!e.title&&t.setAttribute("title",e.title),t}),n=function(e){var t=e.mapObj,a=e.mapType,n=e.bingMapKey,i=e.gaodeMapKey;if(void 0!=t){var l=t.get("paramObj");if(void 0==l||void 0==l.isShowMaptypeToolBar||0!=l.isShowMaptypeToolBar){var s=t.getTarget(),d=t.getTargetElement(),c=null;if(d.querySelector(".map_type_toolbar_container")?c=d.querySelector(".map_type_toolbar_container"):(c=o({labelName:"div","class":"map_type_toolbar_container"}),t.getTargetElement().appendChild(c)),function(){var e=c&&c.childNodes;if(e)for(var t=e.length,a=t;a>0;a--)c.removeChild(e[a-1])}(),a===r.MAPTYPE.GOOGLE_MAP){var g="base_layer_id_google",u=o({labelName:"div","class":"small_map_button google road"}),y=o({labelName:"div","class":"small_map_button google satellite"}),p=o({labelName:"div","class":"small_map_button google terrain"}),m=o({labelName:"div","class":"small_map_button google hybrid"});c.appendChild(u),c.appendChild(y),c.appendChild(p),c.appendChild(m),u.onclick=function(){fusiongis.Map.updateMap({mapId:s,mapType:a,layerId:g,layers:"roadmap"})},y.onclick=function(){fusiongis.Map.updateMap({mapId:s,mapType:a,layerId:g,layers:"satellite"})},p.onclick=function(){fusiongis.Map.updateMap({mapId:s,mapType:a,layerId:g,layers:"terrain"})},m.onclick=function(){fusiongis.Map.updateMap({mapId:s,mapType:a,layerId:g,layers:"hybrid"})}}else if(a===r.MAPTYPE.BING_MAP){var g="base_layer_id_bing",u=o({labelName:"div","class":"small_map_button bing road"}),y=o({labelName:"div","class":"small_map_button bing satellite"}),m=o({labelName:"div","class":"small_map_button bing hybrid"});c.appendChild(u),c.appendChild(y),c.appendChild(m),u.onclick=function(){n&&fusiongis.Map.updateMap({mapId:s,mapType:a,key:n,layerId:g,layers:"Road"})},y.onclick=function(){n&&fusiongis.Map.updateMap({mapId:s,mapType:a,key:n,layerId:g,layers:"Aerial"})},m.onclick=function(){n&&fusiongis.Map.updateMap({mapId:s,mapType:a,key:n,layerId:g,layers:"AerialWithLabels"})}}else if(a===r.MAPTYPE.TIANDI_MAP){var g="base_layer_id_tiandi",u=o({labelName:"div","class":"small_map_button tiandi road"}),y=o({labelName:"div","class":"small_map_button tiandi satellite"});c.appendChild(u),c.appendChild(y),u.onclick=function(){fusiongis.Map.updateMap({mapId:s,mapType:a,layerId:g,layers:"Road"})},y.onclick=function(){fusiongis.Map.updateMap({mapId:s,mapType:a,layerId:g,layers:"Satellite"})}}else if(a===r.MAPTYPE.GAODE_MAP){var g="base_layer_id_gaode",u=o({labelName:"div","class":"small_map_button gaode road"}),y=o({labelName:"div","class":"small_map_button gaode satellite"});c.appendChild(u),c.appendChild(y),u.onclick=function(){i&&fusiongis.Map.updateMap({mapId:s,mapType:a,key:i,layerId:g,layers:"Road"})},y.onclick=function(){i&&fusiongis.Map.updateMap({mapId:s,mapType:a,key:i,layerId:g,layers:"satellite"})}}}}};e.exports={mapTypeToolbar:n}},function(e,t,a){function r(e){if("undefined"!=typeof google){var t=void 0;t=void 0!=e.map?e.map:u.getMapObj(e.mapId);var a=t.getTargetElement(),r=document.createElement("div");r.setAttribute("id","$$customMap_"+e.mapId),r.setAttribute("class","customMap"),r.style.position="absolute",r.style.zIndex=0,r.style.width="100%",r.style.height="100%",a.insertBefore(r,a.firstChild);var o;o=e.layers?e.layers:p.Roadmap;var n=e.googleStyle||"style",i={mapTypeId:o,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:y[n]()};e.googleStyle||delete i.styles;var l=new google.maps.Map(r,i),s=function(e){if(google.maps.event.trigger(l,"resize"),(new c.sessionStorageObj).get("currentMapType")==g.MAPTYPE.GOOGLE_MAP){
var t=e.target,a=d.proj.toLonLat(t.getCenter());l.setCenter(new google.maps.LatLng(a[1],a[0]))}},m=function(e){if((new c.sessionStorageObj).get("currentMapType")==g.MAPTYPE.GOOGLE_MAP){var t=e.target;l.setZoom(t.getZoom())}},f=t.getView(),v=f.getZoom(),h=f.getCenter();l.olViewPropery={},l.olViewPropery.zoom=v,l.olViewPropery.center=h;var I=t.get("customCenterKey"),S=t.get("customResolutionKey");I&&t.unByKey(I),S&&t.unByKey(S),I=f.on("change:center",s),S=f.on("change:resolution",m),t.set("customCenterKey",I),t.set("customResolutionKey",S),t.set("mineCustomMap",l);var b=d.proj.toLonLat(f.getCenter());l.setCenter(new google.maps.LatLng(parseFloat(b[1]),parseFloat(b[0]))),l.setZoom(v);var L=a.querySelectorAll(".customMap");if(L&&L.length>1)for(var T=L.length-1;T>0;T--)t.getTargetElement().removeChild(L[T]);return l}}function o(e,t){var a=document.getElementById("$$customMap_"+e.getTarget());a&&(t?a.style.display="":a.style.display="none")}function n(e,t){var a=document.getElementById("$$customMap_"+e.getTarget());a&&isFinite(t)&&null!==t&&void 0!==t&&(t=Number(t),a.style.opacity=t)}function i(e){var t=u.getMapObj(e.mapId),a=t.get("customMap");if(a){var r=e.layers;a.setMapTypeId(r);var o=t.getView(),n=o.getCenter();a.setCenter(new google.maps.LatLng(n[1],n[0])),a.setZoom(o.getZoom())}}function l(e){var t=u.getMapObj(e.mapId),a=t.get("customMap");a&&a.set("styles",[{stylers:[{hue:"#9DF4C3"},{saturation:-100}]}])}function s(e){var t=u.getMapObj(e.mapId),a=t.get("customMap");a&&a.set("styles",null)}var d=a(3),c=a(1),g=a(7),u=(a(4),a(6)),y=a(25),p={Hybrid:"hybrid",Roadmap:"roadmap",Satellite:"satellite",Terrain:"terrain"},m=[],f=!1,v=0,h=function(e,t,a){if(f===!1){f=!0;var r=document.createElement("script"),o="http:";"file:"!==location.protocol&&(o=location.protocol);var n=t||"en-US",i=o+"//maps.google.com/maps/api/js?v=3&language="+n+"&key="+e;r.setAttribute("src",i),m.push(a),r.onload=function(){v=1,m.forEach(function(e){e(!0)}),m.splice(0)},r.onerror=function(){v=-1,a(!1)},document.body.appendChild(r)}else v>0?a(!0):v<0?a(!1):m.push(a)};e.exports={loadGoogleAPI:h,createCustomMap:r,updateCustomMap:i,setVisible:o,setOpacity:n,setImageFilter:l,removeImageFilter:s}},function(e,t){var a=function(){return[{featureType:"water",elementType:"geometry",stylers:[{color:"#23353b"}]},{featureType:"water",elementType:"labels",stylers:[{color:"#0f6665"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#23363c"},{lightness:10}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#23363c"},{lightness:5}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#23363c"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#23363c"},{lightness:16}]},{featureType:"road.local",elementType:"geometry",stylers:[{weight:.4},{color:"#5b7f91"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#5b7f91"},{weight:1}]},{featureType:"road.highway",elementType:"geometry",stylers:[{weight:.6},{color:"#5b7f91"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#333333"},{weight:2}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#cccccc"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#999999"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#999999"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#cccccc"},{weight:2},{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{gamma:.6},{lightness:-30}]},{featureType:"transit",elementType:"labels.icon",stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{lightness:5},{color:"#999999"}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels.icon",stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6}]},{featureType:"administrative",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{lightness:-30},{gamma:.6}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#658c99"}]},{featureType:"administrative.country",elementType:"geometry",stylers:[{weight:2},{color:"#00ffff"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{lightness:-5},{color:"#00807d"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{weight:1.5},{color:"#00807d"},{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{lightness:-40}]},{featureType:"landscape"}]},r=function(){return[{featureType:"water",elementType:"geometry",stylers:[{color:"#0f171a"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#1a282c"},{lightness:10}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#1a282c"},{lightness:5}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#1a282c"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#1a282c"},{lightness:16}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#415e68"},{weight:.1}]},{featureType:"road.highway",elementType:"geometry",stylers:[{weight:.6},{color:"#415e68"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#333333"},{weight:2},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#cccccc"},{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#999999"},{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#999999"},{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{color:"#cccccc"},{weight:2},{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{gamma:.6},{lightness:-30},{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6},{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{lightness:5},{color:"#999999"},{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{color:"#00807d"},{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels.icon",stylers:[{hue:"#00ccff"},{lightness:-30},{gamma:.6},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.icon",stylers:[{hue:"#00c3ff"},{lightness:-30},{gamma:.6},{visibility:"off"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#557580"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{lightness:-5},{color:"#00807d"},{visibility:"off"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{weight:1.5},{color:"#00807d"},{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{lightness:-40},{visibility:"off"}]},{featureType:"administrative.country",stylers:[{color:"#00fffc"},{weight:2}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}]},o=function(){return[{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]}]},n=function(){return[{elementType:"geometry",stylers:[{color:"#ebe3cd"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#c9b2a6"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#dcd2be"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#93817c"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#a5b076"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#447530"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f5f1e6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fdfcf8"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#f8c967"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#e9bc62"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#e98d58"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#db8555"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#806b63"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#8f7d77"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#ebe3cd"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b9d3c2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#92998d"}]}]},i=function(){return[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]},l=function(){return[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}]};e.exports={style:a,smallStyle:r,hiding:o,retro:n,night:i,silver:l}},function(e,t,a){function r(e){if("undefined"!=typeof AMap){var t=void 0;t=void 0!=e.map?e.map:g.getMapObj(e.mapId);var a=t.getTargetElement(),r=document.getElementById("#$$customMap_"+e.mapId);r&&a.removeChild(r);var o=document.createElement("div");o.setAttribute("id","$$customMap_"+e.mapId),o.setAttribute("class","customMap"),o.style.position="absolute",o.style.zIndex=0,o.style.width="100%",o.style.height="100%",a.insertBefore(o,a.firstChild);var n={resizeEnable:!0,dragEnable:!1,zoomEnable:!1,doubleClickZoom:!1,keyboardEnable:!1,scrollWheel:!1};e&&e.layers&&e.layers===y.Satellite?n.layers=[new AMap.TileLayer.Satellite,new AMap.TileLayer.RoadNet]:delete n.layers;var i=new AMap.Map(o.id,n),l=function(e){if((new u.sessionStorageObj).get("currentMapType")==c.MAPTYPE.GAODE_MAP){AMap.event.trigger(i,"resize");var t=e.target,a=d.proj.toLonLat(t.getCenter());a=u.transformGPS.gcj_encrypt(a[1],a[0]),i.setZoomAndCenter(t.getZoom(),[a.lon,a.lat])}},s=t.getView(),p=s.getZoom(),m=s.getCenter();i.olViewPropery={},i.olViewPropery.zoom=p,i.olViewPropery.center=m;var f=t.get("customCenterKey"),v=t.get("customResolutionKey");f&&t.unByKey(f),v&&t.unByKey(v),f=s.on("change:center",l),v=s.on("change:resolution",l),t.set("customCenterKey",f),t.set("customResolutionKey",v),t.set("mineCustomMap",i);var h=d.proj.toLonLat(s.getCenter());h=u.transformGPS.gcj_encrypt(h[1],h[0]),i.setZoomAndCenter(p,[h.lon,h.lat]);var I=a.querySelectorAll(".customMap");if(I&&I.length>1)for(var S=I.length-1;S>0;S--)t.getTargetElement().removeChild(I[S]);return i}}function o(e){var t=g.getMapObj(e.mapId),a=t.get("customMap");if(a){r(e);var o=t.getView(),n=o.getZoom(),i=d.proj.toLonLat(o.getCenter());i=u.transformGPS.gcj_encrypt(i[1],i[0]),a.setZoomAndCenter(n,[i.lon,i.lat])}}function n(e,t){var a=document.getElementById("$$customMap_"+e.getTarget());a&&(t?a.style.display="":a.style.display="none")}function i(e,t){var a=document.getElementById("$$customMap_"+e.getTarget());a&&isFinite(t)&&null!==t&&void 0!==t&&(t=Number(t),a.style.opacity=t)}function l(e){var t=g.getMapObj(e.mapId),a=t.get("customMap");a&&a.set("styles",[{stylers:[{hue:"#9DF4C3"},{saturation:-100}]}])}function s(e){var t=g.getMapObj(e.mapId),a=t.get("customMap");a&&a.set("styles",null)}var d=a(3),c=a(7),g=(a(4),a(6)),u=a(1),y={Roadmap:"roadmap",Satellite:"satellite"},p=[],m=!1,f=0,v=function(e,t,a){if(m===!1){m=!0;var r=document.createElement("script"),o="http:";"file:"!==location.protocol&&(o=location.protocol);var n=t||"en-US",i=o+"//webapi.amap.com/maps?v=1.3&language="+n+"&key="+e;r.setAttribute("src",i),p.push(a),r.onload=function(){f=1,p.forEach(function(e){e(!0)}),p.splice(0)},r.onerror=function(){f=-1,a(!1)},document.body.appendChild(r)}else f>0?a(!0):f<0?a(!1):p.push(a)};e.exports={loadGaodeAPI:v,createCustomMap:r,updateCustomMap:o,setVisible:n,setOpacity:i,setImageFilter:l,removeImageFilter:s}},function(e,t,a){var r=a(3),o=a(4),n=a(7),i=function(e){var t=e.layerId+"_"+e.mapId,a=void 0;"http:"!==location.protocol&&"file:"!==location.protocol||(a="http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png");var i=new r.layer.Tile({source:new r.source.OSM({url:a,wrapX:!1})});return i.set("type",n.CUSTOMTYPE.LAYERTILETYPE),i.set("layerId",t),i.set("layer_id",e.layer_id),i.set("mapType",n.Search_Engine.OSM),o.put(t,i),i};e.exports={createLayer:i}},function(e,t,a){function r(e){var t;t=e.layers?e.layers:l.Road;var a=new o.layer.Tile({source:new o.source.BingMaps({imagerySet:t,key:e.key||void 0,wrapX:!1})}),r=e.layerId+"_"+e.mapId;return a.set("type",n.CUSTOMTYPE.LAYERTILETYPE),a.set("layerId",r),a.set("layer_id",e.layer_id),i.put(r,a),a}var o=a(3),n=a(7),i=a(4),l=(a(1),{Road:"Road",Aerial:"Aerial",AerialWithLabels:"AerialWithLabels",Birdseye:"Birdseye",BirdseyeWithLabels:"BirdseyeWithLabels",CollinsBart:"CollinsBart",OrdnanceSurvey:"OrdnanceSurvey"});e.exports={BingMapTypes:l,createLayer:r}},function(e,t,a){var r=a(3),o=a(7),n=a(4),i=function(e){var t=e.layerId+"_"+e.mapId,a="http://gis.huawei.com/gis/cbb/rest/ogcservices/v1r1/gmapwmts/MapServer/tile/{z}/{y}/{x}",i=new r.layer.Tile({source:new r.source.XYZ({url:a+"?key="+e.key,attributions:[new r.Attribution({html:'<a href="http://gis.huawei.com/gis/" target="_blank" title="huawei Map">GisSpace</a>'})],wrapX:!1,crossOrigin:"anonymous"})});return i.set("type",o.CUSTOMTYPE.LAYERTILETYPE),i.set("layerId",t),i.set("layer_id",e.layer_id),n.put(t,i),i};e.exports={createLayer:i}},function(e,t,a){var r=a(3),o=a(7),n=a(4),i=function(e){var t,a=e.layerId+"_"+e.mapId;return t=e&&e.isMapCutting?new r.layer.Tile({source:new r.source.XYZ({url:e.url,params:{LAYERS:e.layers,MAPNAME:e.mapName,VERSION:e.version||"1.1.1",mapName:e.mapName},wrapX:!1})}):e&&e.title?new r.layer.Tile({source:new r.source.TileWMS({url:e.url,params:{FORMAT:e.format||"image/png",VERSION:e.version||"1.1.1",BBOX:e.bbox,tiled:!0,LAYERS:e.layers,STYLES:e.styles||""},wrapX:!1})}):new r.layer.Image({source:new r.source.ImageWMS({url:e.url,params:{LAYERS:e.layers,MAPNAME:e.mapName,VERSION:e.version||"1.1.1",mapName:e.mapName},wrapX:!1})}),t.set("type",o.CUSTOMTYPE.LAYERTILETYPE),t.set("layerId",a),t.set("layer_id",e.layer_id),n.put(a,t),t};e.exports={createLayer:i}},function(e,t,a){var r=a(3),o=a(4),n=(a(7),function(e){var t=e.layerId+"_"+e.mapId,a=new r.layer.Tile({title:"VWorld Gray Map",visible:!0,type:"base",source:new r.source.XYZ({url:"http://xdworld.vworld.kr:8080/2d/Base/201512/{z}/{x}/{y}.png",attributions:[new r.Attribution({html:['&copy; <a href="http://map.vworld.kr">V-World Map</a>']})],wrapX:!1})});return a.set("layer_id",e.layer_id),o.put(t,a),a});e.exports={createLayer:n}},function(e,t,a){var r=a(3),o=a(4),n=new r.Attribution({html:'&copy; <a href="http://www.tianditu.cn/index/contact.html?type=3/">map world</a>'}),i=function(e){var t=e.layerId+"_"+e.mapId,a=new r.layer.Tile({attributions:[n],source:new r.source.XYZ({attributions:[n],url:"http://t3.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}",wrapX:!1})});return a.set("layer_id",e.layer_id),o.put(t,a),a},l=function(e){var t=e.layerId+"_"+e.mapId,a=new r.layer.Tile({attributions:[n],source:new r.source.XYZ({attributions:[n],url:"http://t3.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}",wrapX:!1})});return a.set("layer_id",e.layer_id),o.put(t,a),a},s=function(e){var t=e.layerId+"_"+e.mapId,a=new r.layer.Tile({attributions:[n],source:new r.source.XYZ({attributions:[n],url:"http://t3.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}",wrapX:!1})});return a.set("layer_id",e.layer_id),o.put(t,a),a};e.exports={createRoadLayer:i,createMarkerLayer:l,createSatelliteLayer:s}},function(e,t,a){var r=a(3),o=a(7),n=a(4),i=function(e){for(var t=[],a=18,i=0;i<=a;i++)t[i]=Math.pow(2,a-i);var l=new r.tilegrid.TileGrid({origin:[0,0],resolutions:t}),s=new r.source.TileImage({projection:"EPSG:3857",tileGrid:l,tileUrlFunction:function(e,t,a){var r=e[0],o=e[1],n=e[2];return o<0&&(o="M"+-o),n<0&&(n="M"+-n),["http://online0.map.bdimg.com/onlinelabel/?qt=tile&x="+o+"&y="+n+"&z="+r+"&styles=pl&udt=20170730&scaler=1&p=0","http://online1.map.bdimg.com/onlinelabel/?qt=tile&x="+o+"&y="+n+"&z="+r+"&styles=pl&udt=20170730&scaler=1&p=0","http://online2.map.bdimg.com/onlinelabel/?qt=tile&x="+o+"&y="+n+"&z="+r+"&styles=pl&udt=20170730&scaler=1&p=0","http://online3.map.bdimg.com/onlinelabel/?qt=tile&x="+o+"&y="+n+"&z="+r+"&styles=pl&udt=20170730&scaler=1&p=0"]},wrapX:!1}),d=new r.layer.Tile({source:s}),c=e.layerId+"_"+e.mapId;return d.set("type",o.CUSTOMTYPE.LAYERTILETYPE),d.set("layerId",c),d.set("layer_id",e.layer_id),n.put(c,d),d};e.exports={createLayer:i}},function(e,t,a){var r=a(3),o=a(7),n=a(4),i=function(e){var t=new r.layer.Tile({source:new r.source.XYZ({url:"http://www.google.cn/maps/vt/pb=!1m4!1m3!1i{z}!2i{x}!3i{y}!2m3!1e0!2sm!3i345013117!3m8!2szh-CN!3scn!5e1105!12m4!1e68!2m2!1sset!2sRoadmap!4e0",wrapX:!1})}),a=e.layerId+"_"+e.mapId;return t.set("type",o.CUSTOMTYPE.LAYERTILETYPE),t.set("layerId",a),t.set("layer_id",e.layer_id),n.put(a,t),t};e.exports={createLayer:i}},function(e,t,a){var r=a(3),o=a(7),n=a(4),i=function(e){var t=new r.layer.Tile({source:new r.source.XYZ({tileSize:512,url:"https://{0-3}.base.maps.api.here.com/maptile/2.1/maptile/newest/normal.day/{z}/{x}/{y}/512/png8?lg=ENG&ppi=250&token=TrLJuXVK62IQk0vuXFzaig%3D%3D&requestid=yahoo.prod&app_id=eAdkWGYRoc4RfxVo0Z4B",wrapX:!1})}),a=e.layerId+"_"+e.mapId;return t.set("type",o.CUSTOMTYPE.LAYERTILETYPE),t.set("layerId",a),t.set("layer_id",e.layer_id),n.put(a,t),t};e.exports={createLayer:i}},function(e,t,a){var r=a(3),o=a(7),n=a(4),i=a(6),l=function(e){var t=e.layerId+"_"+e.mapId,a=i.getMapObj(e.mapId),l=null;if(n.containsKey(t))l=n.get(t);else{var s="https://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Specialty/ESRI_StateCityHighway_USA/MapServer";l=e.url.indexOf(s)!=-1?new r.layer.Tile({opacity:.7,source:new r.source.TileArcGISRest({url:e.url,wrapX:!1})}):new r.layer.Tile({opacity:.7,source:new r.source.TileArcGISRest({url:e.url,wrapX:!1,crossOrigin:"anonymous"})}),l.set("type",o.CUSTOMTYPE.LAYERTILETYPE),l.set("businessType",o.CUSTOMTYPE.LAYERTILETYPE),void 0!=e.minShowLevel&&l.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&l.set("maxShowLevel",parseInt(e.maxShowLevel)),n.put(t,l),a.addLayer(l)}return l};e.exports={createArcgisTileLayer:l}},function(e,t,a){function r(e,t){var a=t.getView().calculateExtent(t.getSize()),r=[[[a[0],a[1]],[a[2],a[1]],[a[2],a[3]],[a[0],a[3]],[a[0],a[1]]]];e.getSource().clear();var o=new l.Feature(new l.geom.Polygon(r));e.getSource().addFeature(o)}function o(e){for(var t=e.getControls().getArray(),a=e.getInteractions().getArray(),r=t.length;r>=0;r--)e.removeControl(t[r]);for(var o=a.length-2;o>=0;o--)a[o].setActive(!1),e.removeInteraction(a[o])}function n(e,t){var a=t.mapId+"_overview",r=t.layerId,o=t.mapType,n=t.url,i=t.key,s=t.mapName,c=t.layers,I=t.version,S=t.language,b="base_layer";switch(t.mapId=a,t.map=e,o){case d.MAPTYPE.OSM_MAP:e.getLayers().insertAt(0,y.createLayer({mapId:a,layerId:r,layer_id:b}));break;case d.MAPTYPE.HUAWEI_MAP:e.getLayers().insertAt(0,m.createLayer({mapId:a,url:n,key:i,layerId:r,layer_id:b}));break;case d.MAPTYPE.WMS_MAP:e.getLayers().insertAt(0,f.createLayer({mapId:a,url:n,layers:c,version:I,layerId:r,layer_id:b,mapName:s,title:t.title||""}));break;case d.MAPTYPE.BING_MAP:e.getLayers().insertAt(0,p.createLayer({mapId:a,key:i,layerId:r,layer_id:b,layers:c}));break;case d.MAPTYPE.GOOGLE_MAP:i?g.loadGoogleAPI(i,S,function(e){e&&(window.sessionStorage&&sessionStorage.setItem("key",i),g.createCustomMap(t))}):console.error("load google api failed...");break;case d.MAPTYPE.TIANDI_MAP:var L=fusiongis.BaseLayer.getLayer({mapId:a,layerId:b+"_marker"});L&&L instanceof l.layer.Tile&&e.removeLayer(L),e.getLayers().insertAt(0,v.createRoadLayer({mapId:a,layerId:b,layer_id:b})),e.getLayers().insertAt(1,v.createMarkerLayer({mapId:a,layerId:b+"_marker",layer_id:b+"_marker"}));break;case d.MAPTYPE.BAIDU_MAP:e.getLayers().insertAt(0,bDuMap.createLayer({mapId:a,layerId:r,layer_id:b}));break;case d.MAPTYPE.GAODE_MAP:i?u.loadGaodeAPI(i,S,function(e){e&&(window.sessionStorage&&sessionStorage.setItem("key",i),u.createCustomMap(t))}):console.error("load gaode api failed...");break;case d.MAPTYPE.ARCGISTILE_LAYER:e.getLayers().insertAt(0,h.createArcgisTileLayer({mapId:a,layerId:r,layer_id:b,url:n}));break;default:e.getLayers().insertAt(0,y.createLayer({mapId:a,layerId:r,layer_id:b}))}}function i(e){function t(){setTimeout(function(){var e=f.getView(),t=l.animation.pan({duration:250,source:e.getCenter()});f.beforeRender(t),e.setCenter(a.getView().getCenter()),e.setZoom(function(){var e=a.getView().getZoom(),t={};return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=1,t[7]=2,t[8]=3,t[9]=4,t[10]=5,t[11]=6,t[12]=7,t[13]=8,t[14]=9,t[15]=10,t[16]=11,t[17]=12,t[e]}())},300)}var a=c.getMapObj(e.mapId),i=e.mapId+"_overviewSpan",g=e.mapId+"_overview";if(a){var u=document.querySelector("#"+i),y=document.querySelector("#"+g);void 0!=u&&a.getTargetElement().removeChild(u),void 0!=y&&a.getTargetElement().removeChild(y);var p=document.createElement("span");p.setAttribute("style","width: 15px;height:15px;position: absolute;z-index: 2;border: 1px solid gray;left:2px;bottom:2px;color: rgb(255,255,255);cursor: pointer;font-size: 18.4px;background-color: rgba(0,60,136,.5);font-weight: 700;line-height: 15px;border-radius:2px;-webkit-border-radius:2px; -moz-border-radius: 2px"),p.setAttribute("id",i),p.innerHTML="»",a.getTargetElement().appendChild(p);var m=document.createElement("div");m.setAttribute("style","width: 150px;height:150px;position: absolute;z-index: -1;border: 1px solid gray;left:10px;bottom:10px;"),m.setAttribute("id",g),a.getTargetElement().appendChild(m),p.onclick=function(){m.style.zIndex==-1?(m.style.zIndex=1,this.innerHTML="«"):(m.style.zIndex=-1,this.innerHTML="»")};var f=new l.Map({target:m,view:new l.View({center:a.getView().getCenter()})});n(f,e),f.addInteraction(s.addDrag(a)),o(f),f.on("pointermove",function(e){f.getTargetElement().style.cursor="pointer"});var v=new l.layer.Vector({source:new l.source.Vector({wrapX:!1}),style:new l.style.Style({fill:new l.style.Fill({color:"rgba(160,160,160,0.2)"}),stroke:new l.style.Stroke({color:"gray",width:2})})});f.addLayer(v),r(v,a),(e.mapType=d.MAPTYPE.GOOGLE_MAP)&&t(f,a),a.on("moveend",function(){t(f,a),r(v,a)})}}var l=a(3),s=a(38),d=a(7),c=a(6),g=a(24),u=a(26),y=a(27),p=a(28),m=a(29),f=a(30),v=a(32),h=a(36);e.exports={addMinMap:i}},function(e,t){var a={};a.Drag=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:a.Drag.prototype.handleDownEvent,handleDragEvent:a.Drag.prototype.handleDragEvent,handleMoveEvent:a.Drag.prototype.handleMoveEvent,handleUpEvent:a.Drag.prototype.handleUpEvent}),this.mainMap=e,this.id="custom",this.coordinate_=null,this.cursor_="pointer",this.feature_=null,this.previousCursor_=void 0},ol.inherits(a.Drag,ol.interaction.Pointer),a.Drag.prototype.handleDownEvent=function(e){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){return e});return a&&(this.coordinate_=e.coordinate,this.feature_=a),!!a},a.Drag.prototype.handleDragEvent=function(e){var t=e.coordinate[0]-this.coordinate_[0],a=e.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(t,a),this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1]},a.Drag.prototype.handleMoveEvent=function(e){if(this.cursor_){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){return e}),r=e.map.getTargetElement();a?r.style.cursor!=this.cursor_&&(this.previousCursor_=r.style.cursor,r.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}},a.Drag.prototype.handleUpEvent=function(e){var t=e.map,a=new ol.geom.Polygon(this.feature_.getGeometry().getCoordinates()),r=a.getInteriorPoint().getCoordinates();return t.getView().setCenter(r),this.mainMap.getView().setCenter(r),this.coordinate_=null,this.feature_=null,!1},e.exports={addDrag:function(e){return new a.Drag(e)}}},function(e,t,a){function r(e){var t=u.getMapObj(e.mapId);t.getTargetElement().querySelector(".vGisWeb_component")||!function(e){var t=document.createElement("div");t.className="vGisWeb_component",e.getTargetElement().appendChild(t),e.set("component.container",t)}(t);var a=t.get("layerManager.layersChange");a&&t.unByKey(a),a=t.getLayers().on("change:length",function(t){o(e.mapId)}),t.set("layerManager.layersChange",a);new g(e.mapId)}function o(e){var t=u.getMapObj(e);if(void 0!=t){var a=t.getLayers().getArray();if(a=p.sortBy(a,function(e){return e.getZIndex()}),d(t,a)!==!1){var r=[];r.mapId=e,r.changeType="list",a.forEach(function(t){t.get("layer_id")&&n(e,t,r)}),c(r)}}}function n(e,t,a){var r="",o="",n=t.get("layer_id");"base_layer"===n?(r="BASELAYER",o=m.prop("LayerLabel.BASELAYER")):" base_layer_marker"===n?(r="BASELAYER",o=m.prop("LayerLabel.BASELAYER_MARKER")):(r=t.get("businessType"),o=t.get("params.label")?t.get("params.label"):n),a.push({mapId:e,layerName:o,layerId:n,layerType:r,visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")}),i(e,t,r),l(e,t,r),s(e,t,r)}function i(e,t,a){var r=t.get("layerManager.visibleChange");r||(r=t.on("change:visible",function(r){var o={mapId:e,layerName:t.get("params.label"),layerId:t.get("layer_id"),layerType:a,changeType:"visible",visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")},n=u.getMapObj(e),i=n.get("layerManager.manager");i.displayOpacity(o)}),t.set("layerManager.visibleChange",r))}function l(e,t,a){var r=t.get("layerManager.opacityChange");r||(r=t.on("change:opacity",function(){var r={mapId:e,layerName:t.get("params.label"),layerId:t.get("layer_id"),layerType:a,changeType:"opacity",visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")},o=u.getMapObj(e),n=o.get("layerManager.manager");n.displayVisibility(r)}),t.set("layerManager.opacityChange",r))}function s(e,t,a){var r=t.get("layerManager.nameChange");r||(r=t.on("change:params.label",function(){var r={mapId:e,layerName:t.get("params.label"),layerId:t.get("layer_id"),layerType:a,changeType:"layerName",visible:t.getVisible(),opacity:t.getOpacity(),zIndex:t.getZIndex(),showLabel:!!t.get("state.showLabel")},o=u.getMapObj(e),n=o.get("layerManager.manager");n.displayLayerName(r)}),t.set("layerManager.nameChange",r))}function d(e,t){var a=e.get("layerManager.bLayers");if(a){var r=p.sortGroupBy(t,function(e){return e.getZIndex()}),o=p.sortGroupBy(a,function(e){return e.getZIndex()});if(r.length===o.length){for(var n=!0,i=0,l=r.length;i<l;i++){var s=r[i];if(s.length!==o[i].length){n=!1;break}for(var d=0,c=s.length;d<c;d++)if(o[i].indexOf(s[i][d])===-1){n=!1;break}if(n===!1)break}if(n===!0)return!1}}return e.set("layerManager.bLayers",t),!0}function c(e){var t=e.mapId,a=u.getMapObj(t),r=a.get("layerManager.manager");r.appendLayers(e)}function g(e){this.mapId=e,this.isShow=!1;var t=u.getMapObj(this.mapId),a=t.get("layerManager.manager");a&&(a.destroy(),t.unset("layerManager.manager")),this.createElement(),this.addEventHandle(),t.set("layerManager.manager",this)}var u=a(6),y=a(7),p=a(1),m=a(13),f=a(40),v=a(41),h=a(62);g.prototype.createElement=function(){this.element=document.createElement("div"),this.element.className="bLayerManager",this.element.style.display="none",this.headerElement=document.createElement("div"),this.headerElement.className="header",this.titleElement=document.createElement("div"),this.titleElement.className="title",this.titleElement.innerHTML=m.prop("layerManager.title"),this.closeElement=document.createElement("div"),this.closeElement.className="closeIcon",this.closeElement.innerHTML="✖",this.headerElement.appendChild(this.titleElement),this.headerElement.appendChild(this.closeElement),this.contentElement=document.createElement("div"),this.contentElement.className="content",this.element.appendChild(this.headerElement),this.element.appendChild(this.contentElement);var e=u.getMapObj(this.mapId);e.get("component.container")&&e.get("component.container").appendChild(this.element)},g.prototype.appendLayers=function(e){var t=this;e=this.reSortLayers(e);for(var a=this.contentElement,r=a.childNodes.length-1;r>=0;r--)a.removeChild(a.childNodes[r]);e.forEach(function(a,r){a.layerId?t.appendLayer(e,a,r):t.appendLayerGroup(e,a,r)})},g.prototype.appendLayer=function(e,t,a){var r=document.createElement("div");r.className="layerItem",r.mapId=t.mapId,r.layerType=t.layerType,r.layerId=t.layerId;var o=document.createElement("input");o.className="visible_check",o.mapId=t.mapId,o.layerType=t.layerType,
o.layerId=t.layerId,o.setAttribute("type","checkbox"),o.setAttribute("layer_type",t.layerType),o.setAttribute("layer_id",t.layerId),o.checked=t.visible,h.add(o,"click",function(e){var a=v.getLayer({mapId:t.mapId,layerId:t.layerId});void 0!=a&&a.set("layerManagerCheckBoxClick",e.target.checked)});var n=document.createElement("div");t.visible?n.className=t.layerType+"_ICON layerIcon":n.className=t.layerType+"_GRAYICON layerIcon";var i=document.createElement("div");i.className="layerName",i.mapId=t.mapId,i.layerType=t.layerType,i.layerId=t.layerId,i.innerHTML=t.layerName,i.setAttribute("title",t.layerName);var l=document.createElement("input");l.className="range",l.mapId=t.mapId,l.layerType=t.layerType,l.layerId=t.layerId,l.opacity=t.opacity,l.setAttribute("type","range"),l.setAttribute("max","100"),l.setAttribute("min","0"),l.value=100*t.opacity;var s=document.createElement("div");s.className="label_block";var d=document.createElement("input");d.className="label_check",d.mapId=t.mapId,d.layerType=t.layerType,d.layerId=t.layerId,d.setAttribute("type","checkbox"),d.checked=t.showLabel;var c=document.createElement("label");t.showLabel?c.className="active_label":c.className="inactive_label",c.innerHTML="Aa",s.appendChild(d),s.appendChild(c);var g=document.createElement("div");0!==a?g.className="active_up_arrow":g.className="inactive_up_arrow",g.mapId=t.mapId,g.layerType=t.layerType,g.layerId=t.layerId,g.mIndex=a,g.zIndex=t.zIndex;var u=document.createElement("div");a!==e.length-1?u.className="active_down_arrow":u.className="inactive_down_arrow",u.mapId=t.mapId,u.layerType=t.layerType,u.layerId=t.layerId,u.mIndex=a,u.zIndex=t.zIndex,r.appendChild(o),r.appendChild(n),r.appendChild(i),r.appendChild(l),r.appendChild(s),r.appendChild(g),r.appendChild(u),this.contentElement.appendChild(r);var y=v.getLayer({mapId:t.mapId,layerId:t.layerId});if(y&&y.get("mineLegendName")){var m=document.createElement("div");m.setAttribute("class","legend_name"),m.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --"+y.get("mineLegendName"),m.setAttribute("title",p.htmlDecode(y.get("mineLegendName"))),this.contentElement.appendChild(m)}},g.prototype.appendLayerGroup=function(e,t,a){var r=document.createElement("div");r.className="layerItem",r.mapId=t.mapId,r.groupType=t.groupType;var o=document.createElement("input");o.className="visible_check",o.mapId=t.mapId,o.groupType=t.groupType,o.setAttribute("type","checkbox"),o.checked=t.visible;var n=document.createElement("div");t.visible?n.className=t.groupType+"_ICON layerIcon":n.className=t.groupType+"_GRAYICON layerIcon";var i=document.createElement("span");i.className="layerName",i.innerHTML=t.groupName;var l=document.createElement("input");l.className="range",l.mapId=t.mapId,l.groupType=t.groupType,l.opacity=t.opacity,l.setAttribute("type","range"),l.setAttribute("max","100"),l.setAttribute("min","0"),l.value=100*t.opacity;var s=document.createElement("div");s.className="label_block";var d=document.createElement("input");d.setAttribute("type","checkbox"),d.className="label_check",d.mapId=t.mapId,d.groupType=t.groupType,d.checked=t.showLabel;var c=document.createElement("label");t.showLabel?c.className="active_label":c.className="inactive_label",c.innerHTML="Aa",s.appendChild(d),s.appendChild(c);var g=document.createElement("div");0!==a?g.className="active_up_arrow":g.className="inactive_up_arrow",g.mapId=t.mapId,g.groupType=t.groupType,g.mIndex=a,g.zIndex=t.zIndex;var u=document.createElement("div");a!==e.length-1?u.className="active_down_arrow":u.className="inactive_down_arrow",u.mapId=t.mapId,u.groupType=t.groupType,u.mIndex=a,u.zIndex=t.zIndex,r.appendChild(o),r.appendChild(n),r.appendChild(i),r.appendChild(l),r.appendChild(s),r.appendChild(g),r.appendChild(u),this.contentElement.appendChild(r)},g.prototype.reSortLayers=function(e){e=this.transformLayerGroup(e);for(var t=p.sortGroupBy(e,function(e){return-e.zIndex}),a=0,r=t.length;a<r;a++)if(t[a].length>1)for(var o=t[a],n=o[0].zIndex,i=0;i<o.length;i++){var l=n+o.length-1-i;f.setZIndex({mapId:this.mapId,layerId:o[i].layerId,zIndex:l}),o[i].zIndex=l}e=p.flatten(t);for(var s,d=e.length-1;d>-1;d--)d!==e.length-1?(e[d].zIndex<=s&&(e[d].zIndex=s+1),s=e[d].zIndex):s=e[d].zIndex;return e},g.prototype.transformLayerGroup=function(e){var t=u.getMapObj(this.mapId),a=y.layerGroup;for(var r in a){if(!a.hasOwnProperty(r))return;for(var o={mapId:this.mapId,groupType:r,groupName:m.prop("LayerLabel."+r),noAttrs:!0},n=y.layerGroup[r],i=[],l=e.length-1;l>-1;l--){var s=e[l];if(!s.groupType)for(var d=s.layerType,c=0;c<n.length;c++)if(i[c]||(i[c]=[]),n[c]===d){o.noAttrs&&(o.visible=s.visible,o.opacity=s.opacity,o.zIndex=Math.floor(s.zIndex),o.showLabel=s.showLabel,t.set("layerGroup.ZIndex."+r,o.zIndex),delete o.noAttrs);var g=e.splice(l,1)[0];i[c].push(g)}}o.layers=p.flatten(i.reverse()),o.layers.length>0&&e.push(o)}return e},g.prototype.displayOpacity=function(e){var t=document.querySelectorAll("#"+e.mapId+" .layerItem .range"),a=p.find(t,function(t){return t.layerId===e.layerId});a&&a.opacity!==e.opacity&&(a.opacity=e.opacity,a.value=100*e.opacity)},g.prototype.displayVisibility=function(e){var t=document.querySelectorAll("#"+e.mapId+" .layerItem .visible_check"),a=p.find(t,function(t){return t.layerId===e.layerId});a&&a.checked!==e.visible&&(a.checked=e.visible)},g.prototype.displayLayerName=function(e){var t=document.querySelectorAll("#"+e.mapId+" .layerItem .layerName"),a=p.find(t,function(t){return t.layerId===e.layerId});a&&a.innerHTML!==e.layerName&&(a.innerHTML=e.layerName)},g.prototype.addEventHandle=function(){var e=this;this.contentElement.addEventListener("click",function(e){var t=e.target;if("visible_check"===t.className){f.setVisible({mapId:t.mapId,layerId:t.layerId,groupType:t.groupType,visible:t.checked});var a=t.layerType||t.groupType;t.checked?t.nextSibling.className=a+"_ICON layerIcon":t.nextSibling.className=a+"_GRAYICON layerIcon"}"label_check"===t.className&&(f.setShowLabel({mapId:t.mapId,layerId:t.layerId,layerType:t.layerType,groupType:t.groupType,showLabel:t.checked}),t.checked?t.nextSibling.className="active_label":t.nextSibling.className="inactive_label");var r;"active_up_arrow"===t.className?r=document.querySelectorAll("#"+t.mapId+" .layerItem")[t.mIndex-1]:"active_down_arrow"===t.className&&(r=document.querySelectorAll("#"+t.mapId+" .layerItem")[t.mIndex+1]),r&&(f.swapLayerZIndex({mapId:t.mapId,sourceLayerId:t.layerId,sourceGroupType:t.groupType,targetLayerId:r.layerId,targetGroupType:r.groupType}),o(t.mapId))}),this.contentElement.addEventListener("change",function(e){var t=e.target;if("range"===t.className){var a=t.value/t.max;f.setOpacity({mapId:t.mapId,layerId:t.layerId,groupType:t.groupType,opacity:a})}}),this.closeElement.addEventListener("click",function(t){e.hide()})},g.prototype.show=function(){this.isShow=!0,this.element.style.display=""},g.prototype.hide=function(){this.isShow=!1,this.element.style.display="none"},g.prototype.destroy=function(){this.element.getParent().removeChild(this.element),this.element=null,this.headerElement=null,this.closeElement=null,this.contentElement=null;var e=u.getMapObj(this.mapId);e.unset("layerManager.manager")},e.exports={monitorLayers:r,toggle:function(e){var t=u.getMapObj(e.mapId),a=t.get("layerManager.manager");a.isShow=!a.isShow,a.isShow?a.show():a.hide()},syncLayers:o}},function(e,t,a){function r(e){var t;return e===f.BUSINESSTYPE.POINT&&(t=a(42)),e===f.BUSINESSTYPE.CIRCLEPOINT&&(t=a(44)),e===f.BUSINESSTYPE.POLYGON&&(t=a(45)),e===f.BUSINESSTYPE.CELL&&(t=a(46)),e===f.BUSINESSTYPE.VECTOR_CELL&&(t=a(47)),e===f.BUSINESSTYPE.SITE&&(t=a(49)),e===f.BUSINESSTYPE.GRID&&(t=a(50)),e===f.BUSINESSTYPE.SERVICEPOLYGON&&(t=a(51)),e===f.BUSINESSTYPE.SERVICEPOINT&&(t=a(52)),e===f.BUSINESSTYPE.SERVICELINE&&(t=a(53)),e===f.BUSINESSTYPE.LINE&&(t=a(54)),e===f.BUSINESSTYPE.STRAIGHTLINE&&(t=a(55)),"DPOLYGON"===e&&(t=a(56)),"DPOINT"===e&&(t=a(57)),"DLINE"===e&&(t=a(58)),"BUBBLE_CIRCLE_LABEL"===e&&(t=a(59)),"ICON_FONT_STYLE"===e&&(t=a(60)),e===f.BUSINESSTYPE.MULTIPOINT&&(t=a(61)),t}function o(e){var t=f.layerGroup[e.groupType];if(t){var a=m.getMapObj(e.mapId),r=a.getLayers().getArray().slice(0);return r.filter(function(e){for(var a=e.get("businessType"),r=!1,o=0,n=t.length;o<n;o++)if(a===t[o]){r=!0;break}return r})}}function n(e){var t=m.getMapObj(e.mapId),a=t.get("layerGroup.ZIndex."+e.groupType);return null!==a&&void 0!==a||(a=0),a}function i(e){if(e.layerId){var t=r(e.layerType);if(!t||!t.setShowLabel)return;t.setShowLabel(e)}else if(e.groupType){var a=o(e);a.forEach(function(t){var a=r(t.get("businessType"));a&&a.setShowLabel&&a.setShowLabel({mapId:e.mapId,layerId:t.get("layer_id"),layerType:t.get("businessType"),showLabel:e.showLabel})})}}function l(e){var t=e.mapId,a=e.layerId,r=m.getMapObj(t).getLayers().getArray().slice(0);return v.find(r,function(e){if(e&&e.get("layer_id")===a)return e})}function s(e){var t,a,r=e.mapId;e.sourceLayerId?t=l({mapId:r,layerId:e.sourceLayerId}).getZIndex():e.sourceGroupType&&(t=n({mapId:r,groupType:e.sourceGroupType})),e.targetLayerId?a=l({mapId:r,layerId:e.targetLayerId}).getZIndex():e.targetGroupType&&(a=n({mapId:r,groupType:e.targetGroupType})),e.sourceLayerId?l({mapId:r,layerId:e.sourceLayerId}).setZIndex(a):e.sourceGroupType&&d({mapId:r,groupType:e.sourceGroupType,zIndex:a}),e.targetLayerId?l({mapId:r,layerId:e.targetLayerId}).setZIndex(t):e.targetGroupType&&d({mapId:r,groupType:e.targetGroupType,zIndex:t})}function d(e){var t=f.layerGroup[e.groupType];if(t){for(var a=m.getMapObj(e.mapId),r=o(e),n=[],i=0;i<t.length;i++)n.push(0);a.set("layerGroup.ZIndex."+e.groupType,e.zIndex),r.forEach(function(a){for(var r=a.get("businessType"),o=0,i=t.length;o<i;o++)r===t[o]&&(a.setZIndex(e.zIndex+.1*o+.001*n[o]),n[o]++)})}}function c(e){if(e.layerId){var t=l(e);t.setOpacity(e.opacity),h.setEffectLayerOpacity(t,e.opacity),"base_layer"===e.layerId&&p(e.mapId,e.opacity)}else if(e.groupType){var a=o(e);a.forEach(function(t){t.setOpacity(e.opacity),h.setEffectLayerOpacity(t,e.opacity)})}}function g(e){if(e.layerId){var t=l(e);t.setVisible(e.visible),h.setEffectLayerVisible(t,e.visible),"base_layer"===e.layerId&&y(e.mapId,e.visible)}else if(e.groupType){var a=o(e);a.forEach(function(t){t.setVisible(e.visible),h.setEffectLayerVisible(t,e.visible)})}}function u(e){if(e.layerId){var t=l(e);(e.layerId="base_layer")?t.setZIndex(0):(e.layerId="base_layer_marker")?t.setZIndex(1):t.setZIndex(e.zIndex)}else e.groupType&&d(e)}function y(e,t){var a=m.getMapObj(e);if(a){var r=a.get("paramObj");r.mapType.toUpperCase()===f.MAPTYPE.GOOGLE_MAP&&I.setVisible(a,t)}}function p(e,t){var a=m.getMapObj(e);if(a){var r=a.get("paramObj");r.mapType.toUpperCase()===f.MAPTYPE.GOOGLE_MAP&&I.setOpacity(a,t)}}var m=a(6),f=a(7),v=a(1),h=a(41),I=a(24);e.exports={getBsHandler:r,setShowLabel:i,setVisible:g,swapLayerZIndex:s,setOpacity:c,setZIndex:u}},function(e,t,a){function r(e){if(e.layerId)return s.get(e.layerId+"_"+e.mapId)}function o(e,t){var a=e.get("effectLayers");a&&a.forEach(function(e){e.get("effectCombine.visible")!==!1&&e.setVisible(t)})}function n(e,t){var a=e.get("effectLayers");a&&a.forEach(function(e){e.get("effectCombine.opacity")!==!1&&e.setOpacity(t)})}function i(e){var t;if(t=e.layer?e.layer:r(e),t&&e.effectLayer){var a=t.get("effectLayers");a||(a=[],t.set("effectLayers",a)),a.indexOf(e.effectLayer)===-1&&a.push(e.effectLayer)}}function l(e){var t;if(t=e.layer?e.layer:r(e)){var a=t.get("effectLayers");if(a){var o=d.getMapObj(e.mapId);!!a&&a.forEach(function(e){e.get("state.deleted")||(e.set("state.deleted",!0),e.onDestroy&&e.onDestroy(),e.setMap(null),e&&o.removeLayer(e))}),t.set("effectLayers",null)}}}var s=a(4),d=a(6),c=a(1),g=function(e){var t="_"+e,a=[];return s.keys.forEach(function(e){e&&c.endsWith(e,t)&&a.push(s.get(e))}),a};e.exports={getLayer:r,addEffectLayer:i,removeEffectLayer:l,setEffectLayerVisible:o,setEffectLayerOpacity:n,getLayers:g}},function(e,t,a){function r(e,t,a){if(e){var r=e.get("map"),o=r.getTarget(),n=e.get("layer_id"),i=e.get("businessType");y.removeHighlight({mapId:o,layerId:n,hTypes:[t]});var s=y.getHLayer({mapId:o,layerId:n});if(t===c.HTYPE.CLICK){if(a.feature){var d=a.feature,g=d.getId(),u=d.get("select"),p=d.get("data"),m=p.fontStyle+" "+p.fontSize+" "+p.fontFamily,f=new l.style.Style({image:new l.style.Circle({radius:u.radius,stroke:new l.style.Stroke({width:void 0!=u.strokeWidth?u.strokeWidth:2,color:void 0!=u.strokeColor?u.strokeColor:"black"}),fill:new l.style.Fill({color:void 0!=u.fillColor?u.fillColor:"red"})}),text:new l.style.Text({text:p.label||"",font:"undefined undefined undefined"!==m?m:"normal 14px Arial",fill:new l.style.Fill({color:void 0!=u.labelFillColor?u.labelFillColor:"black"}),stroke:new l.style.Stroke({color:void 0!=u.labelStrokeColor?u.labelStrokeColor:"black",width:void 0!==p.labelStrokeWidth?p.labelStrokeWidth:1}),offsetX:void 0!==p.labelOffsetX?p.labelOffsetX:30,offsetY:void 0!==p.labelOffsetY?p.labelOffsetY:-15})}),v=d.clone();v.setStyle(f),v.setId(g),v.set("mapId",o),v.set("layerId",n),v.set("layerType",i),v.set("hType",t),v.set("highlightFeature",!0),s.getSource().addFeature(v)}}else t===c.HTYPE.VECTOR&&a.geoIds.map(function(a){var r=e.getSource().getFeatureById(a);if(r){var d=r.get("select"),c=r.clone(),g=c.get("data"),u=g.fontStyle+" "+g.fontSize+" "+g.fontFamily,y=new l.style.Style({image:new l.style.Circle({radius:d.radius,fill:new l.style.Fill({color:d.fillColor}),stroke:new l.style.Stroke({color:d.strokeColor,width:d.strokeWidth})}),text:new l.style.Text({text:g.label||"",font:"undefined undefined undefined"!==u?u:"normal 14px Arial",fill:new l.style.Fill({color:d.labelFillColor}),stroke:new l.style.Stroke({color:d.labelStrokeColor,width:void 0!==g.labelStrokeWidth?g.labelStrokeWidth:1}),offsetX:void 0!==g.labelOffsetX?g.labelOffsetX:30,offsetY:void 0!==g.labelOffsetY?g.labelOffsetY:-15})});c.setStyle(y),c.setId(a),c.set("mapId",o),c.set("layerId",n),c.set("layerType",i),c.set("hType",t),c.set("highlightFeature",!0),s.getSource().addFeature(c)}})}}function o(e){var t=g.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}function n(e){var t=e.feature;if(t){var a=e.type.split(":")[1],r={fillColor:e.fillColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,radius:e.radius,fontStyle:e.fontStyle,fontSize:e.fontSize,fontFamily:e.fontFamily,labelOffsetX:e.labelOffsetX,labelOffsetY:e.labelOffsetY,label:e.label,type:a},o=i(r);t.setStyle(o)}}function i(e){var t=e.type,a=null,r=e.fontStyle+" "+e.fontSize+" "+e.fontFamily,o=void 0!==e.labelOffsetX?e.labelOffsetX:30,n=void 0!==e.labelOffsetY?e.labelOffsetY:-15,i=void 0!==e.labelStrokeWidth?parseInt(e.labelStrokeWidth):1,s=new l.style.Fill({color:e.fillColor?e.fillColor:"red"}),d=new l.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?parseInt(e.strokeWidth):0}),c=new l.style.Style({image:new l.style.Circle({radius:e.radius?e.radius:5,fill:s,stroke:d}),text:new l.style.Text({text:e.label?e.label:"",fill:new l.style.Fill({color:e.labelFillColor?e.labelFillColor:"black"}),font:"undefined undefined undefined"!==r?r:"normal 14px Arial",offsetX:o,offsetY:n,stroke:new l.style.Stroke({color:e.labelStrokeColor||"#ffffff",width:i})})}),g=new l.style.Style({image:new l.style.RegularShape({fill:s,stroke:d,points:4,radius:e.radius?e.radius:10,radius2:0,angle:Math.PI/4})}),u=new l.style.Style({image:new l.style.RegularShape({fill:s,stroke:d,points:4,radius:e.radius?e.radius:10,radius2:0,angle:0})}),y=new l.style.Style({image:new l.style.RegularShape({fill:s,stroke:d,points:5,radius:e.radius?e.radius:10,radius2:4,angle:0})}),p=new l.style.Style({image:new l.style.RegularShape({fill:s,stroke:d,points:3,radius:e.radius?e.radius:10,rotation:Math.PI/4,angle:0})}),m=new l.style.Style({image:new l.style.RegularShape({fill:s,stroke:d,points:4,radius:e.radius?e.radius:10,angle:Math.PI/4})}),f=new l.style.Style({text:new l.style.Text({text:e.label||"",fill:s,stroke:d,font:r||"10px sans-seri",textAlign:e.textAlign||"start",textBaseline:e.textBaseline||"alphabetic",offsetY:n,offsetX:o})});switch(t){case"":a=c;break;case"x":a=g;break;case"cross":a=u;break;case"star":a=y;break;case"triangle":a=p;break;case"square":a=m;break;case"isUnique":a=f}return a}var l=a(3),s=a(6),d=a(4),c=a(7),g=a(41),u=a(1),y=a(43),p=(a(16),a(11)),m=function(e){var t=e.layerId+"_"+e.mapId,a=null,o=s.getMapObj(e.mapId),n=void 0==e.isShow||e.isShow,i=e.label?e.label:e.layerId;d.containsKey(t)?a=d.get(t):(a=new l.layer.Vector({source:new l.source.Vector({wrapX:!1})}),a.set("type",c.CUSTOMTYPE.LAYERTYPE),a.set("map",o),a.set("layerId",t),a.set("layer_id",e.layerId),a.set("businessType",c.BUSINESSTYPE.POINT),a.set("params.label",i),a.set("isVectorType",!0),a.set("state.showLabel",!!e.showLabel),a.set("legendName",e.legendName),a.setZIndex(c.Z_INDEX.LANDMARKER),a.set("clickId","business_vector_point_event_id"),a.set("isShow",n),e.multiple&&a.set("multiple",e.multiple),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),d.put(t,a),o.addLayer(a)),p.addClickCallback(e.mapId,"business_vector_point_event_id",function(t){if(t.layer&&t.layer.get("businessType")===c.BUSINESSTYPE.POINT&&t.feature&&t.feature.get("businessType")===c.BUSINESSTYPE.POINT){var a=t.feature;r(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId)},f=function(e){var t=[],a=e.datas,r=g.getLayer(e);if(r.set("legendName",e.legendName),r.set("paramObj",e),e.label&&r.set("params.label",e.label),u.isValid(a)||a.length>0){r.set("state.showLabel",!!e.showLabel);var o=r.getSource();a.forEach(function(a){var o=l.proj.fromLonLat(a.coordinate),n=void 0!==a.strokeWidth?a.strokeWidth:0,s=void 0!==a.pointStyle?a.pointStyle:"",d=new l.style.Fill({color:a.fillColor?a.fillColor:"red"}),g=new l.style.Stroke({color:a.strokeColor?a.strokeColor:"#319FD3",width:a.strokeWidth?parseInt(a.strokeWidth):0}),u={fillColor:a.fillColor,strokeColor:"black",strokeWidth:n,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff",radius:a.radius||5},y=new l.Feature({geometry:new l.geom.Point(o),data:a,layerId:e.layerId,mapId:e.mapId,businessType:c.BUSINESSTYPE.POINT,select:a.hightLight?a.hightLight:u});if(a.hightLight)for(var p in u)a.hightLight[p]?a.hightLight[p]:a.hightLight[p]=u[p];y.setId(a.id),y.set("layer",r),y.set("vectorType",c.BUSINESSTYPE.POINT);var m=new l.style.Style({image:new l.style.Circle({radius:a.radius?a.radius:5,fill:d,stroke:g})}),f=i({fillColor:a.fillColor,strokeColor:a.strokeColor,strokeWidth:a.strokeWidth,radius:a.radius,type:s,labelStrokeWidth:a.labelStrokeWidth,labelOffsetX:a.labelOffsetX,labelOffsetY:a.labelOffsetY,fontStyle:a.fontStyle?a.fontStyle:"normal Arial",fontSize:a.fontSize?a.fontSize:"14px",fontFamily:a.fontFamily,labelFillColor:a.labelFillColor,labelStrokeColor:a.labelStrokeColor,label:a.label});y.setStyle(f),y.set("defaultStyle",f),y.set("shapeStyle",m),t.push(y)}),o.addFeatures(t)}},v=function(e,t){var a,r=g.getLayer({mapId:e.mapId,layerId:e.layerId});if(!r)return void t();var o=r.getSource().getFeatureById(e.geoId),n=o.getGeometry();a=new l.proj.toLonLat(n.getCoordinates()),t(a)};e.exports={addLayer:m,setLayerData:f,highlight:r,getLineLonLat:v,setShowLabel:o,setSinglePointStyle:n}},function(e,t,a){function r(e){var t=l.getMapObj(e.mapId),a=s.getLayer(e);if(a){var r=a.get("layer_id"),o=r+"&&&highlight",n=c.getLayer({mapId:e.mapId,layerId:o});return n?n:(n=new i.layer.Vector({source:new i.source.Vector({wrapX:!1})}),n.set("mapId",e.mapId),n.set("source_layerId",r),n.set("layerId",o),n.setZIndex(1999),s.addEffectLayer({layer:a,effectLayer:n}),t.addLayer(n),n)}}function o(e){if(e.layerId){var t=r({mapId:e.mapId,layerId:e.layerId}),a=t&&t.getSource();if(!e.hTypes||!e.hTypes.length)return void a.clear();var o=a.getFeatures().slice(0);o&&o.forEach(function(t){var r=t.get("hType");e.hTypes.indexOf(r)>-1&&a.removeFeature(t)})}}function n(e){var t=s.getLayer({layerId:e.layerId,mapId:e.mapId});if(t){var a=t.get("businessType"),r=d.getBsHandler(a);r&&r.highlight&&r.highlight(t,e.highlightType,e)}}var i=a(3),l=a(6),s=a(41),d=a(40),c=a(16);e.exports={highlight:n,getHLayer:r,removeHighlight:o}},function(e,t,a){function r(e,t,a){if(e){var r=e.get("map"),o=r.getTarget(),i=e.get("layer_id"),l=e.get("businessType");g.removeHighlight({mapId:o,layerId:i,hTypes:[t]});var d=g.getHLayer({mapId:o,layerId:i});if(t===s.HTYPE.CLICK){if(a.feature){var c=a.feature,u=c.getId(),y=c.get("select"),p=c.get("data"),m=p.fontStyle+" "+p.fontSize+" "+p.fontFamily,f=new n.style.Style({image:new n.style.Circle({radius:y.radius,stroke:new n.style.Stroke({width:y.strokeWidth,color:y.strokeColor}),fill:new n.style.Fill({color:y.fillColor})}),text:new n.style.Text({text:p.name||"",font:"undefined undefined undefined"!==m?m:"normal 13px Arial",fill:new n.style.Fill({color:y.labelFillColor}),stroke:new n.style.Stroke({color:y.labelStrokeColor,width:void 0!==p.labelStrokeWidth?p.labelStrokeWidth:2}),offsetX:void 0!==p.labelOffsetX?p.labelOffsetX:30,offsetY:void 0!==p.labelOffsetY?p.labelOffsetY:-15})}),v=c.clone();v.setStyle(f),v.setId(u),v.set("mapId",o),v.set("layerId",i),v.set("layerType",l),v.set("hType",t),v.set("highlightFeature",!0),d.getSource().addFeature(v)}}else t===s.HTYPE.VECTOR&&a.geoIds.map(function(a){var r=e.getSource().getFeatureById(a);if(r){var s=r.get("select"),c=r.clone(),g=c.get("data"),u=g.fontStyle+" "+g.fontSize+" "+g.fontFamily,y=new n.style.Style({image:new n.style.Circle({radius:s.radius,fill:new n.style.Fill({color:s.fillColor}),stroke:new n.style.Stroke({color:s.strokeColor,width:s.strokeWidth})}),text:new n.style.Text({text:g.name||"",font:"undefined undefined undefined"!==u?u:"normal 13px Arial",fill:new n.style.Fill({color:s.labelFillColor}),stroke:new n.style.Stroke({color:s.labelStrokeColor,width:void 0!==g.labelStrokeWidth?g.labelStrokeWidth:2}),offsetX:void 0!==g.labelOffsetX?g.labelOffsetX:30,offsetY:void 0!==g.labelOffsetY?g.labelOffsetY:-15})});c.setStyle(y),c.setId(a),c.set("mapId",o),c.set("layerId",i),c.set("layerType",l),c.set("hType",t),c.set("highlightFeature",!0),d.getSource().addFeature(c)}})}}function o(e){var t=d.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var n=a(3),i=a(6),l=a(4),s=a(7),d=a(41),c=a(1),g=a(43),u=a(11),y=function(e){var t=e.layerId+"_"+e.mapId,a=null,o=i.getMapObj(e.mapId);l.containsKey(t)?a=l.get(t):(a=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})}),a.set("type",s.CUSTOMTYPE.LAYERTYPE),a.set("map",o),a.set("layerId",t),a.set("layer_id",e.layerId),a.set("businessType",s.BUSINESSTYPE.CIRCLEPOINT),a.set("isVectorType",!0),a.set("params.label",e.label),a.set("state.showLabel",!!e.showLabel),a.setZIndex(s.Z_INDEX.LANDMARKER),l.put(t,a),o.addLayer(a)),a.set("legendName",e.legendName),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),e.multiple&&a.set("multiple",e.multiple),a.set("clickid","business_vector_circlePoint_event_id"),u.addClickCallback(e.mapId,"business_vector_circlePoint_event_id",function(t){if(t.layer&&t.layer.get("businessType")===s.BUSINESSTYPE.CIRCLEPOINT&&t.feature&&t.feature.get("businessType")===s.BUSINESSTYPE.CIRCLEPOINT){var a=t.feature;r(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId)},p=function(e){var t=[],a=e.datas,r=d.getLayer(e);if(r.set("legendName",e.legendName),r.set("paramObj",e),e.label&&r.set("params.label",e.label),c.isValid(a)||a.length>0){var o=r.getSource();a.forEach(function(a){var o=n.proj.fromLonLat(a.coordinate),i=void 0!==a.strokeWidth?a.strokeWidth:2,l=(a.fontStyle+" "+a.fontSize+" "+a.fontFamily,void 0!==a.labelStrokeWidth?a.labelStrokeWidth:2),d=void 0!==a.labelOffsetX?a.labelOffsetX:30,c=void 0!==a.labelOffsetY?a.labelOffsetY:-15,g={fillColor:a.fillColor||"red",strokeColor:"black",strokeWidth:i,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff",radius:a.radius||5},u=new n.Feature({geometry:new n.geom.Point(o),data:a,layerId:e.layerId,mapId:e.mapId,businessType:s.BUSINESSTYPE.CIRCLEPOINT,select:a.hightLight?a.hightLight:g});if(a.hightLight)for(var y in g)a.hightLight[y]?a.hightLight[y]:a.hightLight[y]=g[y];u.setId(a.id);var p=new n.style.Style({image:new n.style.Circle({radius:a.radius?a.radius:5,fill:new n.style.Fill({color:a.fillColor?a.fillColor:"red"})}),text:new n.style.Text({text:a.name?a.name:"",fill:new n.style.Fill({color:a.labelFillColor?a.labelFillColor:"black"}),font:"normal 14px Arial",offsetX:d,offsetY:c,stroke:new n.style.Stroke({color:a.labelStrokeColor||"#ffffff",width:l})})}),m=new n.style.Style({image:new n.style.Circle({radius:a.radius?a.radius:5,fill:new n.style.Fill({color:a.fillColor||"green"}),stroke:new n.style.Stroke({color:a.strokeColor||"black",width:i})})});u.setStyle(p),u.set("vectorType","CIRCLEPOINT"),u.set("layer",r),u.set("defaultStyle",p),u.set("shapeStyle",m),t.push(u)}),o.addFeatures(t)}},m=function(e,t){var a,r=d.getLayer({mapId:e.mapId,layerId:e.layerId});if(!r)return void t();var o=r.getSource().getFeatureById(e.geoId),i=o.getGeometry();a=new n.proj.toLonLat(i.getCoordinates()),t(a)};e.exports={addLayer:y,setLayerData:p,highlight:r,getLineLonLat:m,setShowLabel:o}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=d.get(e.mapId),r=(a.getView().getZoom(),void 0==e.isShow||e.isShow),o=e.label?e.label:e.layerId;if(!d.containsKey(t)){var i=new s.layer.Vector({source:new s.source.Vector({wrapX:!1}),updateWhileAnimating:!0,updateWhileInteracting:!0});d.put(t,i),i.set("type",c.CUSTOMTYPE.LAYERTYPE),i.set("map",a),i.set("layerId",t),i.set("layer_id",e.layerId),i.set("params.label",o),i.set("isVectorType",!0),i.set("state.showLabel",!!e.showLabel),i.set("businessType",c.BUSINESSTYPE.POLYGON),i.set("legendName",e.legendName),i.setZIndex(c.Z_INDEX.TEMPPOLYGON),i.set("multiple",!!e.multiple),i.set("clickId","business_vector_polygon_event_id"),i.set("isShow",r),void 0!=e.minShowLevel&&i.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&i.set("maxShowLevel",parseInt(e.maxShowLevel)),a.addLayer(i)}p.addClickCallback(e.mapId,"business_vector_polygon_event_id",function(t){if(t.layer&&t.layer.get("businessType")===c.BUSINESSTYPE.POLYGON&&t.feature&&t.feature.get("businessType")===c.BUSINESSTYPE.POLYGON){var a=t.feature;n(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId)}function o(e){var t=[],a=e.datas,r=g.getLayer(e);if(e.label&&r.set("params.label",e.label),r.set("paramObj",e),u.isValid(a)||a.length>0){r.set("state.showLabel",!0),r.set("legendName",e.legendName);var o=r.getSource();a.forEach(function(a){var o=a.coordinates,n=a.fontStyle+" "+a.fontSize+" "+a.fontFamily,i=void 0!==a.strokeWidth?a.strokeWidth:2,l=void 0!==a.labelStrokeWidth?a.labelStrokeWidth:1,d=new s.geom.Polygon([o]),g=s.extent.getCenter(d.getExtent()),u={fillColor:a.fillColor?a.fillColor:"rgba(255,0,255,0.3)",strokeColor:"black",strokeWidth:i,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff"},y=new s.Feature({geometry:d.transform(c.PROJ.EPSG_4326,c.PROJ.EPSG_3857),labelPoint:s.proj.fromLonLat(g),businessType:c.BUSINESSTYPE.POLYGON,data:a,layerId:e.layerId,mapId:e.mapId,select:a.hightLight?a.hightLight:u});if(a.hightLight)for(var p in u)a.hightLight[p]?a.hightLight[p]:a.hightLight[p]=u[p];y.setId(a.id),y.set("layer",r),y.set("vectorType",c.BUSINESSTYPE.POLYGON);var m=new s.style.Style({fill:new s.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new s.style.Stroke({color:a.strokeColor||"#000",width:i}),text:new s.style.Text({text:a.label?a.label:"",fill:new s.style.Fill({color:a.labelFillColor||"black"}),font:n?n:"normal 14px Arial",stroke:new s.style.Stroke({color:a.labelStrokeColor||"#ffffff",width:l})})}),f=new s.style.Style({fill:new s.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new s.style.Stroke({color:a.strokeColor||"#000",width:i})});y.setStyle(m),y.set("defaultStyle",m),y.set("shapeStyle",f),y.set("state.showLabel",!0),d&&d.getArea()>0&&t.push(y)}),o.addFeatures(t)}}function n(e,t,a){if(e){var r=e.get("map"),o=r.getTarget(),n=e.get("layer_id"),i=e.get("businessType"),l=y.getHLayer({mapId:o,layerId:n});if(l.getSource().clear(),t===c.HTYPE.CLICK){if(a.feature){var d=a.feature.getId(),g=a.feature,u=g.get("select"),p=g.get("data"),m=g.clone(),f=p.fontStyle+" "+p.fontSize+" "+p.fontFamily,v=new s.style.Style({fill:new s.style.Fill({color:u.fillColor}),stroke:new s.style.Stroke({width:u.strokeWidth,color:u.strokeColor}),text:new s.style.Text({text:p.label||"",fill:new s.style.Fill({color:u.labelFillColor}),font:f?f:"normal 14px Arial",stroke:new s.style.Stroke({color:u.labelStrokeColor,width:void 0!==p.labelStrokeWidth?p.labelStrokeWidth:1})})});m.setStyle(v),m.setId(d),m.set("mapId",o),m.set("layerId",n),m.set("layerType",i),m.set("hType",t),m.set("highlightFeature",!0),l.getSource().addFeature(m)}}else t===c.HTYPE.VECTOR&&a.geoIds.length>0&&a.geoIds.map(function(a){var r=e.getSource().getFeatureById(a);if(r){var d=r.get("select"),c=r.get("data"),g=c.fontStyle+" "+c.fontSize+" "+c.fontFamily,u=new s.style.Style({fill:new s.style.Fill({color:d.fillColor}),stroke:new s.style.Stroke({width:d.strokeWidth,color:d.strokeColor}),text:new s.style.Text({text:c.label||"",fill:new s.style.Fill({color:d.labelFillColor}),font:g?g:"normal 14px Arial",stroke:new s.style.Stroke({color:d.labelStrokeColor,width:void 0!==c.labelStrokeWidth?c.labelStrokeWidth:1})})}),y=r.clone();y.setStyle(u),y.setId(a),y.set("mapId",o),y.set("layerId",n),y.set("layerType",i),y.set("hType",t),y.set("highlightFeature",!0),l.getSource().addFeature(y)}})}}function i(e,t){var a=g.getLayer({mapId:e.mapId,layerId:e.layerId});if(!a&&"POLYGON"!==e.sourceLayerType)return void t();var r=null,o=s.proj.fromLonLat(e.targetPoint);if(void 0!==e.coordinates){if(!(e.coordinates instanceof Array)&&e.coordinates.indexOf("POLYGON")>-1){var n=fusiongis.Util.getWKTFromText(e.coordinates);if(1===n.coordinates.length&&n.coordinates[0]instanceof Array)for(var i=n.coordinates[0],l=[],d=0;d<i.length;d++)l.push(s.proj.fromLonLat(i[d]))}r=l}else{var c=a.getSource().getFeatureById(e.geoId).getGeometry();r=c.getCoordinates()[0]}var u=(r[0][0]-o[0])*(r[0][0]-o[0])+(r[0][1]-o[1])*(r[0][1]-o[1]),y=0,p=0;r.forEach(function(e,t){y=(e[0]-o[0])*(e[0]-o[0])+(e[1]-o[1])*(e[1]-o[1]),u>y&&(u=y,p=t)}),t(s.proj.toLonLat(r[p]))}function l(e){var t=g.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var s=a(3),d=a(4),c=a(7),g=a(41),u=a(1),y=a(43),p=(a(16),a(11));e.exports={addLayer:r,setLayerData:o,highlight:n,getLineLonLat:i,setShowLabel:l}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=g.get(e.mapId),r=(a.getView().getZoom(),void 0==e.isShow||e.isShow),o=e.label?e.label:e.layerId,n=null;g.containsKey(t)?n=g.get(t):(n=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),e.multiple&&n.set("multiple",e.multiple),g.put(t,n),a.addLayer(n)),n.setZIndex(u.Z_INDEX.CELL),n.set("type",u.CUSTOMTYPE.LAYERIMGTYPE),n.set("isVectorType",!1),n.set("businessType",u.BUSINESSTYPE.CELL),n.set("params.label",o),n.set("state.showLabel",!!e.showLabel),n.set("layerId",t),n.set("map",a),n.set("layer_id",e.layerId),n.set("legendName",e.legendName),n.set("isShow",r),void 0!=e.minShowLevel&&n.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&n.set("maxShowLevel",parseInt(e.maxShowLevel)),
n.set("clickId","business_service_cell_event_id"),v.addClickCallback(e.mapId,"business_service_cell_event_id",function(t){if(t.layer&&t.layer.get("businessType")===u.BUSINESSTYPE.CELL){var a=(h.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&i(t.layer,"click",a[0]):f.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)}function o(e){var t=y.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("imgToken",e.imgToken),t.set("imgTokenLabel",e.imgTokenLabel),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("legendName",e.legendName),t.set("paramObj",e),e.label&&t.set("params.label",e.label),t.set("state.showLabel",!!e.showLabel);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=void 0!=a?a.slice(0,a.indexOf(":")):void 0,o={VERSION:"1.1.1",imgToken:a,FCName:r};t&&(t.getSource().setUrl(u.GisRootUrl+"/mapRender/export"),t.getSource().updateParams(o))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o,n,i;if(a.coordinate){i=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(",");var l=t.get("params.imgToken").slice(0,t.get("params.imgToken").indexOf(":")),s=t.get("paramObj"),d={geometry:i,tolerance:void 0!=s&&void 0!=s.tolerance?s.tolerance:.1,mapExtent:n,imgToken:t.get("params.imgToken"),FCName:l};o=u.GisRootUrl+"/mapRender/identify"}m.get({url:o,data:p.getParameterString(d),success:function(a){if(!a)return void r([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void r([]);var o=p.sortBy(a.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),n=o[0].extentInfo.radius;o=o.filter(function(e){return e.extentInfo.radius===n}),o.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var i=o.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name}});r(i)},failure:function(){"function"==typeof r&&r([])}})}function i(e,t,a,r){var o,n=e.get("map"),i=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(f.removeHighlight({mapId:i,layerId:s,hTypes:["click"]}),t===u.HTYPE.CLICK){var g=null;g=$.isArray(a.geometry)?a.geometry:JSON.parse(a.geometry);var y=new c.geom.LineString(g);o=new c.Feature({geometry:new c.geom.Polygon([y.getCoordinates()]),mapId:i,layerId:s,layerType:d,hType:t});var p=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});o.setStyle(p);var m=f.getHLayer({mapId:i,layerId:s});m.getSource().addFeature(o)}else t===u.HTYPE.VECTOR&&l(e,a,function(e){if(e){var a=[],n=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});e.map(function(e){var r=null;r=$.isArray(e.geometry)?e.geometry:JSON.parse(e.geometry),o=new c.Feature({geometry:new c.geom.Polygon([r]),mapId:i,layerId:s,layerType:d,hType:t}),o.setStyle(n),a.push(o)});var l=f.getHLayer({mapId:i,layerId:s});l.getSource().addFeatures(a),r&&r(e)}})}function l(e,t,a){var r=e.get("params.imgToken"),o=void 0!=r?r.slice(0,r.indexOf(":")):void 0,n=u.GisRootUrl+"/mapRender/query?FCName="+o;m.postJSON({url:n,data:JSON.stringify({id:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){console.log(e),a(null)}})}function s(e,t){var a,r=y.getLayer({mapId:e.mapId,layerId:e.layerId});if(!r)return void t();var o=e.geoId.indexOf(",")!==-1?e.geoId.split(","):[e.geoId];l(r,{geoIds:o},function(e){e&&(a=e,t(a))})}function d(e){var t=y.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),g=a(4),u=a(7),y=a(41),p=a(1),m=a(14),f=a(43),v=a(11),h=a(6);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:i,getLineLonLat:s,setShowLabel:d}},function(e,t,a){var r=a(3),o=a(4),n=a(7),i=a(5),l=a(1),s=a(43),d=a(48),n=a(7),c=function(e){var t=e.layerId+"_"+e.mapId,a=null,r=o.get(e.mapId),l=(r.getView().getZoom(),void 0==e.isShow||e.isShow);o.containsKey(t)?a=o.get(t):(i.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType",n.BUSINESSTYPE.VECTOR_CELL),a.set("layer_id",e.layerId),a.set("params.label",void 0!==e.label?e.label:e.layerId),a.set("isVectorType",!0),a.set("layerId",t),a.setZIndex(n.Z_INDEX.CELL),a.set("hideWhenPan",e.hideWhenPan),a.set("legendName","mineLegendName"),a.set("isShow",l),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),a.set("clickId","vector-cell-click-event"),fusiongis.Events.addClickCallback(e.mapId,"vector-cell-click-event",function(t){if(t.layer&&t.layer.get("businessType")===n.BUSINESSTYPE.VECTOR_CELL&&t.feature&&t.feature.get("businessType")===n.BUSINESSTYPE.VECTOR_CELL){s.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]});var a=t.feature;u(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId),g(e)},g=function(e){var t=e.layerId+"_"+e.mapId,a=o.get(t),i=a.getSource(),s=[],c=e.datas,g=e.legendInfo,u={};if(g){var y={mapId:e.mapId,layerId:e.layerId,legendInfo:g,label:g.legendName,businessType:n.BUSINESSTYPE.CELL};u=g.legendList,e.legendInfo&&e.legendInfo.legendName&&a.set("legendName",e.legendInfo.legendName),fusiongis.Legend.createLegend(y)}a.set("datas",c),a.set("noChangeRadius",e.noChangeRadius),a.set("legendData",u);var p=o.get(e.mapId);if(l.isValid(c)&&c.length>0){c.length>3e3&&console.warn("建议数据量控制在3000，大于3000建议使用服务类型小区！！");for(var m=c.length-1;m>0;m--)for(var f=0;f<m;f++)if(c[m].azimuth===c[f].azimuth&&c[m].radius>c[f].radius){var v=c[m];c[m]=c[f],c[f]=v}c.forEach(function(t,o,i){var l=t.cellType?t.cellType:"sector",c=t.coordinate[0],u=t.coordinate[1],y=void 0!==t.strokeWidth?t.strokeWidth:2;if(c>180||c<-180)return console.warn("经度需要大于等于-180，且小于等于180！！"),!1;if(u>90||u<-90)return console.warn("纬度需要大于等于-90，且小于等于90！！"),!1;var m=t.radius;if(m<=0)return console.warn("小区半径必须大于0！！"),!1;var f=t.azimuth;if(f<0||f>360)return console.warn("小区方位角必须大于等于0， 或者小于等于360！！"),!1;var v=t.angle;if(v<=0||v>360)return console.warn("小区角度必须大于0，小于等于360！！"),!1;var h;if(e.noChangeRadius){m=m?m:40;var I,S=p.getPixelFromCoordinate(r.proj.fromLonLat(t.coordinate)),b=[];"arrow"===l?I=d.createArrow(S[0],S[1],m,f,v):"sector"===l?I=d.createSector(S[0],S[1],m,f,v):"triangle"===l&&(I=d.createTriangle(S[0],S[1],m,f,v));for(var L=0;L<I.length;L++)b.push(p.getCoordinateFromPixel(I[L]));h=new r.geom.LinearRing(b)}else{m=m?m:4e3;var b,T=r.proj.fromLonLat([c,u]);"arrow"===l?b=d.createArrow(T[0],T[1],m,f,v):"sector"===l?b=d.createSector(T[0],T[1],m,f,v):"triangle"===l&&(b=d.createTriangle(T[0],T[1],m,f,v)),h=new r.geom.LinearRing(b)}var w=h.getCoordinates(),E=null;if(360===v){var C=t.pointRadius||0;E=new r.geom.GeometryCollection,w.splice(0,2),w.splice(w.length-1,2),E.setGeometries([new r.geom.Circle(r.proj.fromLonLat([c,u]),C),new r.geom.Polygon([w])])}else E=new r.geom.Polygon([w]);var k=a.get("legendData");if(g){if("singleColor"===g.legendType)for(var x=0,P=k.length;x<P;x++){var _=!1;if(""!==k[x].value[0]?parseFloat(k[x].value[0])===parseFloat(t.value)&&(_=!0):_=!0,_){if(k[x].fillColor){var O=k[x].fillColor.split(","),M=k[x].borderColor.split(",");t.fillColor=3===O.length?"rgb("+k[x].fillColor+")":"rgba("+k[x].fillColor+")",t.strokeColor=3===M.length?"rgb("+k[x].borderColor+")":"rgba("+k[x].borderColor+")",t.strokeWidth=k[x].borderWidth;break}if(k[x].style){var N=k[x].style.split(",");if(3===N.length){t.fillColor="rgb("+k[x].style+")",t.strokeColor="rgb("+k[x].style+")",t.strokeWidth=3;break}if(4===N.length){t.fillColor="rgba("+k[x].style+")",t.strokeColor="rgba("+k[x].style+")",t.strokeWidth=3;break}}}}if("rangeColor"===g.legendType)for(var x=0,P=k.length;x<P;x++){var F=!1;if(""!==k[x].value[0]&&""===k[x].value[1]?parseFloat(t.value)>=parseFloat(k[x].value[0])&&(F=!0):""===k[x].value[0]&&""!==k[x].value[1]?parseFloat(t.value)<=parseFloat(k[x].value[1])&&(F=!0):F=(parseFloat(t.value)<=parseFloat(k[x].value[1])&&parseFloat(t.value)>=parseFloat(k[x].value[0]),!0),F){if(k[x].fillColor){var O=k[x].fillColor.split(","),M=k[x].borderColor.split(",");t.fillColor=3===O.length?"rgb("+k[x].fillColor+")":"rgba("+k[x].fillColor+")",t.strokeColor=3===M.length?"rgb("+k[x].borderColor+")":"rgba("+k[x].borderColor+")",t.strokeWidth=k[x].borderWidth;break}if(k[x].style){var N=k[x].style.split(",");if(3===N.length){t.fillColor="rgb("+k[x].style+")",t.strokeColor="rgb("+k[x].style+")",t.strokeWidth=3;break}if(4===N.length){t.fillColor="rgba("+k[x].style+")",t.strokeColor="rgba("+k[x].style+")",t.strokeWidth=3;break}}}}}var A={fillColor:t.fillColor,strokeColor:"black",strokeWidth:y,labelFillColor:t.labelFillColor||"black",labelStrokeColor:t.labelStrokeColor||"#ffffff",label:void 0!==t.label?t.label:"",radius:t.radius||5},R=new r.Feature({geometry:E,businessType:n.BUSINESSTYPE.VECTOR_CELL,data:t,select:t.hightLight?t.hightLight:A});if(t.hightLight)for(var o in A)t.hightLight[o]?t.hightLight[o]:t.hightLight[o]=A[o];R.setId(t.id),R.set("data",t),R.set("layer",a),R.set("vectorType",n.BUSINESSTYPE.VECTOR_CELL);var G=new r.style.Style({fill:new r.style.Fill({color:t.fillColor||"#836FFF"}),stroke:new r.style.Stroke({color:t.strokeColor||"#76EEC6",width:t.strokeWidth||2}),text:new r.style.Text({text:(void 0!==t.label?t.label:"").toString()})});R.setStyle(G),R.set("defaultStyle",G),s.push(R)}),"function"==typeof i.addFeatures&&i.addFeatures(s)}},u=function(e,t,a){if(e){var o=e.get("map"),i=o.getTarget(),l=e.get("layer_id"),d=e.get("businessType");s.removeHighlight({mapId:i,layerId:l,hTypes:[t]});var c=s.getHLayer({mapId:i,layerId:l});if(t===n.HTYPE.CLICK){if(a.feature){var g=a.feature.getId(),u=a.feature,y=a.feature.get("select"),p=u.clone(),m=new r.style.Style({fill:new r.style.Fill({color:y.fillColor||"#836FFF"}),stroke:new r.style.Stroke({color:y.strokeColor,width:y.strokeWidth||2}),text:new r.style.Text({text:(void 0!==y.label?y.label:"").toString()})});p.setStyle(m),p.setId(g),p.set("mapId",i),p.set("layerId",l),p.set("layerType",d),p.set("hType",t),p.set("highlightFeature",!0),c.getSource().addFeature(p)}}else if(t===n.HTYPE.VECTOR){var f=a.geoIds.map(function(a){var o=e.getSource().getFeatureById(a),n=o.get("select"),s=o.clone(),c=new r.style.Style({fill:new r.style.Fill({color:n.fillColor||"#836FFF"}),stroke:new r.style.Stroke({color:n.strokeColor,width:n.strokeWidth||2}),text:new r.style.Text({text:(void 0!==n.label?n.label:"").toString()})});return s.setStyle(c),s.setId(a),s.set("mapId",i),s.set("layerId",l),s.set("layerType",d),s.set("hType",t),s.set("highlightFeature",!0),s});c.getSource().addFeatures(f)}}},y=function(e){var t=fusiongis.BaseLayer.getLayer(e);t&&t.getSource()&&t.getSource().clear()};e.exports={addCell:c,setLayerData:g,highlight:u,clear:y}},function(e,t,a){function r(e){if(!e||!p.isArray(e))return 0;var t=e[0],a=e[1];return t&&a?y.haversineDistance(n(t),n(a)):0}function o(e){if(!e||!p.isArray(e))return 0;for(var t=[],a=e.length,r=0;r<a;r++)t.push(n(e[r]));return y.geodesicArea(t)}function n(e){return p.isArray(e)&&2===e.length&&p.isFinite(e[0])&&p.isFinite(e[1])?[Number(e[0]),Number(e[1])]:p.isObject(e)&&p.isFinite(e.lon)&&p.isFinite(e.lat)?[Number(e.lon),Number(e.lat)]:p.isObject(e)&&p.isFinite(e.longitude)&&p.isFinite(e.latitude)?[Number(e.longitude),Number(e.latitude)]:null}function i(e,t,a,r,o,n,i,l){var s,d,c,g,u,y={x:null,y:null,onLine1:!1,onLine2:!1};return s=(l-n)*(a-e)-(i-o)*(r-t),0===s?null!==y.x&&null!==y.y&&y:(d=t-n,c=e-o,g=(i-o)*d-(l-n)*c,u=(a-e)*d-(r-t)*c,d=g/s,c=u/s,y.x=e+d*(a-e),y.y=t+d*(r-t),d>0&&d<1&&(y.onLine1=!0),c>0&&c<1&&(y.onLine2=!0),!(!y.onLine1||!y.onLine2)&&[y.x,y.y])}function l(e){var t={points:[],cross:!1};return e.forEach(function(a){e.forEach(function(e){for(var r=0;r<a.length-1;r++)for(var o=0;o<e.length-1;o++){var n=i(a[r][0],a[r][1],a[r+1][0],a[r+1][1],e[o][0],e[o][1],e[o+1][0],e[o+1][1]);n&&(t.cross=!0,t.points.push([n[0],n[1]]))}})}),t}var s=a(3),d=a(1),c=function(e,t,a,r,o){var n,i,l=a,s=5,d=o/s,c=s*Math.PI/180,g=Math.PI/2-(r+o/2)/180*Math.PI,u=[];u.push([e,t]);for(var y=0;y<d+1;y++)n=e+l*Math.cos(g),i=t+l*Math.sin(g),u.push([n,i]),g+=c;return u.push([e,t]),u},g=function(e,t,a,r,o){var n=[];n.push([e,t]);var i=a,l=Math.PI/2-(r+o/2)/180*Math.PI,s=e+i*Math.cos(l),d=t+i*Math.sin(l);n.push([s,d]),l=Math.PI/2-(r-o/2)/180*Math.PI;var c=e+i*Math.cos(l),g=t+i*Math.sin(l);return n.push([c,g]),n.push([e,t]),n},u=function(e,t,a,r,o){var n=a,i=[],l=Math.PI/2-(r+o/2)/180*Math.PI,s=e+n/2*Math.cos(l),d=t+n/2*Math.sin(l);l=Math.PI/2-(r-o/2)/180*Math.PI;var c=e+n/2*Math.cos(l),g=t+n/2*Math.sin(l);l=Math.PI/2-r/180*Math.PI;var u=e+n*Math.cos(l),y=t+n*Math.sin(l),p=e+n/2*Math.cos(l),m=t+n/2*Math.sin(l);return i.push([e,t]),i.push([p,m]),i.push([c,g]),i.push([u,y]),i.push([s,d]),i.push([p,m]),i.push([e,t]),i},y=new s.Sphere(6378137),p=d;e.exports={checkGeometryCross:l,createSector:c,createArrow:u,createTriangle:g,calcLength:r,calcArea:o}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=g.getMapObj(e.mapId),r=(a.getView().getZoom(),void 0==e.isShow||e.isShow),o=e.label?e.label:e.layerId,n=null;u.containsKey(t)?n=u.get(t):(n=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),u.put(t,n),a.addLayer(n)),n.setZIndex(y.Z_INDEX.SITE),n.set("type",y.CUSTOMTYPE.LAYERIMGTYPE),n.set("businessType",y.BUSINESSTYPE.SITE),n.set("params.label",o),n.set("state.showLabel",!!e.showLabel),n.set("isVectorType",!1),n.set("layerId",t),n.set("map",a),n.set("layer_id",e.layerId),n.set("multiple",e.multiple),n.set("legendName",e.legendName),n.set("isShow",r),void 0!=e.minShowLevel&&_layer.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&_layer.set("maxShowLevel",parseInt(e.maxShowLevel)),n.set("clickId","business_service_site_event_id"),h.addClickCallback(e.mapId,"business_service_site_event_id",function(t){if(t.layer&&t.layer.get("businessType")===y.BUSINESSTYPE.SITE){var a=(g.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&i(t.layer,"click",a[0]):v.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)}function o(e){var t=p.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("state.showLabel",!!e.showLabel),t.set("legendName",e.legendName),t.set("paramObj",e),e.label&&t.set("params.label",e.label);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=a.slice(0,a.indexOf(":")),o={VERSION:"1.1.1",imgToken:a,Fcname:r};t&&(t.getSource().setUrl(y.GisRootUrl+"/mapRender/export"),t.getSource().updateParams(o))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o,n,i,l;i=t.get("params.imgToken");var s=void 0!=i?i.slice(0,i.indexOf(":")):void 0;o=y.GisRootUrl+"/mapRender/identify",l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(",");var d=t.get("paramObj"),c={geometry:l,tolerance:void 0!=d&&void 0!=d.tolerance?d.tolerance:1,mapExtent:n,imgToken:t.get("params.imgToken"),FCName:s};f.get({url:o,data:m.getParameterString(c),success:function(o){if(!o)return void r([]);if(o=JSON.parse(o),!o||!o.data||!o.data.length)return void r([]);var n=o.data,i=n.map(function(r){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.coordinate,geometry:r.geometry,geoId:r.id,geoName:r.name}});r(i)},failure:function(e){r([])}})}function i(e,t,a,r){var o,n=e.get("map"),i=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(v.removeHighlight({mapId:i,layerId:s}),t===y.HTYPE.CLICK){var g=a.geometry;o=new c.Feature({geometry:new c.geom.Point(g),mapId:i,layerId:s,layerType:d,hType:t});var u=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(u);var p=v.getHLayer({mapId:i,layerId:s});p.getSource().addFeature(o)}else t===y.HTYPE.VECTOR&&l(e,a,function(e){var a;if(e){a=e[0].geometry,o=new c.Feature({geometry:new c.geom.Point(a),mapId:i,layerId:s,layerType:d,hType:t});var n=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(n);var l=v.getHLayer({mapId:i,layerId:s});l.getSource().addFeature(o),r&&r(e)}})}function l(e,t,a){var r=e.get("params.imgToken"),o=void 0!=r?r.slice(0,r.indexOf(":")):void 0,n=y.GisRootUrl+"/mapRender/query?FCName="+o;f.postJSON({url:n,data:JSON.stringify({id:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){a(null)}})}function s(e){var t,a=p.getLayer({mapId:e.mapId,layerId:e.sourceLayerId});if(a)return l(a,{geoIds:e.layerId,imgToken:a.get("params.imgToken")},function(e){e&&(t=e.extentInfo.circleCenter)}),t}function d(e){var t=p.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),g=a(6),u=a(4),y=a(7),p=a(41),m=a(1),f=a(14),v=a(43),h=a(11);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:i,getLineLonLat:s,setShowLabel:d}},function(e,t,a){function r(e,t,a){var r=e.get("map"),i=r.getTarget(),l=e.get("layer_id"),s=e.get("businessType");u.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===d.HTYPE.CLICK?o(i,l,s,t,a):t===d.HTYPE.VECTOR&&n(i,l,s,t,a,e)}function o(e,t,a,r,o){var n=o.geometry,l=[n[0],n[1]],s=[n[2],n[1]],d=[n[2],n[3]],c=[n[0],n[3]],g=new i.Feature({geometry:new i.geom.Polygon([[l,s,d,c]]),mapId:e,layerId:t,layerType:a,hType:r}),y=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});g.setStyle(y);var p=u.getHLayer({mapId:e,layerId:t});p.getSource().addFeature(g)}function n(e,t,a,r,o,n){var l=[];o.coordinates.forEach(function(e){l.push({x:e[0],y:e[1]})}),g.postJSON({url:d.GisRootUrl+"/gridManager/queryGridInfo?cacheKey="+n.get("imgToken"),data:JSON.stringify({points:l,imgToken:n.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n=o.geometry,l=[n[0],n[1]],s=[n[2],n[1]],d=[n[2],n[3]],c=[n[0],n[3]],g=new i.Feature({geometry:new i.geom.Polygon([[l,s,d,c]]),mapId:e,layerId:t,layerType:a,hType:r}),u=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});return g.setStyle(u),g}),l=u.getHLayer({mapId:e,layerId:t});l.getSource().addFeatures(n)}},failure:function(e){console.log(e)}})}var i=a(3),l=a(8),s=a(4),d=a(7),c=a(41),g=a(14),u=a(43),y=a(11),p=a(6),m=a(5),f=function(e){var t=e.layerId+"_"+e.mapId,a=s.get(e.mapId),o=(a.getView().getZoom(),void 0==e.isShow||e.isShow),n=e.label?e.label:e.layerId,l=void 0===e.gridType?1:e.gridType,c=null;s.containsKey(t)?c=s.get(t):(c=1===l?new i.layer.Tile({source:new i.source.TileWMS({wrapX:!1})}):new i.layer.Image({source:new i.source.ImageWMS({wrapX:!1})}),e.multiple&&c.set("multiple",e.multiple),s.put(t,c),a.addLayer(c)),c.setZIndex(d.Z_INDEX.GRID),c.set("type",d.CUSTOMTYPE.LAYERTILETYPE),c.set("businessType",d.BUSINESSTYPE.GRID),c.set("isVectorType",!1),c.set("params.label",n),c.set("layerId",t),c.set("map",a),c.set("layer_id",e.layerId),c.set("clickId","business_grid_event_id"),c.set("legendName",e.legendName),c.set("isShow",o),void 0!=e.minShowLevel&&c.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&c.set("maxShowLevel",parseInt(e.maxShowLevel)),y.addClickCallback(e.mapId,"business_grid_event_id",function(t){var a=m.getLayer({mapId:e.mapId,layerId:e.layerId});if(a&&8!==a.get("gridType")){var o=(p.getMapObj(e.mapId),t.transportDataToInnerLayer);o?o&&o.length>0&&r(a,"click",o[0]):u.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},v=function(e){var t=(e.imgTokenParam,e.imgToken),a=e.mapId,r=e.layerId,o=e.gridType?e.gridType:1,n=e.layers?e.layers:void 0,l=e.ISSOLIDGRID,s=c.getLayer({mapId:a,layerId:r});if(s){var g;e.label&&s.set("label",e.label),g=8===o||l===!1?new i.source.ImageWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:o,LAYERS:n,IMGTOKEN:t,VERSION:"1.1.1",ISSOLIDGRID:l,cacheKey:t},wrapX:!1}):new i.source.TileWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:o,LAYERS:n,IMGTOKEN:t,VERSION:"1.1.1",ISSOLIDGRID:l,cacheKey:t},wrapX:!1}),s.setSource(g),s.set("imgToken",t),s.set("gridType",o),s.set("legendName",e.legendName),s.set("paramObj",e)}},h=function(e,t,a,r){var o=l.getExtent(e.getTarget()),n=t.get("paramObj"),i={geometry:{x:a.coordinate[0],y:a.coordinate[1]},tolerance:void 0!=n&&void 0!=n.tolerance?n.tolerance:1,mapExtent:o,imgToken:t.get("imgToken")};g.postJSON({url:d.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(i),success:function(a){var o=JSON.parse(a),n=o.status,i=o.data&&o.data.length>0&&o.data[0];1===n.code&&i?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:i.centerPoint,geometry:i.geometry,extentInfo:i.extentInfo,geoId:i.id,geoName:i.name}]):r([])},failure:function(e){r([])}})};e.exports={addLayer:f,setLayerData:v,getClickData:h,highlight:r}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,l=new i.Feature({geometry:new i.geom.Polygon([n]),mapId:e,layerId:t,layerType:a,hType:r}),s=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});l.setStyle(s);var d=p.getHLayer({mapId:e,layerId:t});d.getSource().addFeature(l)}function o(e,t,a,r,o,n){var l=n.get("params.imgToken"),s=void 0!=l?l.slice(0,l.indexOf(":")):void 0;y.postJSON({url:c.GisRootUrl+"/mapRender/query?FCName="+s,data:JSON.stringify({id:o.geoIds,imgToken:n.get("params.imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n=o.geometry,l=new i.Feature({geometry:new i.geom.Polygon([n]),mapId:e,layerId:t,layerType:a,hType:r}),s=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});return l.setStyle(s),l}),l=p.getHLayer({mapId:e,layerId:t});l.getSource().addFeatures(n)}},failure:function(e){console.log(e)}})}function n(e){var t=g.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.getSource().updateParams(r)}}var i=a(3),l=a(8),s=a(6),d=a(4),c=a(7),g=a(41),u=a(1),y=a(14),p=a(43),m=a(11),f=function(e){var t=e.layerId+"_"+e.mapId,a=d.get(e.mapId),r=(a.getView().getZoom(),e.label?e.label:e.layerId),o=void 0==e.isShow||e.isShow,n=null;d.containsKey(t)?n=d.get(t):(n=new i.layer.Image({source:new i.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),d.put(t,n),a.addLayer(n)),n.setZIndex(c.Z_INDEX.POLYGON),n.set("type",c.CUSTOMTYPE.LAYERTILETYPE),n.set("businessType",c.BUSINESSTYPE.SERVICEPOLYGON),n.set("params.label",r),n.set("isVectorType",!1),n.set("layerId",t),n.set("map",a),n.set("layer_id",e.layerId),n.set("multiple",e.multiple),n.set("legendName",e.legendName),n.set("clickId","business_service_polygon_event_id"),n.set("isShow",o),void 0!=e.minShowLevel&&n.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&n.set("maxShowLevel",parseInt(e.maxShowLevel)),m.addClickCallback(e.mapId,"business_service_polygon_event_id",function(t){if(t.layer&&t.layer.get("businessType")===c.BUSINESSTYPE.SERVICEPOLYGON){var a=(s.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&h(t.layer,"click",a[0]):p.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},v=function(e){var t=g.getLayer(e);if(t.set("legendName",e.legendName),t.set("paramObj",e),t){e.label&&t.set("params.label",e.label),t.set("params.imgToken",e.imgToken),t.set("imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel);var a=e.isShowLabel?e.imgTokenLabel:e.imgToken,r=void 0!=a?a.slice(0,a.indexOf(":")):void 0,o=new i.source.ImageWMS({url:c.GisRootUrl+"/mapRender/export",params:{imgToken:a,VERSION:"1.1.1",FCName:r},wrapX:!1});t.setSource(o)}},h=function(e,t,a){var n=e.get("map"),i=n.getTarget(),l=e.get("layer_id"),s=e.get("businessType");p.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===c.HTYPE.CLICK?r(i,l,s,t,a):t===c.HTYPE.VECTOR&&o(i,l,s,t,a,e)},I=function(e,t,a,r){if(!t.getVisible())return void r([]);var o=l.getExtent(e.getTarget()),n=t.get("params.imgToken"),i=void 0!=n?n.slice(0,n.indexOf(":")):void 0,s=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=s&&void 0!=s.tolerance?s.tolerance:.1,mapExtent:o,imgToken:t.get("params.imgToken"),FCName:i};y.get({url:c.GisRootUrl+"/mapRender/identify",data:u.getParameterString(d),success:function(a){if(a){var o=JSON.parse(a),n=o.status;if(1===n.code)if(o.data&&o.data.length>0){var i=o.data.map(function(a){var r={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name};return r});r&&"function"==typeof r&&r(i)}else r([]);else r([])}},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:f,setLayerData:v,getClickData:I,highlight:h,setShowLabel:n}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,l=new i.Feature({geometry:new i.geom.Point(n[0]),mapId:e,layerId:t,layerType:a,hType:r}),s=new i.style.Style({image:new i.style.Circle({stroke:new i.style.Stroke({width:1.5,color:"#000"}),radius:4})});l.setStyle(s);var d=p.getHLayer({mapId:e,layerId:t});d.getSource().addFeature(l)}function o(e,t,a,r,o,n){var l=n.get("imgToken"),s=void 0!=l?l.slice(0,l.indexOf(":")):void 0;y.postJSON({url:c.GisRootUrl+"/mapRender/query?FCName="+s,data:JSON.stringify({id:o.geoIds,imgToken:n.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n=o.geometry,l=new i.Feature({geometry:new i.geom.Point(n[0]),mapId:e,layerId:t,layerType:a,hType:r}),s=new i.style.Style({image:new i.style.Circle({stroke:new i.style.Stroke({width:1.5,color:"#000"}),radius:4})});return l.setStyle(s),l}),l=p.getHLayer({mapId:e,layerId:t});l.getSource().addFeatures(n)}},failure:function(e){console.log(""+c.GisRootUrl+"/mapRender/query?FCName="+s+" ....fail")}})}function n(e){var t=g.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var i=a(3),l=a(6),s=a(8),d=a(4),c=a(7),g=a(41),u=a(1),y=a(14),p=a(43),m=a(11),f=function(e){var t=e.layerId+"_"+e.mapId,a=l.getMapObj(e.mapId),r=e.label?e.label:e.layerId,o=void 0==e.isShow||e.isShow,n=(a.getView().getZoom(),null);d.containsKey(t)?n=d.get(t):(n=new i.layer.Image({source:new i.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),e.multiple&&n.set("multiple",e.multiple),d.put(t,n),a.addLayer(n)),n.set("isShow",o),n.setZIndex(c.Z_INDEX.MARKER),n.set("type",c.CUSTOMTYPE.LAYERTILETYPE),n.set("businessType",c.BUSINESSTYPE.SERVICEPOINT),n.set("params.label",r),n.set("isVectorType",!1),n.set("layerId",t),n.set("map",a),n.set("legendName",e.legendName),n.set("layer_id",e.layerId),n.set("clickId","business_service_point_event_id"),void 0!=e.minShowLevel&&n.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&n.set("maxShowLevel",parseInt(e.maxShowLevel)),m.addClickCallback(e.mapId,"business_service_point_event_id",function(t){if(t.layer&&t.layer.get("businessType")===c.BUSINESSTYPE.SERVICEPOINT){var a=(l.getMapObj(e.mapId),t.transportDataToInnerLayer);a?h(t.layer,"click",a[0]):p.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},v=function(e){var t=g.getLayer(e),a=e.imgToken,r=void 0!=a?a.slice(0,a.indexOf(":")):void 0;t.set("legendName",e.legendName),e.label&&t.set("params.label",e.label),t.set("imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("params.imgToken",e.imgToken),t.set("paramObj",e);var o={VERSION:"1.1.1",imgToken:e.imgToken,FCName:r};t&&(t.getSource().setUrl(c.GisRootUrl+"/mapRender/export"),t.getSource().updateParams(o))},h=function(e,t,a){var n=e.get("map"),i=n.getTarget(),l=e.get("layer_id"),s=e.get("businessType");p.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===c.HTYPE.CLICK?r(i,l,s,t,a):t===c.HTYPE.VECTOR&&o(i,l,s,t,a,e)},I=function(e,t,a,r){if(!t.getVisible())return void r([]);var o=s.getExtent(e.getTarget()),n=t.get("imgToken"),i=void 0!=n?n.slice(0,n.indexOf(":")):void 0,l=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=l&&void 0!=l.tolerance?l.tolerance:10,mapExtent:o,imgToken:t.get("imgToken"),FCName:i};y.get({url:c.GisRootUrl+"/mapRender/identify",data:u.getParameterString(d),success:function(a){if(a){var o=JSON.parse(a),n=o.status,i=o.data&&o.data.length>0&&o.data[0];1===n.code&&i?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:i.id,geoName:i.name,lonLat:i.centerPoint,geometry:i.geometry,extentInfo:i.extentInfo}]):r([])}},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:f,setLayerData:v,getClickData:I,highlight:h,setShowLabel:n}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,l=new i.Feature({geometry:new i.geom.LineString(n),mapId:e,layerId:t,layerType:a,hType:r}),s=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});l.setStyle(s);var d=p.getHLayer({mapId:e,layerId:t});d.getSource().addFeature(l)}function o(e,t,a,r,o,n){var l=n.get("imgToken").slice(0,n.get("imgToken").indexOf(":"));y.postJSON({url:c.GisRootUrl+"/mapRender/query?FCName="+l,data:JSON.stringify({id:o.geoIds,imgToken:n.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n=o.geometry,l=new i.Feature({geometry:new i.geom.LineString(n),mapId:e,layerId:t,layerType:a,hType:r}),s=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});return l.setStyle(s),l}),l=p.getHLayer({mapId:e,layerId:t});l.getSource().addFeatures(n)}},failure:function(e){console.log(e)}})}function n(e){var t=g.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var i=a(3),l=a(6),s=a(8),d=a(4),c=a(7),g=a(41),u=a(1),y=a(14),p=a(43),m=a(11),f=function(e){var t=e.layerId+"_"+e.mapId,a=l.getMapObj(e.mapId),r=e.label?e.label:e.layerId,o=void 0==e.isShow||e.isShow,n=null;d.containsKey(t)?n=d.get(t):(n=new i.layer.Image({source:new i.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),e.multiple&&n.set("multiple",e.multiple),d.put(t,n),a.addLayer(n)),n.setZIndex(c.Z_INDEX.LINE),n.set("type",c.CUSTOMTYPE.LAYERTILETYPE),n.set("businessType",c.BUSINESSTYPE.SERVICELINE),n.set("params.label",r),n.set("isVectorType",!1),n.set("layerId",t),n.set("map",a),n.set("legendName",e.legendName),n.set("layer_id",e.layerId),n.set("clickId","business_service_line_event_id"),n.set("isShow",o),void 0!=e.minShowLevel&&n.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&n.set("maxShowLevel",parseInt(e.maxShowLevel)),m.addClickCallback(e.mapId,"business_service_line_event_id",function(t){if(t.layer&&t.layer.get("businessType")===c.BUSINESSTYPE.SERVICELINE){var a=(l.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&h(t.layer,"click",a[0]):p.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},v=function(e){var t=g.getLayer(e),a=e.imgToken.slice(0,e.imgToken.indexOf(":"));e.label&&t.set("params.label",e.label),t.set("imgToken",e.imgToken),t.set("legendName",e.legendName),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("params.imgToken",e.imgToken),t.set("paramObj",e);var r={VERSION:"1.1.1",imgToken:e.imgToken,FCName:a};t&&(t.getSource().setUrl(c.GisRootUrl+"/mapRender/export"),
t.getSource().updateParams(r))},h=function(e,t,a){var n=e.get("map"),i=n.getTarget(),l=e.get("layer_id"),s=e.get("businessType");p.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===c.HTYPE.CLICK?r(i,l,s,t,a):t===c.HTYPE.VECTOR&&o(i,l,s,t,a,e)},I=function(e,t,a,r){if(!t.getVisible())return void r([]);var o=s.getExtent(e.getTarget()),n=t.get("imgToken"),i=void 0!=n?n.slice(0,n.indexOf(":")):void 0,l=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=l&&void 0!=l.tolerance?l.tolerance:10,mapExtent:o,imgToken:t.get("imgToken"),FCName:i};y.get({url:c.GisRootUrl+"/mapRender/identify",data:u.getParameterString(d),success:function(a){if(a){var o=JSON.parse(a),n=o.status,i=o.data&&o.data.length>0&&o.data[0];1===n.code&&i?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:i.id,geoName:i.name,lonLat:i.centerPoint,geometry:i.geometry,extentInfo:i.extentInfo}]):r([])}},failure:function(e){console.error(e),r([])}})};e.exports={addLayer:f,setLayerData:v,getClickData:I,highlight:h,setShowLabel:n}},function(e,t,a){function r(e,t,a){if(e){var r=e.get("map"),o=r.getTarget(),i=e.get("layer_id"),l=e.get("businessType"),d=g.getHLayer({mapId:o,layerId:i});if(d.getSource().clear(),t===s.HTYPE.CLICK){if(a.feature){var c=a.feature,u=c.getId(),y=c.get("select"),p=(c.get("data"),new n.style.Style({stroke:new n.style.Stroke({width:y.strokeWidth,color:y.strokeColor})})),m=c.clone();m.setStyle(p),m.setId(u),m.set("mapId",o),m.set("layerId",i),m.set("layerType",l),m.set("hType",t),m.set("highlightFeature",!0),d.getSource().addFeature(m)}}else t===s.HTYPE.VECTOR&&a.geoIds.length>0&&a.geoIds.map(function(a){var r=e.getSource().getFeatureById(a);if(r){var s=r.get("select"),c=(r.get("data"),new n.style.Style({stroke:new n.style.Stroke({color:s.strokeColor,width:s.strokeWidth})})),g=r.clone();g.setStyle(c),g.setId(a),g.set("mapId",o),g.set("layerId",i),g.set("layerType",l),g.set("hType",t),g.set("highlightFeature",!0),d.getSource().addFeature(g)}})}}function o(e){var t=d.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var n=a(3),i=a(6),l=a(4),s=a(7),d=a(41),c=a(1),g=a(43),u=a(16),y=a(11),p=function(e){var t=e.layerId+"_"+e.mapId,a=null,o=i.getMapObj(e.mapId);l.containsKey(t)?a=l.get(t):(a=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})}),a.set("type",s.CUSTOMTYPE.LAYERTYPE),a.set("map",o),a.set("layerId",t),a.set("layer_id",e.layerId),a.set("businessType",s.BUSINESSTYPE.LINE),a.set("params.label",e.label),a.set("isVectorType",!0),a.set("state.showLabel",!!e.showLabel),a.set("legendName",e.legendName),a.setZIndex(s.Z_INDEX.LINE),a.set("clickId","business_line_event_id"),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),l.put(t,a),o.addLayer(a)),y.addClickCallback(e.mapId,"business_line_event_id",function(t){if(t.layer&&t.layer.get("businessType")===s.BUSINESSTYPE.LINE&&t.feature&&t.feature.get("businessType")===s.BUSINESSTYPE.LINE){var a=t.feature;r(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId)},m=function(e){var t=[],a=e.datas,r=d.getLayer(e);if(r.set("legendName",e.legendName),r.set("paramObj",e),e.label&&r.set("params.label",e.label),c.isValid(a)||a.length>0){r.set("state.showLabel",!0);var o=r.getSource();a.forEach(function(a){var o=u.transform(a.coordinates,4326,3857),i=void 0!==a.strokeWidth?a.strokeWidth:2,l=a.fontStyle+" "+a.fontSize+" "+a.fontFamily,d=void 0!==a.labelStrokeWidth?a.labelStrokeWidth:1,c={strokeColor:"black",fillColor:a.fillColor?a.fillColor:"rgba(255,0,255,0.3)",strokeWidth:i,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff"},g=new n.Feature({geometry:new n.geom.LineString(o),data:a,layerId:e.layerId,mapId:e.mapId,businessType:s.BUSINESSTYPE.LINE,select:a.hightLight?a.hightLight:c});if(a.hightLight)for(var y in c)a.hightLight[y]?a.hightLight[y]:a.hightLight[y]=c[y];g.setId(a.id),g.set("data",a),g.set("layer",r),g.set("vectorType",s.BUSINESSTYPE.LINE);var p=new n.style.Style({fill:new n.style.Fill({color:a.fillColor?a.fillColor:"rgba(0,0,0,0)"}),stroke:new n.style.Stroke({color:a.strokeColor||"#000",width:i}),text:new n.style.Text({text:a.label||"",fill:new n.style.Fill({color:a.labelFillColor||"black"}),font:void 0!==l?l:"normal 14px Arial",stroke:new n.style.Stroke({color:a.labelStrokeColor||"#ffffff",width:d})})}),m=new n.style.Style({fill:new n.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new n.style.Stroke({color:a.strokeColor||"#000",width:i})});g.setStyle(p),g.set("defaultStyle",p),g.set("shapeStyle",m),t.push(g)}),o.addFeatures(t)}},f=function(e,t){var a,r=d.getLayer({mapId:e.mapId,layerId:e.layerId});if(!r)return void t();var o=r.getSource().getFeature(e.geoId),i=o.getGeometry();a=new n.proj.toLonLat(i.getCoordinates()),t(a)};e.exports={addLayer:p,setLayerData:m,highlight:r,getLineLonLat:f,setShowLabel:o}},function(e,t,a){function r(e){var t=[];return e.forEach(function(e){var a=n.proj.transform(e,l.PROJ.EPSG_4326,l.PROJ.EPSG_3857);t.push(a)}),t}function o(e,t,a){if(e){var r=e.get("map"),o=r.getTarget(),i=e.get("layer_id"),s=e.get("businessType");d.removeHighlight({mapId:o,layerId:i,hTypes:[t]});var c=d.getHLayer({mapId:o,layerId:i});if(t===l.HTYPE.CLICK){if(a.feature){var g=a.feature.get("arrow"),u=g,y=g.getId(),p=g.get("select"),m=a.feature.getId(),f=a.feature,v=a.feature.get("select"),h=a.feature.get("lineData"),I=new n.style.Style({stroke:new n.style.Stroke({width:v.strokeWidth,color:v.strokeColor}),text:new n.style.Text({text:void 0!==h?h.name:"",font:"12px Calibri,sans-serif",fill:new n.style.Fill({color:v.labelFillColor}),stroke:new n.style.Stroke({color:v.labelStrokeColor,width:v.strokeWidth})})}),S=new n.style.Style({image:new n.style.RegularShape({fill:new n.style.Fill({color:p.labelFillColor||"#208089"}),stroke:new n.style.Stroke({color:p.strokeColor||"#000",width:p.strokeWidth||1}),cursor:"point",points:3,radius:p.arrowRadius,rotation:p.rotation,angle:0})});u.setStyle(S),u.setId(y),u.set("mapId",o),u.set("layerId",i),u.set("layerType",s),u.set("hType",t),u.set("highLightFeatrue",!0),f.setStyle(I),f.setId(m),f.set("mapId",o),f.set("layerId",i),f.set("layerType",s),f.set("hType",t),f.set("highLightFeatrue",!0),f.set("arrow",u),c.getSource().addFeature(u),c.getSource().addFeature(f)}}else t===l.HTYPE.VECTOR&&a.geoIds.map(function(a){var r=e.getSource().getFeatureById(a),l=r.get("arrow"),d=l.getId();if(r&&l){var g=r.get("select"),u=l.get("select"),y=r.clone(),p=l.clone(),m=y.get("lineData"),f=m.fontStyle+" "+m.fontSize+" "+m.fontFamily,v=new n.style.Style({stroke:new n.style.Stroke({width:g.strokeWidth,color:g.strokeColor}),text:new n.style.Text({text:m.name||"",font:void 0!==f?f:"12px Calibri,sans-serif",fill:new n.style.Fill({color:g.labelFillColor}),stroke:new n.style.Stroke({color:g.labelStrokeColor,width:g.strokeWidth})})}),h=new n.style.Style({image:new n.style.RegularShape({fill:new n.style.Fill({color:u.labelFillColor||"#208089"}),stroke:new n.style.Stroke({color:u.strokeColor||"#000",width:u.strokeWidth||1}),cursor:"point",points:3,radius:u.arrowRadius,rotation:u.rotation,angle:0})});p.setStyle(h),p.setId(d),p.set("mapId",o),p.set("layerId",i),p.set("layerType",s),p.set("hType",t),p.set("highlightFeature",!0),y.setStyle(v),y.setId(a),y.set("mapId",o),y.set("layerId",i),y.set("layerType",s),y.set("hType",t),y.set("highlightFeature",!0),y.set("arrow",p),c.getSource().addFeature(y),c.getSource().addFeature(p)}})}}var n=a(3),i=(a(6),a(4)),l=a(7),s=a(1),d=a(43),c=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=i.get(t);if(s.isValid(i.get(a)))o=i.get(a);else{var o=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})});e.multiple&&o.set("multiple",e.multiple),o.set("type",l.CUSTOMTYPE.LAYERTYPE),o.set("map",r),o.set("layerId",a),o.set("layer_id",e.layerId),1===e.isBezier?o.set("businessType",l.BUSINESSTYPE.BEZIERLINE):o.set("businessType",l.BUSINESSTYPE.STRAIGHTLINE),o.set("params.label",e.label),o.setZIndex(l.Z_INDEX.LINE),r.addLayer(o),i.put(a,o)}return void 0!=e.minShowLevel&&o.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&o.set("maxShowLevel",parseInt(e.maxShowLevel)),o},g=function(e,t){var a=e.lineGeoId,i=e.name,s=e.coordinates,d=e.strokeColor,g=e.strokeWidth,u=e.fillColor,y=e.labelStrokeColor,p=e.labelFillColor,m=c(e),f=m.getSource(),v=r(s),h=new n.geom.LineString(v),I={fillColor:u,strokeColor:"black",strokeWidth:g||3,labelFillColor:p||"black",labelStrokeColor:y||"#ffffff"},S=new n.Feature({geometry:h,lineData:e,businessType:1===e.isBezier?l.BUSINESSTYPE.BEZIERLINE:l.BUSINESSTYPE.STRAIGHTLINE,select:e.hightLight?e.hightLight:I});if(e.hightLight)for(var b in I)e.hightLight[b]?e.hightLight[b]:e.hightLight[b]=I[b];var L=new n.style.Style({stroke:new n.style.Stroke({color:d||"rgba(138,43,226,0.5)",width:g||3}),text:new n.style.Text({text:i,font:"12px Calibri,sans-serif",fill:new n.style.Fill({color:u||"rgba(138,43,226,0.5)"}),stroke:new n.style.Stroke({color:d||"rgba(138,43,226,0.5)",width:g||3})})});if(S.setStyle(L),S.set("layer",m),S.setId(a),1===e.isBezier?S.set("vectorType",l.BUSINESSTYPE.BEZIERLINE):S.set("vectorType",l.BUSINESSTYPE.STRAIGHTLINE),S.set("data",s),S.set("coordinates",v),f.addFeature(S),1===e.isBezier){if(!t)return e.coordinates;t(e.coordinates,S)}else t(S);m.set("clickId","straightline-click-event"),fusiongis.Events.addClickCallback(e.mapId,"straightline-click-event",function(t){if(t.layer&&t.layer.get("businessType")===l.BUSINESSTYPE.STRAIGHTLINE&&t.feature&&t.feature.get("businessType")===l.BUSINESSTYPE.STRAIGHTLINE){var a=t.feature;o(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId)};e.exports={addLine:g,highlight:o}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,i=void 0!==o.strokeWidth?o.strokeWidth:1,s=new l.Feature({geometry:new l.geom.Polygon([n]),mapId:e,layerId:t,layerType:a,hType:r}),d=new l.style.Style({stroke:new l.style.Stroke({width:i,color:o.strokeColor||"black"})});s.setStyle(d);var c=m.getHLayer({mapId:e,layerId:t});c.getSource().addFeature(s)}function o(e,t,a,r,o,n){var i=n.get("imgToken"),s=void 0!=i?i.slice(0,i.indexOf(":")):void 0,d=void 0!==o.strokeWidth?o.strokeWidth:1;p.postJSON({url:g.GisRootUrl+"/common/mapRender/query?FCName="+s,data:JSON.stringify({idValue:o.geoIds,imgToken:i}),success:function(n){if(n&&(n=JSON.parse(n),1===n.status.code&&n.data&&n.data.length)){var i=n.data.map(function(n){var i=n.geometry,s=new l.Feature({geometry:new l.geom.Polygon([i]),mapId:e,layerId:t,layerType:a,hType:r}),c=new l.style.Style({stroke:new l.style.Stroke({width:d,color:o.strokeColor||"#9900FF"})});return s.setStyle(c),s}),s=m.getHLayer({mapId:e,layerId:t});s.getSource().addFeatures(i)}},failure:function(e){console.log(e)}})}function n(e){var t=e.callback;p.postJSON({url:g.GisRootUrl+"/custom/queryfeature?FCName="+e.FCName,data:JSON.stringify(e),success:function(e){if(e){var a=JSON.parse(e),r=a.status;t(1===r.code?a:[])}},failure:function(e){t([]),console.log(e)}})}function i(e){var t=u.getLayer(e);if(t){var a;a=e.isShowLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.getSource().updateParams(r)}}var l=a(3),s=a(8),d=a(6),c=a(4),g=a(7),u=a(41),y=a(1),p=a(14),m=a(43),f=a(11),v=function(e){var t=e.layerId+"_"+e.mapId,a=c.get(e.mapId);a.getView().getZoom();if(!c.containsKey(t)){var r=new l.layer.Image({source:new l.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});r.setZIndex(g.Z_INDEX.POLYGON),r.set("type",g.CUSTOMTYPE.LAYERTILETYPE),r.set("businessType","DPOLYGON"),r.set("isVectorType",!1),r.set("params.label",e.label),r.set("layerId",t),r.set("map",a),r.set("layer_id",e.layerId),r.set("multiple",e.multiple),r.set("clickId","business_Dservice_polygon_event_id"),void 0!=e.minShowLevel&&r.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&r.set("maxShowLevel",parseInt(e.maxShowLevel)),c.put(t,r),a.addLayer(r)}f.addClickCallback(e.mapId,"business_Dservice_polygon_event_id",function(t){if(t.layer&&"DPOLYGON"===t.layer.get("businessType")){var a=(d.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&I(t.layer,"click",a[0]):m.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},h=function(e){var t=u.getLayer(e);if(t){e.label&&t.set("params.label",e.label),t.set("params.imgToken",e.imgToken),t.set("imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("paramObj",e);var a=e.isShowLabel?e.imgTokenLabel:e.imgToken,r=void 0!=a?a.slice(0,a.indexOf(":")):void 0,o=new l.source.ImageWMS({url:g.GisRootUrl+"/common/mapRender/export",params:{imgToken:a,VERSION:"1.1.1",FCName:r},wrapX:!1});t.setSource(o)}},I=function(e,t,a){var n=e.get("map"),i=n.getTarget(),l=e.get("layer_id"),s=e.get("businessType");m.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===g.HTYPE.CLICK?r(i,l,s,t,a):t===g.HTYPE.VECTOR&&o(i,l,s,t,a,e)},S=function(e,t,a,r){if(!t.getVisible())return void r([]);var o=s.getExtent(e.getTarget()),n=t.get("imgToken"),i=void 0!=n?n.slice(0,n.indexOf(":")):void 0,l=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=l&&void 0!=l.tolerance?l.tolerance:.1,mapExtent:o,imgToken:n,FCName:i};p.get({url:g.GisRootUrl+"/common/mapRender/identify",data:y.getParameterString(d),success:function(a){if(a){var o=JSON.parse(a),n=o.status;if(1===n.code)if(o.data&&o.data.length>0){var i=o.data.map(function(a){var r={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name};return r});r&&"function"==typeof r&&r(i)}else r([]);else r([])}},failure:function(e){console.log(e),r([])}})};e.exports={addLayer:v,setLayerData:h,getClickData:S,highlight:I,setShowLabel:i,getQueryData:n}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,i=void 0!==o.strokeWidth?param.strokeWidth:1,s=new l.Feature({geometry:new l.geom.Point(n),mapId:e,layerId:t,layerType:a,hType:r}),d=new l.style.Style({image:new l.style.Circle({radius:o.radius||5,fill:new l.style.Fill({color:o.fillColor||"black"}),stroke:new l.style.Stroke({color:o.strokeColor||"black",width:i})})});s.setStyle(d);var c=m.getHLayer({mapId:e,layerId:t});c.getSource().addFeature(s)}function o(e,t,a,r,o,n){var i=n.get("imgToken"),s=void 0!=i?i.slice(0,i.indexOf(":")):void 0,d=void 0!==o.strokeWidth?o.strokeWidth:1;p.postJSON({url:g.GisRootUrl+"/common/mapRender/query?FCName="+s,data:JSON.stringify({idValue:o.geoIds,imgToken:i}),success:function(n){if(n&&(n=JSON.parse(n),1===n.status.code&&n.data&&n.data.length)){var i=n.data.map(function(n){var i=n.geometry,s=new l.Feature({geometry:new l.geom.Point(i[0]),mapId:e,layerId:t,layerType:a,hType:r}),c=new l.style.Style({image:new l.style.Circle({radius:o.radius||5,fill:new l.style.Fill({color:o.fillColor||"black"}),stroke:new l.style.Stroke({color:o.strokeColor||"black",width:d})})});return s.setStyle(c),s}),s=m.getHLayer({mapId:e,layerId:t});s.getSource().addFeatures(i)}},failure:function(e){console.log(e)}})}function n(e){var t=e.callback;p.postJSON({url:g.GisRootUrl+"/custom/queryfeature?FCName="+e.FCName,data:JSON.stringify(e),success:function(e){if(e){var a=JSON.parse(e),r=a.status;t(1===r.code?a:[])}},failure:function(e){t([])}})}function i(e){var t=u.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var l=a(3),s=a(6),d=a(8),c=a(4),g=a(7),u=a(41),y=a(1),p=a(14),m=a(43),f=a(11),v=function(e){var t=e.layerId+"_"+e.mapId,a=s.getMapObj(e.mapId);if(!c.containsKey(t)){var r=new l.layer.Image({source:new l.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});r.setZIndex(g.Z_INDEX.MARKER),r.set("type",g.CUSTOMTYPE.LAYERTILETYPE),r.set("isVectorType",!1),r.set("businessType","DPOINT"),r.set("dw",e.dw),r.set("params.label",e.label),r.set("layerId",t),r.set("map",a),r.set("layer_id",e.layerId),r.set("clickId","business_Dservice_point_event_id"),e.multiple&&r.set("multiple",e.multiple),void 0!=e.minShowLevel&&r.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&r.set("maxShowLevel",parseInt(e.maxShowLevel)),c.put(t,r),a.addLayer(r)}f.addClickCallback(e.mapId,"business_Dservice_point_event_id",function(t){if(t.layer&&"DPOINT"===t.layer.get("businessType")){var a=(s.getMapObj(e.mapId),t.transportDataToInnerLayer);a?I(t.layer,"click",a[0]):m.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},h=function(e){var t=u.getLayer(e);e.label&&t.set("params.label",e.label);var a=null;a=void 0!==t.get("dw")?g.GisRootUrl+"/mapRender/export":g.GisRootUrl+"/common/mapRender/export",t.set("imgToken",e.imgToken),t.set("paramObj",e),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("params.imgToken",e.imgToken);var r=e.showLabel?e.imgTokenLabel:e.imgToken,o=void 0!=r?r.slice(0,r.indexOf(":")):void 0,n={VERSION:"1.1.1",imgToken:r,FCName:o};t&&(t.getSource().setUrl(a),t.getSource().updateParams(n))},I=function(e,t,a){var n=e.get("map"),i=n.getTarget(),l=e.get("layer_id"),s=e.get("businessType");m.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===g.HTYPE.CLICK?r(i,l,s,t,a):t===g.HTYPE.VECTOR&&o(i,l,s,t,a,e)},S=function(e,t,a,r){if(!t.getVisible())return void r([]);var o=d.getExtent(e.getTarget()),n=t.get("imgToken"),i=void 0!=n?n.slice(0,n.indexOf(":")):void 0,l=t.get("paramObj"),s={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=l&&void 0!=l.tolerance?l.tolerance:10,mapExtent:o,imgToken:n,FCName:i};p.get({url:g.GisRootUrl+"/common/mapRender/identify",data:y.getParameterString(s),success:function(a){if(a){var o=JSON.parse(a),n=o.status,i=o.data&&o.data.length>0&&o.data[0];1===n.code&&i?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:i.id,geoName:i.name,lonLat:i.centerPoint,geometry:i.geometry,extentInfo:i.extentInfo}]):r([])}},failure:function(e){r([])}})};e.exports={addLayer:v,setLayerData:h,getClickData:S,highlight:I,getQueryData:n,setShowLabel:i}},function(e,t,a){function r(e,t,a,r,o){var n=o.geometry,i=void 0!==o.strokeWidth?o.strokeWidth:1,s=new l.Feature({geometry:new l.geom.LineString(n),mapId:e,layerId:t,layerType:a,hType:r}),d=new l.style.Style({stroke:new l.style.Stroke({width:i,color:o.strokeColor||"black"})});s.setStyle(d);var c=m.getHLayer({mapId:e,layerId:t});c.getSource().addFeature(s)}function o(e,t,a,r,o,n){var i=n.get("imgToken"),s=void 0!=i?i.slice(0,i.indexOf(":")):void 0,d=void 0!==o.strokeWidth?o.strokeWidth:1;p.postJSON({url:g.GisRootUrl+"/common/mapRender/query?FCName="+s,data:JSON.stringify({idValue:o.geoIds,imgToken:i}),success:function(n){if(n&&(n=JSON.parse(n),1===n.status.code&&n.data&&n.data.length)){var i=n.data.map(function(n){var i=n.geometry,s=new l.Feature({geometry:new l.geom.LineString(i),mapId:e,layerId:t,layerType:a,hType:r}),c=new l.style.Style({stroke:new l.style.Stroke({width:d,color:o.strokeColor||"#9900FF"})});return s.setStyle(c),s}),s=m.getHLayer({mapId:e,layerId:t});s.getSource().addFeatures(i)}},failure:function(e){console.log(e)}})}function n(e){var t=e.callback;p.postJSON({url:g.GisRootUrl+"/custom/queryfeature?FCName="+e.Fcname,data:JSON.stringify(e),success:function(e){if(e){var a=JSON.parse(e),r=a.status;1===r.code?t&&"function"==typeof t&&t(a):t([])}},failure:function(e){t([]),console.log(e)}})}function i(e){var t=u.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var l=a(3),s=a(6),d=a(8),c=a(4),g=a(7),u=a(41),y=a(1),p=a(14),m=a(43),f=a(11),v=function(e){var t=e.layerId+"_"+e.mapId,a=s.getMapObj(e.mapId),r=null;c.containsKey(t)?r=c.get(t):(r=new l.layer.Image({source:new l.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),r.setZIndex(g.Z_INDEX.LINE),r.set("type",g.CUSTOMTYPE.LAYERTILETYPE),r.set("isVectorType",!1),r.set("businessType","DLINE"),r.set("params.label",e.label),r.set("layerId",t),r.set("map",a),r.set("layer_id",e.layerId),e.multiple&&r.set("multiple",e.multiple),c.put(t,r),a.addLayer(r)),void 0!=e.minShowLevel&&r.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&r.set("maxShowLevel",parseInt(e.maxShowLevel)),r.set("clickId","business_Dservice_line_event_id"),f.addClickCallback(e.mapId,"business_Dservice_line_event_id",function(t){if(t.layer&&"DLINE"===t.layer.get("businessType")){var a=(s.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&I(t.layer,"click",a[0]):m.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},h=function(e){var t=u.getLayer(e);e.label&&t.set("params.label",e.label),t.set("params.imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("imgToken",e.imgToken),t.set("paramObj",e);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=void 0!=a?a.slice(0,a.indexOf(":")):void 0,o={VERSION:"1.1.1",imgToken:a,FCName:r};t&&(t.getSource().setUrl(g.GisRootUrl+"/common/mapRender/export"),t.getSource().updateParams(o))},I=function(e,t,a){var n=e.get("map"),i=n.getTarget(),l=e.get("layer_id"),s=e.get("businessType");m.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===g.HTYPE.CLICK?r(i,l,s,t,a):t===g.HTYPE.VECTOR&&o(i,l,s,t,a,e)},S=function(e,t,a,r){if(!t.getVisible())return void r([]);var o=d.getExtent(e.getTarget()),n=t.get("imgToken"),i=void 0!=n?n.slice(0,n.indexOf(":")):void 0,l=t.get("paramObj"),s={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=l&&void 0!=l.tolerance?l.tolerance:1,mapExtent:o,imgToken:n,FCName:i};p.get({url:g.GisRootUrl+"/common/mapRender/identify",data:y.getParameterString(s),success:function(a){if(a){var o=JSON.parse(a),n=o.status,i=o.data&&o.data.length>0&&o.data[0];1===n.code&&i?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),geoId:i.id,geoName:i.name,lonLat:i.centerPoint,geometry:i.geometry,extentInfo:i.extentInfo}]):r([])}},failure:function(e){console.error(e),r([])}})};e.exports={addLayer:v,setLayerData:h,getClickData:S,highlight:I,getQueryData:n,setShowLabel:i}},function(e,t,a){var r=a(3),o=a(4),n=a(5),i=a(1),l=a(7),s=a(6),d=a(48),c=a(43),g=function(e){var t=e.layerId+"_"+e.mapId,a=null;o.containsKey(t)?a=o.get(t):(n.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType","BUBBLE_CIRCLE_LABEL"),a.set("layer_id",e.layerId),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),a.set("isRadiuChange",e.isRadiuChange||!0),a.set("datas",e.datas),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),a.set("isNotTip",void 0!==e.isNotTip&&e.isNotTip),e.isHighlight&&fusiongis.Events.addClickCallback(e.mapId,"bubble-circle-label-click-event",function(t){if(t.layer&&"BUBBLE_CIRCLE_LABEL"===t.layer.get("businessType")&&t.feature&&"BUBBLE_CIRCLE_LABEL"===t.feature.get("vectorType")){c.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]});var a=t.feature;u(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId);var r=a.getSource();e.source=r,y(e)},u=function(e,t,a){if(e){var r=e.get("map"),o=r.getTarget(),n=e.get("layer_id"),i=(e.get("businessType"),e.getZIndex());c.removeHighlight({mapId:o,layerId:n,hTypes:[t]});var s=c.getHLayer({mapId:o,layerId:n}),d=s.get("layerId");if(e.hasOwnProperty("mouseoverCallback")&&"function"==typeof e.mouseoverCallback&&!s.hasOwnProperty("mouseoverCallback")&&h({layerId:d,mapId:a.mapId,callbackfunc:e.mouseoverCallback}),t===l.HTYPE.CLICK){if(a.feature){var g=a.feature.getId(),u=a.feature,y=(a.feature.get("select"),u.clone(),u.get("data")),p=u.get("dealData"),m=u.get("select"),v=a.feature.get("tipCoordinates"),I=f("highlight",{highLightData:m,dealData:p,data:y,mapId:o,getId:g,hType:t,hLayer:s,tipCoordinates:v});y.hType=t,s.set("data",y),s.set("tipCoordinates",v),s.set("dealData",p),s.set("select",m),s.getSource().addFeature(I),s.setZIndex(i+1)}}else if(t===l.HTYPE.VECTOR){var S=[];if(void 0!==a.geoIds&&a.geoIds.length>0){var b=a.geoIds.map(function(a){var r=e.getSource().getFeatureById(a),n=r.get("select"),i=(r.clone(),r.get("data")),l=r.get("dealData");S.push({data:i,dealData:l,highLightData:n,hlType:t,tipCoordinates:r.get("tipCoordinates")});var d=f("highlight",{highLightData:n,dealData:l,data:i,mapId:o,geoId:a,hType:t,hLayer:s,tipCoordinates:r.get("tipCoordinates")});return d});s.set("data",S),s.getSource().addFeatures(b),s.setZIndex(i+1)}}}},y=function(e){var t=e.datas,a=e.layerId+"_"+e.mapId,n=o.get(a),l=n.getSource(),c=s.getMapObj(e.mapId),g=360,u=0,y=0,p=e.tipAzimth;if(n.set("tipAzimth",e.tipAzimth),n.set("isDis",e.isDis),i.isValid(t)||t.length>0){var m=[];t.forEach(function(t,a){var o=t.radius?t.radius:40,i=[],l=t.coordinate[0],s=t.coordinate[1],f=c.getPixelFromCoordinate(r.proj.fromLonLat(t.coordinate)),v=d.createSector(f[0],f[1],o,u,g),h=I(f,o,p),S=r.proj.toLonLat(c.getCoordinateFromPixel(h));console.log(S);for(var b=0;b<v.length;b++)i.push(c.getCoordinateFromPixel(v[b]));var L=new r.geom.LinearRing(i),T=L.getCoordinates(),w=null;w=new r.geom.GeometryCollection,T.splice(0,2),T.splice(T.length-1,2),w.setGeometries([new r.geom.Circle(r.proj.fromLonLat([l,s]),y),new r.geom.Polygon([T])]);var E,C,k=new r.Feature({geometry:w,data:t,businessType:"BUBBLE_CIRCLE_LABEL"}),x=t.radius/50,P=15*x+"px",_=10*x+"px",O=25*x+"px";if(x>=1?(E=4,C=8):x>=.5&&x<1?(E=3,C=4):(E=2,C=3),e.isDis)var M=t.label.labelArea,N=t.label.labelType,F=t.label.labelPercent;else var M=t.label.labelArea.toString().length>E?t.label.labelArea.slice(0,E-1)+"...":t.label.labelArea,N=t.label.labelType.toString().length>C?t.label.labelType.slice(0,C-1)+"...":t.label.labelType,F=t.label.labelPercent;k.setId(t.id),k.set("defaultRadiu",o),k.set("data",t),k.set("layer",n),k.set("tipCoordinates",S),k.set("vectorType","BUBBLE_CIRCLE_LABEL");var A=new r.style.Style({fill:new r.style.Fill({color:t.fillColor||"blue"}),stroke:new r.style.Stroke({color:t.strokeColor||"white",width:t.strokeWidth||3,lineDash:t.lineDash||void 0}),text:new r.style.Text({text:M,fill:new r.style.Fill({color:t.labelColor||"white"}),stroke:new r.style.Stroke({color:e.isDis?"rgba(0,0,0,0.6)":t.labelStrokeColor?t.labelStrokeColor:"transparent",width:e.isDis?3:t.labelStrokeWidth?t.labelStrokeWidth:0}),font:t.label.areaFont||P+" lighter Arail",offsetY:t.label.areaOffsetY||-30*x})}),R=new r.style.Style({text:new r.style.Text({text:N,fill:new r.style.Fill({color:t.labelColor||"white"}),stroke:new r.style.Stroke({color:e.isDis?"rgba(0,0,0,0.6)":t.labelStrokeColor?t.labelStrokeColor:"transparent",width:e.isDis?3:t.labelStrokeWidth?t.labelStrokeWidth:0}),font:t.label.typeFont||_+" lighter Arail",offsetY:t.label.typeOffsetY||-5*x})}),G=new r.style.Style({text:new r.style.Text({text:F,fill:new r.style.Fill({color:t.labelColor||"white"}),stroke:new r.style.Stroke({color:e.isDis?"rgba(0,0,0,0.6)":t.labelStrokeColor?t.labelStrokeColor:"transparent",width:e.isDis?3:t.labelStrokeWidth?t.labelStrokeWidth:0}),font:t.label.percentFont||O+" lighter Arail",offsetY:t.label.percentOffsetY||25*x})}),D=[A,R,G];A.setZIndex(a),R.setZIndex(a),G.setZIndex(a),k.setStyle(D);var j={labelArea:M,labelType:N,labelPercent:F,multiplierNum:x,aeraFontSize:P,percentFontSize:O,typeFontSize:_},Y={strokeColor:t.strokeColor||"black",labelColor:t.labelColor||"white",lineDash:t.lineDash||void 0,fillColor:t.fillColor||"blue"};k.set("dealData",j),k.set("select",t.highlight||Y),m.push(k)}),l.addFeatures(m)}},p=function(e){var t=fusiongis.BaseLayer.getLayer(e);t&&t.getSource()&&t.getSource().clear()},m=function(e){var t,a=s.getMapObj(e.mapId),r=a.getLayers().getArray(),o=[];if(r&&r.forEach(function(a){a.get("layerId")&&a.get("layerId")===e.layerId&&(t=a)}),void 0!==t){t.getSource().clear();var n=t.get("data");if(void 0===n)return;if(n instanceof Array&&n.length>0)o=n.map(function(a){var r=f("highlight",{mapId:e.mapId,geoId:a.data.id,highLightData:a.highLightData,dealData:a.dealData,data:a.data,hType:a.hlType,hLayer:t,tipCoordinates:a.tipCoordinates});return r});else{var i=f(t,{mapId:e.mapId,geoId:n.id,hType:n.hType,tipCoordinates:t.get("tipCoordinates")});o.push(i)}t.getSource().addFeatures(o)}},f=function(e,t){var a,o,n,i,l,c=s.getMapObj(t.mapId),g=t.tipCoordinates;if(void 0!==e&&"highlight"!==e?(a=e.get("data"),o=e.get("select"),n=e.get("dealData"),i=t.geoId,l=e):(a=t.data,o=t.highLightData,n=t.dealData,i=t.geoId,l=t.hLayer),void 0!==a&&void 0!==o&&void 0!==n){for(var y=360,p=0,m=0,f=a.radius?a.radius:40,v=[],h=a.coordinate[0],I=a.coordinate[1],S=c.getPixelFromCoordinate(r.proj.fromLonLat(a.coordinate)),b=d.createSector(S[0],S[1],f,p,y),L=0;L<b.length;L++)v.push(c.getCoordinateFromPixel(b[L]));var T=new r.geom.LinearRing(v),w=T.getCoordinates(),E=null;E=new r.geom.GeometryCollection,w.splice(0,2),w.splice(w.length-1,2),E.setGeometries([new r.geom.Circle(r.proj.fromLonLat([h,I]),m),new r.geom.Polygon([w])]);var C=new r.Feature({geometry:E,data:a,businessType:"BUBBLE_CIRCLE_LABEL"}),k=void 0===o.lineDash?a.lineDash:"solid"===u.lineDash?void 0:u.lineDash,x=new r.style.Style({fill:new r.style.Fill({color:o.fillColor||a.fillColor}),stroke:new r.style.Stroke({color:o.strokeColor||"black",width:a.strokeWidth||3,lineDash:k||void 0}),text:new r.style.Text({text:n.labelArea,fill:new r.style.Fill({color:o.labelColor||"white"}),font:a.label.areaFont||n.aeraFontSize+" lighter Arail",offsetY:a.label.areaOffsetY||-30*n.multiplierNum})}),P=new r.style.Style({text:new r.style.Text({text:n.labelType,fill:new r.style.Fill({color:o.labelColor||"white"}),font:a.label.typeFont||n.typeFontSize+" lighter Arail",offsetY:a.label.typeOffsetY||-5*n.multiplierNum})}),_=new r.style.Style({text:new r.style.Text({text:n.labelPercent,fill:new r.style.Fill({color:o.labelColor||"white"}),font:a.label.percentFont||n.percentFontSize+" lighter Arail",offsetY:a.label.percentOffsetY||25*n.multiplierNum})}),O=[x,P,_];return C.setStyle(O),C.set("hType",t.hType),C.setId(i),C.set("layer",l),C.set("mapId",t.mapId),C.set("highlightFeature",!0),C.set("tipCoordinates",g),C}},v=function(e){n.removeLayer(e);var t=s.getMapObj(e.mapId),a=t.getLayers().getArray(),r=e.layerIds.map(function(e){return e+"&&&highlight"});r.forEach(function(e){a.forEach(function(a){a.get("layer_id")===e&&t.removeLayer(a)})})},h=function(e){var t,a=s.getMapObj(e.mapId),r=a.getLayers().getArray();r.forEach(function(a){a.get("layerId")===e.layerId&&(t=a)}),e.hasOwnProperty("callbackfunc")&&t&&(t.mouseoverCallback=e.callbackfunc)},I=function(e,t,a){var r,o;return a<90?(r=e[0]+t*Math.cos(a),o=Math.sqrt(t*t-(r-e[0])*(r-e[0]))+e[1]):90===a?(r=e[0],o=e[1]+t):a>90&&a<=180?(r=e[0]-t*Math.cos(180-a),o=Math.sqrt(t*t-(r-e[0])*(r-e[0]))+e[1]):a>180&&a<270?(r=e[0]-t*Math.cos(a-180),o=Math.sqrt(t*t-(r-e[0])*(r-e[0]))+e[1]):270===a?(r=e[0],o=e[1]-t):(r=e[0]+t*Math.cos(360-a),o=Math.sqrt(t*t-(r-e[0])*(r-e[0]))+e[1]),[r,o]};e.exports={addBubble:g,setLayerData:y,clear:p,highlight:u,zoomChangeHightlight:m,removeLayer:v}},function(e,t,a){var r=a(3),o=a(4),n=a(5),i=a(1),l=a(7),s=a(6),d=(a(48),a(43)),c=function(e){var t=e.layerId+"_"+e.mapId,a=null,t=e.layerId+"_"+e.mapId,a=null;o.containsKey(t)?a=o.get(t):(n.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType","ICON_FONT_STYLE"),a.set("layer_id",e.layerId),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),a.set("datas",e.datas);var r=a.getSource();e.source=r,e.isHighlight&&fusiongis.Events.addClickCallback(e.mapId,"font-style-click-event",function(t){
if(t.layer&&"ICON_FONT_STYLE"===t.layer.get("businessType")&&t.feature&&"ICON_FONT_STYLE"===t.feature.get("vectorType")){d.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]});var a=t.feature;g(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:a})}},e.layerId),u(e)},g=function(e,t,a){if(e){var o=e.get("map"),n=o.getTarget(),i=e.get("layer_id"),s=e.get("businessType");d.removeHighlight({mapId:n,layerId:i,hType:[t]});var c=d.getHLayer({mapId:n,layerId:i});if(t===l.HTYPE.CLICK){if(a.feature){var g=a.feature.getId(),u=a.feature,y=a.feature.get("select"),p=u.clone(),m=u.get("data").labelFontStyle,f=[];m.forEach(function(e,t){var a=new r.style.Style({text:new r.style.Text({text:e.label||"",fill:new r.style.Fill({color:y.fillColor||"#757171"}),stroke:new r.style.Stroke({color:y.strokeColor||null,width:y.strokeWidth||0,lineDash:e.lineDash||void 0}),font:e.font||"10px sans-seri",textAlign:e.textAlign||"start",textBaseline:e.textBaseline||"alphabetic",offsetY:e.OffsetY||20*t,offsetX:e.OffsetX||0})});f.push(a)}),p.setStyle(f),p.set("hType","click"),p.setId(g),p.set("mapId",a.mapId),p.set("highlightFeature",!0)}c.getSource().addFeature(p)}else if(hType===l.HTYPE.VECTOR){var v=param.geoIds.map(function(a){var o=e.getSource().getFeatureById(a),l=o.get("select"),d=o.clone(),c=o.get("data"),d=o.clone(),g=[];return c.forEach(function(e,t){var a=new r.style.Style({text:new r.style.Text({text:e.label||"",fill:new r.style.Fill({color:l.fillColor||"#757171"}),stroke:new r.style.Stroke({color:l.strokeColor||null,width:l.strokeWidth||0,lineDash:e.lineDash||void 0}),font:e.font||"10px sans-seri",textAlign:e.textAlign||"start",textBaseline:e.textBaseline||"alphabetic",offsetY:e.OffsetY||20*t,offsetX:e.OffsetX||0})});g.push(a)}),d.setStyle(_style),d.setId(a),d.set("mapId",n),d.set("layerId",i),d.set("layerType",s),d.set("hType",t),d.set("highlightFeature",!0),d});c.getSource().addFeature(v)}}},u=function(e){var t=(s.getMapObj(e.mapId),e.datas),a=e.layerId+"_"+e.mapId,n=o.get(a),l=n.getSource();if(i.isValid(t)&&t.length>0){var d=[];t.forEach(function(e){var t=e.coordinate,a=r.proj.fromLonLat([Number(t[0]),Number(t[1])]),o=new r.Feature({geometry:new r.geom.Point(a)}),i=e.labelFontStyle,l=[];if(i instanceof Array){i.forEach(function(e,t){var a=new r.style.Style({text:new r.style.Text({text:e.label||"",fill:new r.style.Fill({color:e.fillColor||"#757171"}),stroke:new r.style.Stroke({color:e.strokeColor||null,width:e.strokeWidth||0,lineDash:e.lineDash||void 0}),font:e.font||"10px sans-seri",textAlign:e.textAlign||"start",textBaseline:e.textBaseline||"alphabetic",offsetY:e.OffsetY||20*t,offsetX:e.OffsetX||0})});l.push(a)});var s={fillColor:i[0].fillColor||"#757171",strokeColor:i[0].strokeColor||null,strokeWidth:i[0].strokeWidth||0};o.setStyle(l),o.set("select",e.highlight?e.highlight:s),o.setId(e.id),o.set("data",e),o.set("vectorType","ICON_FONT_STYLE"),o.set("layer",n)}d.push(o)}),l.addFeatures(d)}};e.exports={addFontLayer:c,setLayerData:u}},function(e,t,a){function r(e,t,a){if(t=l.HTYPE.VECTOR,e){var r=e.get("map"),n=r.getTarget(),i=e.get("layer_id");e.get("businessType");c.removeHighlight({mapId:n,layerId:i});var s=c.getHLayer({mapId:n,layerId:i}),d=a.feature,g=[];if(void 0==d){var u=e.getSource().getFeatures();u.forEach(function(e,t){e.set("targetPoint",[]),a.geoIds instanceof Array&&a.geoIds.length>0&&a.geoIds.forEach(function(t,a){e.get("data").forEach(function(a,r){a.id==t&&(e.get("targetPoint").push(a),g.push(e))})})}),g.length>0&&g.forEach(function(e,t){var a=e.get("select"),r=e.get("pointDataObj"),n=e.get("targetPoint");n.forEach(function(e){var t=new o.Feature({geometry:new o.geom.Point(o.proj.fromLonLat(e.coordinate))}),n=new o.style.Style({image:new o.style.Circle({radius:r.radius,fill:new o.style.Fill({color:a.fillColor}),stroke:new o.style.Stroke({color:a.strokeColor,width:a.strokeWidth})})});t.setStyle(n),s.getSource().addFeature(t)})})}else{var y=d.get("select"),p=d.get("pointDataObj"),m=new o.Feature({geometry:new o.geom.Point(o.proj.fromLonLat(d.get("coordinate")))}),f=new o.style.Style({image:new o.style.Circle({radius:p.radius,fill:new o.style.Fill({color:y.fillColor}),stroke:new o.style.Stroke({color:y.strokeColor,width:y.strokeWidth})})});m.setStyle(f),s.getSource().addFeature(m)}}}var o=a(3),n=a(6),i=a(4),l=a(7),s=a(41),d=a(1),c=a(43),g=(a(16),a(11),function(e){var t=e.layerId+"_"+e.mapId,a=null,r=n.getMapObj(e.mapId),s=void 0==e.isShow||e.isShow,d=e.label?e.label:e.layerId;i.containsKey(t)?a=i.get(t):(a=new o.layer.Vector({source:new o.source.Vector({wrapX:!1})}),a.set("type",l.CUSTOMTYPE.LAYERTYPE),a.set("map",r),a.set("layerId",e.layerId),a.set("layer_id",e.layerId),a.set("businessType",l.BUSINESSTYPE.MULTIPOINT),a.set("params.label",d),a.set("isVectorType",!0),a.set("state.showLabel",!!e.showLabel),a.setZIndex(l.Z_INDEX.LANDMARKER),a.set("isShow",s),e.multiple&&a.set("multiple",e.multiple),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),i.put(t,a),r.addLayer(a))}),u=function(e){var t=[],a=e.datas,r=s.getLayer(e);r.set("paramObj",e),e.label&&r.set("params.label",e.label),(d.isValid(a)||a.length>0)&&(r.set("state.showLabel",!!e.showLabel),a.forEach(function(a){var n=function(){return a.points.map(function(e,t){return o.proj.fromLonLat(e.coordinate)})}(),i=new o.Feature({geometry:new o.geom.MultiPoint(n),data:a.points,pointDataObj:a,layerId:e.layerId,mapId:e.mapId,businessType:l.BUSINESSTYPE.MULTIPOINT,vectorType:l.BUSINESSTYPE.MULTIPOINT,layer:r,id:a.id}),s=new o.style.Style({image:new o.style.Circle({radius:a.radius,stroke:new o.style.Stroke({width:void 0!=a.strokeWidth?a.strokeWidth:2,color:void 0!=a.strokeColor?a.strokeColor:"black"}),fill:new o.style.Fill({color:void 0!=a.fillColor?a.fillColor:"red"})})});i.setStyle(s),i.set("select",a.highlight),t.push(i)}),r.getSource().addFeatures(t))},y=function(e,t){var a,r,n,i=1/0;for(r=0,n=e.length;r<n;r+=1){var l=e[r],s=o.proj.fromLonLat([Number(l.coordinate[0]),Number(l.coordinate[1])]),d=new o.geom.LineString([[Number(t[0]),Number(t[1])],[Number(s[0]),Number(s[1])]]).getLength();d<i&&(i=d,a=l)}return a};e.exports={addLayer:g,setLayerData:u,highlight:r,getTargetClkPoint:y}},function(e,t){function a(e){for(var t in e)return!1;return!0}function r(e,t){for(var a=0,r=e.length;a<r;)t(a,e[a])?a=0:a++}function o(e,t){var r=e.listeners[t]._handler_;e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent("on"+t,r),delete e.listeners[t],a(e.listeners)&&delete e.listeners}function n(e,t,a){e.listeners=e.listeners||{};var r=e.listeners[t]=e.listeners[t]||[];r.push(a),r._handler_||(r._handler_=function(t){for(var a,o=t||window.event,n=0;a=r[n++];)a.call(e,o)},e.addEventListener?e.addEventListener(t,r._handler_,!1):e.attachEvent("on"+t,r._handler_))}function i(e,t,a){if(e.listeners){var n=e.listeners&&e.listeners[t];n&&(r(n,function(e,t){if(t==a)return n.splice(e,1)}),0==n.length&&o(e,t))}}function l(e,t){try{if(e.dispatchEvent){var a=document.createEvent("Event");a.initEvent(t,!0,!0),e.dispatchEvent(a)}else e.fireEvent&&e.fireEvent("on"+t)}catch(r){console.error(r.getMessage())}}e.exports={add:n,remove:i,dispatch:l}},function(e,t,a){function r(){var e,t,a,r,p,f,v=this;setInterval(function(){v.mouseHoverPublisher(r,f,p)},500),this.beat=function(e,t,a){r=e,f=t,p=a},this.mouseHoverPublisher=function(r,o,n){if(r&&o&&n){var i=r.getView().calculateExtent(r.getSize()),l=r.getCoordinateFromPixel(o);if(ol.extent.containsCoordinate(i,l)){if(!t||!e)return t=new Date,void(e=o);var s=new Date-t;if(e[0]==o[0]&&e[1]==o[1]){if(s<=2e3)return;if(a&&a[0]==o[0]&&a[1]==o[1])return;v.mouseHoverHandle(r,o,n),a=o}else t=new Date;e=o}}},this.mouseHoverHandle=function(e,t,a){var r={coordinate:e.getCoordinateFromPixel(t)};y.keys.filter(function(t){return!!t&&t.indexOf(e.getTarget())===t.length-e.getTarget().length}).forEach(function(t){var p=y.get(t);if(p&&p instanceof ol.layer.Layer){var f=p;f.hasOwnProperty("mouseoverCallback")&&"function"==typeof f.mouseoverCallback&&(f.get("businessType")===m.BUSINESSTYPE.GRID?o(e,f,r,void 0,function(e){void 0!=e&&u(a,f,r,e)}):"DCELL"===f.get("businessType")?n(e,f,r,void 0,function(e){if(e&&e.length>0){if(e=e[0],void 0==e)return;u(a,f,r,e)}}):"DPOINT"===f.get("businessType")||"SITE"===f.get("businessType")?i(e,f,r,void 0,function(e){if(e&&e.length>0){if(e=e[0],void 0==e)return;u(a,f,r,e)}}):"DLINE"===f.get("businessType")?l(e,f,r,void 0,function(e){e=e[0],void 0!=e&&u(a,f,r,e)}):"DPOLYGON"===f.get("businessType")?s(e,f,r,void 0,function(e){e=e[0],void 0!=e&&u(a,f,r,e)}):f.get("businessType")===m.BUSINESSTYPE.SERVICEPOINT?c(e,f,r,void 0,function(e){e=e[0],void 0!=e&&u(a,f,r,e)}):f.get("businessType")===m.BUSINESSTYPE.SERVICELINE?g(e,f,r,void 0,function(e){e=e[0],void 0!=e&&u(a,f,r,e)}):f.get("businessType")===m.BUSINESSTYPE.SERVICEPOLYGON&&d(e,f,r,void 0,function(e){e=e[0],void 0!=e&&u(a,f,r,e)}))}})}}function o(e,t,a,r,o){var n=e.getView().calculateExtent(e.getSize()),i=t.get("paramObj"),l={geometry:{x:a.coordinate[0],y:a.coordinate[1]},tolerance:void 0!=i&&void 0!=i.tolerance?i.tolerance:1,mapExtent:n,imgToken:t.get("imgToken")};f.postJSON({url:m.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(l),success:function(a){var n=JSON.parse(a),i=n.status,l=n.data&&n.data.length>0&&n.data[0];1===i.code?l&&o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),lonLat:l.originalCenterPoint,geometry:l.geometry,geoId:l.id,data:l,key:r}):o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")})},failure:function(a){o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")})}})}function n(e,t,a,r,o){if(!t.getVisible())return void o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}]);var n,i,l,s;if(a.coordinate){l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),i=t.get("imgToken"),s=void 0!=i?i.slice(0,i.indexOf(":")):void 0;var d=t.get("paramObj"),c={geometry:l,tolerance:void 0!=d&&void 0!=d.tolerance?d.tolerance:.1,mapExtent:n,imgToken:i,FCName:s}}f.get({url:m.GisRootUrl+"/common/mapRender/identify",data:v.getParameterString(c),success:function(a){if(!a)return void o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}]);var n=v.sortBy(a.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),i=n[0].extentInfo.radius;n=n.filter(function(e){return e.extentInfo.radius===i}),n.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var l=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r}});o(l)},failure:function(a){o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}])}})}function i(e,t,a,r,o){if(!t.getVisible())return void o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")});var n,i,l,s,d;i=t.get("imgToken"),s=t.get("dw"),d=void 0!=s?m.GisRootUrl+"/mapRender/identify":m.GisRootUrl+"/common/mapRender/identify",l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(",");var c=void 0!=i?i.slice(0,i.indexOf(":")):void 0,g=t.get("paramObj"),u={geometry:l,tolerance:void 0!=g&&void 0!=g.tolerance?g.tolerance:10,mapExtent:n,imgToken:i,FCName:c};f.get({url:d,data:v.getParameterString(u),success:function(a){if(!a)return void o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")});if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")});var n=a.data,i=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,geoId:a.id,geoName:a.name,key:r}});o(i)},failure:function(a){o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")})}})}function l(e,t,a,r,o){if(!t.getVisible())return void o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")});var n,i,l,s;i=t.get("imgToken"),l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),s=void 0!=i?i.slice(0,i.indexOf(":")):void 0;var d=t.get("paramObj"),c={geometry:l,tolerance:void 0!=d&&void 0!=d.tolerance?d.tolerance:1,mapExtent:n,imgToken:i,FCName:s};f.get({url:m.GisRootUrl+"/common/mapRender/identify",data:v.getParameterString(c),success:function(a){if(!a)return void o([]);if(a=JSON.parse(a),!a||!a.data||!a.data.length)return void o([]);var n=a.data,i=n.map(function(a){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,geoId:a.id,geoName:a.name,key:r}});o(i)},failure:function(a){o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")})}})}function s(e,t,a,r,o){if(!t.getVisible())return void o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")});var n=e.getView().calculateExtent(e.getSize()),i=t.get("imgToken"),l=void 0!=i?i.slice(0,i.indexOf(":")):void 0,s=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=s&&void 0!=s.tolerance?s.tolerance:.1,mapExtent:n,imgToken:i,FCName:l};f.get({url:m.GisRootUrl+"/common/mapRender/identify",data:v.getParameterString(d),success:function(a){if(a){var n=JSON.parse(a),i=n.status;if(1===i.code&&n.data&&n.data.length>0){var l=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(l)}}},failure:function(a){o({mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")})}})}function d(e,t,a,r,o){if(!t.getVisible())return void o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}]);var n=e.getView().calculateExtent(e.getSize()),i=t.get("imgToken"),l=void 0!=i?i.slice(0,i.indexOf(":")):void 0,s=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=s&&void 0!=s.tolerance?s.tolerance:.1,mapExtent:n,imgToken:i,FCName:l};f.get({url:m.GisRootUrl+"/mapRender/identify",data:v.getParameterString(d),success:function(a){if(a){var n=JSON.parse(a),i=n.status;if(1===i.code&&n.data&&n.data.length>0){var l=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(l)}}},failure:function(a){o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}])}})}function c(e,t,a,r,o){if(!t.getVisible())return void o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}]);var n=e.getView().calculateExtent(e.getSize()),i=t.get("imgToken"),l=void 0!=i?i.slice(0,i.indexOf(":")):void 0,s=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=s&&void 0!=s.tolerance?s.tolerance:2,mapExtent:n,imgToken:i,FCName:l};f.get({url:m.GisRootUrl+"/mapRender/identify",data:v.getParameterString(d),success:function(a){if(a){var n=JSON.parse(a),i=n.status;if(1===i.code&&n.data&&n.data.length>0){var l=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(l)}}},failure:function(a){o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}])}})}function g(e,t,a,r,o){if(!t.getVisible())return void o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}]);var n=e.getView().calculateExtent(e.getSize()),i=t.get("imgToken"),l=void 0!=i?i.slice(0,i.indexOf(":")):void 0,s=t.get("paramObj"),d={geometry:JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),tolerance:void 0!=s&&void 0!=s.tolerance?s.tolerance:10,mapExtent:n,imgToken:i,FCName:l};f.get({url:m.GisRootUrl+"/mapRender/identify",data:v.getParameterString(d),success:function(a){if(a){var n=JSON.parse(a),i=n.status;if(1===i.code&&n.data&&n.data.length>0){var l=n.data.map(function(a){var o={mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.centerPoint,geometry:a.geometry,extentInfo:a.extentInfo,geoId:a.id,geoName:a.name,key:r};return o});o&&"function"==typeof o&&o(l)}}},failure:function(a){o([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType")}])}})}function u(e,t,a,r){t.mouseoverCallback({e:a,layer:t,featureCenter:r.lonLat,data:r.data,geoId:r.geoId,lonLat:r.lonLat,points:h(void 0,{layerType:t&&t.get("businessType"),geometry:r.geometry}),businessType:t&&t.get("businessType"),layerType:t&&t.get("businessType"),mapId:e,target:e,layerId:!!t&&t.get("layer_id"),featureId:r.geoId})}var y=a(4),p=a(16),m=a(7),f=a(14),v=a(1),h=p.transformLonLat,I=function(e){var t=!1;return y.keys.filter(function(t){return!!t&&t.indexOf(e.getTarget())===t.length-e.getTarget().length}).forEach(function(e){var a=y.get(e);if(a&&a instanceof ol.layer.Layer){var r=a;if(r.hasOwnProperty("mouseoverCallback")&&"function"==typeof r.mouseoverCallback){var o=r.get("businessType");o!==m.BUSINESSTYPE.GRID&&o!==m.BUSINESSTYPE.DCELL&&o!==m.BUSINESSTYPE.DPOINT&&o!==m.BUSINESSTYPE.SITE&&o!==m.BUSINESSTYPE.DLINE&&o!==m.BUSINESSTYPE.DPOLYGON&&o!==m.BUSINESSTYPE.SERVICEPOINT&&o!==m.BUSINESSTYPE.SERVICELINE&&o!==m.BUSINESSTYPE.SERVICEPOLYGON||(t=!0)}}}),t};e.exports={mouseHoverHeartBeat:r,isServiceLayer:I}},function(e,t,a){var r=a(3),o=a(10),n=a(41),i=a(7),l=a(4),s=a(1),d=a(6),c="vGisWeb_legend_box",g=new Map;g.set("refreshLayerManager_key",[]);var u=function(e){var t=e.mapId,a=l.get(t).getTargetElement(),r="vGisWeb_legend_switch_"+t,n=c+"_"+t,i=a.querySelector("#"+n),s=document.querySelector("#"+r);s||(s=o.createDom({tagName:"div",attributes:{"class":"vGisWeb_legend_switch",id:r,title:fusiongis.I18n.prop("toolbar.legendSwitch")}}),a.appendChild(s)),i||(i=o.createDom({tagName:"div",attributes:{"class":c,id:n}}),a.appendChild(i)),s.onclick=function(){if(i=a.querySelector("#"+n),i&&i.style){var e=i.style.display;"block"===e?i.style.display="":e||(i.style.display="block")}}},y=function(e){var t=e.mapId,a=e.layerId,y=e.legendInfo,m=e.businessType,f=e.label,v=e.titleImgPath||i.GisResourceURL+"legend/",h=e.legendImgPath||i.GisResourceURL+"marker/",I=y&&y.byPercent,S=e.imgToken||void 0,b=function(){return s.htmlDecode(y&&y.legendName)}(),L=y&&y.legendType,T=y&&y.legendList,w=y&&y.renderStyle,E="business_"+L,C="business_"+a,k="oneLine",x=k+"_"+t,P=l.get(t).get("paramObj").legendSetting,_=!!l.get(t)&&l.get(t).getTargetElement();if(_){!function(){var e=n.getLayer({mapId:t,layerId:a}),o=f+"("+b+")";if(e)if(e.set("mineLayerName",o),e.set("mineLayerImgToken",S),e.set("mineLegendID",C),e.set("mineLegendName",s.htmlDecode(e.get("legendName"))),g.get("refreshLayerManager_key").length<10){var i=new r.layer.Vector;d.getMapObj(t).addLayer(i),g.get("refreshLayerManager_key").push(i)}else{var l=g.get("refreshLayerManager_key");l&&l.length>0&&l.forEach(function(e,a){d.getMapObj(t).removeLayer(e),g.get("refreshLayerManager_key").splice(a,1)})}}();var O=_.querySelector("#"+c+"_"+t);O||(u(e),O=_.querySelector("#"+c+"_"+t));var M=o.createDom({tagName:"div",attributes:{"class":E+" "+C}});_.querySelector("."+C)&&O.removeChild(_.querySelector("."+C)),O.appendChild(M),y&&T&&T.length>0&&(M.appendChild(function(){var e=o.createDom({tagName:"div",attributes:{"class":"legendTitle"}});return e.appendChild(function(){var e=o.createDom({tagName:"div",attributes:{"class":"legendTitleLeft"}});return e.style.background="url("+v+m.toLowerCase()+".png)",e.style.backgroundPosition="3px 7px",e.style.backgroundRepeat="no-repeat",e}()),e.appendChild(function(){return o.createDom({tagName:"div",attributes:{"class":"legendTitleRight",title:b},text:b.length>20?b.substring(0,20)+"...":b})}()),P&&e.appendChild(function(){return o.createDom({tagName:"input",attributes:{type:"button","class":"setting-button",value:"设置图例",title:"设置图例"},text:b.length>20?b.substring(0,20)+"...":b})}()),e}()),T.forEach(function(e){var t=e.value,a=e.label,r=e.style,n=e.fillColor,i=e.borderColor,l=(e.borderWidth,e.percent),d=e.count,c=e.range,g=e.containsMin,u=e.containsMax,y=o.createDom({tagName:"div",attributes:{"class":k,id:x}});M.appendChild(y),P&&y.appendChild(function(){var e=o.createDom({tagName:"div",attributes:{value:t+"","class":"isCheckBox",checkDiv:"checkDiv",style:"vertical-align: middle;margin-right: 5px;float: left;"}});return o.on(e,"click",addCheckDivEvent),e}()),y.appendChild(function(){if(r.indexOf(",")!==-1){if("singleColor"===L||"rangeColor"===L){if("Border"===w){var e=i?i:r;return 3==e.split(",").length?r="rgb("+e+")":4==e.split(",").length&&(r="rgba("+e+")"),o.createDom({tagName:"div",attributes:{style:"border: 1px solid "+r}})}if("Fill"===w){var e=n?n:r;return 3==e.split(",").length?r="rgb("+e+")":4==e.split(",").length&&(r="rgba("+e+")"),o.createDom({tagName:"div",attributes:{style:"background: "+r}})}}}else if("singleSymbol"===L||"rangeSymbol"===L){var t=r;return o.createDom({tagName:"div",attributes:{style:'background-image: url("'+h+t+'.png");background-size: 18px; background-repeat: no-repeat; background-position: 0px 2px;'}})}}()),y.appendChild(function(){var e="",r="";e=g===!0?"[":"(",r=u===!0?"]":")";var n=function(){return"singleColor"===L?[e,t,r," ",a].join(""):"rangeColor"===L?I?c?[e+t[0]+"%,"+t[1]+"%"+r," ",e,c,r," ",a].join(""):[e+t[0]+"%,"+t[1]+"%"+r," ",a].join(""):(t[0]||(t[0]="-&#8734;"),t[1]||(t[1]="+&#8734;"),l?[e,t,r," (",d,",",l,"%)"," ",a].join(""):[e,t,r," ",a].join("")):"singleSymbol"===L?[e,t,r," ",a].join(""):"rangeSymbol"===L?(t[0]||(t[0]="-&#8734;"),t[1]||(t[1]="+&#8734;"),l?[e,t,r," (",l,"%)"," ",a].join(""):[e,t,r," ",a].join("")):void 0}();return o.createDom({tagName:"div",attributes:{title:s.htmlDecode(n)},text:n})}())})),P&&setTimeout(function(){addLegendEventLisener(),p("."+C+" .legendTitle",C)},0)}},p=function(e,t){$(e).find("input").off("click"),$(e).find("input").on("click",function(){var a=$(e).parent(),r=a&&a.parent()[0],o=a.attr("class").substring(a.attr("class").indexOf(" ")+1),i=r&&r.id&&r.id.replace(c+"_",""),l=t.replace("business_",""),d=n.getLayer({mapId:i,layerId:l});if(requestParam=d&&d.get("paramObj"),d&&requestParam){businessType=d&&d.get("businessType");var g=requestParam.legendInfo||d.get("legendInfo"),u=g&&g.legendType,y=g&&g.renderStyle,p=i+"_"+l+"_"+u+"_legengSettingBox",m=dataHandler.businessTypeMapping(businessType)+"_"+u+"_"+y;!serviceLegendInfo[m]&&requestParam&&requestParam.legendInfo&&(serviceLegendInfo[m]=g),requestParam.legendInfo=serviceLegendInfo[m],d.set("legendInfo",serviceLegendInfo[m]);var f=document.querySelectorAll(".removeAllSettingPanel")[0];f&&f.parentNode.removeChild(f);var v=domHandler.createSettingPanel(requestParam||{},p),h=parseInt(v.style.width),I=parseInt(v.style.height),S=parseInt(document.body.offsetWidth),b=parseInt(document.body.offsetHeight),L=(S-h)/2,T=(b-I)/2;v.style.left=L+"px",v.style.top=T+"px",document.body.appendChild(v),setTimeout(function(){var e=$("#"+i+" ."+o+' input[type="checkbox"]'),t=serviceLegendInfo[m]&&serviceLegendInfo[m].legendList,a=(legendService.getLegendList(e,t,u,y),{legendTypeBoxId:p,mapId:i,layerId:l,legendType:u,legendList:t,legendInfo:serviceLegendInfo[m]});backFillDataService.backFillData(a),s.dragBox([p])},0)}})};e.exports={createLegend:y}},function(e,t,a){var r=a(3),o=a(7),n=a(5),i=a(41),l=function(e){var t=function(e){var t,a=[];return e.forEach(function(e){t=new r.Feature({geometry:new r.geom.MultiPoint(e.data).transform(o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)}),t.setStyle(new r.style.Style({image:new r.style.Circle({fill:new r.style.Fill({color:e.fillColor}),stroke:new r.style.Stroke({color:e.strokeColor,width:e.strokeWidth}),radius:e.radius})})),a.push(t)}),a},a=function(e){var t,a=[];return e.forEach(function(e){t=new r.Feature({geometry:new r.geom.MultiLineString(e.data).transform(o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)}),t.setStyle(new r.style.Style({stroke:new r.style.Stroke({color:e.strokeColor,width:e.strokeWidth})})),a.push(t)}),a},l=function(e){var t,a=[];return e.forEach(function(e){t=new r.Feature({geometry:new r.geom.MultiPolygon([e.data]).transform(o.PROJ.EPSG_4326,o.PROJ.EPSG_3857)}),t.setStyle(new r.style.Style({stroke:new r.style.Stroke({color:e.strokeColor,width:e.strokeWidth}),fill:new r.style.Fill({color:e.fillColor})})),a.push(t)}),a},s=i.getLayer({layerId:e.layerId,mapId:e.mapId});switch(s||(n.createLayer({layerId:e.layerId,mapId:e.mapId}),s=i.getLayer({layerId:e.layerId,mapId:e.mapId})),e.layerType){case o.LAYERTYPE.POINT:s.getSource().addFeatures(t(e.layerData));break;case o.LAYERTYPE.LINE:s.getSource().addFeatures(a(e.layerData));break;case o.LAYERTYPE.POLYGON:s.getSource().addFeatures(l(e.layerData));break;default:return}};e.exports={setVectorLayerData:l}},function(e,t,a){var r=a(3),o=(a(6),a(4)),n=a(7),i=a(5),l=a(1),s=function(e){var t=e.layerId+"_"+e.mapId,a=null;o.containsKey(t)?a=o.get(t):(i.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType",n.BUSINESSTYPE.ADMIN_REGION),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),d(e)},d=function(e){var t=[],a=e.datas;if(l.isValid(a)||a.length>0){a.forEach(function(e){var a=e.coordinates,o=new r.geom.Polygon([a]),i=r.extent.getCenter(o.getExtent()),l=new r.Feature({geometry:o.transform("EPSG:4326","EPSG:3857"),labelPoint:r.proj.fromLonLat(i),businessType:n.BUSINESSTYPE.ADMIN_REGION,data:e});l.setId(e.id);var s=new r.style.Style({fill:new r.style.Fill({color:e.fillColor||null}),stroke:new r.style.Stroke({color:e.strokeColor||null,width:e.strokeWidth||1}),text:new r.style.Text({text:e.label?e.label:"",fill:new r.style.Fill({color:e.labelFillColor||"black"}),font:"normal 14px Arial",stroke:new r.style.Stroke({color:"#ffffff",width:3})})});l.setStyle(s),t.push(l)});var i=o.get(e.layerId+"_"+e.mapId);void 0!=i&&i.getSource().addFeatures(t)}};e.exports={addFeature:s,setLayerData:d}},function(e,t,a){var r=a(3),o=a(4),n=a(5),i=a(1),l=a(7),s=function(e){var t=e.layerId+"_"+e.mapId,a=null;o.containsKey(t)?a=o.get(t):(n.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType",l.BUSINESSTYPE.BUBBLE_CIRCLE),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel));var r=a.getSource();e.source=r,d(e)},d=function(e){var t=e.datas,a=e.layerId+"_"+e.mapId,n=o.get(a),s=n.getSource();if(i.isValid(t)||t.length>0){var d=[];t.forEach(function(e){var t=r.proj.fromLonLat(e.coordinate),a=1e3,o=e.radius?e.radius*a:1e4,n=new r.Feature({geometry:new r.geom.Circle(t,o),data:e,businessType:l.BUSINESSTYPE.BUBBLE_CIRCLE});n.setId(e.id);var i=new r.style.Style({fill:new r.style.Fill({color:e.fillColor||"#319FD3"}),stroke:new r.style.Stroke({color:e.strokeColor||"#ff0",width:e.strokeWidth||1})});n.setStyle(i),d.push(n)}),s.addFeatures(d)}};e.exports={addBubble:s,setLayerData:d}},function(e,t,a){var r=a(3),o=a(4),n=a(5),i=a(1),l=a(7),s=function(e){var t=e.layerId+"_"+e.mapId,a=null;o.containsKey(t)?a=o.get(t):(n.createLayer(e),a=o.get(t)),e.multiple&&a.set("multiple",e.multiple),a.set("businessType",l.BUSINESSTYPE.BUBBLE),a.setZIndex(l.Z_INDEX.SITE),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel));var r=a.getSource();e.source=r,d(e)},d=function(e){var t=[],a=e.datas;(i.isValid(a)||a.length>0)&&(a.forEach(function(e,a,o){var n=r.proj.fromLonLat(e.coordinate),i=new r.Feature({geometry:new r.geom.Point(n),data:e,businessType:l.BUSINESSTYPE.BUBBLE});i.setId(e.id),i.set("id",e.id);var s=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor||"red"}),stroke:new r.style.Stroke({color:e.strokeColor||"#319FD3",width:e.strokeWidth||1})})});i.setStyle(s),i.set("defaultStyle",s),t.push(i)}),e.source.addFeatures(t))};e.exports={addBubble:s,setLayerData:d,clear:function(e){o.get(e.layerId+"_"+e.mapId)&&o.get(e.layerId+"_"+e.mapId).getSource()&&o.get(e.layerId+"_"+e.mapId).getSource().clear()}}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId;if(n.containsKey(t)){var a=n.get(t);a.getSource().clear()}}var o=a(3),n=a(4),i=a(5),l=(a(1),a(7),function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(i.createLayer(e),a=n.get(t)),e.multiple&&a.set("multiple",e.multiple),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel));var r=a.getSource();e.source=r,s(e)}),s=function(e){var t=[],a=e.datas;if(a&&a.length>0){for(var r=0;r<a.length;r++)for(var n=o.proj.fromLonLat(a[r].coordinate),i=a[r].radius,l=0;l<i.length;l++){var s=new o.geom.Circle(n,i[l]),d=new o.style.Style({fill:new o.style.Fill({color:a[r].fillColor[l]||"red"}),stroke:new o.style.Stroke({color:a[r].strokeColor[l]||"#319FD3",width:a[r].strokeWidth[l]||1})}),c=new o.Feature({geometry:s,data:a[r],type:"gradientCircle"});c.setStyle(d),0===l?c.setId(a[r].id):c.setId(a[r].id+"_"+l),t.push(c)}e.source.addFeatures(t)}};e.exports={addGradientCircle:l,removeGradientCircle:r}},function(e,t,a){function r(e){var t=n.get(e.mapId),a=null,r=e.data;for(var d in r)if("bar"===d)r[d].forEach(function(e){var r=e.position;e.isLonLat&&(r=o.proj.fromLonLat(e.position));var n=l.addColumnChart(e);a=new o.Overlay({position:r,positioning:"center-center",element:n,stopEvent:!1}),t.addOverlay(a)});else if("pie"===d)for(var c=0;c<r[d].length;c++){var g=r[d][c].position;r[d][c].isLonLat&&(g=o.proj.fromLonLat(r[d][c].position));var u=i.createPie(r[d][c]);a=new o.Overlay({position:g,positioning:"center-center",element:u,stopEvent:!1}),t.addOverlay(a)}else"line"===d&&r[d].forEach(function(e){var r=e.position;e.isLonLat&&(r=o.proj.fromLonLat(e.position));var n=s.createStroke(e);a=new o.Overlay({position:r,positioning:"center-center",element:n,stopEvent:!1}),t.addOverlay(a)})}var o=a(3),n=a(4),i=a(71),l=a(72),s=a(73);e.exports={addCharts:r}},function(e,t,a){var r=(a(3),function(e){var t=e.config,a=document.createElement("div"),r=e.outerRadius;a.style.width=3*r+200+"px",a.style.height=3*r+200+"px",a.style.borderRadius="10px";var n=echarts.init(a),i=o(e);return n.setOption(i),_.isFunction(t.eventFun)&&n.on(t.eventType||"click",t.eventFun),a}),o=function(e){var t=[],a="radius"==e.roseType?"半径模式":"面积模式",r=null,o=void 0!==e.innerRadius?e.innerRadius:0,n=void 0!==e.outerRadius?e.outerRadius:50;e.seriesData.length&&(t=e.seriesData.sort(function(e,t){return e.value-t.value}));var i=function(e){var t=[];return _.each(e,function(e){e.color?t.push(e.color):t.push("#c23531")}),t};r={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},color:i(t),calculable:!0,series:[{name:a,type:"pie",radius:[o,n],center:["50%","50%"],itemStyle:{normal:{borderColor:void 0!==e.borderColor?e.borderColor:"#000",borderWidth:void 0!==e.borderWidth?e.borderWidth:"0",borderType:void 0!==e.borderType?e.borderType:"solid",
shadowColor:void 0!==e.shadowColor?e.shadowColor:"rgba(0, 0, 0, 0.5)",shadowOffsetX:"0",shadowOffsetY:"0",shadowBlur:void 0!==e.shadowBlur?e.shadowBlur:100,opacity:void 0!==e.opacity?e.opacity:1}},animationType:"scale",animationEasing:"elasticOut",data:t}]};var l={normal:{show:void 0!==e.isShowLabel&&e.isShowLabel,position:"outside",textStyle:{color:void 0!==e.labelColor?e.labelColor:"rgba(0, 0, 0, 1)",fontStyle:void 0!==e.fontStyle?e.fontStyle:"normal",fontWeight:void 0!==e.fontWeight?e.fontWeight:"normal",fontFamily:void 0!==e.fontFamily?e.fontFamily:"sans-serif",fontSize:void 0!==e.fontSize?e.fontSize:12},formatter:"{b}: {d}"},emphasis:{show:void 0===e.isShowLabelEmphasis||e.isShowLabelEmphasis,textStyle:{color:void 0!==e.emphasisColor?e.emphasisColor:"rgba(0, 0, 0, 1)",fontStyle:void 0!==e.emphasisfontStyle?e.emphasisfontStyle:"normal",fontWeight:void 0!==e.emphasisfontWeight?e.emphasisfontWeight:"normal",fontFamily:void 0!==e.emphasisfontFamily?e.emphasisfontFamily:"sans-serif",fontSize:void 0!==e.emphasisfontSize?e.emphasisfontSize:12}}},s={normal:{show:!!e.isShowlableLine&&e.isShowlableLine,length:10,length2:20,smooth:.2,lineStyle:{color:e.lineColor?e.lineColor:"rgba(255, 255, 255, 0.3)",width:e.strokeWidth?e.strokeWidth:1,type:e.lineType?e.lineType:"solid"}},emphasis:{show:!e.isShowLabelLineEmphasis||e.isShowLabelLineEmphasis}};return"rose_pie"===e.trueType?(e.roseType&&(r.series[0].roseType=e.roseType),"radius"===e.roseType&&(r.series[0].label=l,r.series[0].lableLine=s)):"ring_pie"===e.trueType?(r.series[0].label=l,r.series[0].lableLine=s,r.series[0].label.normal.position="center",r.series[0].avoidLabelOverlap=!1):"circle_pie"===e.trueType,r};e.exports={createPie:r}},function(e,t,a){var r=(a(3),a(4),function(e){var t=null,a=null,r=null,o=function(e){r=document.createElement("div"),r.style.width=e.width,r.style.height=e.height,r.style.borderRadius="10px";var o=e.config;return t=echarts.init(r),a={backgroundColor:o.backgroundColor||"rgba(255, 255, 255, 0.7)",calculable:o.isCalculable||!1,color:o.color||["#369858","#569814"],chartType:"bar",tooltip:{show:o.isShowTooltip||!1,trigger:"axis",axisPointer:{type:o.axisPointer||"shadow"}},grid:[{width:o.chartWidth||"80%",height:o.chartHeight||"80%",left:o.gridLeft||"3%",right:o.gridRight||"4%",bottom:o.gridBottom||"3%",top:o.gridTop||"2%",containLabel:o.isContainLabel||!0}],xAxis:[{type:"category",rotate:-45,data:e.xAxisData}],yAxis:[{type:"value"}],series:_.map(e.Data,function(e){return{name:e.name||"",itemStyle:{normal:{color:e.color||"#379CF8"}},type:e.type||"bar",data:e.data,barWidth:o.barWidth||null,label:{normal:{show:o.isShowLabel||!1,position:"top",formatter:function(){return this.y}},emphasis:{position:"top",formatter:function(){return this.y},textStyle:{color:o.labelColor||"#333"}}}}})},t.setOption(a),_.isFunction(o.eventFun)&&t.on(o.eventType||"click",o.eventFun),r};return o(e)});e.exports={addColumnChart:r}},function(e,t,a){var r=(a(3),a(4),function(e){createDiv=document.createElement("div");var t=e.config;return createDiv.style.width=e.width,createDiv.style.height=e.height,createDiv.style.borderRadius="10px",chartObj=echarts.init(createDiv),chartOption={backgroundColor:t.backgroundColor||"rgba(255, 255, 255, 0.7)",calculable:!0,tooltip:{show:t.isShowTooltip||!1,trigger:"axis",axisPointer:{type:t.axisPointer||"shadow"}},grid:[{width:t.chartWidth||"80%",height:t.chartHeight||"80%",left:t.gridLeft||"3%",right:t.gridRight||"4%",bottom:t.gridBottom||"3%",top:t.gridTop||"2%",containLabel:t.isContainLabel||!0}],xAxis:[{type:"category",data:e.xAxisData}],yAxis:[{type:"value"}],series:_.map(e.Data,function(e){return{name:e.name||"",itemStyle:{normal:{color:e.color||"#379CF8"}},type:e.type||"line",symbol:e.symbol||"emptyCircle",symbolSize:e.symbolSize||4,data:e.data,label:{normal:{show:t.isShowLabel||!1,position:"top",formatter:function(){return this.y}},emphasis:{position:"top",formatter:function(){return this.y},textStyle:{color:t.labelColor||"#333"}}}}}),color:e.color},chartObj.setOption(chartOption),_.isFunction(t.eventFun)&&chartObj.on(t.eventType||"click",t.eventFun),createDiv});e.exports={createStroke:r}},function(e,t){function a(e,t){var a,o,n,i,l,s,d,c,g=new r;return n=3*(e[1].x-e[0].x),o=3*(e[2].x-e[1].x)-n,a=e[3].x-e[0].x-n-o,s=3*(e[1].y-e[0].y),l=3*(e[2].y-e[1].y)-s,i=e[3].y-e[0].y-s-l,d=t*t,c=d*t,g.x=a*c+o*d+n*t+e[0].x,g.y=i*c+l*d+s*t+e[0].y,g}function r(e,t){this.x=e||0,this.y=t||0}function o(e,t,r){var o,n;for(o=1/(t-1),n=0;n<t;n++)r[n]=a(e,n*o)}var n=function(e,t){var a=e.coordinates.length;if(2===a){var n=[],i=e.coordinates[0],l=e.coordinates[1],s=e.radius[0],d=e.radius[1],c=e.azimuth[0],g=e.azimuth[1],u=ol.proj.fromLonLat(i),y=ol.proj.fromLonLat(l),p=Math.PI/2-c/180*Math.PI,m=Math.PI/2-g/180*Math.PI,f=u[0]+s*Math.cos(p),v=u[1]+s*Math.sin(p),h=y[0]+d*Math.cos(m),I=y[1]+d*Math.sin(m),S=ol.proj.fromLonLat(i),b=ol.proj.fromLonLat(l),L=[f,v],T=[h,I],w=[new r(S[0],S[1]),new r(L[0],L[1]),new r(T[0],T[1]),new r(b[0],b[1])],E=e.numberOfPoints,C=[];if(o(w,E,C),C.length>0)for(var k=0;k<C.length;k++)n.push(ol.proj.toLonLat([C[k].x,C[k].y]));var x={mapId:e.mapId,layerId:e.layerId,isBezier:e.isBezier,lineGeoId:e.lineGeoId,fillColor:e.fillColor?e.fillColor:"##208089",strokeColor:e.strokeColor?e.strokeColor:"##208089",strokeWidth:e.strokeWidth?e.strokeWidth:3,coordinates:n};fusiongis.LineStraight.addLine(x,t)}};e.exports={addCurve:n}},function(e,t,a){var r=a(3),o=a(4),n=a(7),i=(a(1),function(e){var t=e.mapId,a=e.layerId,n=a+"_"+t,i=o.get(t),l=null;return o.get(n)?l=o.get(n):(l=new r.layer.Image({opacity:e.opacity||.7}),l.set("layerId",a),l.set("mapId",t),i.addLayer(l),o.put(n,l)),e.multiple&&l.set("multiple",e.multiple),void 0!=e.minShowLevel&&l.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&l.set("maxShowLevel",parseInt(e.maxShowLevel)),l}),l=function(e,t){var a=e.mapId,i=e.layerId,l=i+"_"+a,s=o.get(l),d=!!o.get(a)&&o.get(a).getSize(),c=null;if(t)c=new r.source.ImageStatic({url:e.imgUrl,projection:e.projection||n.PROJ.EPSG_4326,imageExtent:e.imageExtent});else{var g=n.GisRootUrl;g+="vector"===e.previewType?"/temporalmap/vector/getImage":"/temporalmap/grid/getImage",c=new r.source.ImageWMS({params:{parentTaskId:e.parentTaskId,subTaskId:e.subTaskId,VERSION:"1.1.1",WIDTH:d[0],HEIGHT:d[1]},extent:!!o.get(a)&&o.get(a).getExtent(a)||[-180,-85,180,85],url:g,wrapX:!1})}!!s&&s.setSource(c)};e.exports={createLayer:i,setLayerData:l}},function(e,t,a){function r(e,t,a){for(var r=(a[2]-a[0])/e,n=(-a[3]+a[1])/t,i=r/2,l=n/2,s=0;s<e;s++)for(var g=0;g<t;g++){var m=a[0]+r*s,f=a[3]+n*g,v=0;u.forEach(function(e){var t=o.proj.fromLonLat(e);t[0]>=m-i&&t[0]<m+i&&t[1]<=f-l&&t[1]>f+l&&(v+=1)});var h=d*s,I=c*g;y(h,I,v),p(h,I,v)}}var o=a(3),n=a(6),i=a(4),l=a(7),s=a(1),d=50,c=50,g=null,u=[],y=function(e,t,a){g.lineWidth=1,a>0?g.strokeStyle="rgba(0,0,255,0.8)":g.strokeStyle="rgba(0,0,255,0.1)",g.strokeRect(e-d/2,t-c/2,d,c)},p=function(e,t,a){a>0&&(g.textAlign="center",g.textBaseline="middle",g.font="15px Arial",g.fillStyle="white",g.fillText(a,e,t))},m=function(e,t,a,o,n){this.canvas||(this.canvas=document.createElement("canvas"));var i=o[0],l=o[1];this.canvas.setAttribute("width",i),this.canvas.setAttribute("height",l),g=this.canvas.getContext("2d");var s=i/d,u=l/c;return r(s,u,e),this.canvas},f=function(e){var t=e.mapId,a=e.layerId+"_"+t;u=e.datas;var r=n.getMapObj(t);if(!s.isValid(i.get(a))){var d=new o.layer.Image({source:new o.source.ImageCanvas({canvasFunction:m,projection:r.get("paramObj").proj})});d.set("type",l.CUSTOMTYPE.LAYERIMGTYPE),d.set("isVectorType",!1),d.set("map",r),d.set("layerId",a),d.set("layer_id",e.layerId),void 0!=e.minShowLevel&&d.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&d.set("maxShowLevel",parseInt(e.maxShowLevel)),r.addLayer(d),i.put(a,d)}};e.exports={addGridDensity:f}},function(e,t,a){var r=a(3),o=a(6),n=(a(8),a(4)),i=a(7),l=a(41),s=a(1),d=function(e){var t=e.mapId,a=e.layerId+"_"+t,l=o.getMapObj(t),d=e.label?e.label:e.layerId,c=(l.getView().getZoom(),e.gradient?e.gradient:["#FF3030","#FF4500","#FF7F50","#FF8C00","#FFA54F","#FFB90F","#436EEE","#5CACEE","#54FF9F"]);if(c.reverse(),!s.isValid(n.get(a))){var g=e.radius?e.radius:8,u=e.blur?e.blur:15,y=10*(g+u),p=new r.layer.Heatmap({gradient:c,radius:e.radius?e.radius:30,blur:e.blur?e.blur:50,shadow:y,source:new r.source.Vector({wrapX:!1})});p.set("type",i.CUSTOMTYPE.LAYERHEATTYPE),p.set("map",l),p.set("layerId",a),p.set("businessType",i.BUSINESSTYPE.HEAT_MAP),p.set("params.label",d),p.set("layer_id",e.layerId),e.multiple&&p.set("multiple",e.multiple),void 0!=e.minShowLevel&&p.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&p.set("maxShowLevel",parseInt(e.maxShowLevel)),l.addLayer(p),n.put(a,p)}return p},c=function(e){var t=d(e),a=[],o=[],n=0;e.datas.forEach(function(e){o.push(e.weight)}),s.sortDesc(o),n=o[0],e.datas.forEach(function(e){var t=new r.geom.Point(r.proj.fromLonLat(e.coordinate)),o=new r.Feature({geometry:t,data:e,weight:e.weight/n});o.setId(e.id),a.push(o)}),t.getSource().addFeatures(a)},g=function(e){var t=l.getLayer(e),a=[],o=[],n=0;e.datas.forEach(function(e){o.push(e.weight)}),s.sortDesc(o),n=o[0],e.datas.forEach(function(e){var t=new r.geom.Point(r.proj.fromLonLat(e.coordinate)),o=new r.Feature({geometry:t,data:e,weight:e.weight/n});o.setId(e.id),a.push(o)}),t.getSource().addFeatures(a)};e.exports={addHeatMap:c,addLayer:d,setLayerData:g}},function(e,t,a){var r=a(3),o=a(8),n=a(7),i=a(4),l=a(5),s=(a(1),a(41)),d=n.GisResourceURL+"marker/",c=function(e){var t=e.layerId+"_"+e.mapId,a=void 0!=e.label?e.label:e.layerId,r=null;i.containsKey(t)?r=i.get(t):(l.createLayer(e),r=i.get(t)),e.multiple&&r.set("multiple",e.multiple),void 0!=e.minShowLevel&&r.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&r.set("maxShowLevel",parseInt(e.maxShowLevel)),r.set("type","ICON"),r.set("layerId",t),r.set("layer_id",e.layerId),r.set("businessType","ICON"),r.set("params.label",a),r.set("legendName",e.legendName),g(e)},g=function(e){var t=o.getMapObj(e.mapId),a=s.getLayer(e),i=[],l=e.datas;t.getView().calculateExtent(t.getSize());e.imgPath&&(d=e.imgPath),l&&(l.forEach(function(e){var t=null,o=e.coordinate,l=r.proj.fromLonLat(o),s=new r.geom.Point(l),c=new r.Feature({geometry:s,businessType:n.BUSINESSTYPE.ICON,data:e});t=e.imageName?d+e.imageName:n.GisResourceURL+"marker/ne_default.png";var g=0;g=e.rotation?e.rotation:0;var u=new r.style.Style({image:new r.style.Icon({src:t,rotation:g,opacity:e.opacity||1}),text:new r.style.Text({text:void 0!=e.label?e.label:"",fill:new r.style.Fill({color:void 0!=e.labelFillColor?e.labelFillColor:"black"})})});c.setId(e.id),c.setStyle(u),c.set("data",e),c.set("vectorType",n.BUSINESSTYPE.ICON),c.set("layer",a),i.push(c)}),a.getSource().addFeatures(i),a.set("legendName",e.legendName))};e.exports={addIcon:c,setLayerData:g}},function(e,t,a){var r=a(3),o=a(6),n=a(4),i=(a(7),a(5)),l=a(1),s=null,d=null,c=function(e){var t=e.layerId+"_"+e.mapId;d=o.getMapObj(e.mapId);var a=null;n.containsKey(t)?a=n.get(t):(i.createLayer(e),a=n.get(t)),e.multiple&&a.set("multiple",e.multiple),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),s=a.getSource()},g=function(e){var t=[],a=e.datas,o=d.getView();o.calculateExtent(d.getSize());(l.isValid(a)||a.length>0)&&(a.forEach(function(e){var a=e.coordinate,o=r.proj.fromLonLat(a),n=new r.geom.Point(o),i=new r.Feature({geometry:n}),l=e.id;i.setId(l);var s=i.clone(),d=l+"_shadow";s.setId(d);var c=i.clone(),g=l+"_relation_featureId";c.setId(g);var u=new r.style.Style({image:new r.style.Circle({radius:6,stroke:new r.style.Stroke({color:"#1E90FF",width:3}),fill:new r.style.Fill({color:"white"})}),text:new r.style.Text({text:e.pointLabel,font:"normal 14px Arial",offsetY:e.pointLabelY||20})});i.setStyle(u);var y=new r.style.Style({image:new r.style.Circle({radius:10,stroke:new r.style.Stroke({color:"#87CEEB",width:5}),fill:new r.style.Fill({color:"rgba(0,0,0,0)"})})});s.setStyle(y);var p=new r.style.Style({image:new r.style.Icon({src:e.imgUrl,opacity:.7,scale:e.scale||1,anchor:[.47,.7]}),text:new r.style.Text({text:e.iconLabel,font:"normal 14px Arial",offsetY:e.iconLabelY||25})});c.setStyle(p),t.push(i,s,c)}),s.addFeatures(t))};e.exports={addLayer:c,setLayerData:g}},function(e,t,a){function r(e){var t=u.getMapObj(e.mapId),a=y.getLayer({mapId:e.mapId,layerId:e.sourceLayerId});if(!a)throw new Error("source layer does not exist!");var r=o(e,t);y.addEffectLayer({mapId:e.mapId,layer:a,effectLayer:r}),n(e,t,r);var i=d(e,t);i.onDrag=function(e,t){var a=t,r=a.get("line"),o=r.getGeometry().getCoordinates()[0],n=a.getGeometry().getCoordinates(),i=s(o,n);r.getGeometry().setCoordinates(i)}}function o(e,t){var a="infoPop香"+e.sourceLayerId,r=p.getLayer({mapId:e.mapId,layerId:a});return r?r:(r=new g.layer.Vector({map:t,layerId:a,source:new g.source.Vector({warpX:!1})}),r.setZIndex(1999),t.addLayer(r),r)}function n(e,t,a){var r=[];e.data.forEach(function(a){var o=a.position?a.position:"left",n=a.distance?a.distance:150,s=g.proj.fromLonLat(a.lonLat),d=t.getPixelFromCoordinate(s),c=d.slice(0);switch(o){case"left":c[0]=c[0]-n;break;case"right":c[0]=c[0]+n;break;case"up":c[1]=c[1]+n;break;case"down":c[1]=c[1]-n}var u=t.getCoordinateFromPixel(c),y=i(e,a,u),p=l(e,a,s,u);y.set("line",p),r.push(y),r.push(p)}),a.getSource().addFeatures(r)}function i(e,t,a){var r=new g.Feature(new g.geom.Point(a)),o=t.fontSize?t.fontSize:"16px",n=t.fontFamily?t.fontFamily:"serif",i=o+" "+n,l=t.radius?t.radius:39;return l+=t.strokeWidth?t.strokeWidth:4,r.setStyle([new g.style.Style({image:new g.style.Circle({radius:l,fill:new g.style.Fill({color:t.fillColor||"#FF8870"})})}),new g.style.Style({image:new g.style.Circle({radius:t.radius||35,fill:new g.style.Fill({color:t.fillColor||"#FF8870"}),stroke:new g.style.Stroke({color:t.strokeColor||"#FFFFFF",width:t.strokeWidth||4})}),text:new g.style.Text({font:i,text:t.content,fill:new g.style.Fill({color:t.fontColor||"#000000"})})})]),r.set("data",t),r.set("sourceLayerId",e.sourceLayerId),r.set("type","infoPop_shape"),r.setId(t.id),r}function l(e,t,a,r){var o=s(a,r),n=new g.Feature(new g.geom.LineString(o));return n.setStyle(new g.style.Style({stroke:new g.style.Stroke({color:t.lineColor||"#0099ff",width:t.lineWidth||2})})),n.set("data",t),n.set("sourceLayerId",e.sourceLayerId),n.set("type","infoPop_line"),n.setId("line香"+t.id),n}function s(e,t){var a=[e,t];return e[0]!==t[1]&&e[1]!==t[1]&&a.splice(1,0,[e[0],t[1]]),a}function d(e,t){var a=p.getIntactByName(e.mapId,"infoPopDrag");return a?a:(a=new c,a.set("mapId",e.mapId),a.set("name","infoPopDrag"),t.addInteraction(a),a)}function c(){g.interaction.Pointer.call(this,{handleDownEvent:c.prototype.handleDownEvent,handleDragEvent:c.prototype.handleDragEvent,handleMoveEvent:c.prototype.handleMoveEvent,handleUpEvent:c.prototype.handleUpEvent}),this.coordinate_=null,this.cursor_="pointer",this.feature_=null,this.previousCursor_=void 0,this.onDrag=null}var g=a(3),u=a(6),y=a(41),p=a(16);g.inherits(c,g.interaction.Pointer),c.prototype.handleDownEvent=function(e){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){if("infoPop_shape"===e.get("type"))return e});return a&&(this.coordinate_=e.coordinate,this.feature_=a),!!a},c.prototype.handleDragEvent=function(e){var t=e.coordinate[0]-this.coordinate_[0],a=e.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(t,a),this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1],this.onDrag&&this.onDrag(e,this.feature_)},c.prototype.handleMoveEvent=function(e){if(this.cursor_){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){if("infoPop_shape"===e.get("type"))return e}),r=e.map.getTargetElement();a?r.style.cursor!==this.cursor_&&(this.previousCursor_=r.style.cursor,r.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}},c.prototype.handleUpEvent=function(){return this.coordinate_=null,this.feature_=null,!1},e.exports={addInfoPop:r}},function(e,t,a){function r(e){var t=e.filterType,a=e.mapId,r=e.layerId,o=e.rateR,n=e.rateG,i=e.rateB,l=e.isCustom,s=e.layerRenderEnd,d=m.getLayer({mapId:a,layer_id:r});if(d&&t){var c=d.get("imageFilter.handle");if(c&&d.unByKey(c),c=d.on("postcompose",function(e){h[t]&&h[t](e.context,o,n,i,l),s&&"function"==typeof s&&s(e.context)}),d.set("imageFilter.handle",c),d.set("imageFilter.type",t),e.multiple&&d.set("multiple",e.multiple),"base_layer"===e.layerId){var g=f.getMapObj(e.mapId),u=g.get("paramObj");u.mapType===p.MAPTYPE.GOOGLE_MAP&&v.setImageFilter(e)}}}function o(e){var t=m.getLayer({mapId:e.mapId,layer_id:e.layerId});if(t){var a=t.get("imageFilter.handle");if(a&&(t.unByKey(a),t.unset("imageFilter.handle"),t.unset("imageFilter.type")),"base_layer"===e.layerId){var r=f.getMapObj(e.mapId),o=r.get("paramObj");o.mapType===p.MAPTYPE.GOOGLE_MAP&&v.removeImageFilter(e)}}}function n(e){var t=m.getLayer({mapId:e.mapId,layer_id:e.layerId});if(t)return t.get("imageFilter.type")}function i(e,t,t,t,a){if(!a){for(var r=e.canvas,o=r.width,n=r.height,i=e.getImageData(0,0,o,n),l=i.data,s=0,d=l.length;s<d;s+=4)l[s+0]=l[s+1]=l[s+2]=(3*l[s+0]+4*l[s+1]+l[s+2])/8;e.putImageData(i,0,0)}}function l(e,t,a,r,o){if(!o){var n=e.canvas,i=n.width,l=n.height,s=.01,d=.01,c=.7;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var g=e.getImageData(0,0,i,l),u=g.data,y=0,p=u.length;y<p;y+=4){var m=u[y+0],f=u[y+1],v=u[y+2],h=s*m+d*f+c*v;u[y+0]=255-h,u[y+1]=255-h,u[y+2]=h,u[y+3]=255}e.putImageData(g,0,0)}}function s(e,t,a,r,o){if(!o){var n=e.canvas,i=n.width,l=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var g=e.getImageData(0,0,i,l),u=g.data,y=0,p=u.length;y<p;y+=4){var m=u[y+0],f=u[y+1],v=u[y+2],h=s*m+d*f+c*v;u[y+0]=h,u[y+1]=255-h,u[y+2]=h,u[y+3]=255}e.putImageData(g,0,0)}}function d(e,t,a,r,o){if(!o){var n=e.canvas,i=n.width,l=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var g=e.getImageData(0,0,i,l),u=g.data,y=0,p=u.length;y<p;y+=4){var m=u[y+0],f=u[y+1],v=u[y+2],h=s*m+d*f+c*v;u[y+0]=255-h,u[y+1]=h,u[y+2]=h,u[y+3]=255}e.putImageData(g,0,0)}}function c(e,t,a,r,o){if(!o){var n=e.canvas,i=n.width,l=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var g=e.getImageData(0,0,i,l),u=g.data,y=0,p=u.length;y<p;y+=4){var m=u[y+0],f=u[y+1],v=u[y+2],h=s*m+d*f+c*v;u[y+0]=255-h,u[y+1]=h,u[y+2]=255-h,u[y+3]=255}e.putImageData(g,0,0)}}function g(e,t,a,r,o){if(!o){var n=e.canvas,i=n.width,l=n.height,s=.02,d=.215,c=.545;t&&(s=t),0===t&&(s=t),a&&(d=a),0===a&&(d=a),r&&(c=r),0===r&&(c=r);for(var g=e.getImageData(0,0,i,l),u=g.data,y=0,p=u.length;y<p;y+=4){var m=u[y+0],f=u[y+1],v=u[y+2],h=s*m+d*f+c*v;u[y+0]=h,u[y+1]=h,u[y+2]=255-h,u[y+3]=255}e.putImageData(g,0,0)}}function u(e,t,a,r,o){if(!o){var n=.02,i=.215,l=.545;t&&(n=t),0===t&&(n=t),a&&(i=a),0===a&&(i=a),r&&(l=r),0===r&&(l=r);for(var s=e.canvas,d=s.width,c=s.height,g=e.getImageData(0,0,d,c),u=g.data,y=0,p=u.length;y<p;y+=4){var m=u[y+0],f=u[y+1],v=u[y+2],h=n*m+i*f+l*v;u[y+0]=255-h,u[y+1]=255-h,u[y+2]=255-h,u[y+3]=255}e.putImageData(g,0,0)}}function y(e,t,a,r,o){if(!o){for(var n=e.canvas,i=n.width,l=n.height,s=e.getImageData(0,0,i,l),d=s.data,c=0,g=d.length;c<g;c+=4){var u=d[c+0],y=d[c+1],p=d[c+2],m=255-u+(255-y)+(255-p);d[c+0]=m/3,d[c+1]=m/3,d[c+2]=120,d[c+3]=255}e.putImageData(s,0,0)}var f="自定滤镜算法参考如下:\n/***************************************************************************\n*  var canvas = context.canvas;\n*  var width = canvas.width;\n*  var height = canvas.height;\n*  var imageData = context.getImageData(0, 0, width, height);\n*  var pix = imageData.data;\n*  for (var i = 0, n = pix.length; i < n; i += 4) {\n*      var r = pix[i + 0];\n*      var g = pix[i + 1];\n*      var b = pix[i + 2];\n*      var v = (255 - r) + (255 - g) + (255 - b);\n*      pix[i + 0] = v / 3; // Red\n*      pix[i + 1] = v / 3; // Green\n*      pix[i + 2] = 120; // Blue\n*      pix[i + 3] = 255; // Alpha\n*  }\n*  context.putImageData(imageData, 0, 0);\n***************************************************************************/";I===!1&&console.log("%c "+f,"color:blue;font-size:14px;"),I=!0}var p=(a(1),a(7)),m=a(16),f=a(6),v=a(24),h={gray:i,blue:l,pink:s,teal:d,green:c,yellow:g,black:u,g20:y},I=!1;e.exports={setImageFilter:r,removeImageFilter:o,getImageFilter:n}},function(e,t,a){function r(e){var t=p.getMapObj(e.mapId),a=e.sourceLayerId+"-"+e.targetLayerId,r=v.getLayer({mapId:e.mapId,layerId:a});return r||(r=new y.layer.Vector({source:new y.source.Vector({wrapX:!1})}),r.set("mapId",e.mapId),r.setZIndex(2e3),r.set("layerId",a),r.set("layer_id",a),r.set("sourceLayerId",e.sourceLayerId),r.set("sourceLayerType",e.sourceLayerType),r.set("targetLayerId",e.targetLayerId),r.set("targetLayerType",e.targetLayerType),r.set("businessType",m.BUSINESSTYPE.LINE),t.addLayer(r)),void 0!=e.minShowLevel&&r.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&r.set("maxShowLevel",parseInt(e.maxShowLevel)),r}function o(e){var t=h.getLayer({mapId:e.mapId,layerId:e.sourceLayerId}),a=h.getLayer({mapId:e.mapId,layerId:e.targetLayerId});if(t&&a){var o=r(e);h.addEffectLayer({layer:t,effectLayer:o}),h.addEffectLayer({layer:a,effectLayer:o}),e.datas.forEach(function(t){n(e,o,t)});var i=e.sourceLayerId+"-"+e.targetLayerId,l=function(e){var t=p.getMapObj(e.mapId),a=t.getLayers().getArray(),r=b.find(a,function(e){if(e&&e.get("layerId")===i)return e});if(r&&r.getSource()){var o=L.getHLayer({mapId:e.mapId,layerId:r.get("layer_id")}),n=null;o&&(n=o.getSource().getFeatures());var l=r.getSource().getFeatures(),s=function(e,t){var a=e.getGeometry(),r=t.getGeometry(),o=e.get("coordinates"),n=d(o[0],o[1],mapId);a.setCoordinates([o[0],n]),r.setCoordinates(n)};!!l&&l.forEach(function(e){var t=e.get("arrow");t&&setTimeout(function(){s(e,t)},500)}),!!n&&n.forEach(function(e){var t=e.get("arrow");t&&setTimeout(function(){s(e,t)},500)})}};S.onZoomChange({mapId:e.mapId,id:i,callbackfunc:l})}}function n(e,t,a){var r=[];l(a,e).then(function(o){o instanceof Array&&o.length>0&&o.forEach(function(t,o){var n=t.centerPoint;n&&i(a,e,n).then(function(t){var i={lineId:a&&a.geoId?a.geoId+"_line_"+o:"line_"+o,arrowId:a&&a.geoId?a.geoId+"_arrow_"+o:"arrow_"+o},l=s(t,n,a,e,i);r=r.concat(l)})}),t.getSource().addFeatures(r)})}function i(e,t,a){var r=f.defer();if(e.sourceLngLat){var o=[Number(e.sourceLngLat[0]),Number(e.sourceLngLat[1])];return r.resolve(o),r.promise}if(e.sourceGeoId){var n=I.getBsHandler(t.sourceLayerType),i={mapId:t.mapId,layerId:t.sourceLayerId,layerType:t.sourceLayerType,geoId:e.sourceGeoId,targetPoint:a,coordinates:t.coordinates};if(!n)return;return n.getLineLonLat(i,function(e){e?r.resolve(e):r.reject(e)}),r.promise}}function l(e,t){var a=f.defer();if(e.targetLngLat){var r=[Number(e.targetLngLat[0]),Number(e.targetLngLat[1])];return a.resolve(r),a.promise}if(e.targetGeoId){var o=I.getBsHandler(m.BUSINESSTYPE.CELL),n={mapId:t.mapId,layerId:t.targetLayerId,layerType:t.targetLayerType,geoId:e.targetGeoId};if(!o)return;return o.getLineLonLat(n,function(e){e?a.resolve(e):a.reject(e)}),a.promise}}function s(e,t,a,r,o){var n,i=y.proj.fromLonLat(e),l=y.proj.fromLonLat(t),s=[];n=r.lineType?1===r.lineType[0]?[0]:[r.lineType[0]]:[0];var d=new y.Feature({geometry:new y.geom.LineString([i,l]),businessType:m.BUSINESSTYPE.LINE,mapId:r.mapId}),c=new y.style.Style({fill:new y.style.Fill({color:a.fillColor?a.fillColor:"#000"}),stroke:new y.style.Stroke({color:a.strokeColor?a.strokeColor:"#000",width:a.strokeWidth?a.strokeWidth:1,lineDash:n})});if(d.setStyle(c),d.setId(o.lineId),d.set("sourceGeoId",a.sourceGeoId),d.set("targetGeoId",a.targetGeoId),d.set("coordinates",[i,l]),s.push(d),r.isArrow){var u=g(a,e,t,r.mapId,d,o.arrowId);d.set("arrow",u),s.push(u)}return s}function d(e,t,a){var r=p.getMapObj(a),o=r.getPixelFromCoordinate(e),n=r.getPixelFromCoordinate(t),i=o[0],l=o[1],s=n[0],d=n[1],c=7,g=s-i>=0?-1:1,u=d-l>=0?-1:1,y=Math.atan2(d-l,s-i),m=s+g*c*Math.abs(Math.cos(y)),f=d+u*c*Math.abs(Math.sin(y));return r.getCoordinateFromPixel([m,f])}function c(e,t){var a=t[0]-e[0],r=t[1]-e[1];return-Math.atan2(r,a)+Math.PI/2}function g(e,t,a,r,o,n){var i=c(t,a),l=d(y.proj.fromLonLat(t),y.proj.fromLonLat(a),r);o.getGeometry().setCoordinates([y.proj.fromLonLat(t),l]);var s=new y.Feature({geometry:new y.geom.Point(l)});return s.setStyle(new y.style.Style({image:new y.style.RegularShape({fill:new y.style.Fill({color:e.strokeColor||"#000000"}),stroke:new y.style.Stroke({color:e.strokeColor||"#000000",width:e.strokeWidth||1}),points:3,radius:8,rotation:i,angle:0})})),s.setId(n),s.set("coordinates",l),s}function u(e){var t=e.sourceLayerId+"-"+e.targetLayerId,a=v.getLayer({mapId:e.mapId,layerId:t});a&&a.getSource().clear()}var y=a(3),p=a(6),m=a(7),f=a(83),v=a(16),h=a(41),I=a(40),S=a(11),b=a(1),L=a(43);e.exports={drawLine:o,removeLine:u}},function(e,t){"use strict";function a(){this.state_=o.WAITING,this.callbacks={},this.results={},this.done=!1}function r(){var e=new a;return{promise:e,resolve:function(t){e.resolve(t)},reject:function(t){e.reject(t)},each:function(t,a){return e.each(t,a)}}}var o={};o.RESOLVED="resolved",o.REJECTED="rejected",o.WAITING="waiting",a.prototype.resolve=function(e){this.done||(this.done=!0,this.state_=o.RESOLVED,this.results.resolved=e,this.next_())},a.prototype.reject=function(e){this.done||(this.done=!0,this.state_=o.REJECTED,this.results.rejected=e,this.next_())},a.prototype.then=function(e,t){return e&&(this.callbacks.onResovled=e),t&&(this.callbacks.onRejected=t),this.nextPromise||(this.nextPromise=new a),this.next_(),this.nextPromise},a.prototype.next_=function(){this.nextPromise||(this.nextPromise=new a),this.state_===o.RESOLVED&&this.callbacks.onResovled&&this.callbacks.onResovled(this.results.resolved,this.nextPromise),this.state_===o.REJECTED&&this.callbacks.onRejected&&this.callbacks.onRejected(this.results.rejected,this.nextPromise)},a.prototype.each=function(e,t){function r(e,a,r){r.then(function(e){n++,l[a]=e,s.push(e),n===i&&o.resolve(s)},function(e){n++,l[a]=e,d.push(e),n===i&&o.resolve(s)}),t(e,a,r)}var o=this,n=0,i=e.length,l=new Array(i),s=[],d=[];if(0===i)o.resolve(s);else for(var c=0;c<i;c++){var g=new a;r(e[c],c,g)}return this},e.exports={defer:r}},function(e,t,a){function r(e){this.gisLayerMgrId="gis_layer_manager_id_",this.mapId=e.mapId,this.isShow=e.isShow;var t=e.attributes||{},a=this.gisLayerMgrId+this.mapId;t.id=a,t.hasOwnProperty("class")||(t["class"]="gis_layer_manager");var r=i.createDom({tagName:"div",attributes:t});i.getDom(a)&&i.getDom(this.mapId).removeChild(i.getDom(a)),i.getDom(this.mapId).appendChild(r);var l=o(this.mapId,a);r.appendChild(l);var s=n(r,this.mapId);if(r.appendChild(s),!this.isShow){var d=i.getDom(this.gisLayerMgrId+this.mapId);i.getDom(this.mapId).removeChild(d)}}function o(e,t){var a=i.createDom({tagName:"div",attributes:{"class":"switcher"},text:"+"}),r=function(){var r=i.getDom(t);if(r)if("+"===a.innerText){var o=n(r,e);r.appendChild(o),r.lastChild.style.display="block",a.innerText="-"}else r.lastChild.style.display="none",a.innerText="+"};return l.add(a,"click",r),a}function n(e,t){var a;return document.querySelector(".gis_layer_manager > .layer_list")&&(a=document.querySelector(".gis_layer_manager > .layer_list"),e.removeChild(a)),a=i.createDom({tagName:"div",attributes:{"class":"layer_list"}}),s.isEmpty()||s.keys.forEach(function(e){if(e&&g.endsWith(e,"_"+t)){var r=i.createDom({tagName:"div",attributes:{"class":"layer"}});a.appendChild(r);var o=i.createDom({tagName:"div",attributes:{"class":"controller"}}),n=i.createDom({tagName:"input",attributes:{type:"checkbox","class":"checkbox",name:"layer_name",checked:!0}});o.appendChild(n),r.appendChild(o);var s=e.lastIndexOf("_"),u=e.substring(0,s),y=i.createDom({tagName:"div",attributes:{"class":"layer_name",title:u},text:u.length>25?u.substring(0,25):u});r.appendChild(y);var p=i.createDom({tagName:"div",attributes:{"class":"z_index_btn_box"}}),m=i.createDom({tagName:"div",attributes:{"class":"btn"}}),f=i.createDom({tagName:"div",attributes:{"class":"btn"}});p.appendChild(m),p.appendChild(f),r.appendChild(p);var v=function(e){e.target.checked?d.setVisible({mapId:t,layerIds:[u],isShow:!0}):d.setVisible({mapId:t,layerIds:[u],isShow:!1})};l.add(n,"click",v);var h=0,I=c.getMapObj(t),S=I.getLayers().getLength(),b=function(a){d.setLayerZIndex({mapId:t,layerId:e.substring(0,e.lastIndexOf("_")),zIndex:a})};l.add(m,"click",function(){h!==S&&(h+=1),b(h)}),l.add(f,"click",function(){h-=1,b(h)})}}),a}var i=a(10),l=a(62),s=a(4),d=a(5),c=a(6),g=a(1);e.exports={layerManager:r}},function(e,t,a){var r=a(3),o=a(1),n=a(4),i=a(5),l=a(8),s=a(7),d=a(10),c=null,g=[],u=function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(i.createLayer(e),a=n.get(t)),c=a.getSource(),y(e)},y=function(e){var t=[],a=e.datas;l.getExtent(e.mapId);(o.isValid(a)||a.length>0)&&(a.forEach(function(e){var a=r.proj.fromLonLat(e.coordinate),o=new r.geom.Point(a),n=new r.Feature({geometry:o,businessType:s.BUSINESSTYPE.LEGEND_RANGE,data:e});n.setId(e.id),n.set("legendVal",e.legendVal);var i=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new r.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});n.setStyle(i),n.set("foreverStyle",i),n.set("radius",e.radius?e.radius:5),n.set("strokeWidth",e.strokeWidth?e.strokeWidth:1),t.push(n)}),c.addFeatures(t),g=t),p(e)},p=function(e){var t=e.legendData,a=e.mapId,o=d,n=null,i=o.getDom(a).getElementsByClassName("layer_legend_container_for_one_map");i&&i.length>0?n=i[0]:(n=o.createDom({tagName:"div",attributes:{"class":"layer_legend_container_for_one_map"}}),o.getDom(a).appendChild(n));var l=o.createDom({tagName:"div",attributes:{"class":"one_legend_range__box_one_layer"}});if(!document.querySelector(".layer_legend_container_for_one_map").hasChildNodes("measure-close-legend")){var s=o.createDom({tagName:"div",attributes:{id:"closeEvent","class":"measure-close-legend"}});n.insertBefore(s,n.childNodes[0]),s.onclick=function(){n.style.display="none",o.getDom(a).removeChild(n)}}n.querySelector(".one_legend_range__box_one_layer")&&n.removeChild(n.querySelector(".one_legend_range__box_one_layer")),n.appendChild(l),t.forEach(function(e){var t=o.createDom({tagName:"div",attributes:{"class":"one_legend_line"}});t.style.cursor="pointer",t.id=e.val,l.appendChild(t),t.onclick=function(){var e=t.getAttribute("id").split(",");g.forEach(function(a){var o=a.get("legendVal");if(parseFloat(e[0])<=o&&o<parseFloat(e[1]))if(0===a.get("opacity"))a.set("opacity",1),a.setStyle(a.get("foreverStyle")),t.style.borderLeftWidth="0px",t.childNodes[0].style.backgroundColor=t.childNodes[0].id;else{a.set("opacity",0);var n=new r.style.Style({image:new r.style.Circle({radius:a.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:a.get("strokeWidth")})})});a.setStyle(n),t.style.borderLeftWidth="2px",t.style.borderLeftStyle="solid",t.style.borderLeftColor="#00BFFF",t.childNodes[0].style.backgroundColor="gray"}})};var a=o.createDom({tagName:"div"});a.style.width="8px",a.style.height="8px",a.style.marginTop="9px",a.style.marginLeft="10px",a.style.marginRight="10px",a.style.backgroundColor=e.color,a.style.borderRadius="100px",a.style.webkitBorderRadius="100px",a.style.mozBorderRadius="100px",a.id=e.color,t.appendChild(a);var n=o.createDom({tagName:"div"});n.innerHTML=e.title?e.title:e.text,t.appendChild(n)})};e.exports={addFeature:u,setLayerData:y,createLegend:p}},function(e,t,a){var r=a(3),o=a(1),n=a(4),i=a(5),l=a(8),s=a(7),d=a(10),c=null,g=[],u=function(e){var t=e.layerId+"_"+e.mapId,a=null;n.containsKey(t)?a=n.get(t):(i.createLayer(e),a=n.get(t)),c=a.getSource(),y(e)},y=function(e){var t=[],a=e.datas;l.getExtent(e.mapId);(o.isValid(a)||a.length>0)&&(a.forEach(function(e){
var a=r.proj.fromLonLat(e.coordinate),o=new r.geom.Point(a),n=new r.Feature({geometry:o,businessType:s.BUSINESSTYPE.LEGEND_SLIDER,data:e});n.setId(e.id),n.set("legendVal",e.legendVal);var i=new r.style.Style({image:new r.style.Circle({radius:e.radius?e.radius:5,fill:new r.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new r.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});n.setStyle(i),n.set("foreverStyle",i),n.set("radius",e.radius?e.radius:5),n.set("strokeWidth",e.strokeWidth?e.strokeWidth:1),t.push(n)}),c.addFeatures(t),g=t),p(e)},p=function(e){var t=(e.legendData,e.mapId),a=d,n=o.getBrowserType(),i=null,l=a.getDom(t).getElementsByClassName("layer_legend_container_for_one_map");l&&l.length>0?i=l[0]:(i=a.createDom({tagName:"div",attributes:{"class":"layer_legend_container_for_one_map"}}),a.getDom(t).insertBefore(i,a.getDom(t).childNodes[0]));var s=a.createDom({tagName:"div",attributes:{"class":"one_legend_box_one_layer_slider"}});if(!document.querySelector(".layer_legend_container_for_one_map").hasChildNodes("measure-close-legend")){var c=a.createDom({tagName:"div",attributes:{id:"closeEvent","class":"measure-close-legend"}});i.insertBefore(c,i.childNodes[0]),c.onclick=function(){i.style.display="none",a.getDom(t).removeChild(i)}}i.querySelector(".one_legend_box_one_layer_slider")&&i.removeChild(i.querySelector(".one_legend_box_one_layer_slider")),i.appendChild(s);var u="",y="";n.webkit?(u="slider_left_chrome",y="slider_right_chrome"):n.mozilla?(u="slider_left_Firefox",y="slider_right_Firefox"):n.msie&&(u="slider_left_MsIE",y="slider_right_MsIE");var p=a.createDom({tagName:"div",attributes:{"class":u}});s.appendChild(p);var m=a.createDom({tagName:"input",attributes:{type:"range",step:1,min:1,max:e.legendData.length,value:1,zIndex:2}});m.title=1,p.appendChild(m);var f=function(e){var t=e.inputLeftVal,a=e.inputRightVal;g.forEach(function(e){var o=e.get("legendVal");if(t<=o&&o<=a)e.setStyle(e.get("foreverStyle"));else{var n=new r.style.Style({image:new r.style.Circle({radius:e.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:e.get("strokeWidth")})})});e.setStyle(n)}})},v=function(e){g.forEach(function(t){if(t.get("legendVal")===e)t.setStyle(t.get("foreverStyle"));else if(t.get("legendVal")!==e){var a=new r.style.Style({image:new r.style.Circle({radius:t.get("radius"),fill:new r.style.Fill({color:"gray"}),stroke:new r.style.Stroke({color:"gray",width:t.get("strokeWidth")})})});t.setStyle(a)}})},h=function(e){var t=e.sliderInputColor;if(t.children)for(var a=0,r=t.children.length;a<r;a++){var o=t.children[a];o.style.backgroundColor=o.title,a!==e.legendVal-1&&(o.style.backgroundColor="gray")}},I=function(e){var t=e.sliderInputColor;if(t.children)for(var a=0,r=t.children.length;a<r;a++){var o=t.children[a];o.style.backgroundColor=o.title,a>=e.legendVal[0]-1&&a<=e.legendVal[1]-1||(o.style.backgroundColor="gray")}};m.onchange=function(){var e=parseFloat(this.value),t=parseFloat(L.value);this.title=e,e>=t?(L.value=e,t=e,v(e),h({sliderInputColor:S,legendVal:e})):e<t&&(f({inputLeftVal:e,inputRightVal:t}),I({sliderInputColor:S,legendVal:[e,t]})),a.getDom(".legend_label_div_class")[0].innerHTML=e+" ~ "+t};var S=a.createDom({tagName:"div",attributes:{"class":"slider_color"}});s.appendChild(S),e.legendData.forEach(function(t){var r=a.createDom({tagName:"div",attributes:{title:t.color}}),o=255/e.legendData.length;r.style.backgroundColor=t.color,r.style.height=o+"px",r.style.width="100%",S.appendChild(r)});var b=a.createDom({tagName:"div",attributes:{"class":y}});s.appendChild(b);var L=a.createDom({tagName:"input",attributes:{type:"range",step:1,min:1,max:e.legendData.length,value:e.legendData.length,zIndex:2}});L.title=e.legendData.length,b.appendChild(L),L.onchange=function(){var e=parseFloat(this.value),t=parseFloat(m.value);this.title=e,e<=t?(m.value=e,t=e,v(e),h({sliderInputColor:S,legendVal:e})):e>t&&(f({inputLeftVal:t,inputRightVal:e}),I({sliderInputColor:S,legendVal:[t,e]})),a.getDom(".legend_label_div_class")[0].innerHTML=t+" ~ "+e};var T=a.createDom({tagName:"div",attributes:{"class":"legend_label_div_class"},text:parseFloat(m.value)+" ~ "+parseFloat(L.value)});s.appendChild(T);var w=a.createDom({tagName:"div",attributes:{"class":"legend_label_low_div_class"},text:"Low"});s.appendChild(w);var E=a.createDom({tagName:"div",attributes:{"class":"legend_label_high_div_class"},text:"High"});s.appendChild(E)};e.exports={addFeature:u,setLayerData:y}},function(e,t,a){var r=a(3),o=a(4),n=a(7),i=a(1),l=a(5),s=a(6),d=a(42),c=a(43),g=new Map;g.set("refreshLayerManager_key",[]);var u=function(e){var t=e.layerId+"_"+e.mapId,i=null,g=e.clusterStyle||{},u=g.strokeColor||"#aaaaaa",y=g.fillColor||"#3399cc",p=void 0!==g.strokeWidth?g.strokeWidth:1;0===p&&(u=y);var m=g.fontColor||"#ffffff",f=g.radius||20,v=g.distance||50,h=void 0==e.isShow||e.isShow,I=e.label?e.label:e.layerId;if(p<0)return void console.warn("strokeWidth 必须大于等于0");if(f<=0)return void console.warn("radius 必须大于0");if(v<=0)return void console.warn("distance 必须大于0");void 0===e.isClusterVariableSize&&(e.isClusterVariableSize=!1),e.distance=v;var S=function(t,a){var o=t.get("features"),n=o.length;if(n>1){var i=0;return i=e.isClusterVariableSize?f+n:f,[new r.style.Style({image:new r.style.Circle({radius:i,fill:new r.style.Fill({color:y}),stroke:new r.style.Stroke({color:u,width:p})}),text:new r.style.Text({text:n.toString(),fill:new r.style.Fill({color:m})})})]}var l=o[0].get("property");return[new r.style.Style({image:new r.style.Circle({radius:l.radius,fill:new r.style.Fill({color:l.fillColor}),stroke:new r.style.Stroke({color:l.strokeColor,width:l.strokeWidth})}),text:new r.style.Text({fill:new r.style.Fill({color:m})})})]};o.containsKey(t)?i=o.get(t):(l.createLayer(e),i=o.get(t)),i.setZIndex(n.Z_INDEX.SITE),i.setStyle(S),i.set("type",n.CUSTOMTYPE.LAYERIMGTYPE),i.set("businessType","POINTCLUSTER"),i.set("params.label",I),i.set("isVectorType",!0),i.set("state.showLabel",!!e.showLabel),i.set("layerId",e.layerId),i.set("layer_id",e.layerId),i.set("legendName",e.legendName),i.set("isShow",h),i.set("mapId",e.mapId),void 0!=e.minShowLevel&&i.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&i.set("maxShowLevel",parseInt(e.maxShowLevel)),e.isHightlight&&fusiongis.Events.addClickCallback(e.mapId,"point-cluster-click-event",function(t){if(t.layer&&"POINTCLUSTER"===t.layer.get("businessType")&&t.feature&&t.feature.get("features")instanceof Array&&1===t.feature.get("features").length&&t.feature.get("features")[0].get("businessType")===n.BUSINESSTYPE.POINTER_CLUSTER){c.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]});var r=c.getHLayer({mapId:e.mapId,layerId:e.layerId});r&&!r.getVisible()&&r.setVisible(!0);var o=t.feature.get("features")[0];d.highlight(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:o});var i=s.getMapObj(t.mapId);i&&i.on("moveend",function(e){var t,r,o=e.map.getTarget(),n=a(4),i=a(43),l=(a(40),"");n.keys.forEach(function(e){var t=n.get(e);if(t){var a=t.get("businessType"),i=t.get("mapId");i&&i===o&&"POINTCLUSTER"===a&&(l=t.get("layerId"),r=t)}});var s=i.getHLayer({mapId:o,layerId:l}),d=s.getSource().getFeatures();d instanceof Array&&d.length>0&&(t=d[0].get("$index"));var c=r.getSource().getFeatures(),g=!1;c instanceof Array&&c.length>0&&c.forEach(function(e){var a=e.get("features");a instanceof Array&&a.length>1&&a.forEach(function(e){var a=e.get("$index");a===t&&(g=!0)})}),s.setVisible(!g)})}},e.layerId)},y=function(e){var t=e.layerId+"_"+e.mapId,a=e.datas,l=o.get(t),d=null,c=void 0===e.isCluster||e.isCluster;if(l&&(l.set("legendName",e.legendName),e.label&&l.set("params.label",e.label),d=c===!0?l.getSource().getSource():l.getSource()),i.isValid(a)||a.length>0){var u=[];a.forEach(function(e,t){var a=r.proj.fromLonLat(e.coordinate),o=new r.Feature({geometry:new r.geom.Point(a),property:{fillColor:e.fillColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,radius:e.radius||5},data:e,businessType:n.BUSINESSTYPE.POINTER_CLUSTER});o.setId(e.id),o.set("id",e.id),o.set("data",e),o.set("vectorType",n.BUSINESSTYPE.POINTER_CLUSTER),o.set("layer",l),o.set("$index","$"+t);var i={radius:e.radius||5,fillColor:void 0!==e.highlight&&void 0!==e.highlight.fillColor?e.highlight.fillColor:e.fillColor,strokeColor:void 0!==e.highlight&&void 0!==e.highlight.strokeColor?e.highlight.strokeColor:"black",strokeWidth:void 0!==e.highlight&&void 0!==e.highlight.strokeWidth?e.highlight.strokeWidth:1};o.set("select",i),u.push(o)}),d&&d.addFeatures(u)}if(g.get("refreshLayerManager_key").length<10){var y=new r.layer.Vector;s.getMapObj(e.mapId).addLayer(y),g.get("refreshLayerManager_key").push(y)}else{var p=g.get("refreshLayerManager_key");p&&p.length>0&&p.forEach(function(t,a){s.getMapObj(e.mapId).removeLayer(t),g.get("refreshLayerManager_key").splice(a,1)})}};e.exports={addLayer:u,setLayerData:y}},function(e,t,a){function r(e){for(var t=e.length,a=[],r=t-1;r>=0;r--)a.push(e[r]);return a}function o(e){for(var t=[],a=[e[0].coordinate],o=0;o<e.length;o++){var i=e[o].coordinate,d=e[o].angel,c=e[o].azimuth,g=e[o].radius,u=e[o].fillColor,y=e[o].strokeColor,p=e[o].opacity,m=s.createSector(i[0],i[1],g,c,d),f=m.slice(0,m.length-2),v=r(a),h=f.concat(v);a=f;var I=[];h.forEach(function(e){var t=n.proj.transform(e,l.PROJ.EPSG_4326,l.PROJ.EPSG_3857);I.push(t)});var S=new n.geom.Polygon([I]),b=new n.Feature({geometry:S}),L=u.substring(0,u.length-1),T="rgba"+L+","+p+")",w="rgb"+y,E=new n.style.Style({fill:new n.style.Fill({color:T}),stroke:new n.style.Stroke({color:w,width:1})});b.setStyle(E),t.push(b)}return t}var n=a(3),i=a(6),l=(a(1),a(4),a(7)),s=a(48),d=a(16),c=function(e){var t=null,a=e.mapId,r=e.layerId,o=i.getMapObj(a),s={mapId:a,layerId:r};return d.getLayer(s)?t=d.getLayer(s):(t=new n.layer.Vector,t.set("type",l.CUSTOMTYPE.LAYERIMGTYPE),t.set("map",o),t.set("layerId",r),o.addLayer(t)),void 0!=e.minShowLevel&&t.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&t.set("maxShowLevel",parseInt(e.maxShowLevel)),t},g=function(e){var t=e.mapId,a=e.datas,r=i.getMapObj(t);if(null!=r){var l=c(e);if(null==l.getSource()){var s=new n.source.Vector({wrapX:!1});l.setSource(s)}o(a).forEach(function(e){l.getSource().addFeature(e)})}};e.exports={addRadar:g}},function(e,t,a){var r=a(3),o=a(6),n=a(1),i=a(4),l=a(7),s=a(5),d=function(e){var t=e.mapId,a=e.layerId+"_"+t,s=o.getMapObj(t),d=null;return n.isValid(i.get(a))?d=i.get(a):(d=new r.layer.Vector({source:new r.source.Vector({wrapX:!1})}),d.set("type",l.CUSTOMTYPE.LAYERTYPE),d.set("map",s),d.set("layerId",a),s.addLayer(d),i.put(a,d)),void 0!=e.minShowLevel&&d.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&d.set("maxShowLevel",parseInt(e.maxShowLevel)),d},c=function(e){var t=d(e),a=e.mapId,n=e.layerId,i=e.geoId,c=e.shadowColor,g=e.shadowOpacity,u=e.coordinates;if(e.geoId){var y={layerId:n,mapId:a,featureId:i},p=s.getFeatureById(y);u=p.getGeometry().getCoordinates()}var m=o.getMapObj(a);if(null!=m){var f=new r.source.Vector({wrapX:!1}),v=r.proj.fromLonLat([180,89.99]),h=r.proj.fromLonLat([180,-89.99]),I=r.proj.fromLonLat([-180,-89.99]),S=r.proj.fromLonLat([-180,89.99]),b=[v,h,I,S],L=[];e.geoId?L=u:u.forEach(function(e){var t=r.proj.transform(e,l.PROJ.EPSG_4326,l.PROJ.EPSG_3857);L.push(t)}),L.push(L[0]);var T=new r.geom.LinearRing(L),w=new r.geom.Polygon([b]),E=new r.Feature({geometry:w,type:"bgPolygon",geoId:i});E.setId(i),f.addFeature(E),w.setCoordinates([b]),w.appendLinearRing(T);var C,k;C=null==c?"(50,50,50)":c,k=null==g?.3:g;var x=C.substring(0,C.length-1),P="rgba"+x+","+k+")",_=new r.style.Style({fill:new r.style.Fill({color:P}),stroke:new r.style.Stroke({color:"rgba(255,0,0,0)",width:1})});t.setSource(f),t.setStyle(_),m.addLayer(t)}};e.exports={renderShadowArea:c}},function(e,t,a){var r=a(3),o=a(4),n=a(7),i=a(1),l=a(5),s=new Map,d=new Map,c=function(e){var t=e.mapId,a=e.layerId+"_"+t,r=null;s.set(t,[]),d.set(t,[]),o.containsKey(a)?r=o.get(a):(l.createLayer(e),r=o.get(a)),e.source=r.getSource(),g(e),u(e)},g=function(e){var t=e.datas,a=e.source;if(i.isValid(t))for(var o=0,l=t.length;o<l;o++){for(var s=[],d=t[o].coordinates,c=t[o].style,g=0,u=d.length;g<u;g++){var y=r.proj.fromLonLat([d[g][0],d[g][1]]);s.push(y)}var p=new r.Feature({geometry:new r.geom.LineString(s),businessType:n.BUSINESSTYPE.TRACK_SHOW_LINE});if(c&&c.lineStrokeColor){var m=new r.style.Style({stroke:new r.style.Stroke({color:c.lineStrokeColor,width:c.lineStrokeWidth?c.lineStrokeWidth:3})});p.setStyle(m)}a.addFeature(p);var f=s.filter(function(e,t,a){return t>a.length-3}),v=f[1][0]-f[0][0],h=f[1][1]-f[0][1],I=-Math.atan2(h,v)+Math.PI/2,S=new r.style.Style({image:new r.style.RegularShape({fill:new r.style.Fill({color:c?c.lineStrokeColor:"blue"}),stroke:new r.style.Stroke({color:c?c.lineStrokeColor:"blue",width:1}),points:3,radius:10,rotation:I,angle:0})}),b=new r.Feature({geometry:new r.geom.Point(f[1]),businessType:n.BUSINESSTYPE.TRACK_SHOW_LINE});b.setStyle(S),a.addFeature(b)}},u=function(e){d.get(e.mapId).push(e);var t=e.datas,a=e.source,l=0;l=e.speedRate?500*e.speedRate:500;var c=e.isKeepTrack,g=e.mapId;if(i.isValid(t))for(var u=function(t,i,d){var u=o,y=g+d,p=u.get(y)||0,m=t.length,f=[],v=0,h=setInterval(function(){if(p<m){var o=t[p],l=1e3;if(!o)return;o.length>2&&(l=o[2]);var s=r.proj.fromLonLat([o[0],o[1]]),d=new r.geom.Point(s);if(v+=500,l<v){var g=new r.Feature({geometry:d,businessType:n.BUSINESSTYPE.TRACK_SHOW}),I=null;I=i?new r.style.Style({image:new r.style.Circle({fill:new r.style.Fill({color:i.fillColor||"#319FD3"}),radius:i.radius||5,stroke:new r.style.Stroke({color:i.strokeColor||"#ff0",width:i.strokeWidth||1})})}):new r.style.Style({image:new r.style.Circle({fill:new r.style.Fill({color:e.fillColor||"#319FD3"}),radius:e.radius||5,stroke:new r.style.Stroke({color:e.strokeColor||"#ff0",width:e.strokeWidth||1})})}),g.setStyle(I),c||(f.forEach(function(e){a.removeFeature(e)}),f=[]),a.addFeature(g),f.push(g),p===m-1&&(c?clearInterval(h):p=-1),u.put(y,p),v=0,p++}}},l);s&&s.get(g).push(h)},y=0,p=t.length;y<p;y++){var m=t[y],f=m.style||null;u(m.coordinates,f,m.uniqueIdentify)}},y=function(e){s.size>0&&s.get(e).length>0&&s.get(e).forEach(function(e){clearInterval(e)})},p=function(e){var t=d.get(e),a=t[t.length-1];if(a){var r=a.source.getFeatures();a.isKeepTrack||r.forEach(function(e){n.BUSINESSTYPE.TRACK_SHOW===e.get("businessType")&&a.source.removeFeature(e)}),u(a)}},m=function(e){var t=o;t.keys.forEach(function(a){a.startsWith(e)&&t.put(a,t.get(a)-1)}),p(e)},f=function(e){var t=o;t.keys.forEach(function(a){a.startsWith(e)&&t.put(a,t.get(a)+1)}),p(e)};e.exports={addTackShow:c,pause:y,start:p,pre:m,next:f}},function(e,t,a){var r=a(3),o=a(6),n=(a(1),a(4)),i=a(7),l=a(41),s=(a(16),function(e){var t,a=e.mapId,l=e.layerId,s=o.getMapObj(a),d=l+"_"+a;return n.containsKey(d)?t=n.get(d):(t=new r.layer.Image({source:new r.source.ImageCanvas({canvasFunction:e.canvasFunction,projection:"EPSG:3857"})}),t.set("type",i.CUSTOMTYPE.LAYERIMGTYPE),t.set("isVectorType",!1),t.set("map",s),t.set("layerId",d),t.set("layer_id",l),s.addLayer(t)),void 0!=e.minShowLevel&&t.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&t.set("maxShowLevel",parseInt(e.maxShowLevel)),t}),d=function(e){var t,a=e.mapId,i=e.layerId,s=o.getMapObj(a),d=i+"_"+a;n.containsKey(d)&&(t=l.getLayer(d),t.setSource(new r.source.ImageCanvas({canvasFunction:null,projection:"EPSG:3857"})),s.removeLayer(t),t=null)},c=function(e){function t(e,t,a,r){var o,n,i=[],l=Math.floor(Math.abs(t/r));return o=t>=0?l*Math.abs(r):-l*Math.abs(r),i.push(o),n=l%2===0?Math.ceil(Math.abs(e/a))*Math.abs(a):Math.ceil(Math.abs(e/a)-.5)*Math.abs(a)+.5*Math.abs(a),e<=0&&(n=-n),i.push(n),i}function a(e,a,o){for(var n,s,d,c,y=Math.sqrt(3)*i/2,p=(o[2]-o[0])/e,m=(-o[3]+o[1])/a,f=2*m/3,v=t(o[0],o[3],p,m),h=v[1],I=v[0],S=(h-o[0])/p*2*y,b=(I-o[3])/m*1.5*i,L=0;L<a;L++)for(var T=0;T<e;T++){L%2===0?(d=S+2*y*T,n=h+p*T):(d=S+y+2*y*T,n=h+.5*p+p*T),c=b+1.5*i*L,s=I+m*L;var w=0;l.forEach(function(e){var t=r.proj.fromLonLat(e),a=t[0]-n,o=t[1]-s;Math.abs(o)>=Math.abs(f)||Math.abs(a)>=Math.abs(p)/2||Math.abs(f)-Math.abs(o)>Math.abs(a)/Math.sqrt(3)&&(w+=1)}),g(d,c,w),u(d,c,w)}}var n,i=(o.getMapObj(e.mapId),e.radius),l=e.data,d=e.color,c=e.step,g=function(e,t,a){for(var r,o=0;o<=d.length;o++)a>c*o&&a<=c*(o+1)&&(r=d[o]);void 0===r&&(r="rgba(255,255,255,0)");var l=Math.sqrt(3)/2*i;n.beginPath(),n.lineWidth=1,n.fillStyle=r,n.moveTo(e,t-i),n.lineTo(e+l,t-i/2),n.lineTo(e+l,t+i/2),n.lineTo(e,t+i),n.lineTo(e-l,t+i/2),n.lineTo(e-l,t-i/2),n.fill(),n.closePath()},u=function(e,t,a){a>0&&(n.textAlign="center",n.textBaseline="middle",n.font="15px Arial",n.fillStyle="white",n.fillText(a,e,t))},y=function(e,t,r){var o=e/(Math.sqrt(3)*i),n=t/(1.5*i);a(o,n,r)},p=function(e,t,a,r,o){this.canvas||(this.canvas=document.createElement("canvas"));var i=r[0],l=r[1];return this.canvas.setAttribute("width",i),this.canvas.setAttribute("height",l),n=this.canvas.getContext("2d"),y(i,l,e),this.canvas},m={mapId:e.mapId,canvasFunction:p};s(m)};e.exports={convergeForCell:c,removeConverge:d}},function(e,t,a){var r=a(3),o=a(6),n=(a(1),a(4)),i=a(7),l=a(41),s=(a(16),function(e){var t,a=e.mapId,l=e.layerId,s=o.getMapObj(a),d=l+"_"+a;return n.containsKey(d)?t=n.get(d):(t=new r.layer.Image({source:new r.source.ImageCanvas({canvasFunction:e.canvasFunction,projection:"EPSG:3857"})}),t.set("type",i.CUSTOMTYPE.LAYERIMGTYPE),t.set("isVectorType",!1),t.set("map",s),t.set("layerId",d),t.set("layer_id",l),s.addLayer(t)),void 0!=e.minShowLevel&&t.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&t.set("maxShowLevel",parseInt(e.maxShowLevel)),t}),d=function(e){var t,a=e.mapId,i=e.layerId,s=o.getMapObj(a),d=i+"_"+a;n.containsKey(d)&&(t=l.getLayer(d),t.setSource(new r.source.ImageCanvas({canvasFunction:null,projection:"EPSG:3857"})),s.removeLayer(t),t=null)},c=function(e){function t(e,t){var a;return a=e>=0?Math.ceil(Math.abs(e/t))*Math.abs(t):-Math.ceil(Math.abs(e/t))*Math.abs(t)}function a(e,a,o){for(var n=(o[2]-o[0])/e,s=(-o[3]+o[1])/a,c=n/2,g=s/2,p=t(o[0],n),m=t(o[3],s),f=0;f<e;f++)for(var v=0;v<a;v++){var h=p+n*f,I=m+s*v,S=0;d.forEach(function(e){var t=r.proj.fromLonLat(e);t[0]>=h-c&&t[0]<h+c&&t[1]<=I-g&&t[1]>I+g&&(S+=1)});var b=(p-o[0])/n*50,L=(m-o[3])/s*50,T=b+i*f,w=L+l*v;u(T,w,S),y(T,w,S)}}var n,i=(o.getMapObj(e.mapId),e.width),l=e.height,d=e.data,c=e.color,g=e.step,u=function(e,t,a){var r;n.strokeStyle="rgba(0,0,255,0.1)";for(var o=0;o<=c.length;o++)a>g*o&&a<=g*(o+1)&&(r=c[o]);void 0===r&&(r="rgba(255,255,255,0)"),n.beginPath(),n.fillStyle=r,n.fillRect(e-i/2,t-l/2,i,l),n.fill(),n.closePath()},y=function(e,t,a){a>0&&(n.textAlign="center",n.textBaseline="middle",n.font="15px Arial",n.fillStyle="white",n.fillText(a,e,t))},p=function(e,t,r){var o=e/i,n=t/l;a(o,n,r)},m=function(e,t,a,r,o){this.canvas||(this.canvas=document.createElement("canvas"));var i=r[0],l=r[1];return this.canvas.setAttribute("width",i),this.canvas.setAttribute("height",l),n=this.canvas.getContext("2d"),p(i,l,e),this.canvas},f={mapId:e.mapId,canvasFunction:m};s(f)};e.exports={convergeForGrid:c,removeConverge:d}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=null,r=O.get(e.mapId);r.getView().getZoom();O.containsKey(t)?a=O.get(t):(M.createLayer(e),a=O.get(t)),a.set("businessType","editLayer"),a.set("legendName",e.legendName),a.set("paramObj",e),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),A=a.getSource(),i(e)}function o(e){var t=null,a=e.layerId+"_"+e.mapId,r=O.get(a);return r.set("legendName",e.legendName),r&&(t=r.getSource()),t}function n(e){for(var t=e.length,a=t-1;a>0;a--)for(var r=0;r<a;r++)if(e[r].radius>e[r+1].radius){var o=e[r];e[r]=e[r+1],e[r+1]=o}return e}function i(e){A=o(e);var t=e.datas;if(N.isValid(t)||t.length>0)for(var a=0;a<t.length;a++){var r=t[a].cellInfo;A.addFeature(d(t[a]));for(var i={},l=0;l<r.length;l++)i[r[l].azimuth.toString()]?i[r[l].azimuth.toString()].push(r[l]):(i[r[l].azimuth.toString()]=[],i[r[l].azimuth.toString()].push(r[l]));for(var s in i)i[s].length>1&&n(i[s]);for(var s in i)if(i[s].length>0)for(var g=i[s].length-1;g>=0;g--)A.addFeature(c(i[s][g]))}}function l(e){var t=O.get(e.mapId),a=e.isOpen,r=e.type,n=t.getInteractions().item(2),i=!1;e.callback;if(A=o({mapId:e.mapId,layerId:e.layerId}),a){if(C&&k&&R)return;var l=null;C=t.on("pointerdown",function(e){var a=[];t.forEachFeatureAtPixel(e.pixel,function(e){e&&"siteAndCell"===e.get("businessType")&&(n.setActive(!1),i=!0,a.push(e))}),a.length>0&&(l=a[0])}),k=t.on("pointerdrag",function(t){if(i)if("site"===l.get("type")){if("translate"===r){l.getGeometry().setCoordinates(t.coordinate);var a=l.get("data").coordinates;l.get("data").coordinates=_.proj.toLonLat(t.coordinate),l.set("nowLatlon",t.coordinate);var o=l.get("data").cellInfo;if(o&&o.length>0)for(var n=0;n<o.length;n++){var s=A.getFeatureById(o[n].cellId);o[n].coordinates[0]===a[0]&&o[n].coordinates[1]===a[1]?s&&(v(t,s),E(e.mapId,e.layerId,l,s)):s&&E(e.mapId,e.layerId,l,s)}}}else if("cell"===l.get("type"))if("translate"===r){var d=A.getFeatureById(l.get("data").belongSite);v(t,l),E(e.mapId,e.layerId,d,l)}else h(t,l)}),R=t.on("pointerup",function(){l&&(n.setActive(!0),i=!1,l=null)})}else t.unByKey(C),t.unByKey(k),t.unByKey(R),C=null,k=null,R=null}function s(e,t){if(A=o(e),t)if(Array.isArray(t)&&t.length>0){for(var a=[],r=0;r<t.length;r++)a.push(d(t[r]));A.addFeatures(a)}else A.addFeature(d(t))}function d(e){var t=new _.geom.Point(_.proj.fromLonLat(e.coordinates)),a=new _.Feature({geometry:t,businessType:"siteAndCell",type:"site",data:e});a.setId(e.siteId);var r=new _.style.Style({image:new _.style.Circle({radius:e.radius?e.radius:5,fill:new _.style.Fill({color:e.fillColor?e.fillColor:"red"}),stroke:new _.style.Stroke({color:e.strokeColor?e.strokeColor:"#319FD3",width:e.strokeWidth?e.strokeWidth:1})})});return a.setStyle(r),a}function c(e){var t,a=e.radius,r=e.azimuth,o=e.angle,n=e.cellType,i=_.proj.fromLonLat([e.coordinates[0],e.coordinates[1]]),l=null;"arrow"===n?l=F.createArrow(i[0],i[1],a,r,o):"sector"===n?l=F.createSector(i[0],i[1],a,r,o):"triangle"===n&&(l=F.createTriangle(i[0],i[1],a,r,o));var s=new _.geom.LinearRing(l),d=s.getCoordinates(),c=null;if(360===o){var g=e.pointRadius||0;c=new _.geom.GeometryCollection,d.splice(0,2),d.splice(d.length-1,2),c.setGeometries([new _.geom.Circle(_.proj.fromLonLat([e.coordinates[0],e.coordinates[1]]),g),new _.geom.Polygon([d])])}else c=new _.geom.Polygon([d]);t=new _.Feature({geometry:c,businessType:"siteAndCell",type:"cell",data:e}),t.setId(e.cellId);var u=new _.style.Style({fill:new _.style.Fill({color:e.fillColor||"#836FFF"}),stroke:new _.style.Stroke({color:e.strokeColor||"#76EEC6",width:e.strokeWidth||2})});return t.setStyle(u),t}function g(e,t){if(A=o(e),t){var a=null;if(Array.isArray(t)&&t.length>0){for(var r=[],i=0;i<t.length;i++)r.push(c(t[i])),a=A.getFeatureById(r[i].belongSite),a.get("data").cellInfo.push(t[i]);A.addFeatures(r)}else{a=A.getFeatureById(t.belongSite);for(var l=a.get("data").cellInfo,s=!0,d=[],i=0;i<l.length;i++)t.azimuth===l[i].azimuth&&(s=!1,d.push(l[i]));if(s)A.addFeature(c(t)),l.push(t);else{for(var i=0;i<d.length;i++){var g=A.getFeatureById(d[i].cellId);g&&A.removeFeature(g)}d.push(t);for(var u=n(d),i=u.length-1;i>=0;i--)A.addFeature(c(u[i]));l.push(t)}}}}function u(e,t){if(A=o(e),t)if(Array.isArray(t)&&t.length>0)for(var a=0;a<t.length;a++)A.removeFeature(A.getFeatureById(t[a]));else A.removeFeature(A.getFeatureById(t))}function y(e,t){var a=e.get("data").cellInfo;if(a&&a.length>0)for(var r=0;r<a.length;r++)a[r].cellId===t&&a.splice(r,1)}function p(e,t){if(A=o(e),t){var a,r,n=null;if(Array.isArray(t)&&t.length>0)for(var i=0;i<t.length;i++)r=A.getFeatureById(t[i]),n=A.getFeatureById(t[i]+"_line"),r&&(A.removeFeature(r),a=A.getFeatureById(r.get("data").belongSite),a&&y(a,t[i])),n&&A.removeFeature(n);else r=A.getFeatureById(t),n=A.getFeatureById(t+"_line"),r&&(A.removeFeature(r),a=A.getFeatureById(r.get("data").belongSite),a&&y(a,t)),n&&A.removeFeature(n)}}function m(e,t){if(e&&t){var a=e.get("data");N.mixin(a,t);var r=_.proj.fromLonLat(a.coordinates),o=new _.style.Style({image:new _.style.Circle({radius:a.radius,fill:new _.style.Fill({color:a.fillColor}),stroke:new _.style.Stroke({color:a.strokeColor,width:a.strokeWidth})})});e.setStyle(o),e.getGeometry().setCoordinates(r),e.set("data",a)}}function f(e,t){if(A=o(t),e&&t){var a=e.get("data");N.mixin(a,t);var r=a.radius,i=a.azimuth,l=a.angle,s=a.cellType,d=_.proj.fromLonLat(a.coordinates),g=null;"arrow"===s?g=F.createArrow(d[0],d[1],r,i,l):"sector"===s?g=F.createSector(d[0],d[1],r,i,l):"triangle"===s&&(g=F.createTriangle(d[0],d[1],r,i,l));var u=new _.style.Style({fill:new _.style.Fill({color:a.fillColor||"#836FFF"}),stroke:new _.style.Stroke({color:a.strokeColor||"#76EEC6",width:a.strokeWidth||2})});e.getGeometry().setCoordinates([g]),e.setStyle(u),e.set("data",a);for(var y=A.getFeatureById(e.get("data").belongSite),p=y.get("data").cellInfo,m=!0,f=[],v=0;v<p.length;v++)i===p[v].azimuth&&(m=!1,f.push(p[v]));if(!m){for(var v=0;v<f.length;v++){var h=A.getFeatureById(f[v].cellId);h&&A.removeFeature(h)}for(var I=n(f),v=I.length-1;v>=0;v--)A.addFeature(c(I[v]))}}}function v(e,t){var a,r=t.get("data").radius;"sector"===t.get("data").cellType?a=F.createSector(e.coordinate[0],e.coordinate[1],r,t.get("data").azimuth,t.get("data").angle):"arrow"===t.get("data").cellType?a=F.createArrow(e.coordinate[0],e.coordinate[1],r,t.get("data").azimuth,t.get("data").angle):"triangle"===t.get("data").cellType&&(a=F.createTriangle(e.coordinate[0],e.coordinate[1],r,t.get("data").azimuth,t.get("data").angle)),t.getGeometry().setCoordinates([a]),t.get("data").coordinates=_.proj.toLonLat(e.coordinate),t.set("nowLatlon",e.coordinate)}function h(e,t){var a=t.get("data"),r=_.proj.fromLonLat(a.coordinates),o=180*Math.atan((e.coordinate[0]-r[0])/(e.coordinate[1]-r[1]))/Math.PI;o+=e.coordinate[1]-r[1]>0?360:180,o>360&&(o-=360);var n;"sector"===t.get("data").cellType?n=F.createSector(r[0],r[1],a.radius,o,a.angle):"arrow"===t.get("data").cellType?n=F.createArrow(r[0],r[1],a.radius,o,a.angle):"triangle"===t.get("data").cellType&&(n=F.createTriangle(r[0],r[1],a.radius,o,a.angle)),t.getGeometry().setCoordinates([n]),t.get("data").azimuth=o}function I(e,t){A=o(e);var a=A.getFeaturesInExtent(t);if(a&&a.length>0)for(var r=0;r<a.length;r++)if("site"===a[r].get("type")){u(e,a[r].getId());var n=a[r].get("data").cellInfo;if(n&&n.length>0)for(var i=0;i<n.length;i++)p(e,n[i].cellId)}else"cell"===a[r].get("type")&&p(e,a[r].getId())}function S(e){var t=O.get(e.mapId),a=e.isOpen,r=t.getInteractions().item(2),n=e.callback;A=o({mapId:e.mapId,layerId:e.layerId});var i,l=!1;if(a){if(x&&P&&G)return;var s=A.getFeaturesInExtent(e.extent),d=[];if(s&&s.length>0)for(var c=0;c<s.length;c++)"site"===s[c].get("type")&&d.push(s[c]);var g=null;x=t.on("pointerdown",function(e){var a=[];t.forEachFeatureAtPixel(e.pixel,function(e){e&&"siteAndCell"===e.get("businessType")&&(r.setActive(!1),l=!0,a.push(e))}),a.length>0&&(i=a[0]),g=e.coordinate}),P=t.on("pointerdrag",function(t){if(l&&i)for(var a=t.coordinate[0]-g[0],r=t.coordinate[1]-g[1],o=0;o<s.length;o++)if("site"===s[o].get("type")){var n=_.proj.fromLonLat(s[o].get("data").coordinates);s[o].getGeometry().setCoordinates([n[0]+a,n[1]+r]),s[o].set("nowLatlon",[n[0]+a,n[1]+r]);for(var d=s[o].get("data").cellInfo,c=0;c<d.length;c++){var u=A.getFeatureById(d[c].cellId);w(e.mapId,e.layerId,s[o],u)}}else if("cell"===s[o].get("type")){var y,p=s[o].get("data"),m=_.proj.fromLonLat(p.coordinates);"sector"===p.cellType?y=F.createSector(m[0]+a,m[1]+r,p.radius,p.azimuth,p.angle):"arrow"===p.cellType?y=F.createArrow(m[0]+a,m[1]+r,p.radius,p.azimuth,p.angle):"triangle"===p.cellType&&(y=F.createTriangle(m[0]+a,m[1]+r,p.radius,p.azimuth,p.angle)),s[o].getGeometry().setCoordinates([y]),s[o].set("nowLatlon",[m[0]+a,m[1]+r]);var f=A.getFeatureById(s[o].get("data").belongSite);w(e.mapId,e.layerId,f,s[o])}else"line"===s[o].get("type")}),G=t.on("pointerup",function(e){for(var t=e.coordinate[0]-g[0],a=e.coordinate[1]-g[1],o=0;o<s.length;o++)if("site"===s[o].get("type")){var d=_.proj.fromLonLat(s[o].get("data").coordinates);s[o].get("data").coordinates=_.proj.toLonLat([d[0]+t,d[1]+a])}else if("cell"===s[o].get("type")){var c=s[o].get("data"),u=_.proj.fromLonLat(c.coordinates);c.coordinates=_.proj.toLonLat([u[0]+t,u[1]+a])}else if("line"===s[o].get("type")){var y=s[o].get("data").coordinates,p=[[y[0][0]+t,y[0][1]+a],[y[1][0]+t,y[1][1]+a]];s[o].get("data").coordinates=p}r.setActive(!0),l=!1,n(),i=null})}else t.unByKey(x),t.unByKey(P),t.unByKey(G),x=null,P=null,G=null}function b(e){L({mapId:e.mapId,layerId:e.layerId});var t=e.features,a=e.style?e.style:{};A=o({mapId:e.mapId,layerId:e.layerId});var r={strokeColor:"rgba(0,0,0,1)",strokeWidth:2,fillColor:"rgba(255,255,0,0.8)",radius:5};N.mixin(a,r);var n=new _.style.Style({fill:new _.style.Fill({color:a.fillColor}),stroke:new _.style.Stroke({color:a.strokeColor,width:a.strokeWidth})});if(t&&t.length>0)for(var i=0;i<t.length;i++)if("site"===t[i].get("type")){var l=new _.style.Style({image:new _.style.Circle({radius:t[i].get("data").radius,fill:new _.style.Fill({color:a.fillColor}),stroke:new _.style.Stroke({color:a.strokeColor,width:a.strokeWidth})})});t[i].setStyle(l)}else"cell"===t[i].get("type")&&t[i].setStyle(n);A.set("higthLight",t)}function L(e){A=o({mapId:e.mapId,layerId:e.layerId});var t=A.get("higthLight");if(t&&t.length>0)for(var a=0;a<t.length;a++)if("site"===t[a].get("type")){var r=new _.style.Style({image:new _.style.Circle({radius:t[a].get("data").radius,fill:new _.style.Fill({color:t[a].get("data").fillColor}),stroke:new _.style.Stroke({color:t[a].get("data").strokeColor,width:t[a].get("data").strokeWidth})})});t[a].setStyle(r)}else if("cell"===t[a].get("type")){var n=new _.style.Style({fill:new _.style.Fill({color:t[a].get("data").fillColor}),stroke:new _.style.Stroke({color:t[a].get("data").strokeColor,width:t[a].get("data").strokeWidth})});t[a].setStyle(n)}A.set("higthLight",null)}function T(e,t){A=o({mapId:e.mapId,layerId:e.layerId});for(var a=A.getFeatures(),r=t,n=[],i=0;i<a.length;i++)A.removeFeature(a[i]),n.push(a[i].get("data"));r&&"function"==typeof r&&r(n)}function w(e,t,a,r){A=o({mapId:e,layerId:t});var n=A.getFeatureById(r.get("data").cellId+"_line"),i=a.get("nowLatlon")?a.get("nowLatlon"):_.proj.fromLonLat(a.get("data").coordinates),l=r.get("nowLatlon")?r.get("nowLatlon"):_.proj.fromLonLat(r.get("data").coordinates),s=new _.geom.LineString([i,l]);if(n)n.setGeometry(s),n.get("data").coordinates=[i,l];else{var d=new _.style.Style({fill:new _.style.Fill({color:[0,0,0,.8]}),stroke:new _.style.Stroke({color:[0,0,0,.8],width:2})}),c=new _.Feature({geometry:s,businessType:"siteAndCell",type:"line",data:{coordinates:[i,l]}});c.setId(r.get("data").cellId+"_line"),c.setStyle(d),A.addFeature(c)}}function E(e,t,a,r){A=o({mapId:e,layerId:t});var n=A.getFeatureById(r.get("data").cellId+"_line"),i=_.proj.fromLonLat(a.get("data").coordinates),l=_.proj.fromLonLat(r.get("data").coordinates),s=new _.geom.LineString([i,l]);if(n)n.setGeometry(s),n.get("data").coordinates=[i,l];else{var d=new _.style.Style({fill:new _.style.Fill({color:[0,0,0,.8]}),stroke:new _.style.Stroke({color:[0,0,0,.8],width:2})}),c=new _.Feature({geometry:s,businessType:"siteAndCell",type:"line",data:{coordinates:[i,l]}});c.setId(r.get("data").cellId+"_line"),c.setStyle(d),A.addFeature(c)}}var C,k,x,P,_=a(3),O=a(4),M=(a(7),a(5)),N=a(1),F=a(48),A=null,R=null,G=null;e.exports={addSiteAndCell:r,moveFeature:l,moveFeatures:S,addSite:s,addCell:g,deleteSite:u,deleteCell:p,editCell:f,editSite:m,deleteSiteByExtent:I,removeHightLight:L,hightLight:b,refreshLayer:T,siteAndCellLine:E}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=c.getMapObj(e.mapId),r=(a.getView().getZoom(),void 0==e.isShow||e.isShow),o=e.label?e.label:e.layerId;if(!g.containsKey(t)){var n=new d.layer.Vector({
source:new d.source.Vector({wrapX:!1})});n.set("type",u.CUSTOMTYPE.LAYERTYPE),n.set("map",a),n.set("layerId",t),n.set("layer_id",e.layerId),n.set("params.label",o),n.set("isVectorType",!0),n.set("state.showLabel",!!e.showLabel),n.set("businessType",u.BUSINESSTYPE.POLYGON),n.setZIndex(u.Z_INDEX.POLYGON),n.set("multiple",e.multiple),n.set("legendName",e.legendName),n.set("clickId","business_vector_polygon_event_id"),n.set("isShow",r),void 0!=e.minShowLevel&&n.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&n.set("maxShowLevel",parseInt(e.maxShowLevel)),g.put(t,n),a.addLayer(n)}f.addClickCallback(e.mapId,"business_vector_polygon_event_id",function(t){t.layer&&t.layer.get("businessType")===u.BUSINESSTYPE.POLYGON&&t.feature&&t.feature.get("businessType")===u.BUSINESSTYPE.POLYGON?i(t.layer,"click",{mapId:e.mapId,layerId:e.layerId,feature:t.feature}):m.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})},e.layerId)}function o(e){var t=[],a=e.datas,r=y.getLayer(e);if(r.set("legendName",e.legendName),r.set("paramObj",e),e.label&&r.set("params.label",e.label),p.isValid(a)||a.length>0){r.set("state.showLabel",!0);var o=r.getSource();a.forEach(function(a){var r=a.coordinates,o=new d.geom.Polygon([r]),n=d.extent.getCenter(o.getExtent()),i=new d.Feature({geometry:o.transform(u.PROJ.EPSG_4326,u.PROJ.EPSG_3857),labelPoint:d.proj.fromLonLat(n),businessType:u.BUSINESSTYPE.POLYGON,data:a,layerId:e.layerId,mapId:e.mapId});i.setId(a.id);var l=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth?a.strokeWidth:0}),text:new d.style.Text({text:a.label?a.label:"",fill:new d.style.Fill({color:a.labelFillColor||"black"}),font:"normal 14px Arial",stroke:new d.style.Stroke({color:"#ffffff",width:3})})}),s=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth?a.strokeWidth:0})});i.setStyle(l),i.set("defaultStyle",l),i.set("shapeStyle",s),i.set("state.showLabel",!0),t.push(i)}),o.addFeatures(t)}}function n(e){var t=[],a=e.datas,r=y.getLayer(e);if(e.label&&r.set("params.label",e.label),p.isValid(a)||a.length>0){r.set("state.showLabel",!0);var o=r.getSource();a.forEach(function(a){var r=a.coordinates,o=void 0!==a.strokeWidth?a.strokeWidth:0,n=new d.geom.Polygon([r]),i=d.extent.getCenter(n.getExtent()),l={fillColor:a.fillColor?a.fillColor:"rgba(255,0,255,0.3)",strokeColor:"black",strokeWidth:o,labelFillColor:a.labelFillColor||"black",labelStrokeColor:a.labelStrokeColor||"#ffffff"},s=new d.Feature({geometry:n.transform(u.PROJ.EPSG_4326,u.PROJ.EPSG_3857),labelPoint:d.proj.fromLonLat(i),businessType:u.BUSINESSTYPE.POLYGON,data:a,layerId:e.layerId,mapId:e.mapId,select:a.hightLight?a.hightLight:l});s.setId(a.id);var c=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth?a.strokeWidth:0}),text:new d.style.Text({text:a.label?a.label:"",fill:new d.style.Fill({color:a.labelFillColor||"black"}),font:"normal 14px Arial",stroke:new d.style.Stroke({color:"#ffffff",width:3})})}),g=new d.style.Style({fill:new d.style.Fill({color:a.fillColor||"rgba(0,0,0,0)"}),stroke:new d.style.Stroke({color:a.strokeColor||"#000",width:a.strokeWidth?a.strokeWidth:0})});s.setStyle(c),s.set("defaultStyle",c),s.set("shapeStyle",g),s.set("state.showLabel",!0),t.push(s)}),o.addFeatures(t)}}function i(e,t,a){var r=e.get("map"),o=r.getTarget(),n=e.get("layer_id"),i=e.get("businessType");m.removeHighlight({mapId:o,layerId:n,hTypes:["click"]});var l=m.getHLayer({mapId:o,layerId:n});if(t===u.HTYPE.CLICK){if(a.feature){var s=a.feature,c=a.feature.get("select");s=s.clone();var g=new d.style.Style({fill:new d.style.Fill({color:c.fillColor}),stroke:new d.style.Stroke({width:c.strokeWidth,color:c.strokeColor})});s.setStyle(g),s.setId(a.geoId),s.set("mapId",o),s.set("layerId",n),s.set("layerType",i),s.set("hType",t);var y=s;y=p.compact(y),l.getSource().addFeature(y)}}else if(t===u.HTYPE.VECTOR){var f=a.geoIds.map(function(r){var l=e.getSource().getFeatureById(r),s=l.get("select");if(l){l=l.clone();var c=new d.style.Style({fill:new d.style.Fill({color:s.fillColor}),stroke:new d.style.Stroke({width:s.strokeWidth,color:s.strokeColor})});return l.setStyle(c),l.setId(a.geoId),l.set("mapId",o),l.set("layerId",n),l.set("layerType",i),l.set("hType",t),l}});f=p.compact(f),l.getSource().addFeatures(f)}}function l(e,t){var a=y.getLayer({mapId:e.mapId,layerId:e.layerId});if(!a&&"POLYGON"!==e.sourceLayerType)return void t();var r,o=a.getSource().getFeatureById(e.geoId).getGeometry(),n=o.getCoordinates()[0],i=(n[0][0]-e.targetPoint[0])*(n[0][0]-e.targetPoint[0])+(n[0][1]-e.targetPoint[1])*(n[0][1]-e.targetPoint[1]),l=0;n.forEach(function(t,a){l=(t[0]-e.targetPoint[0])*(t[0]-e.targetPoint[0])+(t[1]-e.targetPoint[1])*(t[1]-e.targetPoint[1]),i>l&&(i=l,r=a)}),t(n[r])}function s(e){var t=y.getLayer(e);if(t){var a=t.get("state.showLabel"),r=t.getSource().getFeatures().slice(0);r.forEach(function(t){e.showLabel&&!a?t.setStyle(t.get("defaultStyle")):!e.showLabel&&a&&t.setStyle(t.get("shapeStyle"))}),t.set("state.showLabel",!!e.showLabel)}}var d=a(3),c=a(6),g=a(4),u=a(7),y=a(41),p=a(1),m=a(43),f=(a(16),a(11));e.exports={addLayer:r,appendLayerData:n,setLayerData:o,highlight:i,getLineLonLat:l,setShowLabel:s}},function(e,t,a){function r(e,t,a){var r=e.get("map"),i=r.getTarget(),l=e.get("layer_id"),s=e.get("businessType");u.removeHighlight({mapId:i,layerId:l,hTypes:["click"]}),t===d.HTYPE.CLICK?o(i,l,s,t,a):t===d.HTYPE.VECTOR&&n(i,l,s,t,a,e)}function o(e,t,a,r,o){var n,l,s=o.geometry,d=50,c=[];l=o.lonLat[0]-d/2,n=o.lonLat[0]+d/2,c.push([l,s[1]]),c.push([n,s[1]]),c.push([n,s[3]]),c.push([l,s[3]]);var g=new i.Feature({geometry:new i.geom.Polygon([c]),mapId:e,layerId:t,layerType:a,hType:r}),y=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});g.setStyle(y);var p=u.getHLayer({mapId:e,layerId:t});p.getSource().addFeature(g)}function n(e,t,a,r,o,n){var l=[];o.coordinates.forEach(function(e){l.push({x:e[0],y:e[1]})}),g.postJSON({url:d.GisRootUrl+"/gridManager/queryGridInfo?cacheKey="+n.get("imgToken"),data:JSON.stringify({points:l,imgToken:n.get("imgToken")}),success:function(o){if(o&&(o=JSON.parse(o),1===o.status.code&&o.data&&o.data.length)){var n=o.data.map(function(o){var n,l,s=o.geometry,d=50,c=[];l=o.centerPoint[0]-d/2,n=o.centerPoint[0]+d/2,c.push([l,s[1]]),c.push([n,s[1]]),c.push([n,s[3]]),c.push([l,s[3]]);var g=new i.Feature({geometry:new i.geom.Polygon([c]),mapId:e,layerId:t,layerType:a,hType:r}),u=new i.style.Style({stroke:new i.style.Stroke({width:2,color:"black"})});return g.setStyle(u),g}),l=u.getHLayer({mapId:e,layerId:t});l.getSource().addFeatures(n)}},failure:function(e){}})}var i=a(3),l=a(8),s=a(4),d=a(7),c=a(41),g=a(14),u=a(43),y=a(11),p=a(6),m=a(5),f=function(e){var t=e.layerId+"_"+e.mapId,a=s.get(e.mapId),o=(a.getView().getZoom(),null);if(s.containsKey(t))o=s.get(t);else{o=new i.layer.Tile({source:new i.source.TileWMS({wrapX:!1})});var n=new i.layer.Image({source:new i.source.ImageWMS({wrapX:!1})});o.set("imageLayer",n),o.setZIndex(d.Z_INDEX.GRID),o.set("type",d.CUSTOMTYPE.LAYERTILETYPE),o.set("isVectorType",!1),o.set("businessType",d.BUSINESSTYPE.GRID),o.set("params.label",e.label),o.set("layerId",t),o.set("map",a),o.set("layer_id",e.layerId),e.multiple&&o.set("multiple",e.multiple),s.put(t,o),a.addLayer(o)}void 0!=e.minShowLevel&&o.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&o.set("maxShowLevel",parseInt(e.maxShowLevel)),o.set("clickId","business_Dgrid_event_id"),y.addClickCallback(e.mapId,"business_Dgrid_event_id",function(t){var a=m.getLayer({mapId:e.mapId,layerId:e.layerId});if(a&&8!==a.get("gridType")){var o=(p.getMapObj(e.mapId),t.transportDataToInnerLayer);o?o&&o.length>0&&r(a,"click",o[0]):u.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)},v=function(e){var t=e.imgTokenParam,a=e.imgToken,r=e.mapId,o=e.layerId,n=e.gridType?e.gridType:void 0,l=e.layers?e.layers:void 0,s=!e.ISSOLIDGRID||e.ISSOLIDGRID,g=p.getMapObj(r),u=c.getLayer({mapId:r,layerId:o});if(u){var y;e.label&&u.set("label",e.label),8===n||s===!1?(y=new i.source.ImageWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:n,LAYERS:l,IMGTOKEN:a,VERSION:"1.1.1",ISSOLIDGRID:s,cacheKey:a},wrapX:!1}),g.addLayer(u.get("imageLayer")),u.get("imageLayer").setSource(y),u.set("imgToken",a),u.set("gridType",n),u.set("imgTokenParam",t)):(y=new i.source.TileWMS({url:d.GisRootUrl+"/gridManager/export",params:{GRIDTYPE:n,LAYERS:l,IMGTOKEN:a,VERSION:"1.1.1",ISSOLIDGRID:s,cacheKey:a},wrapX:!1}),g.addLayer(u),u.setSource(y),u.set("imgToken",a),u.set("gridType",n),u.set("imgTokenParam",t)),u.set("paramObj",e)}},h=function(e,t,a,r){var o=l.getExtent(e.getTarget()),n=t.get("paramObj"),i={geometry:{x:a.coordinate[0],y:a.coordinate[1]},tolerance:void 0!=n&&void 0!=n.tolerance?n.tolerance:1,mapExtent:o,imgToken:t.get("imgToken")};g.postJSON({url:d.GisRootUrl+"/gridManager/getGridInfo?cacheKey="+t.get("imgToken"),data:JSON.stringify(i),success:function(a){var o=JSON.parse(a),n=o.status,i=o.data&&o.data.length>0&&o.data[0];1===n.code&&i?r&&"function"==typeof r&&r([{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:i.centerPoint,geometry:i.geometry,extentInfo:i.extentInfo,geoId:i.id,geoName:i.name}]):r([])},failure:function(e){r([])}})};e.exports={addLayer:f,setLayerData:v,getClickData:h,highlight:r}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=g.get(e.mapId),r=(a.getView().getZoom(),null);g.containsKey(t)?r=g.get(t):(r=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})}),e.multiple&&r.set("multiple",e.multiple),r.setZIndex(u.Z_INDEX.CELL),r.set("type",u.CUSTOMTYPE.LAYERIMGTYPE),r.set("isVectorType",!1),r.set("businessType","DCELL"),r.set("params.label",e.label),r.set("state.showLabel",!!e.showLabel),r.set("layerId",t),r.set("map",a),r.set("layer_id",e.layerId),g.put(t,r),a.addLayer(r)),void 0!=e.minShowLevel&&r.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&r.set("maxShowLevel",parseInt(e.maxShowLevel)),r.set("clickId","business_Dservice_cell_event_id"),v.addClickCallback(e.mapId,"business_Dservice_cell_event_id",function(t){if(t.layer&&"DCELL"===t.layer.get("businessType")){var a=(h.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&i(t.layer,"click",a[0]):f.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)}function o(e){var t=y.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("imgToken",e.imgToken),t.set("imgTokenLabel",e.imgTokenLabel),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("paramObj",e),e.label&&t.set("params.label",e.label),t.set("state.showLabel",!!e.showLabel);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=void 0!=a?a.slice(0,a.indexOf(":")):void 0,o={VERSION:"1.1.1",imgToken:a,FCName:r};t&&(t.getSource().setUrl(u.GisRootUrl+"/common/mapRender/export"),t.getSource().updateParams(o))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o,n,i,l;if(a.coordinate){l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),n=e.getView().calculateExtent(e.getSize()).join(","),i=t.get("params.imgToken");var s=i.slice(0,i.indexOf(":")),d=t.get("paramObj"),c={geometry:l,tolerance:void 0!=d&&void 0!=d.tolerance?d.tolerance:.1,mapExtent:n,imgToken:i,FCName:s};o=u.GisRootUrl+"common/mapRender/identify"}m.get({url:o,data:p.getParameterString(c),success:function(o){if(!o)return void r([]);if(o=JSON.parse(o),!o||!o.data||!o.data.length)return void r([]);var n=p.sortBy(o.data,function(e){return"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=2*e.extentInfo.radius),Number(e.extentInfo.radius)}),i=n[0].extentInfo.radius;n=n.filter(function(e){return e.extentInfo.radius===i}),n.forEach(function(e){"0"===e.extentInfo.isDirect&&(e.extentInfo.radius=e.extentInfo.radius/2)});var l=n.map(function(r){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.coordinate,geometry:r.geometry,extentInfo:r.extentInfo,geoId:r.id,geoName:r.name}});r(l)},failure:function(e){r([])}})}function i(e,t,a,r){var o,n=e.get("map"),i=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(f.removeHighlight({mapId:i,layerId:s,hTypes:["click"]}),t===u.HTYPE.CLICK){var g=JSON.parse(a.geometry),y=new c.geom.LineString(g);o=new c.Feature({geometry:new c.geom.Polygon([y.getCoordinates()]),mapId:i,layerId:s,layerType:d,hType:t});var p=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});o.setStyle(p);var m=f.getHLayer({mapId:i,layerId:s});m.getSource().addFeature(o)}else t===u.HTYPE.VECTOR&&l(e,a,function(e){if(e){var a=[],n=new c.style.Style({stroke:new c.style.Stroke({width:2,color:"black"})});e.map(function(e){o=new c.Feature({geometry:new c.geom.Polygon([JSON.parse(e.geometry)]),mapId:i,layerId:s,layerType:d,hType:t}),o.setStyle(n),a.push(o)});var l=f.getHLayer({mapId:i,layerId:s});l.getSource().addFeatures(a),r&&r(e)}})}function l(e,t,a){var r=e.get("params.imgToken"),o=void 0!=r?r.slice(0,r.indexOf(":")):void 0,n=u.GisRootUrl+"/common/mapRender/query?FCName="+o;m.postJSON({url:n,data:JSON.stringify({idValue:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){a(null)}})}function s(e,t){var a,r=y.getLayer({mapId:e.mapId,layerId:e.layerId});return r?void l(r,{geoIds:[e.geoId]},function(e){e&&(a=e,t(a))}):void t()}function d(e){var t=y.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),g=a(4),u=a(7),y=a(41),p=a(1),m=a(14),f=a(43),v=a(11),h=a(6);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:i,getLineLonLat:s,setShowLabel:d}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=g.getMapObj(e.mapId);a.getView().getZoom();if(!u.containsKey(t)){var r=new c.layer.Image({source:new c.source.ImageWMS({params:{VERSION:"1.1.1"},wrapX:!1})});r.setZIndex(y.Z_INDEX.SITE),r.set("type",y.CUSTOMTYPE.LAYERIMGTYPE),r.set("isVectorType",!1),r.set("businessType",y.BUSINESSTYPE.SITE),r.set("params.label",e.label),r.set("state.showLabel",!!e.showLabel),r.set("layerId",t),r.set("map",a),r.set("layer_id",e.layerId),r.set("multiple",e.multiple),r.set("clickId","business_Dservice_site_event_id"),void 0!=e.minShowLevel&&_layer.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&_layer.set("maxShowLevel",parseInt(e.maxShowLevel)),u.put(t,r),a.addLayer(r)}h.addClickCallback(e.mapId,"business_Dservice_site_event_id",function(t){if(t.layer&&t.layer.get("businessType")===y.BUSINESSTYPE.SITE){var a=(g.getMapObj(e.mapId),t.transportDataToInnerLayer);a?a&&a.length>0&&i(t.layer,"click",a[0]):v.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}},e.layerId)}function o(e){var t=p.getLayer(e);t.set("params.imgToken",e.imgToken),t.set("params.imgTokenLabel",e.imgTokenLabel),t.set("state.showLabel",!!e.showLabel),t.set("paramObj",e),e.label&&t.set("params.label",e.label);var a=e.showLabel?e.imgTokenLabel:e.imgToken,r=a.slice(0,a.indexOf(":")),o={VERSION:"1.1.1",imgToken:a,Fcname:r};t&&(t.getSource().setUrl(y.GisRootUrl+"/common/mapRender/export"),t.getSource().updateParams(o))}function n(e,t,a,r){if(!t.getVisible())return void r([]);var o=t.get("params.imgToken"),n=void 0!=o?o.slice(0,o.indexOf(":")):void 0,i=y.GisRootUrl+"/common/mapRender/identify",l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),s=e.getView().calculateExtent(e.getSize()).join(","),d=t.get("paramObj"),c={geometry:l,tolerance:void 0!=d&&void 0!=d.tolerance?d.tolerance:1,mapExtent:s,imgToken:o,FCName:n};f.get({url:i,data:m.getParameterString(c),success:function(o){if(!o)return void r([]);if(o=JSON.parse(o),!o||!o.data||!o.data.length)return void r([]);var n=o.data,i=n.map(function(r){return{mapId:e.getTarget(),layerId:t.get("layer_id"),layerType:t.get("businessType"),label:t.get("params.label"),lonLat:a.coordinate,geometry:r.geometry,geoId:r.id,geoName:r.name}});r(i)},failure:function(e){r([])}})}function i(e,t,a,r){var o,n=e.get("map"),i=n.getTarget(),s=e.get("layer_id"),d=e.get("businessType");if(v.removeHighlight({mapId:i,layerId:s}),t===y.HTYPE.CLICK){var g=a.geometry;o=new c.Feature({geometry:new c.geom.Point(g),mapId:i,layerId:s,layerType:d,hType:t});var u=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(u);var p=v.getHLayer({mapId:i,layerId:s});p.getSource().addFeature(o)}else t===y.HTYPE.VECTOR&&l(e,a,function(e){var a;if(e){a=e[0].geometry,o=new c.Feature({geometry:new c.geom.Point(a),mapId:i,layerId:s,layerType:d,hType:t});var n=new c.style.Style({image:new c.style.Circle({stroke:new c.style.Stroke({width:2,color:"#000"}),radius:5})});o.setStyle(n);var l=v.getHLayer({mapId:i,layerId:s});l.getSource().addFeature(o),r&&r(e)}})}function l(e,t,a){var r=e.get("params.imgToken"),o=void 0!=r?r.slice(0,r.indexOf(":")):void 0,n=y.GisRootUrl+"/common/mapRender/query?FCName="+o;f.postJSON({url:n,data:JSON.stringify({id:t.geoIds,imgToken:r}),success:function(e){var t=JSON.parse(e);a(t&&t.data&&t.data.length?t.data:null)},failure:function(e){a(null)}})}function s(e){var t,a=p.getLayer({mapId:e.mapId,layerId:e.sourceLayerId});if(a)return l(a,{geoIds:e.layerId,imgToken:a.get("params.imgToken")},function(e){e&&(t=e.extentInfo.circleCenter)}),t}function d(e){var t=p.getLayer(e);if(t){var a;a=e.showLabel?t.get("params.imgTokenLabel"):t.get("params.imgToken");var r={VERSION:"1.1.1",imgToken:a};t.set("state.showLabel",!!e.showLabel),t.getSource().updateParams(r)}}var c=a(3),g=a(6),u=a(4),y=a(7),p=a(41),m=a(1),f=a(14),v=a(43),h=a(11);e.exports={addLayer:r,setLayerData:o,getClickData:n,highlight:i,getLineLonLat:s,setShowLabel:d}},function(e,t,a){var r=(a(3),a(7),function(e,t){var t=t,a="";a=void 0!=e.dw?fusiongis.Constant.GisRootUrl+"/mapRender/dw/getImgToken?FCName="+e.fcName:fusiongis.Constant.GisRootUrl+"/common/mapRender/getImgToken?FCName="+e.fcName,fusiongis.OriginalAjax.postJSON({url:a,data:JSON.stringify(e.data),success:function(e){if(e){var a=JSON.parse(e);t&&"function"==typeof t&&t(a)}else t&&"function"==typeof t&&t(null)},failure:function(e){t&&"function"==typeof t&&t(null)}})});e.exports={render:r}},function(e,t,a){var r=(a(3),a(7),function(e,t){var t=t,a={commonParam:e.commonParam,renderParam:{legendInfo:1===e.commonParam.isUserDefinedLegend?e.legendInfo:{}},queryParam:e.queryParam,geoParams:e.geoParams};fusiongis.OriginalAjax.postJSON({url:fusiongis.Constant.GisRootUrl+"/gridManager/getImgToken?FCName="+e.fcName,data:JSON.stringify(a),success:function(e){if(e){var a=JSON.parse(e);t&&"function"==typeof t&&t(a)}},failure:function(e){console.log(e),t&&"function"==typeof t&&t(null)}})});e.exports={getImageToken:r}},function(e,t,a){var r,o,n,i,l,s=a(3),d=a(8),c=a(6),g=function(e,t,a){if("undefined"==typeof google){var r=document.createElement("script"),o="http:";"file:"!==location.protocol&&(o=location.protocol);var n=t||"en-US",i=o+"//maps.google.com/maps/api/js?v=3&language="+n+"&key="+e;document.querySelector("#google-api-load-yet")?r.setAttribute("src","http://www.huawei.com/Assets/CBG/js/Huawei.Personalization.CBG.js?ver=1"):(r.setAttribute("src",i),r.setAttribute("id","google-api-load-yet")),r.onload=function(){a(!0)},r.onerror=function(){a(!1)},document.body.appendChild(r)}else a(!0)},u=function(e,t,a){var r=new google.maps.StreetViewService;r.getPanorama({location:e,radius:t?t:50},function(e,t){t===google.maps.StreetViewStatus.OK&&a(e.location.pano)})},y=function(e,t){o||(o=document.getElementById(e).cloneNode(!1),o.id="sv"+e,document.body.appendChild(o)),m(e,function(a){u(a.latLng,t.radius,function(a){if(r)r.setPano(a);else{p(e,"open",t.style),d.refreshMaps([e]);var n={addressControlOptions:{position:google.maps.ControlPosition.BOTTOM_CENTER},linksControl:!1,panControl:!1,enableCloseButton:!1,pano:a};r=new google.maps.StreetViewPanorama(o,n),1===t.isPanochanged&&f(e)}})})},p=function(e,t,a){var r=document.getElementById(e),n=document.getElementById("$$customMap_"+e),i=r?r.clientWidth:n.clientWidth,l=r?r.clientHeight:n.clientHeight;"open"===t?(n?(n.style.width=Math.ceil(i/2)+"px",n.style.padding="0px",n.style.margin="0px",n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.border="0px"):r&&(r.style.width=Math.ceil(i/2)+"px",r.style.padding="0px",r.style.margin="0px",r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.border="0px"),o.style.width=Math.ceil(i/2)+"px",o.style.height=l+"px",o.style.padding="0px",o.style.margin="0px",o.style.position="absolute",o.style.right="0px",o.style.top="0px",o.style.border="0px"):o&&(document.body.removeChild(o),r.style.width=i+"px",n&&(n.style.width=i+"px"),o=null)},m=function(e,t){var a=c.getMapObj(e);l||(l=new s.layer.Vector({layerName:"street_view",source:new s.source.Vector({wrapX:!1}),opacity:.8,style:new s.style.Style({fill:new s.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new s.style.Stroke({color:"#ff0000",width:2}),image:new s.style.Circle({radius:7,fill:new s.style.Fill({color:"#ff0000"})})})}),a.addLayer(l)),i&&(n&&l.getSource().clear(),a.unByKey(i),i=null),i=a.on("singleclick",function(e){var a=s.proj.toLonLat(e.coordinate);n&&l.getSource().clear(),n=new s.Feature({geometry:new s.geom.Point(e.coordinate),name:"street_view_marker"}),n.setId("street_view_marker");var r=new s.source.Vector({features:[n],wrapX:!1});l.setSource(r),t({latLng:{lat:a[1],lng:a[0]}})}),a.set("clickEventKey",i)},f=function(e){google.maps.event.addListener(r,"position_changed",function(){var t=r.getPosition();v(e,{lng:t.lng(),lat:t.lat()}),d.setMapCenter({mapId:e,coordinate:[t.lng(),t.lat()],opt_projection:"EPSG:3857"})})},v=function(e,t){c.getMapObj(e);if(l){var a=l.getSource().getFeatureById("street_view_marker"),r=a.getGeometry(),o=s.proj.fromLonLat([t.lng,t.lat]);r.setCoordinates(o)}},h=function(e){var t=c.getMapObj(e);r&&(r=null,p(e,"close",void 0),d.refreshMaps([e])),l&&(n=null,t.removeLayer(l),t.unByKey(t.get("clickEventKey")),l=null,i=null)};e.exports={loadGoogleAPI:g,loadGoogleStreetView:y,closeGoogleStreetView:h}},function(e,t,a){var r=a(102),o=a(103),n=a(6);e.exports={measure:function(e){if("geoLine"===e.measureType){if(e.isOpen)return r.measureLine(e);r.clearLastLine(e.mapId)}"geoArea"===e.measureType&&o.measureArea(e)},isMeasuring:function(e){var t=n.getMapObj(e.mapId);if(!t)return!1;var a=e.measureType||"geoLine";return!!t.get("state.measure."+a)}}},function(e,t,a){function r(e){var t=k.getMapObj(e.mapId);if(!t.get("state.drawing")){var a=t.getTarget(),r=L(e.mapId),i=new E.Collection;i.on("change:length",function(t){for(var r=i.getArray(),n=M[a],l=n[n.length-1],s=0;s<r.length;s++)r[s].get("type")||(r[s].set("type",l),r[s].setStyle(o(e)))});var s=t.get("measureLine.Layer");s||(s=new E.layer.Vector({source:new E.source.Vector({features:i,wrapX:!1}),style:new E.style.Style({stroke:new E.style.Stroke({color:"#0099ff",width:3})})}),s.setMap(t),s.set("layer_id","measure-line-layer-id"),t.set("measureLine.Layer",s)),b(e.mapId,r),n(e,t,s,r),fusiongis.Events.addClickCallback(a,"measure-distance-click-event",function(o){var n=o.e,i=!0;e.clickCallback&&(i=e.clickCallback({mapId:a,coordinate:n.coordinate})),i!==!1&&(I(n,t,r),l(n.coordinate,t,r,e))},"measure-line-layer-id")}}function o(e){return new E.style.Style({stroke:new E.style.Stroke({color:e.strokeColor||"#0099ff",width:e.strokeWidth||3})})}function n(e,t,a,r){var o=t.getTarget();t.set("state.drawing",!0),t.set("state.measure.geoLine",!0);var n=x.getIntactByName(o,R);n?n.setActive(!0):(n=new E.interaction.Draw({clickTolerance:1e-11,snapTolerance:1e-8,source:a.getSource(),type:"LineString"}),n.set("name",R),t.addInteraction(n)),f(t,r);var l=null,s=n.on("drawstart",function(e){var a=e.feature;t.set("measureLine.drawLineSketch",a),i(e.feature.getGeometry().getCoordinates()[0],t,r);var o=a.getGeometry().on("change",function(e){h(e,t,r),l=S(e.target)});t.set("measureLine.sketchChange",o)}),g=n.on("drawend",function(a){fusiongis.Events.removeClickCallback(o,"measure-distance-click-event");var i=a.feature.getGeometry().getCoordinates();d(i[i.length-1],t,r),v(o,r),p(o,n),"0 m"===l&&(c(t,r),l=null),setTimeout(function(){n.setActive(!1),t.set("state.drawing",!1),t.set("state.measure.geoLine",!1),e.endCallback&&e.endCallback({mapId:o,coordinates:i})},0)});t.set("measureLine.drawStart",s),t.set("measureLine.drawEnd",g)}function i(e,t,a){var r=document.createElement("div");r.className="measure-tooltip mile",r.style.zIndex=x.getPopupZIndex(t.getTarget()),r.innerHTML=_.prop("measure.message.start");var o=new E.Overlay({element:r,offset:A});o.set("type",a),o.setPosition(e),t.addOverlay(o)}function l(e,t,a,r){var o=x.getIntactByName(t.getTarget(),R);if(o.getActive()){var n=t.get("measureLine.PointLayer");n||(n=new E.layer.Vector({source:new E.source.Vector({wrapX:!1}),layerId:"point"}),t.set("measureLine.PointLayer",n)),n.setMap(t);var i=new E.Feature(new E.geom.Point(e));i.set("type",a),i.setStyle(s(r)),n.getSource().addFeature(i)}}function s(e){return new E.style.Style({image:new E.style.Circle({radius:e.pointRadius||4,fill:new E.style.Fill({color:e.pointFillColor||"#ffffff"}),stroke:new E.style.Stroke({color:e.pointStrokeColor||"#0099ff",width:e.pointStrokeWidth||2})})})}function d(e,t,a){var r=document.createElement("div");r.className="measure-close",r.style.zIndex=x.getPopupZIndex(t.getTarget());var o=new E.Overlay({element:r,offset:A});o.set("type",a),o.setPosition(e),t.addOverlay(o),P.on(r,"click",function(){c(t,a)})}function c(e,t){u(e,t),g(e,t),m(e,t)}function g(e,t){var a=e.get("measureLine.Layer");a&&x.delFeatureByType(a.getSource(),t)}function u(e,t){var a=e.getTarget(),r=e.getOverlays().getArray().slice(0);if(r.forEach(function(a){var r=a.get("type");r&&r===t&&e.removeOverlay(a)}),M[a]){var o=M[a].indexOf(t);o>-1&&M[a].splice(o,1)}N[a]&&N[a][t]&&N[a][t].splice(0)}function y(e){var t=x.getIntactByName(e,R);if(t){var a=C.last(M[e]),r=k.getMapObj(e);c(r,a),p(e,t),r.get("state.drawing")&&(t.setActive(!1),r.set("state.drawing",!1),r.set("state.measure.geoLine",!1),r.set("measureLine.drawLineSketch",null))}}function p(e,t){var a=k.getMapObj(e);E.Observable.unByKey(a.get("measureLine.sketchChange")),t.unByKey(a.get("measureLine.drawStart")),t.unByKey(a.get("measureLine.drawEnd"))}function m(e,t){var a=e.get("measureLine.PointLayer");a&&x.delFeatureByType(a.getSource(),t)}function f(e,t){var a=document.createElement("div");a.innerHTML=_.prop("measure.message.startHelper"),a.className="measure-tooltip";var r=new E.Overlay({element:a,offset:A,positioning:"center-left"});r.set("type",t),r.set("name",t+"_helpTooltip"),e.addOverlay(r),a.parentNode.style.zIndex=x.getPopupZIndex(e.getTarget())+100}function v(e,t){var a=x.getOverlayByName(e,t+"_helpTooltip"),r=a.get("element");a.setOffset([-7,-30]);var o=r.innerHTML,n=o.indexOf("<br>");o=o.slice(0,n),r.innerHTML=o,r.parentNode.style.zIndex=x.getPopupZIndex(e);var i=C.last(N[e][t]);if(void 0!==i){var l=x.getOverlayByName(e,i);k.getMapObj(e).removeOverlay(l)}}function h(e,t,a){var r=e.target,o=t.getTarget(),n=S(r),i=r.getLastCoordinate(),l=x.getOverlayByName(o,a+"_helpTooltip");l.get("element").innerHTML=function(e){var t=_.prop("measure.message.total")+e;return t=t+"<br>"+_.prop("measure.message.helper")}(n),l.setPosition(i)}function I(e,t,a){var r=document.createElement("div");r.className="measure-tooltip mile";var o=t.get("measureLine.drawLineSketch");if(o){var n=o.getGeometry(),i=S(n);if("0"===i.slice(0,1))return;r.innerHTML=i,r.style.zIndex=x.getPopupZIndex(t.getTarget()),r.setAttribute("actId",a);var l=new E.Overlay({element:r,offset:A,positioning:"bottom-center"});l.set("type",a),l.set("name",T(t.getTarget(),a)),l.setPosition(e.coordinate),t.addOverlay(l)}}function S(e){var t,a=e.getCoordinates();t=0;for(var r=0,o=a.length-1;r<o;++r){var n=E.proj.toLonLat(a[r]),i=E.proj.toLonLat(a[r+1]);t+=O.haversineDistance(n,i)}var l;return l=t>1e3?Math.round(t/1e3*1e3)/1e3+" km":Math.round(1e3*t)/1e3+" m"}function b(e,t){N[e]||(N[e]={}),N[e][t]||(N[e][t]=[])}function L(e){var t=w("measure_act_");return M[e]||(M[e]=[]),M[e].push(t),t}function T(e,t){var a=w("measure_ov_");return N[e][t].push(a),a}function w(e){var t=e+F;return F+=1,t}var E=a(3),C=a(1),k=a(6),x=a(16),P=a(10),_=a(13),O=new E.Sphere(6378137),M={},N={},F=1,A=[3,-1],R="distanceMeasure";e.exports={measureLine:r,clearLastLine:y}},function(e,t,a){function r(e,t){var a=n(e);a.set("state.drawing",t),a.set("state.measure.geoArea",t)}function o(e){var t=n(e);return t.get("state.drawing")}function n(e){return w.getMapObj(e)}function i(e){var t=O.uniqueId("measureArea_act_");return P[e]||(P[e]=[]),P[e].push(t),t}function l(e){var t=e.mapId,a=n(t);if(a&&!o(t)){var l=i(t),c=d(t),g=s(t,l,c);g.setActive(!0);var u=a.on("pointermove",function(a){y(t,a,e)});return a.set("KEYS.MEASURE_AREA_PMOVE",u),r(t,!0),l}}function s(e,t,a){var r=n(e);if(r){c(e,t);var o=E.getIntactByName(e,"areaMeasure");return o||(o=new L.interaction.Draw({type:"Polygon"}),o.set("name","areaMeasure"),o.on("drawend",function(t){m(t,e,o);var a=t.feature.getGeometry().getCoordinates()[0];a.pop(a[a.length-1]);var r=a.slice(1),n=!1;if(r.length>1)for(var i=0;i<r.length-1;i++)r[i][0]===r[i+1][0]&&r[i][1]===r[1][1]||(n=!0);n&&d(e).getSource().addFeature(t.feature)}),o.on("drawstart",function(e){o.set("STATE.MEASURE.START",!0)}),r.addInteraction(o)),o.set("actId",t),o}}function d(e){var t=E.getLayer({mapId:e,layerId:"measureArea"});return t||(t=new L.layer.Vector({layerId:"measureArea",source:new L.source.Vector({wrapX:!1}),style:new L.style.Style({stroke:new L.style.Stroke({color:"#0099ff",width:3})})}),n(e).addLayer(t)),t}function c(e,t){var a=document.createElement("div");a.className="measure-tooltip",a.innerHTML=k.prop("measure.message.startHelper");var r=new L.Overlay({element:a,offset:[120,85],positioning:"bottom-center"});r.set("type",t),r.set("name",t+"_helper"),n(e).addOverlay(r),a.parentNode.style.zIndex=E.getPopupZIndex(e)}function g(e,t){var a=E.getOverlayByName(e,t+"_helper"),r=a.get("element");a.setOffset([-7,-10]);var o=r.innerHTML,n=o.indexOf("<br>");o=o.slice(0,n),r.innerHTML=o}function u(e,t){var a=E.getIntactByName(e,"areaMeasure"),r=document.createElement("div");r.className="measure-close",C.on(r,"click",function(){h(e,t)});var o=new L.Overlay({element:r,offset:[15,6],positioning:"bottom-center"});o.set("name",t+"_close"),o.set("type",t),n(e).addOverlay(o);var i=O.getSketchCoords(a),l=i[i.length-2];o.setPosition(l)}function y(e,t,a){if(!t.dragging){var r=E.getIntactByName(e,"areaMeasure");if(r){var o=O.last(P[e]),n=E.getOverlayByName(e,o+"_helper"),i=n.get("element");n.setPosition(t.coordinate),r.getActive()===!1&&r.setActive(!0);var l=O.getSketchFeature(r);if(l){l.getStyle()||l.setStyle(p(a));var s=l.getGeometry(),d=f(s);r.set("measureOutput",d),i.innerHTML=v(d)}}}}function p(e){return new L.style.Style({stroke:new L.style.Stroke({color:e.strokeColor||"#0099ff",width:e.strokeWidth||3})})}function m(e,t,a,o){var i=a.get("actId");g(t,i),u(t,i);var l=n(t).get("KEYS.MEASURE_AREA_PMOVE");l&&n(t).unByKey(l),e.feature.set("type",i),o&&o(t,i);var s=a.get("measureOutput"),d="0 m<sup>2</sup>";s===d&&S(t,i),setTimeout(function(){r(t,!1),a.setActive(!1)},0)}function f(e){var t,a=e.clone().transform("EPSG:3857","EPSG:4326"),r=a.getLinearRing(0).getCoordinates();t=Math.abs(_.geodesicArea(r));var o;return o=t>1e6?Math.round(t/1e6*100)/100+" km<sup>2</sup>":Math.round(100*t)/100+" m<sup>2</sup>"}function v(e){var t=k.prop("measureArea.message.total")+e;return t=t+"<br>"+k.prop("measure.message.helper")}function h(e,t){I(e,t),S(e,t)}function I(e,t){var a=E.getLayer({mapId:e,layerId:"measureArea"});a&&E.delFeatureByType(a.getSource(),t);
}function S(e,t){var a=n(e),r=a.getOverlays().getArray().slice(0);if(r.forEach(function(e){var r=e.get("type");r&&r===t&&a.removeOverlay(e)}),P[e]){var o=P[e].indexOf(t);o>-1&&P[e].splice(o,1)}}function b(e){if(e.isOpen)return l(e)}var L=a(3),T=a(1),w=a(6),E=a(16),C=a(10),k=a(13),x=1,P={},_=new L.Sphere(6378137),O={isNull:function(e){return null===e},last:function(e){if(e)return e[e.length-1]},uniqueId:function(e){var t=e+x;return x+=1,t},getSketchCoords:function(e){var t;for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];T.isArray(r)&&r.length>0&&T.isArray(r[0])&&(t=r)}return t},getSketchFeature:function(e){var t;for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];r instanceof L.Feature&&r.getGeometry()&&r.getGeometry()instanceof L.geom.Polygon&&(t=r)}return t}};e.exports={measureArea:b}},function(e,t,a){function r(e,t){var a=Math.sqrt(Math.pow(e,2)/(1+Math.pow(e,2)));return 360>=360-t&&360-t>=180&&(a=-a),a}function o(e,t){var a=Math.sqrt(1/(1+Math.pow(e,2)));return 270>=360-t&&360-t>=90&&(a=-a),a}function n(e,t,a,n){var i=e,s=t,d=i[0]-s[0],c=i[1]-s[1],g=v.proj.toLonLat(s),u=v.proj.fromLonLat([180,g[1]]),y=new v.geom.LineString([u,s,i]),p=l(y),m=c/d,f=r(m,p),h=o(m,p),I=a*f*.25,S=a*h*.25;n.push([s[0]+S,s[1]+I])}function i(e){var t=Math.PI*e/180;return t}function l(e){var t,a=e.getCoordinates(),r=a.length-1;if(!(r<2)){var o=v.proj.toLonLat(a[0]),n=v.proj.toLonLat(a[1]),l=v.proj.toLonLat(a[2]),s=i(o[1]-n[1])*i(l[0]-n[0])-i(l[1]-n[1])*i(o[0]-n[0]),d=i(o[1]-n[1])*i(l[1]-n[1])+i(o[0]-n[0])*i(l[0]-n[0]),c=Math.atan2(s,d)*(180/Math.PI);return c<0?360+c:c}return t=0}function s(e){var t=e.getCoordinates(),a=t.slice(0,2),r=t.slice(1),o=new v.geom.LineString(a),n=new v.geom.LineString(r),i=o.getLength(),l=n.getLength();return i<=l?i:l}function d(e,t,a){var r=document.createElement("div");r.className="measure-close";var o=new v.Overlay({element:r,offset:[0,-7]});r.id=T,o.tag=T,o.setPosition(a),h.getMapObj(e).addOverlay(o);var n=T;$(".measure-close").on("click",function(){Number(this.id)===n&&c(e,t,n)})}function c(e,t,a){g(t,a),u(e,a)}function g(e,t){for(var a=e.getSource().getFeatures(),r=0;r<a.length;r++)a[r].tag==t&&e.getSource().removeFeature(a[r])}function u(e,t){var a=h.getMapObj(e).getOverlays().getArray().slice(0);a.forEach(function(a){a.tag!=t&&a.get("name")!==t||h.getMapObj(e).removeOverlay(a)})}function y(e,t){var a=document.createElement("div");a.innerHTML=b.prop("measure.message.startHelper"),a.className="measure-tooltip";var r=new v.Overlay({element:a,offset:[5,-1],positioning:"center-left"});r.set("type",t),r.set("name",t+"_helpTooltip"),e.addOverlay(r),a.parentNode.style.zIndex=L.getPopupZIndex(e.getTarget())+100}function p(e,t,a){var r=e.target,o=t.getTarget(),n=e.target,i=!isNaN(l(n))&&l(n).toFixed(2),s=r.getLastCoordinate(),d=L.getOverlayByName(o,a+"_helpTooltip");d&&(d.get("element").innerHTML=function(e){var t=b.prop("measure.angle.now")+e;return t=t+"<br>"+b.prop("measure.message.helper")}(i+"°"),d.setPosition(s))}function m(e){var t="measure_act_"+w;return w+=1,t}function f(e,t){var a=null,r=null,o=null,i=null,g=null;t||(t="#0099ff");var f=h.getMapObj(e);if(!f.get("state.drawing")){var b=f.getInteractions(),L=m();if(b.forEach(function(e){"have"==e.get("measureAngle")&&(i="have",g=e)}),"have"===i)return g.setActive(!0),f.set("state.drawing",!0),void f.set("state.measure.geoAngle",!0);var w=new v.Collection;w.on("change:length",function(e){var t=w.getArray();t[t.length-1].tag=T});var E=h.getMapObj(e);a=new v.source.Vector({wrapX:!1}),r=new v.layer.Vector({source:a,style:new v.style.Style({fill:new v.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new v.style.Stroke({color:t,width:2}),image:new v.style.Circle({radius:7,fill:new v.style.Fill({color:"#0099ff"})})})}),f.set("state.drawing",!0),f.set("state.measure.geoAngle",!0),o=new v.interaction.Draw({minPoints:3,source:a,features:w,type:"LineString",style:new v.style.Style({fill:new v.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new v.style.Stroke({color:t,width:2}),image:new v.style.Circle({radius:5,stroke:new v.style.Stroke({color:t}),fill:new v.style.Fill({color:"#0099ff"})})})}),o.set("measureAngle","have"),E.addInteraction(o),E.addLayer(r),y(f,L),o.on("drawstart",function(e){var t=e.feature;f.set("measureDistance.drawLineSketch",t);var a=t.getGeometry().on("change",function(e){p(e,f,L)});f.set("measureDistance.sketchChange",a)}),o.on("drawend",function(i){u(e,L+"_helpTooltip"),T+=1;var g=i.feature,y=g.getGeometry(),p=y.getCoordinates().slice(0,3);i.feature.getGeometry().setCoordinates(p);var m=l(y);d(e,r,i.feature.getGeometry().getLastCoordinate());var h,b=y.getCoordinates(),w=b[0],C=b[1],k=b[2],x=w[0]-C[0],P=w[1]-C[1],_=k[0]-C[0],O=k[1]-C[1],M=Math.sqrt(Math.pow(x,2)+Math.pow(P,2)),N=Math.sqrt(Math.pow(_,2)+Math.pow(O,2));if(h=M>=N?N:M,0!==h){var F=v.proj.toLonLat(C),A=v.proj.fromLonLat([F[0],85]),R=[];n(w,C,h,R),R.push(C),n(k,C,h,R);var G=new v.geom.LineString(R),D=new v.geom.LineString([A,C,R[2]]),j=l(D),Y=l(G),B=j-Y/2,U=s(G),V=6.5*U/7/1e5,H=I.createSector(F[0],F[1],V,B,Y),W=H.slice(1,H.length-3),z=v.proj.fromLonLat(H.slice(H.length-3,H.length-2)[0]),J=v.proj.fromLonLat(H.slice(H.length-2,H.length-1)[0]),K=C,Z=w,q=(new v.geom.LineString([z,J]),new v.geom.LineString([K,Z]),S.getCrossPoint_(z,J,K,Z,!0)),X=[];X.push(R[2]),W.forEach(function(e){var t=v.proj.fromLonLat(e);X.push(t)}),X.push(q);var $=new v.geom.LineString(X),Q=new v.Feature({geometry:$});Q.tag=T,Q.setStyle(new v.style.Style({fill:new v.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new v.style.Stroke({color:t,width:1}),text:new v.style.Text({font:"12px Calibri,sans-serif",text:m.toFixed(2)+"°",fill:new v.style.Fill({color:"black"})}),image:new v.style.Circle({radius:7,fill:new v.style.Fill({color:"#ffcc33"})})})),a.addFeature(Q),g=null}setTimeout(function(){0===h&&c(e,r,T),f.set("state.drawing",!1),f.set("state.measure.geoArea",!1),f.set("state.measure.geoAngle",!1),E.removeInteraction(o)},100)},this)}}var v=a(3),h=a(6),I=a(48),S=a(1),b=a(13),L=a(16),T=0,w=1;e.exports={measureAngle:f}},function(e,t,a){function r(e){if(e)return e[e.length-1]}function o(e){return P.getMapObj(e)}function n(e){var t=e+F;return F+=1,t}function i(e,t){var a=o(e).getInteractions().getArray();return M.find(a,function(e){return e.get("name")===t})}function l(e,t){e&&e.getFeatures().forEach(function(a){a.get("type")===t&&e.removeFeature(a)})}function s(e){var t=n("drawGeo_act_");return A[e]||(A[e]=[]),A[e].push(t),t}function d(e){var t;for(var a in e)if(e.hasOwnProperty(a)){var r=e[a];M.isArray(r)&&r.length>0&&M.isArray(r[0])&&(t=r)}return t}function c(e){var t=e.mapId,a=e.type,r=o(t);if(!r.get("state.drawing")){var n=null;m(t,!1);var i=s(t);if(n="Polygon"===a?h(t,a,i,e.fillColor):h(t,a,i)){n.setActive(!0);var l=n.get("endKey");l&&n.unByKey(l),l=n.on("drawend",function(a){g(e,i,n,a),m(t,!0),fusiongis.Events.removeClickCallback(t,"draw-geometry-click-event")}),n.set("endKey",l),e.clickCallback&&fusiongis.Events.addClickCallback(t,"draw-geometry-click-event",function(t){var a=t.e,r={coordinate:a.coordinate,evt:a};e.clickCallback(r)},"tempGeometryLayer_"+t)}}}function g(e,t,a,r){var n=e.mapId,i=e.type,l=o(n);r.feature.set("type",t),r.feature.set("id",t),e.isStyle||r.feature.setStyle(y(e));var s=p(r,a,i),d=s[1],c=s[0];if(e.showCloseIcon){var g=[];if(c)for(var m=0;m<c.length-1;m++)g=c[m].concat(c[m+1]);var v=M.unique(g);v.length<=2&&v.length>0?f(n,t,void 0,i):f(n,t,d,i)}a.setActive(!1);var h=l.get("Keys.DrawGeometryClick");if(h&&a.unByKey(h),e.endCallback){var S={},b=[];if(e.type===R.Circle){var L=r.feature.getGeometry();S={center:L.getCenter(),radius:L.getRadius(),lastCoordinate:L.getLastCoordinate()}}else if(e.type===R.Polygon){var T=r.feature.getGeometry().getCoordinates()[0],w=T.slice(1),E=!1;if(w.length>1)for(var m=0;m<w.length-1;m++)w[m][0]===w[m+1][0]&&w[m][1]===w[1][1]||(E=!0);setTimeout(function(){E||I(n,t)},500),S=O.transform(T,3857,4326)}else if(e.type===R.Point)S=r.feature.getGeometry().getCoordinates(),S=O.transform(S,3857,4326);else if(e.type===R.LineString){S=r.feature.getGeometry().getCoordinates();for(var m=0;m<S[0].length-1;m++)b=S[m].concat(S[m+1]);S=O.transform(S,3857,4326)}else S=r.feature.getGeometry().getCoordinates();"function"==typeof e.endCallback&&e.endCallback({mapId:n,actId:t,coordinates:S})}e.isClear||setTimeout(function(){u(e,l,n,t)},500),setTimeout(function(){l.set("state.draw."+e.type,!1)},1e3)}function u(e,t,a,r){e.showGeometry||S(a,r),t.set("state.drawing",!1)}function y(e){return new x.style.Style({fill:new x.style.Fill({color:e.fillColor||"rgba(255, 255, 255, 0.2)"}),stroke:new x.style.Stroke({color:e.strokeColor||"#0099FF",width:e.strokeWidth||3}),image:new x.style.Circle({radius:e.imageRadius||7,fill:new x.style.Fill({color:e.imageFillColor||"#0099FF"}),stroke:new x.style.Stroke({color:e.imageStrokeColor||"#FFFFFF",width:e.imageStrokeWidth||1})})})}function p(e,t,a){var o=e.feature.getGeometry(),n=d(t);if(a===R.Point){var i=o.getCoordinates();return[n,i]}if(a===R.LineString){var i=o.getCoordinates();return[n,r(i)]}if(a===R.Polygon){var i=o.getCoordinates(),l=i[0];return[n,l[l.length-2]]}return a===R.Circle?[n,r(n)]:a===R.Square?[n,r(n)]:a===R.Box?[n,r(n)]:void 0}function m(e,t){var a=o(e).getInteractions().getArray();a.forEach(function(e){e instanceof x.interaction.DoubleClickZoom&&(t?setTimeout(function(){e.setActive(t)},500):e.setActive(t))})}function f(e,t,a,r){var n=document.createElement("div");n.className="measure-close",n.mapId=e,n.actId=t,_.on(n,"click",function(){I(this.mapId,this.actId);var a="";"Point"===r?a="tempPoint":"LineString"===r?a="tempLine":"Polygon"===r&&(a="tempPolygon");var o=N.get(a+"_"+e);if(o){var n=o.getSource(),i=fusiongis.Highlight.getHLayer({mapId:e,layerId:o.get("layer_id")}),l=n.getFeatureById(t),s=i.getSource().getFeatures()[0];l&&n.removeFeature(l),s&&i.getSource().removeFeature(s)}});var i=new x.Overlay({element:n,offset:[15,6],positioning:"bottom-center"});i.set("name",t+"_close"),i.set("type",t),o(e).addOverlay(i),i.setPosition(a)}function v(e){var t=N.get("tempGeometryLayer_"+e);return t||(t=new x.layer.Vector({layerId:"tempGeometryLayer",type:"tempGeometryLayer",source:new x.source.Vector({wrapX:!1}),style:new x.style.Style({fill:new x.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new x.style.Stroke({color:"#0099FF",width:3}),image:new x.style.Circle({radius:7,fill:new x.style.Fill({color:"#0099FF"})})}),opacity:0}),N.put("tempGeometryLayer_"+e,t),o(e).addLayer(t)),t}function h(e,t,a,r){var n=o(e),l=i(e,"geometryDrawer");if(l){if(t===l.get("drawType"))return l.set("actId",a),l;n.removeInteraction(l)}var s=t;if("None"!==t){var d,c;"Square"===t?(s="Circle",d=x.interaction.Draw.createRegularPolygon(4)):"Box"===t&&(s="LineString",c=2,d=function(e,t){t||(t=new x.geom.Polygon(null));var a=e[0],r=e[1];return t.setCoordinates([[a,[a[0],r[1]],r,[r[0],a[1]],a]]),t}),l=new x.interaction.Draw({name:"geometryDrawer",actId:a,source:!!v(e)&&v(e).getSource(),type:s,geometryFunction:d,maxPoints:c}),"Polygon"===t&&(l=new x.interaction.Draw({name:"geometryDrawer",actId:a,source:!!v(e)&&v(e).getSource(),style:new x.style.Style({fill:new x.style.Fill({color:void 0===r?"transparent":r}),stroke:new x.style.Stroke({color:"#0099FF",width:2}),image:new x.style.Circle({radius:5,stroke:new x.style.Stroke({color:"#0099FF"}),fill:new x.style.Fill({color:"#0099FF"})})}),type:s,geometryFunction:d,maxPoints:c})),l.set("name","geometryDrawer"),l.set("actId",a),l.set("drawType",t),n.addInteraction(l)}return l}function I(e,t){S(e,t),L(e,t)}function S(e,t){var a=v(e);a&&l(a.getSource(),t)}function b(e){var t=v(e);t.getSource().clear()}function L(e,t){var a=o(e),r=a.getOverlays().getArray().slice(0);if(r.forEach(function(e){var r=e.get("type");r&&r===t&&a.removeOverlay(e)}),A[e]){var n=A[e].indexOf(t);n>-1&&A[e].splice(n,1)}}function T(e){var t=o(e),a=A[e];if(a||!a.length){var r=t.getOverlays().getArray().slice(0);r.forEach(function(e){var r=e.get("type");r&&a.indexOf(r)>-1&&t.removeOverlay(e)}),a.splice(0,a.length)}}function w(e){b(e),T(e)}function E(e){var t=i(e,"geometryDrawer");if(t&&t.getActive()){t.setActive(!1);var a=t.get("actId");a&&I(e,a)}}function C(e){var t=e.mapId,a=o(t);a&&(e.isOpen?(c(e),a.set("state.drawing",!0),a.set("state.draw."+e.type,!0)):(E(t),a.set("state.drawing",!1),setTimeout(function(){a.set("state.draw."+e.type,!1)},1100)))}function k(e){var t=P.getMapObj(e.mapId);if(!t)return!1;var a=e.type||"Point";return t.get("state.draw."+a)}var x=a(3),P=a(6),_=a(10),O=a(16),M=a(1),N=(a(13),a(4)),F=1,A={},R={Point:"Point",LineString:"LineString",Polygon:"Polygon",Circle:"Circle",Square:"Square",Box:"Box"};e.exports={DrawTypes:R,drawGeometry:C,isDrawing:k,clearGeometryDraw:w}},function(e,t,a){var r=a(3),o=a(4),n=a(5),i=a(7),l=a(24),s=function(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml");else if(window.ActiveXObject)for(var t=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],a=0;a<t.length;a++)try{if(e=new ActiveXObject(t[a]))break}catch(r){}return e},d=function(e){var t="search_result_inner_layer_id",a=e.mapId,l=t+"_"+a,s=e.coordinate,d=e.imgUrl,c=null;o.containsKey(l)?c=o.get(l):(e.layerId=t,n.createLayer(e),c=o.get(l));var g=c.getSource(),u=r.proj.fromLonLat(s),y=new r.geom.Point(u),p=new r.Feature({geometry:y}),m=new r.style.Style({image:new r.style.Icon({src:d||i.GisResourceURL+"search/search-result-icon.png"})});p.setStyle(m),g.clear(),g.addFeature(p)},c=function(e){var t=o.get("search_result_inner_layer_id_"+e);t&&t.getSource().clear()},g=function(e){var t=s(),a="http:";"file:"!==location.protocol&&(a=location.protocol);var r=encodeURI(a+"//nominatim.openstreetmap.org/search?q="+e.address+"&format=json&polygon=1&addressdetails=1&num="+Math.random());t.open("GET",r,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),t.onreadystatechange=function(){if(4==t.readyState)if(200==t.status){var a=t.responseText,r=JSON.parse(a),o=[];r&&r.length>0?r.forEach(function(e){var t=e.address,a=e.boundingbox;o.push({centerLonLat:[parseFloat(e.lon),parseFloat(e.lat)],displayName:e.display_name,type:e.type,placeId:e.place_id,city:t.city,country:t.country,countryCode:t.country_code,postCode:t.postcode,bbox:[parseFloat(a[2]),parseFloat(a[0]),parseFloat(a[3]),parseFloat(a[1])]})}):o.push({displayName:"Sorry, we do not found the information you want"}),e.callback&&"function"==typeof e.callback&&e.callback(o)}else console.log("search location failed")},t.send()},u=function(e){e&&e.key&&l.loadGoogleAPI(e.key,e.language,function(t){if(t){var a=new google.maps.Geocoder;a.geocode({address:e.address},function(t,a){if(a==google.maps.GeocoderStatus.OK){var r=[];t&&t.length>0?t.forEach(function(e){var t=[];e.geometry.bounds&&(t=[e.geometry.bounds.b.b,e.geometry.bounds.f.f,e.geometry.bounds.b.f,e.geometry.bounds.f.b]),r.push({centerLonLat:[parseFloat(e.geometry.location.lng()),parseFloat(e.geometry.location.lat())],displayName:e.formatted_address,bbox:t})}):r.push({displayName:"Sorry, we do not found the information you want"}),e.callback&&"function"==typeof e.callback&&e.callback(r)}else alert("Geocode was not successful for the following reason: "+a)})}})},y=function(e){e.serviceVendor===i.Search_Engine.OSM?g(e):e.serviceVendor===i.Search_Engine.GOOGLE&&u(e)};e.exports={searchLocal:y,addMarker:d,clearMarker:c}},function(e,t,a){function r(e){var t=s.getMapObj(e.mapId),a=e.type?e.type:"all",r=e.callback,o=[],n=d.getLayer({mapId:e.mapId,layerId:"tempPolygon_"+e.mapId});n||fusiongis.Polygon.addLayer({mapId:e.mapId,layerId:"tempPolygon"}),fusiongis.Geometry.drawGeometry({mapId:e.mapId,type:fusiongis.Geometry.DrawTypes.Box,isOpen:!0,showCloseIcon:!1,endCallback:function(e){console.log(e);for(var n=[],i=0;i<e.coordinates[0].length;i++)n.push(ol.proj.transform(e.coordinates[0][i],"EPSG:3857","EPSG:4326"));var l=new ol.geom.Polygon([e.coordinates[0]]);if(l.getArea()>0){var s=l.getExtent(),d=t.getLayers();d.forEach(function(e){var t=e.get("businessType");if(t){var r=[];"all"===a?r=e.getSource().getFeaturesInExtent(s):a===t&&(r=e.getSource().getFeaturesInExtent(s)),o=o.concat(r)}}),r&&"function"==typeof r&&r({extext:s,features:o})}}})}function o(e){var t=e.callback,a=fusiongis.Geometry.DrawTypes.Box,r=void 0===e.drawType?a:e.drawType;fusiongis.Geometry.drawGeometry({mapId:e.mapId,type:r,isOpen:!0,showCloseIcon:!1,endCallback:function(a){console.log(a);var o="";if("Box"==r){var n=[];a.coordinates[0].forEach(function(e){n.push(ol.proj.toLonLat(e))}),o=n.join("-")}else o=a.coordinates.join("-");var s=o.replace(/,/g," "),d=s.replace(/-/g,",");i.postJSON({url:l.GisRootUrl+"/mapRender/contains",data:JSON.stringify({polygon:"POLYGON(("+d+"))",imgToken:e.imgToken}),success:function(e){var a=JSON.parse(e),r=a.status;1===r.code&&t(a)},failure:function(e){t({msg:e})}})}})}function n(e){var t=e.callback,a=fusiongis.Geometry.DrawTypes.Box,r=void 0===e.drawType?a:e.drawType;fusiongis.Geometry.drawGeometry({mapId:e.mapId,type:r,isOpen:!0,showCloseIcon:!1,endCallback:function(a){console.log(a);var o=[];"Box"==r?a.coordinates[0].forEach(function(e){o.push(ol.proj.toLonLat(e))}):o=a.coordinates,i.postJSON({url:l.GisRootUrl+"/spatialAnalysis/contain/geomContainFcos",data:JSON.stringify({containFcObject:{cordinates:o,geometryId:"1",geometryType:"POLYGON"},containedFcObjectIdList:[],featureClassNameContained:e.featureClassNameContained}),success:function(e){var a=JSON.parse(e),r=a.status;1===r.code&&t(a)},failure:function(e){t({msg:e})}})}})}var i=a(14),l=a(7),s=a(6),d=a(16),l=a(7),c=function(e,t,a){1===e?i.postJSON({url:l.GisRootUrl+"/spatialAnalysis/contain/geomContainGeoms",data:JSON.stringify({containFcObject:t.containFcObject,containedFcObjectList:t.containedFcObjectList}),success:function(e){a(e)},failure:function(e){a({msg:e})}}):2===e?i.postJSON({url:l.GisRootUrl+"/spatialAnalysis/contain/fcosContainFcos",data:JSON.stringify({containFcObjectId:t.containFcObjectId,containedFcObjectIdList:t.containedFcObjectIdList,featureClassNameContain:t.featureClassNameContain,featureClassNameContained:t.featureClassNameContained}),success:function(e){a(e)},failure:function(e){a({msg:e})}}):3===e?i.postJSON({url:l.GisRootUrl+"/spatialAnalysis/contain/geomContainFcos",data:JSON.stringify({containFcObject:t.containFcObject,containedFcObjectIdList:t.containedFcObjectIdList,featureClassNameContained:t.featureClassNameContained}),success:function(e){a(e)},failure:function(e){a({msg:e})}}):4===e&&fusiongis.OriginalAjax.postJSON({url:fusiongis.Constant.GisRootUrl+"/spatialAnalysis/contain/fcosContainGeoms",data:JSON.stringify({containFcObjectId:t.containFcObjectId,featureClassNameContain:t.featureClassNameContain,containedFcObjectList:t.containedFcObjectList}),success:function(e){a(e)},failure:function(e){a({msg:e})}})};e.exports={seachFeature:c,seachFeatures:r,searchByImgToken:o,searchBackStage:n}},function(e,t,a){function r(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("state");r?l(e):i(e)}var o=a(3),n=a(6),i=function(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("graticule");r||(r=new o.Graticule({strokeStyle:new o.style.Stroke({color:"#3B78FD",width:2,lineDash:[.5,4]}),targetSize:e.cellWidth||100}),a.set("graticule",r)),a.set("state",!0),r.setMap(a)},l=function(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("graticule");r&&(a.set("state",!1),r.setMap(null))};e.exports={addGraticule:i,removeGraticule:l,toggleGraticule:r}},function(e,t,a){function r(e,t){function a(e,t,a){var r=[],n=e+"_"+t,l=null;if(i.containsKey(n)){l=i.get(n);var s=l.getSource(),d=s.getFeatures();return d.forEach(function(e){var t=e.getGeometry().getCoordinates()[0],n=o.extent.containsCoordinate(a,t[t.length-1]);if(n){var i=e.getId(),l=t[t.length-1],s=t.slice(0,t.length-1),d={cellId:i,centerPoint:l,points:s};r.push(d)}}),r}}var r=e.layerId,l=e.mapId,s=e.isOpen,d=n.getMapObj(l),c=new o.source.Vector({wrapX:!1}),g=l+"_select",u=i.get(g),y=function(e,t){t||(t=new o.geom.Polygon(null));var a=e[0],r=e[1];return t.setCoordinates([[a,[a[0],r[1]],r,[r[0],a[1]],a]]),t};if(u)return u.setActive(s),void d.set("state.drawing",s);u=new o.interaction.Draw({source:c,type:"LineString",geometryFunction:y,maxPoints:2,style:new o.style.Style({fill:new o.style.Fill({color:"rgba(255, 255, 255, 0)"}),stroke:new o.style.Stroke({color:"rgba(255, 0, 0, 0.5)",width:2}),image:new o.style.Circle({radius:5,stroke:new o.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new o.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})})}),i.put(g,u);var p=function(e,t){var a=e[0]<=t[0]?e[0]:t[0],r=e[0]>=t[0]?e[0]:t[0],o=e[1]<=t[1]?e[1]:t[1],n=e[1]>=t[1]?e[1]:t[1];return[a,o,r,n]};u.on("drawend",function(e){var o=e.feature.getGeometry(),n=o.getCoordinates()[0],i=n[0],s=n[2],d=p(i,s),c=a(r,l,d);t&&"function"==typeof t&&t(c)},this),d.set("state.drawing",!0),d.addInteraction(u)}var o=a(3),n=a(6),i=a(4);e.exports={selectMode:r}},function(e,t,a){var r=a(3),o=a(6),n=a(4),i=a(7),l=function(e){var t=e.layerId,a=e.mapId,o=e.style.type?e.style.type:1;fusiongis.LineAdd.addLineType(e),e.numberOfPoints=500;var l,s,d,c,g,u=fusiongis.Curve.addCurve(e),y=new r.Feature,p=new r.Feature,m=new r.Feature,f=new r.Feature,v=new r.Feature,h=new r.Feature,I=null,S=0,b=0;if(1===o){var L=new r.style.Style({image:new r.style.Circle({radius:e.style.width[0]?e.style.width[0]:4,fill:new r.style.Fill({color:e.style.color[0]?e.style.color[0]:[255,255,255,1]})})}),T=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[1]?e.style.color[1]:[255,255,255,.9],width:e.style.width[1]?e.style.width[1]:5})}),w=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[2]?e.style.color[2]:[255,255,255,.8],width:e.style.width[2]?e.style.width[2]:4})}),E=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[3]?e.style.color[3]:[255,255,255,.7],width:e.style.width[3]?e.style.width[3]:3})}),C=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[4]?e.style.color[4]:[255,255,255,.6],width:e.style.width[4]?e.style.width[4]:2})}),k=new r.style.Style({stroke:new r.style.Stroke({color:e.style.color[5]?e.style.color[5]:[255,255,255,.5],width:e.style.width[5]?e.style.width[5]:1})});y.setStyle(L),p.setStyle(T),m.setStyle(w),f.setStyle(E),v.setStyle(C),h.setStyle(k);var x=n.get(t+"_"+a);x.getSource().addFeature(y),x.getSource().addFeature(p),x.getSource().addFeature(m),x.getSource().addFeature(f),x.getSource().addFeature(v),x.getSource().addFeature(h)}else if(2===o){var x=n.get(t+"_"+a);x.getSource().addFeature(p)}setInterval(function(){if(S<u.length-1){var t=u[S],a=u[S+1],n=a[0]-t[0],L=a[1]-t[1],T=Math.atan2(L,n);b=T>=0?2*Math.PI-T:-1*T}1===o?(S<454?(l=new r.geom.Point(r.proj.fromLonLat(u[S+45])),s=new r.geom.LineString(u.slice(S+36,S+45)),d=new r.geom.LineString(u.slice(S+27,S+36)),c=new r.geom.LineString(u.slice(S+18,S+27)),g=new r.geom.LineString(u.slice(S+9,S+18)),I=new r.geom.LineString(u.slice(S,S+9))):(s=new r.geom.LineString(u.slice(S+45,u.length-S-45)),d=new r.geom.LineString(u.slice(S+36,u.length-S-36)),c=new r.geom.LineString(u.slice(S+27,u.length-S-27)),g=new r.geom.LineString(u.slice(S+18,u.length-S-18)),I=new r.geom.LineString(u.slice(S+9,u.length-S-9))),y.setGeometry(l),h.setGeometry(I),v.setGeometry(g),f.setGeometry(c),m.setGeometry(d),p.setGeometry(s)):2===o?(l=new r.geom.Point(r.proj.fromLonLat(u[S])),p.setGeometry(l),p.setStyle(new r.style.Style({image:new r.style.Icon({src:i.GisResourceURL+"plane.png",size:e.style.size,imgSize:e.style.imgSize,opacity:e.style.opacity,rotation:b})}))):console.warn("no support!"),S=(S+2)%u.length},e.time)},s=function(e){var t=e.mapId,a=e.layerId+"_"+e.mapId,r=null;if(n.containsKey(a)){r=n.get(a);var i=o.getMapObj(t);i.removeLayer(r),n.remove(a),r=null}};e.exports={addMigrationMap:l,removeMigrationMap:s}},function(e,t,a){var r=a(3),o=a(4),n=a(6),i=function(e,t){var a=new r.geom.Circle(r.proj.fromLonLat(e),t);return a},l=function(e){var t=new r.style.Style({stroke:new r.style.Stroke({color:e,width:2}),fill:new r.style.Fill({color:"rgba(255,255,255,0)"})});return t},s=function(e){var t,a=e.layerId,s=e.mapId,d=e.center,c=e.RGB,g=e.bubbleRadius,u=c[0],y=c[1],p=c[2],m=n.getMapObj(s),f=m.getView();t=g*f.getResolution();var v,h,I,S,b,L,T=o.get(a+"_"+s),w=T.getSource(),E=new r.Feature,C=new r.Feature,k=new r.Feature,x=new r.Feature,P=new r.Feature,_=[E,C,k,x,P],O=new r.Feature,M=new r.Feature,N=new r.Feature,F=new r.Feature,A=new r.Feature,R=[O,M,N,F,A],G=new r.Feature;v=i(d,.1*t),S=l("rgba(255,255,255,0)"),h=i(d,.55*t),b=l("rgba(255,255,255,0)"),I=i(d,.85*t),L=l("rgba(255,255,255,0)"),E.setGeometry(v),E.setStyle(S),O.setGeometry(h),O.setStyle(b),G.setGeometry(I),G.setStyle(L),_.forEach(function(e){w.addFeature(e)}),R.forEach(function(e){w.addFeature(e)}),w.addFeature(G);var D=1;setInterval(function(){t=g*f.getResolution();var e=(g-2)*f.getResolution(),a=(g-4)*f.getResolution(),r=(g-6)*f.getResolution(),o=(g-8)*f.getResolution(),n=1,s=.15,c=.1,m=.1,T=.45,w=n-(D-1)*s,_=n-(D-1)*c-T,R=1-.05*(D-1)-.75,j=m+s*(D-1),Y=m*D+T,B=.05*(D-1)+.85;v=i(d,j*t);var U="rgba("+u+","+y+","+p+","+w+")";S=l(U);var V=i(d,j*e),H="rgba("+u+","+y+","+p+","+.8*w+")",W=l(H),z=i(d,j*a),J="rgba("+u+","+y+","+p+","+.6*w+")",K=l(J),Z=i(d,j*r),q="rgba("+u+","+y+","+p+","+.4*w+")",X=l(q),$=i(d,j*o),Q="rgba("+u+","+y+","+p+","+.2*w+")",ee=l(Q);C.setGeometry(V),C.setStyle(W),k.setGeometry(z),k.setStyle(K),x.setGeometry(Z),x.setStyle(X),P.setGeometry($),P.setStyle(ee),h=i(d,Y*t);var te="rgba("+u+","+y+","+p+","+_+")";b=l(te);var ae=i(d,Y*e),re="rgba("+u+","+y+","+p+","+.8*_+")",oe=l(re),ne=i(d,Y*a),ie="rgba("+u+","+y+","+p+","+.6*_+")",le=l(ie),se=i(d,Y*r),de="rgba("+u+","+y+","+p+","+.4*_+")",ce=l(de),ge=i(d,Y*o),ue="rgba("+u+","+y+","+p+","+.2*_+")",ye=l(ue);M.setGeometry(ae),M.setStyle(oe),N.setGeometry(ne),N.setStyle(le),F.setGeometry(se),F.setStyle(ce),A.setGeometry(ge),A.setStyle(ye),I=i(d,B*t);var pe="rgba("+u+","+y+","+p+","+R+")";L=l(pe),E.setGeometry(v),E.setStyle(S),O.setGeometry(h),O.setStyle(b),G.setGeometry(I),G.setStyle(L),D=(D+1)%5,0===D&&D++},400)},d=function(e){var t=e;t.center=e.coordinates[e.coordinates.length-1],fusiongis.LineAdd.addLineType(e),s(t)},c=function(e){var t=e.mapId,a=e.layerId+"_"+e.mapId,r=null;if(o.containsKey(a)){r=o.get(a);var i=n.getMapObj(t);i.removeLayer(r),o.remove(a),r=null}};e.exports={addBubbleMap:d,removeBubbleMap:c}},function(e,t,a){var r=a(7),o=a(14),n=a(1),i=function(e,t){var a={mapId:e.mapId,layerId:e.layerId};o.postJSON({url:r.PolygonQuery.GET_THIESSEN_POLYGONLAYER_INFO,data:JSON.stringify({featureClassName:e.featureClassName,columnName:e.columnName,operator:e.operator,value:e.value}),success:function(r){var o=JSON.parse(r);if(o&&o.data&&1===o.status.code){var i=o.data.fcObjectList;i&&(i.forEach(function(e,t){for(var a=[],r=n.htmlDecode(e.geometry),o=r.substr(9),i=o.substr(0,o.indexOf(")")),l=i.split(","),s=0;s<l.length;s++){var d=l[s].split(" "),c=parseFloat(d[0]),g=parseFloat(d[1]);a.push([c,g])}e.coordinates=a,e.id=e.fcObjectId}),a.datas=i,void 0!==e.layerId&&""!==e.layerId&&(fusiongis.Polygon.addLayer(a),fusiongis.Polygon.setLayerData(a),fusiongis.Map.setMapCenter({mapId:e.mapId,coordinate:a.datas[0].coordinates[0]})),t&&t(i))}},fail:function(e){console.log("get feature on thiessenPolygon layer fail:"+e)}})};e.exports={getPolygonFeatureInfo:i}},function(e,t){function a(e,t){var a=r(e,t);if(!a)for(var o=0;o<t.length;o++){var n=t[o];if(a=i(n,e))break}return a}function r(e,t){var a,r,i,l,s,d,c,g,u=!1,y=o(e),p=o(t);e:for(var m=1;m<y.length;m++){a=y[m-1],r=a.x1,i=a.x2,l=a.y1,s=a.y2;for(var f=1;f<p.length&&(d=p[f-1],!(d.x1>i));f++)if(!(d.x2<r)&&(c=d.y1,g=d.y2,!(Math.min(c,g)>Math.max(l,s))&&!(Math.max(c,g)<Math.min(l,s))&&n(a,d))){u=!0;break e}}return u}function o(e){function t(e,t){return e.x1-t.x1}for(var a,r,o=e.length-1,n=new Array(o),i=1;i<e.length;i++)a=e[i-1],r=e[i],a.x<r.x?n[i]={x1:a.x,y1:a.y,x2:r.x,y2:r.y}:n[i]={x1:r.x,y1:r.y,x2:a.x,y2:a.y};return n.sort(t)}function n(e,t,a){var r=a&&a.point,o=a&&a.tolerance,n=!1,i=e.x1-t.x1,s=e.y1-t.y1,d=e.x2-e.x1,c=e.y2-e.y1,g=t.y2-t.y1,u=t.x2-t.x1,y=g*d-u*c,p=u*s-g*i,m=d*s-c*i;if(0==y)0==p&&0==m&&(n=!0);else{var f=p/y,v=m/y;if(f>=0&&f<=1&&v>=0&&v<=1)if(r){var h=e.x1+f*d,I=e.y1+f*c;n={x:h,y:I}}else n=!0}if(o){var S;if(n){if(r){var b,h,I,L=[e,t];e:for(var T=0;T<2;++T){b=L[T];for(var w=1;w<3;++w)if(h=b["x"+w],I=b["y"+w],S=Math.sqrt(Math.pow(h-n.x,2)+Math.pow(I-n.y,2)),S<o){n.x=h,n.y=I;break e}}}}else{var E,C,h,I,k,x,L=[e,t];e:for(var T=0;T<2;++T){E=L[T],C=L[(T+1)%2];for(var w=1;w<3;++w)if(k={x:E["x"+w],y:E["y"+w]},x=l(k,C),x.distance<o){n=!r||{x:k.x,y:k.y};break e}}}}return n}function i(e,t){function a(e,t){var a=0;return t>0&&(a=parseFloat(e.toPrecision(t))),a}function r(e,t,a,r,o){return(e-o)*((r-t)/(o-a))+r}for(var o,n,i,l,s,d,c,g=14,u=a(e.x,g),y=a(e.y,g),p=(t.length-1,0),m=0;m++;)if(o=t[m],i=a(o.x,g),l=a(o.y,g),n=t[m+1],s=a(n.x,g),d=a(n.y,g),l!=d){if(c=a(r(y,i,l,s,d),g),c==u&&(l<d&&y>=l&&y<=d||l>d&&y<=l&&y>=d)){p=-1;break}c<=u||i!=s&&(c<Math.min(i,s)||c>Math.max(i,s))||(l<d&&y>=l&&y<d||l>d&&y<l&&y>=d)&&++p}else if(y==l&&(i<=s&&u>=i&&u<=s||i>=s&&u<=i&&u>=s)){p=-1;break}var f=p==-1?1:!!(1&p);return f}function l(e,t){var a=s(e,t);return a.distance=Math.sqrt(a.distance),a}function s(e,t){var a,r,o=e.x,n=e.y,i=t.x1,l=t.y1,s=t.x2,d=t.y2,c=s-i,g=d-l,u=(c*(o-i)+g*(n-l))/(Math.pow(c,2)+Math.pow(g,2));return u<=0?(a=i,r=l):u>=1?(a=s,r=d):(a=i+u*c,r=l+u*g),{distance:Math.pow(a-o,2)+Math.pow(r-n,2),x:a,y:r,along:u}}e.exports={intersectsPolygonAndPolygon:a}},function(e,t,a){var r=a(3),o=function(e){var t=e.data;if(t&&t.length>0)for(var a=0;a<t.length;a++){var o=t[a].coordinates,n=[{}],i=new r.geom.Polygon([o]),l=r.extent.getCenter(i.getExtent()),s=l;n[0]={coordinate:s,id:a},fusiongis.Icon.addIcon({layerId:e.layerId,mapId:e.mapId,datas:n})}};e.exports={showPolygonCenterIcon:o}},function(e,t,a){var r=a(3),o=a(41),n=a(6),i=a(4),l=a(7),l=(a(1),a(7)),s=function(e){var t=e.mapId,a=e.layerId,o=a+"_"+t,l=n.getMapObj(t),s=null;if(i.get(o))s=i.get(o);else{var s=new r.layer.Image({source:new r.source.ImageWMS({wrapX:!1})});s.set("layerId",a),s.set("mapId",t),l.addLayer(s),i.put(o,s)}return void 0!=e.minShowLevel&&s.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&s.set("maxShowLevel",parseInt(e.maxShowLevel)),s},d=function(e){var t=e.mapId,a=e.layerId,n=o.getLayer({mapId:t,layerId:a});if(n){e.label&&n.set("label",e.label),n.set("params.imgToken",e.imgToken),n.set("params.imgTokenLabel",e.imgTokenLabel);var i=e.isShowLabel?e.imgTokenLabel:e.imgToken,s=void 0!=i?i.slice(0,i.indexOf(":")):void 0,d=new r.source.ImageWMS({url:l.GisRootUrl+"/mapRender/export",params:{imgToken:i,VERSION:"1.1.1",FCName:s},wrapX:!1});n.setSource(d),n.set("imgToken",i)}};e.exports={createLayer:s,setLayerData:d}},function(e,t,a){function r(e){l.removeHighlight({mapId:e.mapId,layerId:e.layerId,hTypes:["click"]})}function o(e,t,a){var o=e.get("map"),s=o.getTarget(),d=e.get("layer_id"),c=e.get("businessType"),g=l.getHLayer({mapId:s,layerId:d});if(r(g),t===i.HTYPE.CLICK){var u=a;if(!u)return;var y=u.clone();y.setStyle(new n.style.Style({fill:new n.style.Fill({color:"red"}),stroke:new n.style.Stroke({color:"rgba(255,215,0)",width:2})})),y.set("mapId",s),y.set("layerId",d),y.set("layerType",c),y.set("hType",t),g.getSource().addFeature(y)}}var n=a(3),i=a(7),l=a(43);e.exports={removeHighlight:r,highlight:o}},function(e,t,a){function r(e,t,a){var r=d.getMapObj(a),o=r.getPixelFromCoordinate(e),n=r.getPixelFromCoordinate(t),i=o[0],l=o[1],s=n[0],c=n[1],g=7,u=s-i>=0?-1:1,y=c-l>=0?-1:1,p=Math.atan2(c-l,s-i),m=s+u*g*Math.abs(Math.cos(p)),f=c+y*g*Math.abs(Math.sin(p));return r.getCoordinateFromPixel([m,f])}function o(e,t){if(e&&e.getSource()){var a=g.getHLayer({mapId:t,layerId:e.get("layer_id")}),o=null;a&&(o=a.getSource().getFeatures());var n=e.getSource().getFeatures(),i=function(e,a){var o=e.getGeometry(),n=a.getGeometry(),i=e.get("coordinates"),l=r(i[0],i[1],t);o.setCoordinates([i[0],l]),n.setCoordinates(l)};!!n&&n.forEach(function(e){var t=e.get("arrow");t&&setTimeout(function(){i(e,t)},500)}),!!o&&o.forEach(function(e){var t=e.get("arrow");t&&setTimeout(function(){
i(e,t)},500)})}}function n(e,t){var a=!1;return e.forEach(function(e){e.get("layerId")&&e.get("layerId")===t&&(a=!0)}),a}function i(e){var t=e.mapId,a=d.getMapObj(t),r=e.targetLayerId,o=e.targetGeoId,i=e.sourceLayerId,c=e.sourceGeoId,g=e.layerId,y=e.lineGeoId,p=s.get(r+"_"+t),m=s.get(i+"_"+t);if(p&&m){var f=p.getSource().getFeatureById(o),v=m.getSource().getFeatureById(c);if(f&&v){var h=l.proj.toLonLat(l.extent.getCenter(f.getGeometry().getExtent())),I=l.proj.toLonLat(l.extent.getCenter(v.getGeometry().getExtent()));e.coordinates=[h,I],u(e),a.getLayers().on("change:length",function(){if(n(this,r+"_"+t)&&n(this,i+"_"+t));else{var e=s.get(g+"_"+t);if(e){var a=e.getSource().getFeatureById(y),o=e.getSource().getFeatureById(y+"_arrow");a&&e.getSource().removeFeature(a),o&&e.getSource().removeFeature(o)}}})}else console.warn("the feature is undefined")}else console.warn("the layer is undefined")}var l=a(3),s=(a(7),a(4)),d=a(6),c=a(1),g=(a(11),a(43)),u=function(e){e.layerId;1===e.isBezier?fusiongis.Curve.addCurve(e,function(t,a){1==e.isArrow&&(e.controlCoordinate=t,m(e,a)),e.color&&v(e)}):fusiongis.LineStraight.addLine(e,function(t){1==e.isArrow&&m(e,t),e.color&&v(e)})},y=function(e,t){var a,r,o=Math.sqrt(Math.pow(e[0][0]-e[1][0],2)+Math.pow(e[0][1]-e[1][1],2));if(e[0][0]===e[1][0])a=e[0][0],r=e[0][1]<e[1][1]?o*t+e[0][1]:e[0][1]-o*t;else{var n=(e[0][1]-e[1][1])/(e[0][0]-e[1][0]),i=(e[0][1]+e[1][1]-n*(e[0][0]+e[1][0]))/2,l=o*t,s=Math.pow(2*n*(i-e[0][1])-2*e[0][0],2)-4*(1+n*n)*(Math.pow(e[0][0],2)+Math.pow(i-e[0][1],2)-l*l),d=2*e[0][0]-2*n*(i-e[0][1]);a=(d+Math.sqrt(s))/(2*(1+n*n)),e[0][0]<e[1][0]?a<e[0][0]&&(a=(d-Math.sqrt(s))/(2*(1+n*n))):a>e[0][0]&&(a=(d-Math.sqrt(s))/(2*(1+n*n))),r=n*a+i}return[a,r]},p=function(e,t){var a,r,o,n,i=[];if(2===e.length)r=y(e,t)[0],o=y(e,t)[1],i=l.proj.toLonLat(e[0]);else{var s=e.length;if(.5===t)s%2===0?(r=(e[s/2-1][0]+e[s/2][0])/2,o=(e[s/2-1][1]+e[s/2][1])/2,i=l.proj.toLonLat(e[s/2-1]),n=s/2-1):(r=e[(s-1)/2][0],o=e[(s-1)/2][1],i=l.proj.toLonLat(e[(s-1)/2-1]),n=(s-1)/2-1);else{var d=Math.round(s*t);d=d===s?d-1:d,r=e[d][0],o=e[d][1];var c=0===d?0:d-1;i=l.proj.toLonLat(e[c]),n=c}}a=0===t?e[0]:[r,o];var g=0===t?[i,l.proj.toLonLat(e[1])]:[i,l.proj.toLonLat(a)];return{middlePointCoordinate:a,middleAndPrePointCoordinate:g,index:n}},m=function(e,t){for(var a,o,n,i=[],d=e.coordinates,c=null,g=null,u=[],y=[],m=0;m<d.length;m++)i.push(l.proj.fromLonLat(d[m]));var v=i[i.length-2];if(e.isSetArrowPosition){var h=e.arrowPosition,I="undefined"==typeof h||h>1||h<0?.5:h;"undefined"==typeof e.controlCoordinate?a=p(i,I):(e.controlCoordinate.forEach(function(e){u.push(l.proj.fromLonLat(e))}),a=p(u,I),e.controlCoordinate.forEach(function(e,t){t<=a.index&&y.push(e)})),o=e.isSetArrowPosition?y:e.controlCoordinate,n=e.isSetArrowPosition?a.middleAndPrePointCoordinate:e.coordinates,g=a.middlePointCoordinate}else g=i[i.length-1];var S=e.lineGeoId+"_arrow";if(1===e.isBezier)e.controlCoordinate&&(c=f(n,o));else{var b=r(v,g,e.mapId);t.getGeometry().setCoordinates([v,b]);var L=g[0]-v[0],T=g[1]-v[1];c=-Math.atan2(T,L)+Math.PI/2}var w=null,E={labelFillColor:e.fillColor,labelStrokeColor:e.labelStrokeColor,strokeColor:"black",strokeWidth:e.strokeWidth||1,arrowRadius:e.arrowRadius||8,rotation:c,angle:0};w=1===e.isBezier?new l.Feature({geometry:new l.geom.Point(a.middlePointCoordinate),select:e.hightLight?e.hightLight:E}):new l.Feature({geometry:new l.geom.Point(b),select:e.hightLight?e.hightLight:E});var C=new l.style.Style({image:new l.style.RegularShape({fill:new l.style.Fill({color:e.fillColor||"#208089"}),stroke:new l.style.Stroke({color:e.strokeColor||"#000",width:e.strokeWidth||1}),cursor:"point",points:3,radius:e.arrowRadius||8,rotation:c,angle:0})});w.setId(S),w.setStyle(C),1!==e.isBezier&&w.set("coordinates",b),t.set("arrow",w);var k=s.get(e.layerId+"_"+e.mapId);k&&k.getSource().addFeatures([w])},f=function(e,t){if(t.length>0){var a=e[e.length-1],r=[],o=t.length;r=1===t.length?t[0]:t[o-1];var n=a[0]-r[0],i=a[1]-r[1],l=-Math.atan2(i,n)+Math.PI/2;return l}},v=function(e){var t=null,a=null;fusiongis.BaseLayer.registerMouseEvent(e,function(r){if(r)"STRAIGHTLINE"===r.get("businessType")&&(t=r.clone(),a=r,r.setStyle(new l.style.Style({stroke:new l.style.Stroke({color:e.color,width:e.strokeWidth||3})})),e.mouseOverCallback&&"function"==typeof e.mouseOverCallback&&e.mouseOverCallback(r));else{if(t){var o=new l.style.Style({stroke:new l.style.Stroke({color:e.strokeColor,width:e.strokeWidth||3})});a.setStyle(o)}e.mouseLeaveCallback&&"function"==typeof e.mouseLeaveCallback&&e.mouseLeaveCallback()}})},h=function(e){var t=e.get("data").cellType,a=e.get("data").radius,r=e.get("data").azimuth,o=[],n=e.getGeometry();if(n){var i=n.getCoordinates()[0],s=[];if("triangle"===t){for(var d=[],g=i.length,u=0;u<g;u++){for(var y=!0,p=u;p<i.length-1&&(y=!1,i[u]!=i[p+1]);p++);y&&(d=i[u])}for(var m=c.unique(i),u=0,y=!0;u<m.length;y?u++:u)m[u][0]===d[0]&&m[u][1]===d[1]?(m.splice(u,1),y=!1):y=!0;if(2===m.length){var f=(m[0][0]+m[1][0])/2,v=(m[0][1]+m[1][1])/2;s.push(f,v)}}else if("arrow"===t)s=i[3];else{var h=a,I=l.proj.fromLonLat(e.get("data").coordinate),S=Math.PI/2-r/180*Math.PI,b=I[0]+h*Math.cos(S),L=I[1]+h*Math.sin(S);s.push(b,L)}return o=l.proj.toLonLat(s)}},I=function(e){if(2===e.length){var t=l.proj.fromLonLat(e[0]),a=l.proj.fromLonLat(e[1]),r=a[0]-t[0],o=a[1]-t[1],n=180*Math.atan(r/o)/Math.PI;return n!==-90&&90!==n||(n*=-1),n+=o>0?270:90,n>360&&(n-=360),0===n&&(n=360),n}},S=function(e){if(e){for(var t=0,a=e,r=l.proj.fromLonLat(e[0]),o=l.proj.fromLonLat(e[1]),n=0,i=a.length-1;n<i;++n)t+=new l.geom.LineString([r,o]).getLength();var s;return s=Math.round(1e3*t)/1e3+" m"}};e.exports={addLineType:u,clickShowAzimuth:I,showDistance:S,addLineByGeomId:i,getCellApex:h,setNewCoordinate:o}},function(e,t){var a=function(e){if("POLYGON"===e.layerType){var t=e.coordinates.length;if(2===t){var a=[],r=(e.coordinates[0][0]+e.coordinates[t-1][0])/2,o=(e.coordinates[0][1]+e.coordinates[t-1][1])/2;a=e.coordinates[0][0]===e.coordinates[t-1][0]?[r+1,o]:[r,o+1],e.coordinates.splice(1,0,a),fusiongis.LineAdd.addLineType(e)}}};e.exports={addPolygonBezier:a}},function(e,t,a){var r=a(3),o=a(4),n=a(7),i=a(1),l=a(5),s=a(6),d=function(e){var t=e.layerId+"_"+e.mapId,a=null,r=void 0==e.isShow||e.isShow,i=e.label?e.label:e.layerId;o.containsKey(t)?a=o.get(t):(l.createLayer(e),a=o.get(t)),a.set("type",n.CUSTOMTYPE.LAYERIMGTYPE),a.set("businessType","unChangePolygon"),a.set("params.label",i),a.set("layerId",e.layerId),a.set("layer_id",e.layerId),a.set("isShow",r),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel))},c=function(e){var t=e.layerId+"_"+e.mapId,a=e.datas,n=(s.getMapObj(e.mapId),o.get(t));n.set("datas",a);var l=null;if(n&&(l=n.getSource()),i.isValid(a)||a.length>0){var d=[];a.forEach(function(e){var t=r.proj.fromLonLat(e.coordinate),a=void 0!=e.height?e.height:20,o=void 0!=e.width?e.width:10,i=t[0]-o/2,l=t[0]+o/2,s=t[1]-a/2,c=t[1]+a/2,g=[];g.push([i,s]),g.push([l,s]),g.push([l,c]),g.push([i,c]),g.push([i,s]);var u=new r.Feature({geometry:new r.geom.Polygon([g]),data:e,businessType:"unChangePolygon",layer:n});u.setId(e.id);var y=new r.style.Style({fill:new r.style.Fill({color:e.fillColor||"rgba(255,255,0,0.1)"}),stroke:new r.style.Stroke({color:e.strokeColor||"#76EEC6",width:e.strokeWidth||2})});u.setStyle(y),u.set("vectorType","unChangePolygon"),d.push(u)}),l&&l.addFeatures(d)}};e.exports={addLayer:d,setLayerData:c}},function(e,t,a){function r(e,t,a){var r=e.width,o=e.height;void 0===t&&(t=r),void 0===a&&(a=o);var n=document.createElement("canvas"),i=n.getContext("2d");return n.width=t,n.height=a,i.drawImage(e,0,0,r,o,0,0,t,a),n}function o(e,t,a,o){return e=r(e,a,o),e.toDataURL(t)}function n(e,t){if(t=t?t:"download",p.getBrowserType().msie){var a=i(e);window.navigator.msSaveBlob(a,t)}else{var r=document.createElement("a");r.href=e,r.download=t;var o=new MouseEvent("click",{bubbles:!0,cancelable:!1,view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});r.dispatchEvent(o)}}function i(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],r=atob(t[1]),o=r.length,n=new Uint8Array(o);o--;)n[o]=r.charCodeAt(o);return new Blob([n],{type:a})}function l(e){e=e.toLowerCase().replace(/jpg/i,"jpeg");var t=e.match(/png|jpeg|bmp|gif/)[0];return"image/"+t}function s(e,t,a,r,i){if(m.canvas&&m.dataURL){"string"==typeof e&&(e=document.getElementById(e)),void 0===r&&(r="png"),i.indexOf("."+r)<0&&(i=i+"."+r),r=l(r);var s=o(e,r,t,a);n(s.replace(r,f),i)}}function d(e){return"string"==typeof e?document.getElementById(e):e}function c(){var e=document.querySelector(".gm-style>div:first-child>div");if(!e)return null;for(var t=e.style.transform,a=t.split(","),r=parseFloat(a[4]),o=parseFloat(a[5]),n=document.querySelectorAll(".gm-style>div:first-child>div"),i=n.length,l=0;l<i;l++){var s=n[l];s.style.transform="none",s.style.left=r,s.style.top=o}return t}function g(e){if(e)for(var t=document.querySelectorAll(".gm-style>div:first-child>div"),a=t.length,r=0;r<a;r++){var o=t[r];o.style.transform=e,o.style.left=0,o.style.top=0}}function u(e,t,a){t=t.split(".");var r=t[t.length-1];t=t[0],e=d(e);var o=c();html2canvas(e,{useCORS:!0,onrendered:function(e){s(e,e.width,e.height,r,t),a&&a(e),g(o)}})}function y(e){u(e.targetId,e.fileName,e.endCallback)}var p=a(1),m=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return{canvas:!!t,imageData:!!t.getImageData,dataURL:!!e.toDataURL,btoa:!!window.btoa}}(),f="image/octet-stream";e.exports={exportImage:y}},function(e,t,a){var r=a(122),o=a(124);e.exports={createExportDataUI:r.createExportDataUI,createExportImageUI:o.createExportImageUI}},function(e,t,a){function r(e){var t=d.createDom({tagName:"div",attributes:{"class":"export_box_header",style:"width: 400px; height: 24px; line-height: 24px; text-indent: 8px; color: #388E8E;border-bottom-style: solid; border-bottom-color: #EBEBEB;border-bottom-width: 1px;"},text:m.prop("dataExport.title")});e.appendChild(t);var a=d.createDom({tagName:"div",attributes:{title:m.prop("components.exportImage.closeExportBox"),style:"width: 16px; height: 16px;line-height: 16px;text-align: center; background: #388E8E; color: white; position: absolute;top: 4px; right: 4px;cursor: pointer;text-indent: 0px;"},text:"X"});u.add(a,"click",function(){e.style.display="none"}),t.appendChild(a)}function o(e,t){var a=[m.prop("dataExport.exportTypeSel"),"KML","KMZ","Shape","GRD","TAB(Raster)","TAB(Vector)","KML(Raster)"],r=d.createDom({tagName:"div",attributes:{"class":"export_box_body",style:"margin-top: 25px; width: 100%; height: 261px;color: gray;"}});t.appendChild(r);var o=d.createDom({tagName:"div",attributes:{style:"height: 20px; line-height: 20px; margin-bottom: 15px;"}});r.appendChild(o);var i=d.createDom({tagName:"div",attributes:{style:"height:225px;"}});r.appendChild(i);var l=d.createDom({tagName:"span",attributes:{style:"display: block;float: left; text-indent: 18px;"},text:m.prop("components.exportImage.format")});o.appendChild(l);var u=d.createDom({tagName:"select",attributes:{name:"export_file_type","class":"export_file_type",style:"padding: 0 5%; height: 20px; line-height: 20px; outline: none;margin-left: 10px;color: gray;"}});a.forEach(function(e){var t=d.createDom({tagName:"option",attributes:{value:e},text:e});u.appendChild(t)}),o.appendChild(u);var p=d.createDom({tagName:"span",attributes:{style:"display:block;float:left;text-indent:18px;"},text:m.prop("components.exportImage.Layers")});i.appendChild(p);var f=d.createDom({tagName:"div",attributes:{style:"height: 225px;width: 273px;outline:none;border:1px solid #EBEBEB;float:left;margin-left:10px;padding:5px;"}});i.appendChild(f);var v=d.createDom({tagName:"ul",attributes:{style:"list-style: none"}}),h=[],I=y.getLayers(e.mapId);if(I)for(var S=0;S<I.length;S++){var b=I[S];if(b&&b.get("businessType")){var L=b.get("mineLayerName")?b.get("mineLayerName"):b.get("params.label");L&&"Temp Polygon"!==L&&"Temp Point"!==L&&"Temp Line"!==L&&(b.get("isVectorType")||h.push(s(v,L)))}}f.appendChild(v);for(var S=0;S<v.childNodes.length;S++)g.get(v.childNodes[S].childNodes[1].innerText)===c.BUSINESSTYPE.GRID.toLowerCase()&&(v.childNodes[S].style.display="none");n(e)}function n(e){var t=g.get(e.mapId).getTargetElement(),a=t.querySelector(".export_box_body");a&&a.querySelector("select").value===m.prop("dataExport.exportTypeSel")?a.querySelector("ul").style.display="none":a.querySelector("ul").style.display="block"}function i(e,t){var a=g.get(e.mapId).getTargetElement(),r=a.querySelector(".export_file_type"),o=d.createDom({tagName:"div",attributes:{"class":"export_box_foot",style:"margin: 30px auto; width: 210px; height: 30px; line-height: 30px;"}});t.appendChild(o);var n=d.createDom({tagName:"div",attributes:{type:"submit",style:"float: left; width: 100px; height: 100%;line-height: 30px; text-align: center; background: #9ACD32;cursor: pointer; margin-right: 10px;font-weight: bold; color: white;"},text:m.prop("components.exportImage.OK")});o.appendChild(n),u.add(n,"click",function(){var o=a.querySelectorAll(".export_layer_checkbox_in_li"),n=function(e){for(var t=[],a=0;a<e.length;a++)e[a].checked&&e[a].value&&t.push(e[a].value);return t}(o);n&&n.length>0&&p.exportFileToClient(e.mapId,r.value,n),t.style.display="none"}),l(r,a);var i=d.createDom({tagName:"div",attributes:{style:"float: left; width: 100px; height: 100%;line-height: 30px; text-align: center; background: #D4D4D4;cursor: pointer; font-weight: bold; color: white;"},text:m.prop("components.exportImage.Cancel")});o.appendChild(i),u.add(i,"click",function(){t.style.display="none"})}function l(e,t){u.add(e,"change",function(){var a=t.querySelectorAll(".export_layer_checkbox_in_li");if(a)for(var r=0;r<a.length;r++){var o=a[r];o.parentNode.style.display="none";var i=o.value.substring(0,o.value.indexOf("(")),l=e.value;"GRC"===l||"GRD"===l||"TAB(Raster)"===l||"KML(Raster)"===l?i===c.BUSINESSTYPE.GRID.toLowerCase()&&(o.parentNode.style.display="block"):"Shape"!==l&&"KML"!==l&&"KMZ"!==l&&"TAB(Vector)"!==l||i!==c.BUSINESSTYPE.GRID.toLowerCase()&&(o.parentNode.style.display="block")}n({mapId:t.id})})}function s(e,t){var a=d.createDom({tagName:"li"}),r=d.createDom({tagName:"input",attributes:{type:"radio",name:"exportLayerName",value:t,"class":"export_layer_checkbox_in_li"}});a.appendChild(r),e.appendChild(a);var o=d.createDom({tagName:"label",attributes:{style:"position:relative;top:-4px;"},text:t});return a.appendChild(o),r}var d=a(10),c=a(7),g=a(4),u=a(62),y=a(41),p=a(123),m=a(13),f=function(e){var t=g.get(e.mapId).getTargetElement(),a=t.querySelector(".export_kml_kmz_shape_grd_window");a&&t.removeChild(a);var n=d.createDom({tagName:"div",attributes:{"class":"export_box export_kml_kmz_shape_grd_window",style:"width: 400px; height: 390px;border:1px solid #EBEBEB; background: white; position: absolute; margin-left: -200px; margin-top: -185px; z-index: 1;top: 50%; left: 50%;"}});t.appendChild(n),r(n),o(e,n),i(e,n)};e.exports={createExportDataUI:f}},function(e,t,a){function r(e,t){var a=s.getLayers(e),r=null;return a.forEach(function(e){if(e)if(e.get("mineLayerName")){var a=e.get("mineLayerName");if(a===t[0])return r=e.get("mineLayerImgToken")}else if(e.get("params.label")){var a=e.get("params.label");if(a===t[0])return r=e.get("imgToken")}}),r}function o(e,t,a){var o=r(e,a);if(!o)return console.warn("%c vector layer not support data export","color:red"),!1;var i=null;if("KML"===t||"KMZ"===t||"Shape"===t||"TAB(Vector)"===t){var s=void 0!=o?o.slice(0,o.indexOf(":")):void 0;i=c+s}else"GRD"!==t&&"GRC"!==t&&"TAB(Raster)"!==t&&"KML(Raster)"!==t||(i=g+o);var u=l.get(e);if(!u)return!1;var y=d.getExtent(e),p=u.getTargetElement();t.indexOf("TAB")!==-1&&(t="TAB"),t.indexOf("KML")!==-1&&(t="KML");var m={extent:y,imgToken:o,Format:t.toLowerCase()},f="kml_kmz_shape_grd_grc_form_id",v=p.querySelector("."+f);v&&p.removeChild(v);var h=n.createDom({tagName:"form",attributes:{style:"display: none",action:i,method:"post","class":f}});p.appendChild(h);var I=n.createDom({tagName:"input",attributes:{type:"hidden",name:"export",value:JSON.stringify(m)}});h.appendChild(I),h.submit()}var n=a(10),i=a(7),l=a(4),s=a(41),d=a(6),c=i.GisRootUrl+"/vectorManager/data/export?FCName=",g=i.GisRootUrl+"/gridManager/data/export?cacheKey=";e.exports={exportFileToClient:o}},function(e,t,a){var r=a(120),o=a(6),n=a(10),i=a(13),l=function(e){var t=e.mapId,a=o.getMapObj(t).getTargetElement(),l=function(e){var t=document.createElement(e.labelName);return!!e.id&&t.setAttribute("id",e.id),!!e["class"]&&t.setAttribute("class",e["class"]),!!e.title&&t.setAttribute("title",e.title),!!e.style&&t.setAttribute("style",e.style),!!e.value&&t.setAttribute("value",e.value),e.text&&(t.innerHTML=e.text),t},s=l({labelName:"div","class":"export-image-window",style:"width: 400px; height: 140px; position: absolute; top: 50%; left: 50%; margin-left: -200px; margin-top: -70px; border:1px solid #EBEBEB; background: white;"});a.appendChild(s);var d=n.createDom({tagName:"div",attributes:{"class":"export_image_header",style:"width: 400px; height: 24px; line-height: 24px; text-indent: 8px; color: #388E8E; border-bottom-style: solid; border-bottom-color: #EBEBEB;border-bottom-width: 1px;"},text:fusiongis.I18n.prop("imageExport.title")});s.appendChild(d);var c=l({labelName:"div","class":"export-image-title",style:"width: 16px; height: 16px;line-height: 16px;text-align: center; background: #388E8E; color: white; position: absolute;top: 4px; right: 4px;cursor: pointer;text-indent: 0px;",text:"X"});d.appendChild(c),c.onclick=function(){a.removeChild(s)};var g=l({labelName:"select","class":"export-image-select",style:"position: absolute;top: 50px;left: 50%;width: 138px;margin-left: -69px;cursor: pointer;"}),u=[fusiongis.I18n.prop("imageExport.exportTypeSel"),"PNG","GIF","JPG"];u.forEach(function(e){var t=l({labelName:"option","class":"export-image-select",style:"",value:e===fusiongis.I18n.prop("imageExport.exportTypeSel")?"png":e,text:e});g.appendChild(t)}),s.appendChild(g);var y=l({labelName:"div",style:"width: 100px; height: 30px;line-height: 30px;position: absolute;bottom: 10px;left: 95px;background-color:#9ACD32;font-weight:bold;color:white;text-align:center;",text:i.prop("components.exportImage.OK")});s.appendChild(y),y.onclick=function(){s.style.display="none";var e=this.parentNode.querySelector(".export-image-select").value;r.exportImage({targetId:t,fileName:"map."+e}),a.removeChild(s)};var p=l({labelName:"div",style:"width: 100px; height: 30px;line-height: 30px;position: absolute;bottom: 10px;left: 205px;background-color:#D4D4D4;font-weight:bold;color:white;text-align:center;",text:i.prop("components.exportImage.Cancel")});s.appendChild(p),p.onclick=function(){a.removeChild(s)}};e.exports={createExportImageUI:l}},function(e,t,a){var r=a(3),o=a(6),n=null,i=function(e){n||(n=new r.interaction.DragZoom({condition:r.events.condition.always}),o.getMapObj(e.mapId).addInteraction(n)),e.isActive?n.setActive(!0):n.setActive(!1)};e.exports={dragZoomInteraction:i}},function(e,t,a){var r=a(3),o=a(6),n=(a(7),a(4)),i=a(48),l=a(8),s=a(16),d=(a(1),a(13)),c=6378137,g=function(e){var t=e.mapId,a=e.layerId+"_line_"+t,i=e.layerId+"_arrow_"+t,l=null,s=null;n.containsKey(a)||n.containsKey(i)||(l=new r.layer.Vector({source:new r.source.Vector({wrapX:!1})}),s=new r.layer.Vector({source:new r.source.Vector({wrapX:!1})}),l.set("mapId",t),l.set("layerId",e.layerId),l.set("popList",[]),n.put(a,l),o.getMapObj(t).addLayer(l),s.set("mapId",t),s.set("layerId",e.layerId),n.put(i,s),o.getMapObj(t).addLayer(s))},u=function(e){var t=e.layerId+"_line_"+e.mapId,a=e.layerId+"_arrow_"+e.mapId,o=n.get(t),g=n.get(a),u=e.data,y=void 0===e.showBreakPoint||e.showBreakPoint,p=void 0!==e.showStraightIcon&&e.showStraightIcon,m=e.breakPointInterval||3,f=e.straightInterval||1e3,v=e.breakPointStyle||{},h=e.straightStyle||{},I=e.lineStyle||{},S=void 0!==e.showMeasure&&e.showMeasure,b=void 0!==e.isClear&&e.isClear,L=l.getMapObj(e.mapId),T=L.getView().getProjection(),w=new r.Sphere(c),E=[],C=[],k=[];if(u&&u.length>1){for(var x=0;x<u.length;x++){var P=r.proj.fromLonLat(u[x].coordinate);if(k.push(P),x<u.length-1){var _=r.proj.fromLonLat(u[x+1].coordinate),O=_[0]-P[0],M=_[1]-P[1],N=180*Math.atan(O/M)/Math.PI;N!==-90&&90!==N||(N*=-1),N+=M>0?360:180,N>360&&(N-=360);for(var F=new r.geom.LineString([P,_]).getLength(),A=parseInt(F/f),R=0;R<A;R++){var G=Math.PI/2-N/180*Math.PI,D=P[0]+(R+1)*f*Math.cos(G),j=P[1]+(R+1)*f*Math.sin(G);if(p){var Y=h.height||500,B=i.createArrow(D,j,Y,N,60),U=new r.geom.LinearRing(B),V=new r.geom.Polygon([U.getCoordinates()]),H=new r.Feature({geometry:V,data:u[x]}),W=new r.style.Style({fill:new r.style.Fill({color:h.fillColor||"blue"}),stroke:new r.style.Stroke({color:h.strokeColor||"blue",width:h.width||1})});H.setStyle(W),E.push(H)}}var z=v.height||500,J=i.createArrow(P[0],P[1],z,N,60),K=new r.geom.LinearRing(J),V=new r.geom.Polygon([K.getCoordinates()]),Z=new r.Feature({geometry:V,data:u[x]}),W=new r.style.Style({fill:new r.style.Fill({color:v.fillColor||"blue"}),stroke:new r.style.Stroke({color:v.strokeColor||"blue",width:v.width||1})});Z.setStyle(W),x%m===0&&x<=u.length-2&&y&&E.push(Z)}}var q=new r.Feature({geometry:new r.geom.LineString(k)}),W=new r.style.Style({stroke:new r.style.Stroke({color:I.strokeColor||"white",width:I.width||2})});q.setStyle(W),C.push(q)}var X=o.get("popList");if(X&&X.length>0){for(var x=0;x<X.length;x++)L.removeOverlay(X[x]);o.set("popList",[])}var $=0;if(S)for(var x=0;x<k.length-1;x++){var Q=r.proj.transform(k[x],T,"EPSG:4326"),ee=r.proj.transform(k[x+1],T,"EPSG:4326"),te=w.haversineDistance(Q,ee);$+=te;var ae;ae=te>100?Math.round(te/1e3*100)/100+"km":Math.round(100*te)/100+"m";var re=document.createElement("div");if(re.className="measure-tooltip mile",x===k.length-2){var oe;oe=$>100?Math.round($/1e3*100)/100+"km":Math.round(100*$)/100+"m",re.innerHTML=ae+";"+d.prop("measure.message.total")+oe}else re.innerHTML=ae;re.style.zIndex=s.getPopupZIndex(L.getTarget());var ne=new r.Overlay({element:re,offset:[-5,-1],positioning:"top-center"});ne.setPosition(k[x+1]),L.addOverlay(ne),X.push(ne)}if(b){if(!!o&&o.getSource().clear(),!!g&&g.getSource().clear(),X.length>0)for(var x=0;x<X.length;x++)L.removeOverlay(X[x]);X=[]}!!o&&o.getSource().addFeatures(C),!!g&&g.getSource().addFeatures(E)};e.exports={addLayer:g,setLayerData:u}},function(e,t,a){function r(e){var t=e,a=0;return e<-180?(a=Math.abs(parseInt((e+180)/360))+1,t+=360*a):e>180&&(a=Math.abs(parseInt((e-180)/360))+1,t-=360*a),t}function o(e,t,a){var r=!0,o=1113190*(90-Math.abs(t));return a>o&&(r=!1),r}var n=a(3),i=a(4),l=a(7),s=function(e){var t=e.callback,a=e.mapId,s=e.layerId,d=e.dataList,c=s+l.Joiner.UNDERLINE+a,g=i.get(a),u=null;i.containsKey(c)?u=i.get(c):(u=new n.layer.Vector({source:new n.source.Vector({wrapX:!1})}),i.put(c,u),g.addLayer(u)),void 0!=paramObj.minShowLevel&&u.set("minShowLevel",parseInt(paramObj.minShowLevel)),void 0!=paramObj.maxShowLevel&&u.set("maxShowLevel",parseInt(paramObj.maxShowLevel)),function(){var e=new n.interaction.Select({layers:[u],wrapX:!1});g.addInteraction(e);var a=new n.interaction.Translate({features:e.getFeatures()});g.addInteraction(a),a.on("translateend",function(e){var a=e.features.getArray()[0],o=n.proj.transformExtent(a.getGeometry().getExtent(),l.PROJ.EPSG_3857,l.PROJ.EPSG_4326);o[0]=r(o[0]),o[2]=r(o[2]),t&&"function"==typeof t&&(Math.abs(o[1])<90&&Math.abs(o[3])<90?t({extent:o}):console.warn("the circle out of range"))});var o=new n.interaction.Modify({features:e.getFeatures()});g.addInteraction(o);var i=!1,s=null;o.on("modifystart",function(e){var a=e.features;if(a&&a.getArray().length>0){var o=a.getArray()[0];if(0==i){var d=o.getGeometry().getExtent(),c=n.extent.getCenter(d);s=g.on("pointermove",function(e){var t=e.coordinate,a=new n.geom.LineString([c,t]),r=a.getLength(),i=new n.geom.Circle(c,r),l=new n.geom.Polygon.fromCircle(i,1e3);o.setGeometry(l)}),i=!0}else if(g.unByKey(s),i=!1,s=null,t&&"function"==typeof t){var u=n.proj.transformExtent(o.getGeometry().getExtent(),l.PROJ.EPSG_3857,l.PROJ.EPSG_4326);u[0]=r(u[0]),u[2]=r(u[2]),Math.abs(u[1])<90&&Math.abs(u[3])<90?t({extent:u}):console.warn("the circle out of range")}}})}(),function(){!!d&&d.forEach(function(e){if(!(e.radius>0))return void console.warn("radius must be greater than 0");var a=e.coordinate[0],i=e.coordinate[1];if(a>180||a<-180)return void console.warn("lon must between -180 at 180");if(i>=90||i<=-90)return void console.warn("lat must between -90 at 90");var s=o(a,i,e.radius);if(!s)return void console.warn("the circle out of range");var d=new n.geom.Circle(n.proj.fromLonLat(e.coordinate),e.radius),c=new n.Feature({geometry:new n.geom.Polygon.fromCircle(d,1e3)});if(c.setId(e.id),u.getSource().addFeature(c),c.setStyle(function(){return new n.style.Style({fill:new n.style.Fill({color:"rgba(33, 150, 243, .6)"}),stroke:new n.style.Stroke({color:"#ff0",width:1})})}),t&&"function"==typeof t){var g=n.proj.transformExtent(c.getGeometry().getExtent(),l.PROJ.EPSG_3857,l.PROJ.EPSG_4326);g[0]=r(g[0]),g[2]=r(g[2]),Math.abs(g[1])<90&&Math.abs(g[3])<90?t({extent:g}):console.warn("the circle out of range")}})}()},d=function(e,t){var a=e.layerId+l.Joiner.UNDERLINE+e.mapId,r=i.get(a);if(r&&r instanceof n.layer.Vector){var o=r.getSource().getFeatures();arguments[1]&&arguments[1]===!0?r.getSource().clear():o.forEach(function(t){t.getId()===e.featureId&&r.getSource().removeFeature(t)})}};e.exports={circle:s,removeGeometry:d}},function(e,t,a){var r=a(7),o=a(14),n=function(e){o.postJSON({url:r.CustomQuery.GET_FEATURE_INFO,data:JSON.stringify(e.requestParam),success:function(t){var a=JSON.parse(t);if(a&&0===a.State.resultCode){var r=a.datas;r&&e.callback&&"function"==typeof e.callback&&e.callback(r)}},failure:function(e){console.log("get feature on custom layer fail:"+e)}})},i=function(e){o.postJSON({url:r.CustomQuery.GET_LAYER_INFO,data:null,success:function(t){var a=JSON.parse(t);if(a&&0===a.State.resultCode){var r=a.datas;r&&e&&"function"==typeof e&&e(r)}},failure:function(e){console.log("get custom layers fail:"+e)}})},l=function(e){o.get({url:r.CustomQuery.GET_COMMON_LAYER_INFO,data:null,success:function(t){var a=JSON.parse(t);a&&1===a.status.code&&a.data&&e&&"function"==typeof e&&e(a.data)},failure:function(e){console.log("get common layers fail:"+e)}})},s=function(e){var t=e.callback;o.postJSON({url:r.CustomQuery.GET_FEATURE_IN_COMMON_LAYER,data:JSON.stringify(e.requestParam),success:function(e){var a=JSON.parse(e);if(a&&1===a.status.code){var r=a.data;r&&t&&"function"==typeof t&&t(r)}},failure:function(e){console.log("get common layers fail:"+e)}})};e.exports={getLayerInfo:i,getFeatureInfo:n,getCommonLayerInfo:l,getFeatureInCommonLayer:s}},function(e,t,a){function r(e){var t=e.coordinate,a=e.sourceProj,r=e.targetProj;return 4===t.length?n.proj.transformExtent(t,a,r):2===t.length?n.proj.transform(t,a,r):n.proj.transform(t,a,r)}function o(){return r({coordinate:[-180,-87,180,87],sourceProj:i.PROJ.EPSG_4326,targetProj:i.PROJ.EPSG_3857})}var n=a(3),i=a(7);e.exports={Transform:{transform:r},Extent:{mapMaxExtent:o},transform:r}},function(e,t,a){function r(e){var t=function(t){var a=e.querySelector(".layer-name").querySelector("select");t.forEach(function(e){a.appendChild(function(){var t=e.layerName;return c.createDom({tagName:"option",attributes:{value:t,title:t},text:!!t&&t.substring(0,30)})}())})},a=[];fusiongis.CustomQuery.getCommonLayerInfo(function(e){var a=[];!!e&&e.forEach(function(e){a.push({layerName:e.name})}),t(a)}),function(){a=a.concat([{layerName:"layer_name_empty_"},{layerName:"layer_name_site_"},{layerName:"layer_name_cell_"},{layerName:"layer_name_polygon_"}])}();var r=c.createDom({tagName:"div",attributes:{"class":"layer-name"}});e.appendChild(r),r.appendChild(function(){return c.createDom({tagName:"span",text:m.prop("search.layerName")+"："})}()),r.appendChild(function(){var e=c.createDom({tagName:"select",attributes:{name:"layerName"}});return a.forEach(function(t){e.appendChild(function(){var e=t.layerName;return"layer_name_site_"===e?e=m.prop("search.site"):"layer_name_cell_"===e?e=m.prop("search.cell"):"layer_name_polygon_"===e?e=m.prop("search.systemPolygon"):"layer_name_empty_"===e&&(e="--"+m.prop("search.choose")+"--"),c.createDom({tagName:"option",attributes:{value:t.layerName},text:e})}())}),e}());var n=r.querySelector("select");n&&(n.onchange=function(){o(e,this.value)})}function o(e,t){var a=e.querySelector(".layer-attr"),r=e.querySelector(".layer-val");a||(a=c.createDom({tagName:"div",attributes:{"class":"layer-attr"}}),e.insertBefore(a,r)),a.innerHTML="",a.appendChild(function(){return c.createDom({tagName:"span",text:m.prop("search.propertyName")+"："})}()),function(){var e=c.createDom({tagName:"select",attributes:{name:"layerAttr"}});a.appendChild(e);var r=function(t){t.forEach(function(t,a){var r=c.createDom({tagName:"option",attributes:{value:t},text:t});e.appendChild(r)})};"layer_name_site_"===t||"layer_name_cell_"===t||"layer_name_polygon_"===t?r(["id","name"]):y.postJSON({url:g.CustomQuery.GET_ATTR_IN_COMMON_LAYER,data:JSON.stringify({featureClassName:t}),success:function(e){var t=JSON.parse(e);if(t&&1===t.status.code){var a=t.data;if(a){var o=[];a.forEach(function(e){o.push(e.columnName)}),r(o)}}},failure:function(e){console.warn("get attribute in layer failed: "+e)}})}()}function n(e,t,a){var r=c.createDom({tagName:"div",attributes:{"class":"layer-val"}});a.appendChild(r),r.appendChild(function(){return c.createDom({tagName:"span",text:m.prop("search.propertyValue")+"："})}());var o=c.createDom({tagName:"input",attributes:{type:"search"}});r.appendChild(o),r.appendChild(function(){var r=c.createDom({tagName:"div",attributes:{"class":"searchBtn"}});return r.onclick=function(){if(!o.value)return console.warn("Search box does not contain a null value!!!"),!1;var r=a.querySelector(".layer-name").querySelector("select").value,n=a.querySelector(".layer-attr").querySelector("select").value,l=t.querySelector(".featureList");l&&t.removeChild(l);var s=c.createDom({tagName:"div",attributes:{"class":"featureList"}});t.appendChild(s);var d=c.createDom({tagName:"div",attributes:{"class":"head"},text:m.prop("search.elementList")});s.appendChild(d);var g=c.createDom({tagName:"div",attributes:{"class":"close"},text:"X"});d.appendChild(g),g.onclick=function(){t.removeChild(s)};var u=c.createDom({tagName:"div",attributes:{"class":"content"}});s.appendChild(u),fusiongis.CustomQuery.getFeatureInCommonLayer({requestParam:{featureClassName:r,columnName:n,value:[o.value],operator:"like"},callback:function(t){if(t&&t.fcObjectList){var a=t.fcObjectList;a.forEach(function(t){if(!t)return!1;var a=t.fcObjectId||t.attributeList.SECTOREQMKEY||t.attributeList.POLYGONID||t.attributeList.SITEKEY||t.attributeList.BTSNAME,r=t.attributeList&&t.attributeList.name||t.attributeList.CELLNAME||t.attributeList.POLYGONNAME||t.attributeList.NOdEBNAME||t.attributeList.ENODEBNAME||t.attributeList.BTSNAME,o="";r&&a?o=r+" "+a:r&&!a?o=r:!r&&a&&(o=a);var n=p.htmlDecode(t.geometry),l=function(){var e=p.getWKTFromText(n),t=e.coordinates,a=e.geoType;return{coordinate:t,geomType:a}}(),s=c.createDom({tagName:"div",attributes:{id:a,coordinate:l.coordinate,geomType:l.geomType,title:o},text:o});u.appendChild(s),i(e,s)})}}})},r}())}function i(e,t){t&&(t.onclick=function(a){a.stopPropagation();var r=t.getAttributeNode("coordinate").value,o=t.getAttributeNode("geomtype").value;if(!r)return!1;var n=0,i=0;if(r.indexOf("[[")!==-1&&r.indexOf("]]")!==-1){var l=r.substring(2,r.length-2);if(l.indexOf("],[")){var s=l.split("],["),d=s[0].split(",");n=parseFloat(d[0]),i=parseFloat(d[1])}else{var d=l.split(",");n=parseFloat(d[0]),i=parseFloat(d[1])}n&&i&&fusiongis.Map.setMapCenter({mapId:e,coordinate:[n,i],zoom:o&&"Point"===o?17:void 0})}else if(r.indexOf(",")!=-1){var d=r.split(","),n=parseFloat(d[0]),i=parseFloat(d[1]);n&&i&&fusiongis.Map.setMapCenter({mapId:e,coordinate:[n,i],zoom:o&&"Point"===o?17:void 0
})}})}function l(e,t,a){for(var r=t.querySelectorAll(".tab-item"),o=function(e,a){t.querySelector(e)&&(t.querySelector(e).style.display="block"),t.querySelector(a)&&(t.querySelector(a).style.display="none")},n=0;n<r.length;n++){var i=r[n];i.onclick=function(){var t=this.classList;if("tab-online"===t[0])o(".content-online",".content-offline");else if("tab-offline"===t[0]){var r=e.querySelector(".content-offline");r||(r=c.createDom({tagName:"div",attributes:{"class":"content-offline content"}}),e.appendChild(r)),a(r),o(".content-offline",".content-online")}}}}function s(e,t,a,r,o,n){fusiongis.Search.searchLocal({serviceVendor:r,address:o.value,key:window.sessionStorage?sessionStorage.getItem("key"):Cookie.read("key"),callback:function(r){!!r&&r.forEach(function(r){var o=r.centerLonLat,i=r.displayName,l=r.bbox,s=c.createDom({tagName:"div",attributes:{title:i},text:i.substring(0,25)+"..."});a.appendChild(s),s.onclick=function(){l.length?fusiongis.Map.setExtent({mapId:e,extent:l}):fusiongis.Map.setMapCenter({coordinate:o,zoom:10,mapId:e}),fusiongis.Search.clearMarker(e),fusiongis.Search.addMarker({mapId:e,coordinate:o,imgUrl:n||fusiongis.Constant.GisResourceURL+"search/search-result-icon.png"}),t.style.display="none"}})}})}function d(e){e.appendChild(function(){var e=c.createDom({tagName:"div",attributes:{"class":"tab"}});return e.appendChild(function(){return c.createDom({tagName:"div",attributes:{"class":"tab-online tab-item"},text:m.prop("search.online")})}()),e.appendChild(function(){return c.createDom({tagName:"div",attributes:{"class":"border"}})}()),e.appendChild(function(){return c.createDom({tagName:"div",attributes:{"class":"tab-offline tab-item"},text:m.prop("search.offline")})}()),e}())}var c=a(10),g=a(7),u=a(4),y=a(14),p=a(1),m=a(13),f=function(e){var t=e.mapId,a=u.get(t).getTargetElement(),o=null;!function(){o=a.querySelector(".search");var e=80,r=a.querySelector(".export-image")&&a.querySelector(".export-image").style.display,n=a.querySelector(".map-mode")&&a.querySelector(".map-mode").style.display;"block"!==r&&"block"!==n||(e=110),"block"===r&&"block"===n&&(e=140);var i=function(){o=c.createDom({tagName:"div",attributes:{id:t+"_search","class":"search",style:"right: "+e+"px"}}),a.appendChild(o)};o&&a.removeChild(o),i(),setTimeout(function(){p.dragBox([t+"_search"],[t])})}(),function(){var e=c.createDom({tagName:"div",attributes:{"class":"header"},text:m.prop("search.title")});o.appendChild(e);var t=c.createDom({tagName:"div",attributes:{"class":"close-btn"},text:"X"});e.appendChild(t),t.onclick=function(){a.removeChild(o)}}();var i=c.createDom({tagName:"div",attributes:{"class":"body"}});o.appendChild(i),d(i),function(){var a=c.createDom({tagName:"div",attributes:{"class":"content-online content"}});i.appendChild(a);var r=c.createDom({tagName:"div",attributes:{"class":"header"}});a.appendChild(r);var n=c.createDom({tagName:"input",attributes:{type:"search"}});r.appendChild(n);var l=c.createDom({tagName:"div",attributes:{"class":"searchBtn"},title:m.prop("search.click.search")});r.appendChild(l);var d=c.createDom({tagName:"div",attributes:{"class":"body"}});a.appendChild(d),l.onclick=function(){d.innerHTML="";var a=function(){var e=void 0,a=u.get(t),r=a.getLayers(),o=r.item(0);return o&&o.get("mapType")&&(e=o.get("mapType")),e}(),r=document.getElementById("$$customMap_"+t);r&&(a="GOOGLE"),a?s(t,o,d,a,n,e.imgUrl):d.innerHTML=m.prop("search.current.map.not.support")}}(),l(i,o,function(e){e.innerHTML="",r(e),n(t,o,e)})};e.exports={createSearchUI:f}},function(e,t,a){var r=a(3),o=a(6),n=a(4),i=a(7),l=(a(1),function(e){var t=e.mapId,a=e.layerId,l=a+"_"+t,s=o.getMapObj(t),d=(s.getView().getZoom(),e.label?e.label:e.layerId),c=null;return n.get(l)?c=n.get(l):(c=new r.layer.Image({opacity:e.opacity||.7}),c.set("layerId",a),c.set("mapId",t),c.set("businessType",i.BUSINESSTYPE.HEAT_MAP),c.set("isVectorType",!1),c.set("params.label",d),s.addLayer(c),n.put(l,c)),void 0!=e.minShowLevel&&c.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&c.set("maxShowLevel",parseInt(e.maxShowLevel)),c}),s=function(e){var t="https://127.0.0.1:11251/fusiongis";t+="/heatmap.do";var a=o.getMapObj(e),n=o.getExtent(e),i=[n[0],n[1]],l=[n[2],n[3]],s=r.proj.toLonLat(i),d=r.proj.toLonLat(l),c=a.getSize();return t=t+"?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&FORMAT=image%2Fpng&TRANSPARENT=true&minx="+s[0]+"&miny="+s[1]+"&maxx="+d[0]+"&maxy="+d[1]+"&width="+c[0]+"&height="+c[1]+"&featureClassName=m49ed41dd3c2b4b6ab03baed853e7a2fc_places"},d=function(e){var t=e.mapId,a=e.layerId,i=a+"_"+t,l=n.get(i),d=o.getMapObj(t),c=null,g=s(t);c=new r.source.ImageStatic({projection:"EPSG:3857",url:g,imageExtent:o.getExtent(t)}),!!l&&l.setSource(c),d.on("moveend",function(){var e=s(t);c=new r.source.ImageStatic({projection:"EPSG:3857",url:e,imageExtent:o.getExtent(t)}),!!l&&l.setSource(c)});var u=d.getView();u.on("change:resolution",function(){var e=s(t);c=new r.source.ImageStatic({projection:"EPSG:3857",url:e,imageExtent:o.getExtent(t)}),!!l&&l.setSource(c)})};e.exports={createLayer:l,addServiceHeatMap:d}},function(e,t,a){var r=(a(3),function(e){if(!e)return!1;e[0].length>0&&e[0][0][0]!==e[0][e[0].length-1][0]&&e[0][0][1]!==e[0][e[0].length-1][1]&&e[0].push(e[0][0]);var t={type:"Feature",properties:{fill:"#00f"},geometry:{type:"Polygon",coordinates:e}};return t}),o=function(e,t){var a=r(e),o=r(t),n=turf.union(a,o);if(n&&n.geometry){var i=n.geometry;return{type:i.type,coordinates:function(){return"Polygon"===i.type?i.coordinates[0]:"MultiPolygon"===i.type?i.coordinates:void 0}()}}return{}};e.exports={getUnionPolygonCoordinates:o}},function(e,t,a){var r=(a(3),function(e){if(!e)return!1;e[0].length>0&&e[0][0][0]!==e[0][e[0].length-1][0]&&e[0][0][1]!==e[0][e[0].length-1][1]&&e[0].push(e[0][0]);var t={type:"Feature",properties:{fill:"#00f"},geometry:{type:"Polygon",coordinates:e}};return t}),o=function(e,t){var a=r(e),o=r(t),n=turf.intersect(a,o);if(n&&n.geometry){var i=n.geometry;return{type:i.type,coordinates:function(){return"Point"===i.type?i.coordinates:"Polygon"===i.type?i.coordinates[0]:void 0}()}}return{}};e.exports={getIntersectPolyCoordinates:o}},function(e,t,a){var r=(a(3),function(e){if(!e)return!1;e[0].length>0&&e[0][0][0]!==e[0][e[0].length-1][0]&&e[0][0][1]!==e[0][e[0].length-1][1]&&e[0].push(e[0][0]);var t={type:"Feature",properties:{fill:"#00f"},geometry:{type:"Polygon",coordinates:e}};return t}),o=function(e,t){var a=r(e),o=r(t),n=turf.difference(a,o);if(n&&n.geometry){var i=n.geometry;return{type:i.type,coordinates:i.coordinates}}return{}};e.exports={getDiffPolyCoordinates:o}},function(e,t,a){function r(e){var t=e.mapId,a=n.getMapObj(t),r=a.get("state");r?l(e):i(e)}var o=a(3),n=a(6),i=function(e){var t=e.mapId,a=1e6;if(void 0!=e.distance){var r=parseInt(e.distance);r>=500?a=r:console.warn("the distance must greater than or equal to 500!!!")}var i=e.lineColor?e.lineColor:[0,100,250,.6],l=e.lineWidth?e.lineWidth:1.5,s=e.lineDash?e.lineDash:[2,5],d=n.getMapObj(t),c=new o.source.Vector({wrapX:!1}),g=new o.layer.Vector({id:"myLayer",source:c});g.set("id","myLayer"),d.addLayer(g);for(var u=o.proj.fromLonLat([180,0])[0],y=o.proj.fromLonLat([0,85])[1],p=2*u,m=2*y,f=Math.round(m/a),v=Math.round(p/a),h=new o.style.Style({stroke:new o.style.Stroke({width:l,color:i,lineDash:s})}),I=[],S={},b=0;b<=f;b++)S=new o.Feature,S.setGeometry(new o.geom.LineString([[-u,-y+a*b],[u,-y+a*b]])),S.setStyle(h),I.push(S);for(var b=0;b<=v;b++)S=new o.Feature,S.setGeometry(new o.geom.LineString([[-u+a*b,y],[-u+a*b,-y]])),S.setStyle(h),I.push(S);g.getSource().addFeatures(I),d.set("state",!0)},l=function(e){var t=e.mapId,a=n.getMapObj(t),r=a.getLayers();r.forEach(function(e){"myLayer"==e.get("id")&&(a.removeLayer(e),a.set("state",!1))})};e.exports={addGrid:i,removeGrid:l,toggleGrid:r}},function(e,t,a){var r=a(3),o=a(6),n=function(e){for(var t=e.mapId,a=e.points,n=new r.source.Vector({wrapX:!1}),i=new r.layer.Vector({source:n}),l=[],s=new r.Feature,d=a.length,c=0;c<d;c++)a[c]=r.proj.fromLonLat(a[c]);var g=new r.geom.Polygon([a]),u=new r.style.Style({stroke:new r.style.Stroke({width:1.5,color:[255,255,0,1]}),fill:new r.style.Fill({color:[0,255,0,.7]})});s.setGeometry(g),s.setStyle(u),l.push(s),n.addFeatures(l);var y=o.getMapObj(t);if(y.addLayer(i),d>=4&&a[0][0]===a[d-1][0]&&a[0][1]===a[d-1][1])for(var c=1;c<d-2;c++){for(var p=c+1;p<d-1;p++)if(a[c][0]===a[p][0]&&a[c][1]===a[p][1])return void console.log("该多边形自相交");c==d-3&&console.log("该多边形不自相交")}};e.exports={judgeConnection:n}},function(e,t,a){function r(e){for(var t,a,r,n,i,l=(new o.format.GeoJSON).readFeatures(e),s=[],d=0;d<l.length;d++)n=l[d].getId(),t=l[d].getProperties().name,a=l[d].getGeometry().getType(),r=l[d].getGeometry().getCoordinates(),i={id:n,name:t,type:a,coordinates:r[0]},s.push(i);return s}var o=a(3);e.exports={getDataByGeoJson:r}},function(e,t){},function(e,t,a){function r(e){var t=i.getMapObj(e.mapId);this.drag=new l.Drag(e),t.addInteraction(this.drag)}function o(e){var t=i.getMapObj(e);t.removeInteraction(this.drag)}var n=a(3),i=a(6),l={};l.Drag=function(e){this.handleDownEvent=e.handleDownEvent,this.handleDragEvent=e.handleDragEvent,this.handleMoveEvent=e.handleMoveEvent,this.handleUpEvent=e.handleUpEvent,this.cursor_=e.cursor||"pointer",this.type=e.type,this.featureId=e.featureId,n.interaction.Pointer.call(this,{handleDownEvent:l.Drag.prototype.handleDownEvent,handleDragEvent:l.Drag.prototype.handleDragEvent,handleMoveEvent:l.Drag.prototype.handleMoveEvent,handleUpEvent:l.Drag.prototype.handleUpEvent}),this.coordinate_=null,this.feature_=null,this.previousCursor_=void 0},n.inherits(l.Drag,n.interaction.Pointer),l.Drag.prototype.handleDownEvent=function(e){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){return e});return a&&(this.coordinate_=e.coordinate,this.feature_=a),this.handleDownEvent&&"function"==typeof this.handleDownEvent&&(void 0==a?this.handleDownEvent({}):this.handleDownEvent({evt:e,feature:a,data:a.get("data"),extent:n.proj.transformExtent(a.getGeometry().getExtent(),"EPSG:3857","EPSG:4326")})),!!a},l.Drag.prototype.handleDragEvent=function(e){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){return e});if(this.featureId){if(this.feature_.getId()!==this.featureId)return!1;var r=e.coordinate[0]-this.coordinate_[0],o=e.coordinate[1]-this.coordinate_[1],i=this.feature_.getGeometry();i.translate(r,o),this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1];var l=this.feature_.get("layer"),s=this.feature_.getId();if(l){var d=l.get("datas");if(d&&d.length>0)for(var c=0,g=d.length;c<g;c++)if(s===d[c].id){d[c].coordinate=n.proj.toLonLat(e.coordinate);break}}this.handleDragEvent&&"function"==typeof this.handleDragEvent&&(void 0==a?this.handleDragEvent({}):this.handleDragEvent({evt:e,feature:this.feature_,data:this.feature_.get("data"),extent:n.proj.transformExtent(a.getGeometry().getExtent(),"EPSG:3857","EPSG:4326")}))}else{var r=e.coordinate[0]-this.coordinate_[0],o=e.coordinate[1]-this.coordinate_[1],i=this.feature_.getGeometry();i.translate(r,o);var l=this.feature_.get("layer"),s=this.feature_.getId();if(l){var d=l.get("datas");if(d&&d.length>0)for(var c=0,g=d.length;c<g;c++)if(s===d[c].id){d[c].coordinate=n.proj.toLonLat(e.coordinate);break}}this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1],this.handleDragEvent&&"function"==typeof this.handleDragEvent&&(void 0==a?this.handleDragEvent({}):this.handleDragEvent({evt:e,feature:this.feature_,data:this.feature_.get("data"),extent:n.proj.transformExtent(a.getGeometry().getExtent(),"EPSG:3857","EPSG:4326")}))}},l.Drag.prototype.handleMoveEvent=function(e){if(this.cursor_){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,function(e){return e}),r=e.map.getTargetElement();a?r.style.cursor!=this.cursor_&&(this.previousCursor_=r.style.cursor,r.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(r.style.cursor=this.previousCursor_,this.previousCursor_=void 0),this.handleMoveEvent&&"function"==typeof this.handleMoveEvent&&this.handleMoveEvent({evt:e,feature:a,data:a.get("data"),extent:n.proj.transformExtent(a.getGeometry().getExtent(),"EPSG:3857","EPSG:4326")})}},l.Drag.prototype.handleUpEvent=function(e){return this.coordinate_=null,this.feature_=null,this.handleMoveEvent&&"function"==typeof this.handleMoveEvent&&this.handleMoveEvent(e),!1},e.exports={addDrag:r,removeDrag:o}},function(e,t,a){function r(e){var t=e.layerId+"_"+e.mapId,a=i.getMapObj(e.mapId),r=e.label?e.label:e.layerId;if(!l.containsKey(t)){var o=new n.layer.Tile({source:new n.source.XYZ({wrapX:!1})});o.set("map",a),o.set("layerId",t),o.set("layer_id",e.layerId),o.set("params.label",r),o.set("legendName",e.legendName),o.set("businessType",s.BUSINESSTYPE.GRID),o.setZIndex(s.Z_INDEX.GRID),void 0!=e.minShowLevel&&o.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&o.set("maxShowLevel",parseInt(e.maxShowLevel)),l.put(t,o),a.addLayer(o)}}function o(e){var t=e.layerId+"_"+e.mapId,a=l.get(t);a&&(a.set("legendName",e.legendName),a.getSource().setUrl(e.url),a.set("paramObj",e))}var n=a(3),i=a(6),l=a(4),s=a(7);a(1),a(16),a(11);e.exports={addLayer:r,setLayerData:o}},function(e,t,a){var r=a(14);e.exports={setHeader:function(){var e=location.search,t=new Object;if(e.indexOf("?")!=-1)for(var a=e.substr(1),o=a.split("&"),n=0;n<o.length;n++)t[o[n].split("=")[0]]=o[n].split("=")[1];t.hasOwnProperty("devMode")||t.devMode||r.setHeader()}()}},function(e,t,a){function r(e){this.source=e.source,this.trackId=e.uniqueIdentify,this.mapId=e.mapId,this.layerId=e.layerId,this.coordinates=e.coordinates,this.style=e.style,this.showLine=e.showLine,this.isKeepTrack=e.isKeepTrack,this.cycling=e.cycling,this.speedRate=e.speedRate||1,this.callback=e.callback,this._position=-1,this._finalPosition=this.coordinates.length-1,this._playing=!1,this._finished=!1,this._lineFeature=null,this._arrowFeature=null,this._pointFeatures=[],this._dotHandler=null,this._addLine(),this._addPoints()}function o(e){var t=this;this._playing=!1,this.playerUnit=[],e.datas.forEach(function(a){var o=r.$new({source:e.source,uniqueIdentify:a.uniqueIdentify,mapId:e.mapId,layerId:e.layerId,coordinates:a.coordinates,style:a.style,showLine:e.showLine,isKeepTrack:e.isKeepTrack,cycling:e.cycling,speedRate:e.speedRate,callback:e.callback});t.playerUnit.push(o)})}function n(e){var t=e.mapId,a=e.layerId+"_"+t,r=null;i.containsKey(a)?r=i.get(a):(d.createLayer(e),r=i.get(a)),e.source=r.getSource();var n=c[t];n?n.length&&n.destroy():c[t]=o.$new(e)}var i=a(4),l=a(7),s=a(1),d=a(5);r.$new=function(e){return new this(e)},r.prototype._addLine=function(){var e=this.source,t=this.style,a=this.coordinates.map(function(e){return ol.proj.fromLonLat(e.slice(0,2))});this._lineFeature=new ol.Feature({geometry:new ol.geom.LineString(a),businessType:l.BUSINESSTYPE.TRACK_SHOW_LINE}),t&&t.lineStrokeColor&&this._lineFeature.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:t.lineStrokeColor,width:t.lineStrokeWidth?t.lineStrokeWidth:3})}));var r=a.slice(-2),o=r[1][0]-r[0][0],n=r[1][1]-r[0][1],i=-Math.atan2(n,o)+Math.PI/2,s=new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:t?t.lineStrokeColor:"blue"}),stroke:new ol.style.Stroke({color:t?t.lineStrokeColor:"blue",width:1}),points:3,radius:10,rotation:i,angle:0})});this._arrowFeature=new ol.Feature({geometry:new ol.geom.Point(r[1]),businessType:l.BUSINESSTYPE.TRACK_SHOW_LINE}),this._arrowFeature.setStyle(s),this.showLine||(this._lineFeature.setGeometryName("invisible"),this._arrowFeature.setGeometryName("invisible")),e.addFeature(this._lineFeature),e.addFeature(this._arrowFeature)},r.prototype._addPoints=function(){var e,t=this,a=t.style;e=a?new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:a.fillColor?a.fillColor:"#319FD3"}),radius:a.radius?a.radius:5,stroke:new ol.style.Stroke({color:a.strokeColor?a.strokeColor:"#ff0",width:a.strokeWidth?a.strokeWidth:1})})}):new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"#319FD3"}),radius:5,stroke:new ol.style.Stroke({color:"#ff0",width:1})})}),t.coordinates.forEach(function(a,r){var o=new ol.geom.Point(ol.proj.fromLonLat(a.slice(0,2))),n=new ol.Feature({geometry:o,businessType:l.BUSINESSTYPE.TRACK_SHOW});n.setStyle(e),n.setId("trackPoint_"+r),n.setGeometryName("invisible"),t._pointFeatures.push(n)}),t.source.addFeatures(t._pointFeatures)},r.prototype["continue"]=function(){this._position===-1?this.playAtPosition(0):this.playAtPosition(this._position)},r.prototype.playAtPosition=function(e){if(null!==e&&isFinite(e)&&!(e<0&&e>this._finalPosition)){if(this._position===this._finalPosition&&!this.cycling)return this._playing=!1,void(this._finished=!0);this._playing&&clearTimeout(this._dotHandler),this._playing=!0,this._finished=!1;var t="track_"+(new Date).getTime().toString(16);this._dot(t,e)}},r.prototype.previous=function(){var e=this._position;e>0?e-=1:e=this.cycling?this._finalPosition:0,this._playing?this.playAtPosition(e):this.setPosition(e)},r.prototype.next=function(){var e=this._position;e<this._finalPosition?e+=1:e=this.cycling?0:this._finalPosition,this.isPlaying()?this.playAtPosition(e):this.setPosition(e)},r.prototype._dot=function(e,t){if(t>=0?this.setPosition(t):this.cycling&&this._position===this._finalPosition?this.setPosition(0):this.setPosition(this._position+1),this._position===this._finalPosition){if(!this.cycling)return this.setPosition(this._position+1),this._playing=!1,this._finished=!0,void(this.callback&&this.callback({data:this.coordinates[this._position],position:this.position}))}else this.callback&&this.callback({data:this.coordinates[this._position],position:this._position});this.callback&&this.callback({data:this.coordinates[this._position],position:this._position}),this._dotHandler=setTimeout(this._dot.bind(this),this._getInterval(),e)},r.prototype._getInterval=function(){var e=500/this.speedRate,t=this.coordinates[this._position];return t.length>2&&(e=t[2]/this.speedRate),e},r.prototype.setPosition=function(e){null===e||!isFinite(e)||this._position===e||e<0&&e>this._finalPosition||(this._position=e,this.isKeepTrack?this._pointFeatures.forEach(function(t,a){var r=t.getGeometryName();a<=e?"geometry"!==r&&t.setGeometryName("geometry"):"invisible"!==r&&t.setGeometryName("invisible")}):this._pointFeatures.forEach(function(t,a){var r=t.getGeometryName();a===e?"geometry"!==r&&t.setGeometryName("geometry"):"invisible"!==r&&t.setGeometryName("invisible")}))},r.prototype.getPosition=function(){return this._position},r.prototype.isPlaying=function(){return this._playing},r.prototype.isFinished=function(){return this._finished},r.prototype.pause=function(){this._playing&&(this._playing=!1,clearTimeout(this._dotHandler))},r.prototype.destroy=function(){this._dotHandler&&clearTimeout(this._dotHandler),this.source=null,this.trackId=null,this.mapId=null,this.layerId=null,this.coordinates=null,this.style=null,this.showLine=null,this.isKeepTrack=null,this.cycling=null,this.speedRate=null,this.callback=null,this._position=null,this._finalPosition=null,this._playing=null,this._finished=null,this._lineFeature=null,this._arrowFeature=null,this._pointFeatures=null,this._dotHandler=null},o.$new=function(e){return new this(e)},o.prototype.getPlayer=function(e){return this.playerUnit.find(function(t){return t.trackId===e})},o.prototype.each=function(e){this.playerUnit.forEach(e.bind(this))},o.prototype.start=function(e){this.each(function(t){s.isValid(e)?t.playAtPosition(e):t["continue"]()})},o.prototype.previous=function(){this.each(function(e){e.previous()})},o.prototype.next=function(){this.each(function(e){e.next()})},o.prototype.pause=function(){this.each(function(e){e.pause()})},o.prototype.position=function(e,t){var a=this.getPlayer(e);if(a){if(!s.isValid(t))return a.getPosition();a.setPosition(t)}},o.prototype.destroy=function(){this.each(function(e){e.destroy()}),this.playerUnit.splice(0)};var c={};e.exports={addTrackShow:n,pause:function(e){var t=c[e];t&&t.pause()},start:function(e,t){var a=c[e];a&&a.start(t)},position:function(e,t,a){var r=c[e];if(r)return r.position(t,a)},isPlaying:function(e,t){var a=c[e];if(a){var r=a.getPlayer(t);return r?r.isPlaying():void 0}},pre:function(e){var t=c[e];t&&t.previous()},next:function(e){var t=c[e];t&&t.next()},destroy:function(e){var t=c[e];t&&t.destroy(),delete c[e]}}},function(e,t,a){function r(e,t){var a=s.getLayer({mapId:e,layerId:t});a&&(this.mapId=e,this.layerName=t,this.layer=a,this.intervalType=c.fixed,this.process=-1,this.finalProcess=-1,this.stepTime=500,this.isPlaying=!1,this.speed=1,this.playCallback=function(){},this.data=[])}function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function n(e,t){var a=l.getMapObj(e);if(a){var o=a.get(d);o&&o.destroy();var n=new r(e,t);return a.set(d,n),{setAllData:function(e){n.setData(e)},setTimeInterval:function(e){n.setStepTime(e)},setSpeed:function(e){n.setSpeed(e)},startInterval:function(e,t){n.setIntervalType(e),n.setPlayCallback(t),n.process===-1&&(n.process=0),n.playAt(n.process)},resumeInterval:function(){var e=n.getProcess();n.playAt(e,!0)},pauseInterval:function(){n.pause()},stopInterval:function(){n._setProcess(n.finalProcess),n.pause()},getIsPlayFinished:function(){var e=n.getProcess(),t=n.finalProcess;return n.isPlaying===!1&&e>=t},setIntervalProcess:function(e,t){n.isPlaying?n.playAt(e,t):n.setProcess(e,t)},getIntervalProcess:function(){return n.getProcess()}}}}var i=a(3),l=a(6),s=a(5),d="lastTrack",c={fixed:0,real:1};r.prototype.setData=function(e){if(!(e&&e instanceof Array&&e.length))return!1;this.data=e,this.finalProcess=e.length-1;var t=this.layer.getSource();t.getFeatures().forEach(function(e,t){e.setGeometryName("invisible")})},r.prototype.getItem=function(e){if(this.data&&this.data.length&&Number.isFinite(e)&&(e=Number(e),!(e<0||e>this.finalProcess)))return this.data[e]},r.prototype.setIntervalType=function(e){Number.isFinite(e)&&[0,1].indexOf(Number(e))>-1&&(this.intervalType=e)},r.prototype.setPlayCallback=function(e){e&&(this.playCallback=e)},r.prototype.setProcess=function(e,t){return!!Number.isFinite(e)&&(e=Number(e),!(e<0||e>this.finalProcess)&&(this._setProcess(e),void(t||this.playCallback.call(null,{mapId:this.mapId,layerName:this.layerName,data:this.data[this.process],realDeltaTime:this.deltaTime,realTime:this.lastTime,process:this.process,intervalType:this.intervalType,stepTime:this.stepTime,speed:this.speed}))))},r.prototype._setProcess=function(e){if(Number.isFinite(e)&&(e=Number(e),!(e<0||e>this.finalProcess)&&this.process!==e)){this.process=e;var t=new Date;this.lastTime?this.deltaTime=t.getTime()-this.lastTime:this.deltaTime=0,this.lastTime=t,this.focus();var a=this.layer.getSource(),r=a.getFeatures();r.forEach(function(t){var a=Number(t.getId().split("_")[1]),r=t.getGeometryName();a<=e?"geometry"!==r&&t.setGeometryName("geometry"):"invisible"!==r&&t.setGeometryName("invisible")})}},r.prototype.focus=function(){var e=this.getProcess(),t=this.getItem(e);if(!(Number(t.lon)<-180||Number(t.lon)>180||Number(t.lat)<-85||Number(t.lat)>85)){var a=i.proj.fromLonLat([t.lon,t.lat]),r=l.getExtent(this.mapId);0!==e&&i.extent.containsCoordinate(r,a)||l.getMapObj(this.mapId).getView().setCenter(a)}},r.prototype.getProcess=function(){return this.process},r.prototype.setSpeed=function(e){!Number.isFinite(e)||e<=0||(this.speed=Number(e))},r.prototype.setStepTime=function(e){Number.isFinite(e)&&(this.stepTime=e)},r.prototype.playAt=function(e,t){function a(e){if(i.isPlaying!==!1&&i.flow.id===e.id){var t=i.getProcess()+1;if(t===i.finalProcess)return i.callbackHander=0,e.process=t,i.setProcess(t),i.isPlaying=!1,void(i.flow=null);if(e.process=t,i.setProcess(t),i.isPlaying&&i.process===e.process){var r=i.stepTime/i.speed;i.callbackHander=setTimeout(a,r,e),i.flow.stepHandler=i.callbackHander}}}function r(e){if(i.isPlaying!==!1&&i.flow.id===e.id){var t=i.getProcess()+1;if(t===i.finalProcess)return i.callbackHander=0,e.process=t,i.setProcess(t),i.isPlaying=!1,void(i.flow=null);if(e.process=t,i.setProcess(t),i.isPlaying&&i.process===e.process){var a=i.getItem(t).time,o=i.getItem(t+1).time,n=(o-a)/i.speed;i.callbackHander=setTimeout(r,n,e),i.flow.stepHandler=i.callbackHander}}}var n,i=this;if(!Number.isFinite(e))return!1;if(e=Number(e),e<0||e>this.finalProcess)return!1;if((this.process!==e||!this.flow)&&(this.callbackHander&&clearTimeout(this.callbackHander),this.setProcess(e,t),e!==this.finalProcess))if(this.flow={id:o,process:e,timeStamp:(new Date).getTime()},this.intervalType===c.fixed)n=this.stepTime/this.speed,this.isPlaying=!0,this.callbackHander=setTimeout(a,n,this.flow),this.flow.stepHandler=this.callbackHander;else if(this.intervalType===c.real){var l=this.getItem(e).time,s=this.getItem(e+1).time;n=(s-l)/this.speed,this.isPlaying=!0,this.callbackHander=setTimeout(r,n,this.flow),this.flow.stepHandler=this.callbackHander}},r.prototype.pause=function(){this.callbackHander&&(clearInterval(this.callbackHander),this.flow=null),this.isPlaying=!1},r.prototype.destroy=function(){this.callbackHander&&clearInterval(this.callbackHander),this.layer&&this.layer.getSource()&&this.layer.getSource().clear(),this.mapId=null,this.layerName=null,this.layer=null,this.intervalType=0,this.process=-1,this.finalProcess=-1,this.stepTime=500,this.isPlaying=!1,this.speed=1,this.data=null},e.exports={instanceTrack:n}},function(e,t,a){function r(e){var t=[K,J,Z,X,q];z.removeLayer({mapId:e,layerIds:t});var a=[Q,ee,ae,te,re];x(e,a);for(var r=[K,J],o=0;o<r.length;o++)z.createLayer({mapId:e,layerId:r[o]});var n=z.getLayer({mapId:e,layerId:J});n.setZIndex(530),z.getLayer({mapId:e,layerId:K}).setZIndex(520),n.setStyle(new H.style.Style({stroke:new H.style.Stroke({color:[19,129,255,255],width:2}),fill:new H.style.Fill({color:[255,255,255,0]})}))}function o(e){var t=W.getMapObj(e);t.on("singleclick",function(t){ie=!1;for(var a=[ee,Q,te,ae,re],r=!1,o=0;o<a.length;o++)k(e,a[o])&&k(e,a[o]).getActive()&&(r=!0);r||oe.sel(t,e)}),t.on("dblclick",function(e){ie=!0;for(var t in ne)ne[t](e)})}function n(e,t,a){var r=k(e,ee),o=k(e,Q);return r&&r.getActive()||o&&o.getActive()?void this.chooseRoadCancel(e,t):(O(e,J,[],!0),void("polygon"===t?s(e,a):d(e,a)))}function i(e,t){o(e),t.GisTokenName&&(se.name=t.GisTokenName,se.value=t.GISTokenValue)}function l(e,t){t?le[e]=t:le[e]=[]}function s(e,t){function a(a){M("polygon",!0);var r=a.feature.getGeometry().getCoordinates()[0];setTimeout(function(){var t=z.getLayer({mapId:e,layerId:J});t.getSource().clear()},20);var n={};n.business="getRoadByPolygon";var i=_.map(r,function(e){return P(e,3857)});return n.data={roadLayer:le[e],points:[i]},i.length>201?(t({polygonPoints:i}),setTimeout(function(){o.setActive(!1)},10),O(e,J,[],!0),void M("polygon",!1)):(B(de,n,function(a){M("polygon",!1),o.setActive(!1),O(e,J,[],!0);try{var r=JSON.parse(a);if(_.isEmpty(r)||r.message)throw new Error("polygon select road mode response is error")}catch(n){return}a=JSON.parse(a),t(a.geometries)}),setTimeout(function(){o.setActive(!1)},10),void O(e,J,[],!0))}var r=z.getLayer({mapId:e,layerId:J}),o=new H.interaction.Draw({source:r.getSource(),type:"Polygon",style:new H.style.Style({stroke:new H.style.Stroke({width:2,color:"#42A8CF"}),fill:new H.style.Fill({color:"rgba(255, 255, 255, 0.5)"}),image:new H.style.Circle({radius:5,stroke:new H.style.Stroke({color:"rgba(255, 255, 255, 0.7)"}),fill:new H.style.Fill({color:"#42A8CF"})})})});o.set("id","polygonInter");var n=W.getMapObj(e);n.addInteraction(o),o.setActive(!0),o.on("drawend",a)}function d(e,t){var a=W.getMapObj(e),r=null,o=1,n={},i=[],l=z.getLayer({mapId:e,layerId:K}),s=function(a){var r=P(a.coordinate,3857);if(O(e,J,[],!0),setTimeout(function(){c.setActive(!1),x(e,[Q]),d=[]},10),1!==o){var l={business:"roadSimulation",data:{action:"execute",data:[{routeId:-1,layerId:"-1",geometry:{x:r[0],y:r[1]}}],roadLayer:le[e]}};l.data.data.push({routeId:n.routeId,layerId:""+n.layerId,geometry:n.geometry}),M("polyline",!0,e),setTimeout(function(){var t=z.getLayer({mapId:e,layerId:J});t.getSource().clear()},20),B(de,l,function(a){M("polyline",!1,e);try{var l=JSON.parse(a);if(_.isEmpty(l)||l.message)throw new Error(" the dbclick response of polyline select road mode is error")}catch(s){var d=D(i);return void t(d)}a=JSON.parse(a);var c=G(a,r,o,n);if(o>2){var g=[],u=[],y=_.last(c.selectRoads),p=!1;_.each(c.selectRoads.slice(0,-1),function(e){var t=_.first(e.paths[0]),a=_.last(y.paths[0]);if(p=e.routeId===y.routeId){var r=t.slice(0,-1),o=a.slice(0,-1);u.push(o.concat(t[2]),r.concat(a[2]))}}),g.push({routeId:y.routeId,layerId:y.layerId,points:u}),i=i.concat(c.selectRoads);var d=D(i);t(d)}})}};ne.lineDblClick=s;var d=[],c=new H.interaction.Draw({source:z.getLayer({mapId:e,layerId:J}).getSource(),type:"LineString",geometryFunction:function(a,s){if(d.length<a.length){d=JSON.parse(JSON.stringify(a));var c=P(a[a.length-1],3857);if(r={business:"roadSimulation",data:{action:"start",roadLayer:le[e],data:[]}},1===o)r.data.data.push({routeId:-1,layerId:"-1",geometry:{x:c[0],y:c[1]}});else{r.data.action="execute";var g={routeId:n.routeId,layerId:""+n.layerId,geometry:n.geometry},u={routeId:-1,layerId:"-1",geometry:{x:c[0],y:c[1]}};2===o&&(g.start=!0),r.data.data.push(g),r.data.data.push(u)}B(de,r,function(r){M("polyline",!1,e);try{if(r=JSON.parse(r),_.isEmpty(r)||r.message)throw new Error("polyline response error")}catch(g){r={message:!r||_.isEmpty(r)?"10000002":r.message},t({error:r.message})}if(s||(s=new H.geom.LineString(null)),!r||r.message)a.pop();else{var u=G(r,c,o,n);n=u.preRoadObj,0!==u.selectRoads.length&&i.concat(u.selectRoads),o++;var y=[];2===o?(y=[[r.point.x,r.point.y]],1===y.length&&y.push([y[0][0]+1e-6,y[0][1]+1e-7]),N(l,null,y,ce)):_.each(r.geometries,function(e){N(l,null,e.paths[0],ce)})}d=JSON.parse(JSON.stringify(a))})}return s||(s=new H.geom.LineString(null)),s.setCoordinates(a),s}});c.set("id",Q),a.addInteraction(c),c.setActive(!0)}function c(e,t,a){ye=!1,ue=!1,U=null,O(e,J,[],!0),C(e,t.paths);var r=[t.paths[0],t.paths[t.paths.length-1]];L(e,r);var o=function(r){setTimeout(function(){ie&&k(e,ae)&&k(e,ae).getActive()?b(r,t,a):ie||S(r,t)},260)},n=w(e,ae,"Point",o);n.setActive(!1),E(e);var i=k(e,te);i.setActive(!1),T(e,r)}function g(e){var t=W.getMapObj(e);if(t){var a=[re,ae,te];x(e,a),O(e,J,[],!0),O(e,q,[],!0),z.removeLayer({mapId:e,layerIds:[Z]}),_.each(t.getInteractions().getArray(),function(e){typeof e===H.interaction.DoubleClickZoom&&setTimeout(function(){e.setActive(!0)},100)})}}function u(e,t){if("polygon"===t)x(e,["polygonInter"]);else{delete ne.lineDblClick;var a=k(e,Q);a&&a.getActive()&&(O(e,K,[void 0]),x(e,[Q]))}O(e,J,[],!0),M("polyline",!1,e)}function y(e){O(e,K,[],!0)}function p(e){var t=[J,K,q];z.removeLayer({mapId:e,layerIds:t})}function m(e,t){var a=function(e,a){var r=k(a,Q),o=k(a,"polygonInter");if(!(r&&r.getActive()||o&&o.getActive())){var n=P(e.coordinate,3857),i={};i.business="query",i.data={action:"queryRouteId",roadLayer:le[a],data:[{geometry:{x:n[0],y:n[1]}}]},B(de,i,function(e){try{var a=JSON.parse(e);a&&a.layerId&&t(a)}catch(r){console.log("selRoadOnMap no response!","warn")}})}};oe.sel=a}function f(e,t){B(e,{},function(e){if(null!==e&&""!==e){var a=JSON.parse(e),r=a.fullExtent,o=P([r.xmin,r.ymin],3857),n=P([r.xmax,r.ymax],3857);t([o[0],o[1],n[0],n[1]])}})}function v(e,t){t&&0!==t.length?O(e,K,t):O(e,K,[],!0)}function h(e,t,a){var r=z.getLayer({mapId:e,layerId:K});O(e,K,[t.id]),N(r,t.id,t.vertexes,a)}function I(e,t,a){var r=z.getLayer({mapId:e,layerId:K}),o=r.getSource().getFeatureById(t);o&&o.setStyle(new H.style.Style({stroke:new H.style.Stroke(a)}))}function S(e,t){var a=e.target.getMap(),r=a.getTarget();O(r,J,["clickFeature"]);var o=e.feature.getGeometry().getFirstCoordinate(),n=a.getPixelFromCoordinate(o),i=P(o,3857);ge=i,e.feature.setId("clickFeature");var l=z.getLayer({mapId:r,layerId:J});l.getSource().addFeature(e.feature),k(r,ae).setActive(!1),k(r,te).setActive(!1),a.forEachFeatureAtPixel(n,function(e){var a=e.get("roadNum");if(a||0===a){O(r,J,["spareFeature"]),"start"===U?ue=!1:"end"===U&&(ye=!1),V=e;var o=P(e.getGeometry().getFirstCoordinate(),3857),n=A(t.paths,o,ye),s=ye?n[1].concat([i]):[i].concat(n[1]),d=new H.Feature(new H.geom.MultiLineString([_.map(s,function(e){
return P(e,4326)})]));d.setId("spareFeature"),d.setStyle(new H.style.Style({stroke:new H.style.Stroke(ce)})),l.getSource().addFeature(d)}})}function b(e,t,a){var r=e.target.getMap(),o=r.getTarget(),n=e.feature.getGeometry().getCoordinates(),i=r.getPixelFromCoordinate(n),l=P(n,3857);_.each(r.getInteractions().getArray(),function(e){typeof e===H.interaction.DoubleClickZoom&&e.setActive(!1)});var s=[ae,re,te];x(o,s),r.forEachFeatureAtPixel(i,function(e){var r=e.get("roadNum");if(r||0===r){var n=[];if(ye&&!ue){var i=P(e.getGeometry().getFirstCoordinate(),3857);n=[l].concat(A(t.paths,i,!0)[0])}else if(!ye&&ue){var i=P(e.getGeometry().getFirstCoordinate(),3857);n=A(t.paths,i,!1)[0].concat([l])}else if(ye&&ue){var s=V.get("roadNum");if(s===r)n=[l].concat([ge]);else if(s!==r&&s>r){var d=[l].concat(A(t.paths,P(e.getGeometry().getFirstCoordinate(),3857),!0)[0]);n=A(d,P(V.getGeometry().getFirstCoordinate(),3857),!1)[0].concat([ge])}else if(s!==r&&s<r){var d=A(t.paths,P(e.getGeometry().getFirstCoordinate(),3857),!1)[0].concat([l]);n=[ge].concat(A(d,P(V.getGeometry().getFirstCoordinate(),3857),!0)[0])}}O(o,K,[t.routeId]);var c=parseInt(j(n));n[0][2]||0===n[0][2]||(n[1][2]=n[1][2]?n[1][2]:0,n[0][2]=n[1][2]-Y(n[0],n[1])),n[n.length-1][2]||(n[n.length-1][2]=n[n.length-2][2]-Y(n[n.length-1],n[n.length-2])),a({paths:n,length:c})}}),g(o)}function L(e,t){var a=new H.style.Style({image:new H.style.Circle({radius:5,fill:new H.style.Fill({color:"#FF0000"})})});z.removeLayer({mapId:e,layerIds:[Z]}),z.createLayer({mapId:e,layerId:Z});var r=z.getLayer({mapId:e,layerId:Z}),o=P(t[0],4326),n=P(t[1],4326),i=new H.Feature(new H.geom.Point(o));i.setId("marker_start"),i.setStyle(a);var l=new H.Feature(new H.geom.Point(n));l.setId("marker_end"),l.setStyle(a),r.getSource().addFeatures([i,l])}function T(e,t){var a=W.getMapObj(e),r=z.getLayer({mapId:e,layerId:Z}),o=new H.interaction.Select({layers:[r]});o.set("id","markerInter"),a.addInteraction(o);var n=k(e,ae),i=k(e,te);o.on("select",function(e){if(0!==e.selected.length){var r=e.mapBrowserEvent.pixel,o=a.getPixelFromCoordinate(P(t[0],4326)),l=a.getPixelFromCoordinate(P(t[1],4326)),s=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)),d=Math.sqrt(Math.pow(r[0]-l[0],2)+Math.pow(r[1]-l[1],2));s>10&&d>10||(s<=10&&!n.getActive()?(n.setActive(!0),i.setActive(!0),ye=!0,U="start"):d<=10&&!n.getActive()&&(n.setActive(!0),i.setActive(!0),ue=!0,U="end"))}})}function w(e,t,a,r){var o=W.getMapObj(e),n=z.getLayer({mapId:e,layerId:J}),i=new H.interaction.Draw({source:n.getSource(),type:a});return i.on("drawend",r),i.set("id",t),o.addInteraction(i),i}function E(e){var t=W.getMapObj(e),a=z.getLayer({mapId:e,layerId:J}),r=z.getLayer({mapId:e,layerId:q}),o=new H.interaction.Snap({features:new H.Collection(r.getSource().getFeatures()),pixelTolerance:1e5,source:a.getSource()});o.set("id","snapInter"),t.addInteraction(o)}function C(e,t){var a=F(e,t),r=[];_.each(a,function(e,t){var a=new H.Feature(new H.geom.MultiPoint(e));a.set("roadNum",t),a.setStyle(new H.style.Style({image:new H.style.Circle({radius:.5,fill:new H.style.Fill({color:[0,255,0,1]})})})),r.push(a)});var o=z.getLayer({mapId:e,layerId:q});return o?(o.getSource().clear(),o.getSource().addFeatures(r)):(z.createLayer({mapId:e,layerId:q}),o=z.getLayer({mapId:e,layerId:q}),o.getSource().addFeatures(r),o.setZIndex(510)),a}function k(e,t){for(var a=W.getMapObj(e),r=a.getInteractions().getArray(),o=null,n=0;n<r.length;n++)if(r[n].get("id")===t){o=r[n];break}return o}function x(e,t){for(var a=W.getMapObj(e),r=0;r<t.length;r++){var o=k(e,t[r]);a.removeInteraction(o)}}function P(e,t){var a=3857===t?4326:3857;return H.proj.transform([e[0],e[1]],"EPSG:"+t,"EPSG:"+a)}function O(e,t,a,r){var o=z.getLayer({mapId:e,layerId:t});if(o){var n=o.getSource();r?n&&n.clear():n&&n.forEachFeature(function(e){a.forEach(function(t){t===e.getId()&&n.removeFeature(e)})})}}function M(e,t,a){function r(){var e=$("#"+a),t=e.width(),r=e.height(),o='<div style="width:'+t+"px;height:"+r+'px;position:fixed;z-index:1000" id="roadMask"></div>';e.before(o)}function o(){$("#roadMask").remove()}if("polygon"===e)t?$("#geoLoading").removeClass("hide").addClass("show"):$("#geoLoading").removeClass("show").addClass("hide");else{var n=$("#"+a),i=n.attr("style")||"";i.indexOf("cursor")>=0?(i=t?i.replace("default","wait"):i.replace("wait","default"),t?r():o()):(i+=t?"cursor:wait":"cursor:default",t?r():o()),n.attr("style",i)}}function N(e,t,a,r){var o=_.map(a,function(e){return H.proj.transform([e[0],e[1]],"EPSG:4326","EPSG:3857")}),n=new H.Feature({geometry:new H.geom.MultiLineString([o])});t&&n.setId(t),n.setStyle(new H.style.Style({stroke:new H.style.Stroke(r)})),e.getSource().addFeature(n)}function F(e,t){for(var a=W.getMapObj(e),r=1,o=[],n=function(e,t,a){var r=t[0],o=t[1],n=a[0],i=a[1];return(r-n)*e/(o-i)+(n*o-r*i)/(o-i)},i=function(e,t,a){var r=t[0],o=t[1],n=a[0],i=a[1];return(o-i)*e/(r-n)+(r*i-n*o)/(r-n)},l=0;l<t.length-1;l++){var s=a.getPixelFromCoordinate(H.proj.transform(t[l],"EPSG:4326","EPSG:3857")),d=a.getPixelFromCoordinate(H.proj.transform(t[l+1],"EPSG:4326","EPSG:3857")),c=Math.abs(s[0]-d[0])>Math.abs(s[1]-d[1]);if(o[l]=[],c){var g=!(s[0]>d[0]);if(g)for(var u=s[0];u<=d[0];u+=r)o[l].push(a.getCoordinateFromPixel([u,i(u,s,d)]));else for(var u=s[0];u>=d[0];u-=r)o[l].push(a.getCoordinateFromPixel([u,i(u,s,d)]))}else{var y=!(s[1]>d[1]);if(y)for(var p=s[1];p<=d[1];p+=r)o[l].push(a.getCoordinateFromPixel([n(p,s,d),p]));else for(var p=s[1];p>=d[1];p-=r)o[l].push(a.getCoordinateFromPixel([n(p,s,d),p]))}}return o}function A(e,t,a){for(var r=0,o=0;o<e.length;o++)if(Math.abs(t[0]-e[o][0])<1e-4&&Math.abs(t[1]-e[o][1])<1e-5){r=o;break}return tempArr1=e.slice(0,r+1),tempArr2=e.slice(r+1,e.length),[a?tempArr2:tempArr1,a?tempArr1:tempArr2]}function R(e,t,a){var r=new H.geom.LineString([H.proj.transform(e,"EPSG:4326","EPSG:3857"),H.proj.transform([t[0],t[1]],"EPSG:4326","EPSG:3857")]).getLength(),o=new H.geom.LineString([H.proj.transform(e,"EPSG:4326","EPSG:3857"),H.proj.transform([a[0],a[1]],"EPSG:4326","EPSG:3857")]).getLength();return r>o?a:t}function G(e,t,a,r){var o=JSON.parse(JSON.stringify(r)),n=[];if(e&&!e.message){1===a?e={geometries:[{paths:[[[e.point.x,e.point.y,e.point.m]]],routeId:e.routeId,layerId:e.layerId,length:0}]}:_.each(e.geometries,function(e){n.push(e)});var i,l;return 1!==e.geometries.length?(i=e.geometries[0].routeId===o.routeId?_.last(e.geometries):_.first(e.geometries),l=R(t,_.first(i.paths[0]),_.last(i.paths[0]))):(i=_.first(e.geometries),l=_.isEmpty(o)?R(t,_.first(i.paths[0]),_.last(i.paths[0])):o.geometry.x===_.last(i.paths[0])[0]||o.geometry.y===_.last(i.paths[0])[1]?_.first(i.paths[0]):_.last(i.paths[0])),o={routeId:i.routeId,layerId:i.layerId,geometry:{x:l[0],y:l[1],m:parseInt(l[2])}},{selectRoads:n,preRoadObj:o}}}function D(e){var t=_.groupBy(e,function(e){return e.routeId}),a=_.map(t,function(e){for(var t=1;t<e.length;t++)e[0].paths[0]=e[0].paths[0].concat(e[t].paths[0]);e[0].paths[0]=_.sortBy(e[0].paths[0],function(e){return e[2]}),e[0].paths[0]=_.uniq(e[0].paths[0],function(e){return e[2]});var a=e[0].paths[0].length;return e[0].length=parseInt(e[0].paths[0][a-1][2]-e[0].paths[0][0][2]),e[0]});return a}function j(e){var t=0;e=_.uniq(e);for(var a=0;a<e.length;a++)a<=e.length-2&&(t+=new H.Sphere(6378137).haversineDistance([e[a][0],e[a][1]],[e[a+1][0],e[a+1][1]]));return t}function Y(e,t){var a=[e[0],e[1]],r=[t[0],t[1]],o=new H.Sphere(6378137).haversineDistance(a,r);return o}function B(e,t,a,r){function o(e){var t=document.createElement("div");t.innerHTML=e;var a=t.innerText||t.textContent;return t=null,a}if(se==={})return void console.error("no domain setting. Please execute crossDomainHandshake first.");var n;e="/CosmosGISMaster"+e,n=new XMLHttpRequest,n.open("POST",e,!0),n.setRequestHeader(se.name,se.value),n.send(JSON.stringify(t)),n.onreadystatechange=function(){4===n.readyState&&200===n.status?a(o(n.responseText)):4===n.readyState&&console.error(e+" response error")}}var U,V,H=a(3),W=a(6),z=(a(4),a(5)),J="interLayer",K="highlightLayer",Z="editMarkerLayer",q="pixPointsLayer",X="route",Q="polylineInter",ee="polygonInter",te="snapInter",ae="editInter",re="markerInter",oe={},ne={},ie=!1,le={},se={},de="/roadTestServlet",ce={color:"#0000FF",width:2},ge=[],ue=!1,ye=!1;e.exports={initRoadMgt:r,chooseRoads:n,editRoads:c,setRoadLayers:l,editCancel:g,changeLineStyle:I,drawRouteLine:h,initRoadParams:i,chooseRoadCancel:u,removeRoadDataOnMap:y,removeRoadInRoadMgt:p,selRoadOnMap:m,setWMSExtent:f,removeFeatureDataByIdList:v}},function(e,t,a){var r=a(3),o=a(4),n=a(7),i=(a(1),a(5)),l=(a(6),new Map,n.GisResourceURL+"marker/"),s=function(e){var t=e.layerId+"_"+e.mapId,a=e.clusterStyle||{},s=a.fontColor||"#ffffff",d=a.distance||50;void 0===e.isClusterVariableSize&&(e.isClusterVariableSize=!1),e.distance=d;var c=function(e,t){var a=null,o=e.get("features"),i=o[0].get("data"),d=o.length;a=i&&i.imageName?l+i.imageName:n.GisResourceURL+"marker/ne_default.png";var c=0;return c=i.rotation?i.rotation:0,d>1?[new r.style.Style({image:new r.style.Icon({src:n.GisResourceURL+"marker/ne_default.png",rotation:c,opacity:i.opacity||1,anchor:void 0!=i.anchor?i.anchor:[0,0]}),text:new r.style.Text({scale:1.5,text:d.toString(),fill:new r.style.Fill({color:s}),stroke:new r.style.Stroke({width:3,color:"black"})})})]:[new r.style.Style({image:new r.style.Icon({src:a,rotation:c,opacity:i.opacity||1,anchor:void 0!=i.anchor?i.anchor:[0,0]}),text:new r.style.Text({text:(void 0!=i.label?i.label:"")+""})})]},g=null;o.containsKey(t)?g=o.get(t):(i.createLayer(e),g=o.get(t)),g.setZIndex(n.Z_INDEX.MARKER),g.setStyle(c),g.set("businessType","ICON_CLUSTER"),g.set("params.label",e.label?e.label:e.layerId),g.set("state.showLabel",!!e.showLabel),g.set("layerId",t),g.set("layer_id",e.layerId),g.set("legendName",e.legendName),void 0!=e.minShowLevel&&g.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&g.set("maxShowLevel",parseInt(e.maxShowLevel))},d=function(e){var t=e.layerId+"_"+e.mapId,a=e.datas,i=o.get(t),s=null,d=void 0===e.isCluster||e.isCluster;if(i&&(i.set("legendName",e.legendName),e.label&&i.set("params.label",e.label),s=d===!0?i.getSource().getSource():i.getSource()),e.imgPath&&(l=e.imgPath),a){var c=[];a.forEach(function(e){var t=null,a=e.coordinate,o=r.proj.fromLonLat(a),i=new r.geom.Point(o),s=new r.Feature({geometry:i,businessType:n.BUSINESSTYPE.ICON,data:e});t=e.imageName?l+e.imageName:n.GisResourceURL+"marker/ne_default.png";var d=0;d=e.rotation?e.rotation:0,s.setId(e.id),c.push(s)}),s.addFeatures(c),i.set("legendName",e.legendName)}};e.exports={addLayer:s,setLayerData:d}},function(e,t,a){var r=a(3),o=a(7),n=a(4),i=a(6),l=function(e){var t=e.layerId+"_"+e.mapId,a=null,l=i.getMapObj(e.mapId);return e.singleTitle?(a=new r.layer.Image({source:new r.source.ImageWMS({ratio:e.ratio,url:e.url,params:e.params})}),a.set("type",o.CUSTOMTYPE.LAYERIMGTYPE),a.set("businessType",o.CUSTOMTYPE.LAYERIMGTYPE)):(a=new r.layer.Tile({source:new r.source.TileWMS({url:e.url,params:e.params,wrapX:!1})}),a.set("type",o.CUSTOMTYPE.LAYERTILETYPE),a.set("businessType",o.CUSTOMTYPE.LAYERTILETYPE)),a.set("layerId",t),a.set("layer_id",e.layer_id),void 0!=e.minShowLevel&&a.set("minShowLevel",parseInt(e.minShowLevel)),void 0!=e.maxShowLevel&&a.set("maxShowLevel",parseInt(e.maxShowLevel)),n.put(t,a),l.addLayer(a),a};e.exports={createWmsLayer:l}},function(e,t,a){function r(e,t){var a=h.getMapObj(e),r=t.layerId+"_"+t.mapId,o=new v.layer.Image({layerName:t.layerId,defaultVisibleLevel:t.defaultVisibleLevel,source:new v.source.ImageWMS({wrapX:!1})});o.set("layerId",r),o.set("layer_id",t.layerId),o.set("businessType","SERVICELAYER"),o.set("serviceLayerType",t.layerType),a.addLayer(o),I.put(r,o)}function o(e,t,a){var r={FORMAT:"png",VERSION:"1.1.1",F:"image",BBOXSR:3857,IMAGESR:3857};for(var o in a)"url"!==o&&"roadtype"!==o&&(r[o]=a[o]);var n=S.getLayer({mapId:e,layerId:t}),i=new v.source.ImageWMS({url:a.url,params:r,wrapX:!1});n.set("layerData",a),n.setSource(i)}function n(e,t,a,r){L[t]=r;var o={mapId:e,layerId:t,callbackfunc:s};S.registerClick(o)}function i(e,t,a,r){var o=t.get("layerName"),n=v.proj.transform(a.coordinate,"EPSG:3857","EPSG:4326"),i=e.getTarget(),l=JSON.stringify({x:a.coordinate[0],y:a.coordinate[1]}),s=e.getView().calculateExtent(e.getSize()).join(","),c={geometry:l,tolerance:1,mapExtent:s,imgToken:t.get("layerData").imgToken};d(L[o],c,"GET",function(e){if(e=JSON.parse(e),e&&e.results&&e.results.length>0){var t=[];e.results.forEach(function(e){var a=v.proj.fromLonLat([Number(e.attributes.CENTERPOINTLON),Number(e.attributes.CENTERPOINTLAT)]);e.attributes.CENTERPOINTLON=a[0],e.attributes.CENTERPOINTLAT=a[1];var r={layerId:o,mapId:i,geoId:e.attributes.WORSTAREAID,layerType:"WORSTAREA",lonLat:n,pixLonLat:n,featureName:e.attributes&&e.attributes.WORSTAREANAME,dataType:"LTE",label:"",jsonData:e.geometry,orignData:e.attributes};t.push(r)}),r(t)}else r([{layerId:o}])},function(){r([{layerId:o}])})}function l(e,t,a,r){var o=e.getTarget(),n=t.get("layerName"),i=v.proj.transform(a.coordinate,"EPSG:3857","EPSG:4326"),l={x:i[0],y:i[1]},s=(e.getView().calculateExtent(e.getSize()).join(","),t.get("layerData")),c={subject:{param:{},formatter:{date:"yyyy-MM-dd"}},services:[{name:"railwayInfo",param:{roadtype:s.roadtype,imgToken:s.imgToken,geometry:l}}]},g={layerId:n};d(L[n],c,"POST",function(e){if(e=JSON.parse(e),e&&e.data&&e.data.railwayInfo&&e.data.railwayInfo.geometries){var a=[];e.data.railwayInfo.geometries.forEach(function(e,t){a[t]=[],e.paths[0].forEach(function(e){a[t].push([e[0],e[1]])})}),g=[{layerId:n,mapId:o,layerType:t.get("serviceLayerType"),geoId:e.data.railwayInfo.geometries[0].layerId,lonLat:i,pixLonLat:i,jsonData:a,originData:e.data.railwayInfo.properties,featureName:"Railway"}],r(g)}else r([g])},function(){_base.log("grid clickFun error!"),r([g])})}function s(e,t,a,r){"RAILWAY"===t.get("serviceLayerType")?l(e,t,a,r):"WORSTAREA"===t.get("serviceLayerType")&&i(e,t,a,r)}function d(e,t,a,r,o){function n(e){var t=document.createElement("div");t.innerHTML=e;var a=t.innerText||t.textContent;return t=null,a}if(""===$g.cosMosGisMasterCsrfHeader)return void console.error("no domain setting. Please execute crossDomainHandshake first.");var i;if(e=T+e,i=new XMLHttpRequest,"POST"===a)i.open(a,e,!0),i.setRequestHeader($g.cosMosGisMasterCsrfHeader,$g.cosMosGisMasterCsrfToken),i.send(JSON.stringify(t));else{var l=c(t);i.open(a,e+l,!0),i.setRequestHeader($g.cosMosGisMasterCsrfHeader,$g.cosMosGisMasterCsrfToken),i.send("")}i.onreadystatechange=function(){4===i.readyState&&200===i.status?r(n(i.responseText)):4===i.readyState&&console.error(e+" response error")}}function c(e){var t=[];for(var a in e){var r=e[a];if(null!==r&&"function"!=typeof r){var o;if("object"==typeof r&&r.constructor===Array){for(var n,i=[],l=0,s=r.length;l<s;l++)n=r[l],i.push(encodeURIComponent(null===n||void 0===n?"":n));o=i.join(",")}else o=encodeURIComponent(r);t.push(encodeURIComponent(a)+"="+o)}}return t.join("&")}function g(e,t,a){y(a,function(a){var r=b.getHLayer({mapId:e,layerId:t}),o=new v.Feature({geometry:new v.geom.Polygon(a.rings)});o.setStyle(new v.style.Style({fill:new v.style.Fill({color:[0,0,0,0]}),stroke:new v.style.Stroke({width:2,color:[0,0,0,1]})})),o.setId("serviceLayer_"+t),r.getSource().addFeature(o)})}function u(e,t,a){var r=a.width||3,o=a.strokeColor||"rgba(255,255,255,0.9)",n=new v.style.Style({stroke:new v.style.Stroke({color:o,width:r})});p(a,function(a){if(null!==a){var r=b.getHLayer({mapId:e,layerId:t}),o=new v.Feature({geometry:new v.geom.MultiLineString(a.jsonData).transform("EPSG:4326","EPSG:3857"),mapId:e,layerName:t});o.setStyle(n),o.setId("serviceLayer_"+t),r.getSource().addFeature(o)}})}function y(e,t){var a;a="UMTS"===e.dataType?"/worstArea/_img_get/services/DisCoverGeo/UWorstArea/MapServer/0/query?where=WORSTAREAID in ("+e.featureId+")&date="+e.date:"LTE"===e.dataType?"/worstArea/_img_get/services/DisCoverGeo/LWorstArea/MapServer/0/query?where=WORSTAREAID in ("+e.featureId+")&date="+e.date:"/worstArea/_img_get/services/DisCoverGeo/GWorstArea/MapServer/0/query?where=WORSTAREAID in ("+e.featureId+")&date="+e.date,d(a,{},"GET",function(e){var a=JSON.parse(e);if("{}"===e||a.error||a.data&&0===a.data.features.length)t(null);else{var r=a.data.features[0].geometry;t(r)}})}function p(e,t){var a="/railwayMgr.do?",r={subject:{param:{},formatter:{date:"yyyy-MM-dd"}},services:[{name:"railwayByDimension",param:e.featureIds}]};d(a,r,"POST",function(a){var r=JSON.parse(a);if(r&&r.data&&r.data.railwayByDimension.geometries){var o=[];r.data.railwayByDimension.geometries.forEach(function(e,t){o[t]=[],e.paths[0].forEach(function(e){o[t].push([e[0],e[1]])})});var n={layerName:e.layerName,layerType:e.layerType,label:e.label,jsonData:o,originData:r,persistHighLightFlag:e.persistHighLightFlag};t(n)}else t(null)},function(e){_base.log(e)})}function m(e,t,a){var r=S.getLayer({mapId:e,layerId:t}).get("serviceLayerType");"WORSTAREA"===r?g(e,t,a):"RAILWAY"===r&&u(e,t,a)}function f(e,t){var a=b.getHLayer({mapId:e,layerId:t}),r=a.getSource().getFeatureById("serviceLayer_"+t);a&&a.getSource()&&r&&a.getSource().removeFeature(r)}var v=a(3),h=a(6),I=a(4),S=a(5),b=a(43),L={},T="/CosmosGISMaster";e.exports={addLayer:r,setData:o,registerEvent:n,highlight:m,removeHighlight:f,getServiceLayerInfo:s}},function(e,t,a){function r(e){var t=n.createDom({tagName:"div",attributes:{"class":"filter_feature_head_class",style:"width: 400px; height: 24px; line-height: 24px; text-indent: 8px; color: #388E8E;border-bottom-style: solid; border-bottom-color: #EBEBEB;border-bottom-width: 1px;"},text:g});e.appendChild(t);var a=n.createDom({tagName:"div",attributes:{title:u,style:"width: 16px; height: 16px;line-height: 16px;text-align: center; background: #388E8E; color: white; position: absolute;top: 4px; right: 4px;cursor: pointer;text-indent: 0px;"},text:"X"});s.add(a,"click",function(){e.style.display="none"}),t.appendChild(a)}function o(e,t){var a=l.get(e.mapId),r=function(){for(var e=[],t=a.getLayers().getArray(),r=0;r<t.length;r++)void 0!=t[r].get("businessType")&&(void 0!=t[r].get("params.label")?e.push(t[r].get("params.label")+"|"+t[r].get("layer_id")):e.push(t[r].get("layer_id")+"|"+t[r].get("layer_id")));return e}(),o=n.createDom({tagName:"div",attributes:{"class":"layerlist"}}),c=n.createDom({tagName:"select",attributes:{name:"filter_layer_id","class":"filter_layer_id"}}),g=n.createDom({tagName:"option",attributes:{value:"blank_layerid",selected:!0},text:y});c.appendChild(g),r.forEach(function(t){var a=t.split("|")[1],r=d.getLayer({layerId:a,mapId:e.mapId});if(void 0==r||r.get("businessType")!=i.BUSINESSTYPE.GRID){var o=t.split("|")[0],l=n.createDom({tagName:"option",attributes:{value:o,title:o,id:a},text:o&&o.length>30?o.substring(0,30)+"...":o});c.appendChild(l)}}),o.appendChild(c);var u=n.createDom({tagName:"div",attributes:{"class":"drawPolygon"}});t.appendChild(o),t.appendChild(u);var p=a.getTargetElement().querySelector(".filter_layer_id");s.add(p,"change",function(){var e=p.selectedOptions[0].id;l.put("layerId_by_polygon_filter",e)}),s.add(u,"click",function(){var a={mapId:e.mapId,type:"Polygon",isOpen:!0,fillColor:"rgba(0, 191, 255, 0.76)",endCallback:function(t){var a=e.mapId,r=l.get("layerId_by_polygon_filter"),o=function(){var t=l.get(r+"_"+e.mapId);return t&&t.get("imagToken")?t.get("imgToken"):void 0}(),n=t.coordinates;void 0!=e.callback&&"function"==typeof e.callback&&e.callback({mapId:a,layerId:r,imgToken:o,coordinates:n}),l.put("layerId_by_polygon_filter",void 0)}};void 0!=l.get("layerId_by_polygon_filter")&&(console.warn("please select the layer"),fusiongis.Geometry.drawGeometry(a)),t.style.display="none"})}var n=a(10),i=a(7),l=a(4),s=a(62),d=a(41),c=a(13),g=c.prop("filterFeature.wind.head.title"),u=c.prop("filterFeature.wind.close.title"),y=(c.prop("filterFeature.body.layerId"),c.prop("featureFilter.layerTypeSel")),p=function(e){l.put("layerId_by_polygon_filter",void 0);var t=l.get(e.mapId).getTargetElement(),a=t.querySelector(".filter_feature_by_polygon_window");a&&t.removeChild(a);var i=n.createDom({tagName:"div",attributes:{"class":"filter_feature_by_polygon_window"}});t.appendChild(i),r(i),o(e,i)};e.exports={filterFeatureUI:p}},function(e,t,a){function r(e){var t=e.layerId,a=e.mapId,r=e.coordinates,l=null,s=u.getLayer({mapId:a,layerId:t});if(s){var d=s.get("imgToken")?s.get("imgToken"):s.get("params.imgToken");if(!s.getVisible())return;if(d)l=1,o(d,r,function(e){var r=s.get("businessType"),o=e.data,n={mapId:a,layerId:t,resultData:o,layerType:r,layerCategory:l,layer:s};i(n)});else{l=0;var c=s.get("businessType"),g={layer:s,polygonCoords:r,layerType:c};n(g,function(e){var r={mapId:a,layerId:t,resultData:e,layerType:c,layerCategory:l,layer:s};i(r)})}}}function o(e,t,a){var r=a,o=y.translateVertexToWKT([t]);c.postJSON({url:g.GisRootUrl+"/mapRender/contains",data:JSON.stringify({polygon:o,imgToken:e}),success:function(e){var t=JSON.parse(e),a=t.status;1===a.code&&r(t)},failure:function(e){r({msg:e})}})}function n(e,t){var a=e.layer,r=a.getSource().getFeatures(),t=t,o=[],n=e.layerType,i=e.polygonCoords,s=[];if(i.length>0)for(var d=0;d<i.length;d++){var c=m.proj.fromLonLat(i[d]);s.push(c)}if(r.length>0){for(var u=0;u<r.length;u++){var y=r[u].getGeometry(),p=null;if(n==g.BUSINESSTYPE.VECTOR_CELL){if(r[u].get("data")){var f=r[u].get("data"),v=f.angle;if(360===v)for(var h=y.getGeometries(),d=0;d<h.length;d++){var I=h[d];d===h.length-1&&I&&(p=I.getCoordinates())}else p=y.getCoordinates()}}else p=y.getCoordinates();var S=r[u].getId()?r[u].getId():r[u].get("id");o.push({id:S,geometry:p})}var b=l(s,o,e.layerType);t(b)}}function i(e){var t=null,a=e.layer,r={mapId:e.mapId,layerId:e.layerId,layerType:e.layerType,layerCategory:e.layerCategory,olLayer:a};t=e.resultData.map(function(t){var a=null;if(e.layerType==g.BUSINESSTYPE.CELL){var o=null;o=$.isArray(t.geometry)?t.geometry:JSON.parse(t.geometry),a=o}else if(e.layerType==g.BUSINESSTYPE.GRID){var n,i,l=t.geometry,s=50,c=[];i=t.centerPoint[0]-s/2,n=t.centerPoint[0]+s/2,c.push([i,l[1]]),c.push([n,l[1]]),c.push([n,l[3]]),c.push([i,l[3]]),a=c}else a=t;return r.data=a,d(r)});var o=p.getHLayer({mapId:e.mapId,layerId:e.layerId});o.getSource().addFeatures(t)}function l(e,t,a){var r=[],o=[];if(t.length>0){for(var n=0;n<t.length;n++){var i=0,l=t[n].geometry,s=t[n].id;if(o=a==g.BUSINESSTYPE.POLYGON||a==g.BUSINESSTYPE.VECTOR_CELL?l[0]:l,a==g.BUSINESSTYPE.POINT){var d=turf.point(o),c=turf.polygon([e]),u=turf.inside(d,c);u&&r.push({id:s,geometry:o})}else{for(var y=0;y<o.length;y++){var p=o[y],d=turf.point(p),c=turf.polygon([e]),u=turf.inside(d,c);u&&i++}i===o.length&&r.push({id:s,geometry:o})}}return r}}function s(e){var t=e.olLayer;if(t){var a=e.data.id,r=t.getSource().getFeatureById(a);if(r){var o=r.clone();return o.setStyle(e.style),o}}}function d(e){var t=null,a=null,r=null,o=new m.style.Style({stroke:new m.style.Stroke({width:2,color:"black"})}),n=new m.style.Style({image:new m.style.Circle({stroke:new m.style.Stroke({width:2,color:"black"}),radius:5})}),i=e.layerType;a=i==g.BUSINESSTYPE.GRID?e.data:e.data.geometry;var l=null;switch(i){case g.BUSINESSTYPE.SERVICEPOINT:l=new m.geom.Point(a[0]),r=n;break;case g.BUSINESSTYPE.SERVICELINE:l=new m.geom.LineString(a),r=o;break;case g.BUSINESSTYPE.SERVICEPOLYGON:l=new m.geom.Polygon([a]),r=o;break;case g.BUSINESSTYPE.POINT:r=n;break;case g.BUSINESSTYPE.LINE:r=o;break;case g.BUSINESSTYPE.STRAIGHTLINE:r=o;break;case g.BUSINESSTYPE.POLYGON:r=o;break;case g.BUSINESSTYPE.CELL:l=new m.geom.Polygon([a]),r=o;break;case g.BUSINESSTYPE.VECTOR_CELL:r=o;break;case g.BUSINESSTYPE.SITE:l=new m.geom.Point(a),r=n;break;case g.BUSINESSTYPE.GRID:l=new m.geom.Polygon([a]),r=o}if(0===e.layerCategory){var d={data:e.data,olLayer:e.olLayer,style:r};t=s(d)}else t=new m.Feature({geometry:l,mapId:e.mapId,layerId:e.layerId,layerType:e.layerType}),t.setStyle(r);return t}var c=a(14),g=a(7),u=(a(6),a(41)),y=a(1),g=a(7),p=a(43),m=a(3);e.exports={layerFilterHighlight:r}},function(e,t,a){var r=a(3),o=a(10),n=a(6),i=(a(1),[]),l="popup_as_circle_label",s=function(e){if(void 0!=e.position){var t=e.mapId,a=n.getMapObj(t),s=e.content,d=r.proj.fromLonLat(e.position),c=e.labelId,g=o.createDom({tagName:"div",attributes:{"class":"circle-label-container"}}),u=o.createDom({tagName:"div"});s&&("string"==typeof s?u.innerHTML=s:"object"==typeof s&&u.appendChild(s)),g.appendChild(u),document.body.appendChild(g);var y=new r.Overlay({element:g,position:d});return y.set("mapId",t),y.set("type",l),y.set("id",c),y.setMap(a),i.push(y),y}},d=function(e,t){var a=n.getMapObj(e);if(i&&i.length>0)for(var r=0;r<i.length;r++){var o=i[r];if(void 0!=o&&o.mapId===e&&o.get("type")==l){if(void 0!=t){if(o.get("id")==t){a.removeOverlay(o);break}}else a.removeOverlay(o);i.splice(index,1)}}};e.exports={addCircleLabel:s,removeCircleLabel:d}}]);